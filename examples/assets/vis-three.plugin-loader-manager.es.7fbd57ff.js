import{q as Z,o as N,I as He,J as Fe,K as Ke,k as we,l as ue,X as lt,Y as ut,Z as st,_ as ht,$ as tn,b as Dt,M as bt,a0 as Be,a1 as ns,a2 as Ne,V as Ht,a3 as ur,a4 as mn,a5 as re,a6 as hr,H as Tt,F as Qt,e as vt,x as ss,d as Xe,a7 as rs,P as nn,a8 as is,a9 as rt,aa as Pe,a as Cn,ab as fr,ac as pr,Q as it,N as Ar,ad as dr,ae as Br,af as mr,ag as gn,C as sn,ah as Cr,ai as os,aj as gr,ak as Fr,al as Er,am as yr,an as Pt,ao as Mr,ap as pt,aq as as,ar as Tr,as as cs,L as ls,at as vr,h as us,au as de,O as hs,av as fs,aw as rn,ax as ps,ay as As,E as on,v as wt,w as K,az as ds,G as Ot,aA as Ir,aB as Rr,aC as jt,aD as Gr,aE as Dr,aF as wr,A as Lr,aG as Sr,aH as xr,aI as ot,aJ as Hn,aK as br,R as Bs,aL as Hr,aM as Pr,aN as Or,aO as _r,aP as ms,aQ as Cs,aR as Ur,aS as Jr,aT as gs,aU as kr,aV as Kr,aW as Pn,aX as Nr}from"./three.837c9bb0.js";import{t as Xr,b as jr}from"./index.7d48aff8.js";const Qr=/^[og]\s*(.+)?/,Vr=/^mtllib /,Yr=/^usemtl /,Zr=/^usemap /,On=new Z,Vt=new Z,_n=new Z,Un=new Z,ce=new Z,It=new N;function Wr(){const o={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:i!==void 0?i.smooth:this.smooth,groupStart:i!==void 0?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,r=this.object.geometry.normals;On.fromArray(s,e),Vt.fromArray(s,t),_n.fromArray(s,n),ce.subVectors(_n,Vt),Un.subVectors(On,Vt),ce.cross(Un),ce.normalize(),r.push(ce.x,ce.y,ce.z),r.push(ce.x,ce.y,ce.z),r.push(ce.x,ce.y,ce.z)},addColor:function(e,t,n){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&r.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,r,i,a,c,l){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(n,h);if(this.addVertex(u,f,p),this.addColor(u,f,p),a!==void 0&&a!==""){const A=this.normals.length;u=this.parseNormalIndex(a,A),f=this.parseNormalIndex(c,A),p=this.parseNormalIndex(l,A),this.addNormal(u,f,p)}else this.addFaceNormal(u,f,p);if(s!==void 0&&s!==""){const A=this.uvs.length;u=this.parseUVIndex(s,A),f=this.parseUVIndex(r,A),p=this.parseUVIndex(i,A),this.addUV(u,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let r=0,i=e.length;r<i;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,i=t.length;r<i;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return o.startObject("",!1),o}class zr extends He{constructor(e){super(e),this.materials=null}load(e,t,n,s){const r=this,i=new Fe(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(a){try{t(r.parse(a))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Wr;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let s="",r="",i=0,a=[];const c=typeof"".trimLeft=="function";for(let u=0,f=n.length;u<f;u++)if(s=n[u],s=c?s.trimLeft():s.trim(),i=s.length,i!==0&&(r=s.charAt(0),r!=="#"))if(r==="v"){const p=s.split(/\s+/);switch(p[0]){case"v":t.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7?(It.setRGB(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6])).convertSRGBToLinear(),t.colors.push(It.r,It.g,It.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":t.uvs.push(parseFloat(p[1]),parseFloat(p[2]));break}}else if(r==="f"){const A=s.slice(1).trim().split(/\s+/),B=[];for(let C=0,g=A.length;C<g;C++){const d=A[C];if(d.length>0){const F=d.split("/");B.push(F)}}const m=B[0];for(let C=1,g=B.length-1;C<g;C++){const d=B[C],F=B[C+1];t.addFace(m[0],d[0],F[0],m[1],d[1],F[1],m[2],d[2],F[2])}}else if(r==="l"){const p=s.substring(1).trim().split(" ");let A=[];const B=[];if(s.indexOf("/")===-1)A=p;else for(let m=0,C=p.length;m<C;m++){const g=p[m].split("/");g[0]!==""&&A.push(g[0]),g[1]!==""&&B.push(g[1])}t.addLineGeometry(A,B)}else if(r==="p"){const A=s.slice(1).trim().split(" ");t.addPointGeometry(A)}else if((a=Qr.exec(s))!==null){const p=(" "+a[0].slice(1).trim()).slice(1);t.startObject(p)}else if(Yr.test(s))t.object.startMaterial(s.substring(7).trim(),t.materialLibraries);else if(Vr.test(s))t.materialLibraries.push(s.substring(7).trim());else if(Zr.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(r==="s"){if(a=s.split(" "),a.length>1){const A=a[1].trim().toLowerCase();t.object.smooth=A!=="0"&&A!=="off"}else t.object.smooth=!0;const p=t.object.currentMaterial();p&&(p.smooth=t.object.smooth)}else{if(s==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}t.finalize();const l=new Ke;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let u=0,f=t.objects.length;u<f;u++){const p=t.objects[u],A=p.geometry,B=p.materials,m=A.type==="Line",C=A.type==="Points";let g=!1;if(A.vertices.length===0)continue;const d=new we;d.setAttribute("position",new ue(A.vertices,3)),A.normals.length>0&&d.setAttribute("normal",new ue(A.normals,3)),A.colors.length>0&&(g=!0,d.setAttribute("color",new ue(A.colors,3))),A.hasUVIndices===!0&&d.setAttribute("uv",new ue(A.uvs,2));const F=[];for(let y=0,M=B.length;y<M;y++){const E=B[y],I=E.name+"_"+E.smooth+"_"+g;let T=t.materials[I];if(this.materials!==null){if(T=this.materials.create(E.name),m&&T&&!(T instanceof lt)){const R=new lt;ut.prototype.copy.call(R,T),R.color.copy(T.color),T=R}else if(C&&T&&!(T instanceof st)){const R=new st({size:10,sizeAttenuation:!1});ut.prototype.copy.call(R,T),R.color.copy(T.color),R.map=T.map,T=R}}T===void 0&&(m?T=new lt:C?T=new st({size:1,sizeAttenuation:!1}):T=new ht,T.name=E.name,T.flatShading=!E.smooth,T.vertexColors=g,t.materials[I]=T),F.push(T)}let v;if(F.length>1){for(let y=0,M=B.length;y<M;y++){const E=B[y];d.addGroup(E.groupStart,E.groupCount,y)}m?v=new tn(d,F):C?v=new Dt(d,F):v=new bt(d,F)}else m?v=new tn(d,F[0]):C?v=new Dt(d,F[0]):v=new bt(d,F[0]);v.name=p.name,l.add(v)}else if(t.vertices.length>0){const u=new st({size:1,sizeAttenuation:!1}),f=new we;f.setAttribute("position",new ue(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(f.setAttribute("color",new ue(t.colors,3)),u.vertexColors=!0);const p=new Dt(f,u);l.add(p)}return l}}class qr extends He{constructor(e){super(e)}load(e,t,n,s){const r=this,i=this.path===""?Be.extractUrlBase(e):this.path,a=new Fe(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(r.parse(c,i))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let s={};const r=/\s+/,i={};for(let c=0;c<n.length;c++){let l=n[c];if(l=l.trim(),l.length===0||l.charAt(0)==="#")continue;const h=l.indexOf(" ");let u=h>=0?l.substring(0,h):l;u=u.toLowerCase();let f=h>=0?l.substring(h+1):"";if(f=f.trim(),u==="newmtl")s={name:f},i[f]=s;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=f.split(r,3);s[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[u]=f}const a=new $r(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(i),a}}class $r{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:ns,this.wrap=this.options.wrap!==void 0?this.options.wrap:Ne}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const s=e[n],r={};t[n]=r;for(const i in s){let a=!0,c=s[i];const l=i.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(a=!1);break}a&&(r[l]=c)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],s={name:e,side:this.side};function r(a,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:a+c}function i(a,c){if(s[a])return;const l=t.getTextureParams(c,s),h=t.loadTexture(r(t.baseUrl,l.url));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(h.encoding=re),s[a]=h}for(const a in n){const c=n[a];let l;if(c!=="")switch(a.toLowerCase()){case"kd":s.color=new N().fromArray(c).convertSRGBToLinear();break;case"ks":s.specular=new N().fromArray(c).convertSRGBToLinear();break;case"ke":s.emissive=new N().fromArray(c).convertSRGBToLinear();break;case"map_kd":i("map",c);break;case"map_ks":i("specularMap",c);break;case"map_ke":i("emissiveMap",c);break;case"norm":i("normalMap",c);break;case"map_bump":case"bump":i("bumpMap",c);break;case"map_d":i("alphaMap",c),s.transparent=!0;break;case"ns":s.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(s.opacity=l,s.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(s.opacity=1-l,s.transparent=!0);break}}return this.materials[e]=new ht(s),this.materials[e]}getTextureParams(e,t){const n={scale:new Ht(1,1),offset:new Ht(0,0)},s=e.split(/\s+/);let r;return r=s.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(s[r+1]),s.splice(r,2)),r=s.indexOf("-s"),r>=0&&(n.scale.set(parseFloat(s[r+1]),parseFloat(s[r+2])),s.splice(r,4)),r=s.indexOf("-o"),r>=0&&(n.offset.set(parseFloat(s[r+1]),parseFloat(s[r+2])),s.splice(r,4)),n.url=s.join(" ").trim(),n}loadTexture(e,t,n,s,r){const i=this.manager!==void 0?this.manager:ur;let a=i.getHandler(e);a===null&&(a=new mn(i)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const c=a.load(e,n,s,r);return t!==void 0&&(c.mapping=t),c}}class ei extends hr{constructor(e){super(e),this.type=Tt}parse(e){const a=function(d,F){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(F||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(F||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(F||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(F||""))}return-1},u=`
`,f=function(d,F,v){F=F||1024;let M=d.pos,E=-1,I=0,T="",R=String.fromCharCode.apply(null,new Uint16Array(d.subarray(M,M+128)));for(;0>(E=R.indexOf(u))&&I<F&&M<d.byteLength;)T+=R,I+=R.length,M+=128,R+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(M,M+128)));return-1<E?(v!==!1&&(d.pos+=I+E+1),T+R.slice(0,E)):!1},p=function(d){const F=/^#\?(\S+)/,v=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,y=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*FORMAT=(\S+)\s*$/,E=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,I={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let T,R;if(d.pos>=d.byteLength||!(T=f(d)))return a(1,"no header found");if(!(R=T.match(F)))return a(3,"bad initial token");for(I.valid|=1,I.programtype=R[1],I.string+=T+`
`;T=f(d),T!==!1;){if(I.string+=T+`
`,T.charAt(0)==="#"){I.comments+=T+`
`;continue}if((R=T.match(v))&&(I.gamma=parseFloat(R[1])),(R=T.match(y))&&(I.exposure=parseFloat(R[1])),(R=T.match(M))&&(I.valid|=2,I.format=R[1]),(R=T.match(E))&&(I.valid|=4,I.height=parseInt(R[1],10),I.width=parseInt(R[2],10)),I.valid&2&&I.valid&4)break}return I.valid&2?I.valid&4?I:a(3,"missing image size specifier"):a(3,"missing format specifier")},A=function(d,F,v){const y=F;if(y<8||y>32767||d[0]!==2||d[1]!==2||d[2]&128)return new Uint8Array(d);if(y!==(d[2]<<8|d[3]))return a(3,"wrong scanline width");const M=new Uint8Array(4*F*v);if(!M.length)return a(4,"unable to allocate buffer space");let E=0,I=0;const T=4*y,R=new Uint8Array(4),D=new Uint8Array(T);let G=v;for(;G>0&&I<d.byteLength;){if(I+4>d.byteLength)return a(1);if(R[0]=d[I++],R[1]=d[I++],R[2]=d[I++],R[3]=d[I++],R[0]!=2||R[1]!=2||(R[2]<<8|R[3])!=y)return a(3,"bad rgbe scanline format");let w=0,L;for(;w<T&&I<d.byteLength;){L=d[I++];const H=L>128;if(H&&(L-=128),L===0||w+L>T)return a(3,"bad scanline data");if(H){const S=d[I++];for(let k=0;k<L;k++)D[w++]=S}else D.set(d.subarray(I,I+L),w),w+=L,I+=L}const O=y;for(let H=0;H<O;H++){let S=0;M[E]=D[H+S],S+=y,M[E+1]=D[H+S],S+=y,M[E+2]=D[H+S],S+=y,M[E+3]=D[H+S],E+=4}G--}return M},B=function(d,F,v,y){const M=d[F+3],E=Math.pow(2,M-128)/255;v[y+0]=d[F+0]*E,v[y+1]=d[F+1]*E,v[y+2]=d[F+2]*E,v[y+3]=1},m=function(d,F,v,y){const M=d[F+3],E=Math.pow(2,M-128)/255;v[y+0]=vt.toHalfFloat(Math.min(d[F+0]*E,65504)),v[y+1]=vt.toHalfFloat(Math.min(d[F+1]*E,65504)),v[y+2]=vt.toHalfFloat(Math.min(d[F+2]*E,65504)),v[y+3]=vt.toHalfFloat(1)},C=new Uint8Array(e);C.pos=0;const g=p(C);if(g!==-1){const d=g.width,F=g.height,v=A(C.subarray(C.pos),d,F);if(v!==-1){let y,M,E;switch(this.type){case Qt:E=v.length/4;const I=new Float32Array(E*4);for(let R=0;R<E;R++)B(v,R*4,I,R*4);y=I,M=Qt;break;case Tt:E=v.length/4;const T=new Uint16Array(E*4);for(let R=0;R<E;R++)m(v,R*4,T,R*4);y=T,M=Tt;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:d,height:F,data:y,header:g.string,gamma:g.gamma,exposure:g.exposure,type:M}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(i,a){switch(i.type){case Qt:case Tt:i.encoding=ss,i.minFilter=Xe,i.magFilter=Xe,i.generateMipmaps=!1,i.flipY=!0;break}t&&t(i,a)}return super.load(e,r,n,s)}}class ti extends He{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new oi(t)}),this.register(function(t){return new pi(t)}),this.register(function(t){return new Ai(t)}),this.register(function(t){return new ci(t)}),this.register(function(t){return new li(t)}),this.register(function(t){return new ui(t)}),this.register(function(t){return new hi(t)}),this.register(function(t){return new ii(t)}),this.register(function(t){return new fi(t)}),this.register(function(t){return new ai(t)}),this.register(function(t){return new si(t)}),this.register(function(t){return new di(t)})}load(e,t,n,s){const r=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=Be.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},c=new Fe(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{r.parse(l,i,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const i={},a={};if(typeof e=="string")r=e;else if(Be.decodeText(new Uint8Array(e,0,4))===Fs){try{i[b.KHR_BINARY_GLTF]=new Bi(e)}catch(u){s&&s(u);return}r=i[b.KHR_BINARY_GLTF].content}else r=Be.decodeText(new Uint8Array(e));const c=JSON.parse(r);if(c.asset===void 0||c.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Di(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,i[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],f=c.extensionsRequired||[];switch(u){case b.KHR_MATERIALS_UNLIT:i[u]=new ri;break;case b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:i[u]=new gi;break;case b.KHR_DRACO_MESH_COMPRESSION:i[u]=new mi(c,this.dracoLoader);break;case b.KHR_TEXTURE_TRANSFORM:i[u]=new Ci;break;case b.KHR_MESH_QUANTIZATION:i[u]=new Fi;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(i),l.setPlugins(a),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function ni(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const b={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class si{constructor(e){this.parser=e,this.name=b.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,c=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const h=new N(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new is(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new nn(h),l.distance=u;break;case"spot":l=new rs(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class ri{constructor(){this.name=b.KHR_MATERIALS_UNLIT}getMaterialType(){return rt}extendParams(e,t,n){const s=[];e.color=new N(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const i=r.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,re))}return Promise.all(s)}}class ii{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class oi{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ht(a,a)}return Promise.all(r)}}class ai{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(r)}}class ci{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new N(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=s.extensions[this.name];return i.sheenColorFactor!==void 0&&t.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,re)),i.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(r)}}class li{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(r)}}class ui{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new N(a[0],a[1],a[2]),Promise.all(r)}}class hi{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class fi{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Pe}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new N(a[0],a[1],a[2]),i.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,re)),Promise.all(r)}}class pi{constructor(e){this.parser=e,this.name=b.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,i)}}class Ai{constructor(e){this.parser=e,this.name=b.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const i=r.extensions[t],a=s.images[i.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,i.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class di{constructor(e){this.name=b.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,f=new ArrayBuffer(h*u),p=new Uint8Array(a[0],c,l);return i.decodeGltfBuffer(new Uint8Array(f),h,u,p,s.mode,s.filter),f})}else return null}}const Fs="glTF",tt=12,Jn={JSON:1313821514,BIN:5130562};class Bi{constructor(e){this.name=b.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,tt);if(this.header={magic:Be.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Fs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-tt,s=new DataView(e,tt);let r=0;for(;r<n;){const i=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===Jn.JSON){const c=new Uint8Array(e,tt+r,i);this.content=Be.decodeText(c)}else if(a===Jn.BIN){const c=tt+r;this.body=e.slice(c,c+i)}r+=i}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class mi{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=b.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},c={},l={};for(const h in i){const u=cn[h]||h.toLowerCase();a[u]=i[h]}for(const h in e.attributes){const u=cn[h]||h.toLowerCase();if(i[h]!==void 0){const f=n.accessors[e.attributes[h]],p=At[f.componentType];l[u]=p,c[u]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const A=f.attributes[p],B=c[p];B!==void 0&&(A.normalized=B)}u(f)},a,l)})})}}class Ci{constructor(){this.name=b.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class an extends Cn{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new N().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class gi{constructor(){this.name=b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return an}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new N(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const i=s.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(s.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",s.diffuseTexture,re)),e.emissive=new N(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new N(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const i=s.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",i)),r.push(n.assignTexture(e,"specularMap",i,re))}return Promise.all(r)}createMaterial(e){const t=new an(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=fr,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Fi{constructor(){this.name=b.KHR_MESH_QUANTIZATION}}class Fn extends pr{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let i=0;i!==s;i++)t[i]=n[r+i];return t}}Fn.prototype.interpolate_=function(o,e,t,n){const s=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=i*2,c=i*3,l=n-e,h=(t-e)/l,u=h*h,f=u*h,p=o*c,A=p-c,B=-2*f+3*u,m=f-u,C=1-B,g=m-u+h;for(let d=0;d!==i;d++){const F=r[A+d+i],v=r[A+d+a]*l,y=r[p+d+i],M=r[p+d]*l;s[d]=C*F+g*v+B*y+m*M}return s};const Ei=new it;class yi extends Fn{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return Ei.fromArray(r).normalize().toArray(r),r}}const Me={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},At={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kn={9728:Ar,9729:Xe,9984:dr,9985:Br,9986:mr,9987:gn},Kn={33071:sn,33648:Cr,10497:Ne},Nn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ge={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Mi={CUBICSPLINE:void 0,LINEAR:os,STEP:gr},Yt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ti(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Cn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ns})),o.DefaultMaterial}function nt(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function be(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function vi(o,e,t){let n=!1,s=!1,r=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(o);const i=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):o.attributes.position;i.push(f)}if(s){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):o.attributes.normal;a.push(f)}if(r){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):o.attributes.color;c.push(f)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2];return n&&(o.morphAttributes.position=h),s&&(o.morphAttributes.normal=u),r&&(o.morphAttributes.color=f),o.morphTargetsRelative=!0,o})}function Ii(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ri(o){const e=o.extensions&&o.extensions[b.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Xn(e.attributes):t=o.indices+":"+Xn(o.attributes)+":"+o.mode,t}function Xn(o){let e="";const t=Object.keys(o).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+o[t[n]]+";";return e}function ln(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Gi(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Di{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ni,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||n||s&&r<98?this.textureLoader=new mn(this.options.manager):this.textureLoader=new Fr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fe(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const a={scene:i[0][s.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:s.asset,parser:n,userData:{}};nt(r,a,s),be(a,s),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const i=t[s].joints;for(let a=0,c=i.length;a<c;a++)e[i[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const i=e[s];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(i,a)=>{const c=this.associations.get(i);c!=null&&this.associations.set(a,c);for(const[l,h]of i.children.entries())r(h,a.children[l])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[b.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,i){n.load(Be.resolveURL(t.uri,s.path),r,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(i){const a=i[0],c=Nn[s.type],l=At[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,f=s.byteOffset||0,p=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,A=s.normalized===!0;let B,m;if(p&&p!==u){const C=Math.floor(f/p),g="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+C+":"+s.count;let d=t.cache.get(g);d||(B=new l(a,C*p,s.count*p/h),d=new Er(B,p/h),t.cache.add(g,d)),m=new yr(d,c,f%p/h,A)}else a===null?B=new l(s.count*c):B=new l(a,f,s.count*c),m=new Pt(B,c,A);if(s.sparse!==void 0){const C=Nn.SCALAR,g=At[s.sparse.indices.componentType],d=s.sparse.indices.byteOffset||0,F=s.sparse.values.byteOffset||0,v=new g(i[1],d,s.sparse.count*C),y=new l(i[2],F,s.sparse.count*c);a!==null&&(m=new Pt(m.array.slice(),m.itemSize,m.normalized));for(let M=0,E=v.length;M<E;M++){const I=v[M];if(m.setX(I,y[M*c]),c>=2&&m.setY(I,y[M*c+1]),c>=3&&m.setZ(I,y[M*c+2]),c>=4&&m.setW(I,y[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let a=this.textureLoader;if(i.uri){const c=n.manager.getHandler(i.uri);c!==null&&(a=c)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const s=this,r=this.json,i=r.textures[e],a=r.images[t],c=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,i.name&&(h.name=i.name);const f=(r.samplers||{})[i.sampler]||{};return h.magFilter=kn[f.magFilter]||Xe,h.minFilter=kn[f.minFilter]||gn,h.wrapS=Kn[f.wrapS]||Ne,h.wrapT=Kn[f.wrapT]||Ne,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const i=s.images[e],a=self.URL||self.webkitURL;let c=i.uri||"",l=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:i.mimeType});return c=a.createObjectURL(f),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(f,p){let A=f;t.isImageBitmapLoader===!0&&(A=function(B){const m=new Ot(B);m.needsUpdate=!0,f(m)}),t.load(Be.resolveURL(u,r.path),A,void 0,p)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=i.mimeType||Gi(i.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(i){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[b.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[b.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=r.associations.get(i);i=r.extensions[b.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),r.associations.set(i,c)}}return s!==void 0&&(i.encoding=s),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new st,ut.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new lt,ut.prototype.copy.call(c,n),c.color.copy(n.color),this.cache.add(a,c)),n=c}if(s||r||i){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),r&&(c.vertexColors=!0),i&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Cn}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let i;const a={},c=r.extensions||{},l=[];if(c[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=s[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else if(c[b.KHR_MATERIALS_UNLIT]){const u=s[b.KHR_MATERIALS_UNLIT];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new N(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture,re)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),i=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Mr);const h=r.alphaMode||Yt.OPAQUE;if(h===Yt.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Yt.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&i!==rt&&(l.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Ht(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}return r.occlusionTexture!==void 0&&i!==rt&&(l.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&i!==rt&&(a.emissive=new N().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&i!==rt&&l.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,re)),Promise.all(l).then(function(){let u;return i===an?u=s[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new i(a),r.name&&(u.name=r.name),be(u,r),t.associations.set(u,{materials:e}),r.extensions&&nt(s,u,r),u})}createUniqueName(e){const t=pt.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(a){return n[b.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return jn(c,a,t)})}const i=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=Ri(l),u=s[h];if(u)i.push(u.promise);else{let f;l.extensions&&l.extensions[b.KHR_DRACO_MESH_COMPRESSION]?f=r(l):f=jn(new we,l,t),s[h]={primitive:l,promise:f},i.push(f)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],i=r.primitives,a=[];for(let c=0,l=i.length;c<l;c++){const h=i[c].material===void 0?Ti(this.cache):this.getDependency("material",i[c].material);a.push(h)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let p=0,A=h.length;p<A;p++){const B=h[p],m=i[p];let C;const g=l[p];if(m.mode===Me.TRIANGLES||m.mode===Me.TRIANGLE_STRIP||m.mode===Me.TRIANGLE_FAN||m.mode===void 0)C=r.isSkinnedMesh===!0?new as(B,g):new bt(B,g),C.isSkinnedMesh===!0&&!C.geometry.attributes.skinWeight.normalized&&C.normalizeSkinWeights(),m.mode===Me.TRIANGLE_STRIP?C.geometry=Qn(C.geometry,Tr):m.mode===Me.TRIANGLE_FAN&&(C.geometry=Qn(C.geometry,cs));else if(m.mode===Me.LINES)C=new tn(B,g);else if(m.mode===Me.LINE_STRIP)C=new ls(B,g);else if(m.mode===Me.LINE_LOOP)C=new vr(B,g);else if(m.mode===Me.POINTS)C=new Dt(B,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(C.geometry.morphAttributes).length>0&&Ii(C,r),C.name=t.createUniqueName(r.name||"mesh_"+e),be(C,r),m.extensions&&nt(s,C,m),t.assignFinalMaterial(C),u.push(C)}for(let p=0,A=u.length;p<A;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return u[0];const f=new Ke;t.associations.set(f,{meshes:e});for(let p=0,A=u.length;p<A;p++)f.add(u[p]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new us(de.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new hs(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),be(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const n=this.json.animations[e],s=[],r=[],i=[],a=[],c=[];for(let l=0,h=n.channels.length;l<h;l++){const u=n.channels[l],f=n.samplers[u.sampler],p=u.target,A=p.node!==void 0?p.node:p.id,B=n.parameters!==void 0?n.parameters[f.input]:f.input,m=n.parameters!==void 0?n.parameters[f.output]:f.output;s.push(this.getDependency("node",A)),r.push(this.getDependency("accessor",B)),i.push(this.getDependency("accessor",m)),a.push(f),c.push(p)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2],p=l[3],A=l[4],B=[];for(let C=0,g=h.length;C<g;C++){const d=h[C],F=u[C],v=f[C],y=p[C],M=A[C];if(d===void 0)continue;d.updateMatrix(),d.matrixAutoUpdate=!0;let E;switch(Ge[M.path]){case Ge.weights:E=ps;break;case Ge.rotation:E=rn;break;case Ge.position:case Ge.scale:default:E=fs;break}const I=d.name?d.name:d.uuid,T=y.interpolation!==void 0?Mi[y.interpolation]:os,R=[];Ge[M.path]===Ge.weights?d.traverse(function(G){G.morphTargetInfluences&&R.push(G.name?G.name:G.uuid)}):R.push(I);let D=v.array;if(v.normalized){const G=ln(D.constructor),w=new Float32Array(D.length);for(let L=0,O=D.length;L<O;L++)w[L]=D[L]*G;D=w}for(let G=0,w=R.length;G<w;G++){const L=new E(R[G]+"."+Ge[M.path],F.array,D,T);y.interpolation==="CUBICSPLINE"&&(L.createInterpolant=function(H){const S=this instanceof rn?yi:Fn;return new S(this.times,this.values,this.getValueSize()/3,H)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),B.push(L)}}const m=n.name?n.name:"animation_"+e;return new As(m,void 0,B)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const i=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&i.traverse(function(a){if(!!a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),i})}loadNode(e){const t=this.json,n=this.extensions,s=this,r=t.nodes[e],i=r.name?s.createUniqueName(r.name):"";return function(){const a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(r.isBone===!0?c=new on:a.length>1?c=new Ke:a.length===1?c=a[0]:c=new wt,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(r.name&&(c.userData.name=r.name,c.name=i),be(c,r),r.extensions&&nt(n,c,r),r.matrix!==void 0){const l=new K;l.fromArray(r.matrix),c.applyMatrix4(l)}else r.translation!==void 0&&c.position.fromArray(r.translation),r.rotation!==void 0&&c.quaternion.fromArray(r.rotation),r.scale!==void 0&&c.scale.fromArray(r.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],r=this,i=new Ke;s.name&&(i.name=r.createUniqueName(s.name)),be(i,s),s.extensions&&nt(n,i,s);const a=s.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(Es(a[l],i,t,r));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[f,p]of r.associations)(f instanceof ut||f instanceof Ot)&&u.set(f,p);return h.traverse(f=>{const p=r.associations.get(f);p!=null&&u.set(f,p)}),u};return r.associations=l(i),i})}}function Es(o,e,t,n){const s=t.nodes[o];return n.getDependency("node",o).then(function(r){if(s.skin===void 0)return r;let i;return n.getDependency("skin",s.skin).then(function(a){i=a;const c=[];for(let l=0,h=i.joints.length;l<h;l++)c.push(n.getDependency("node",i.joints[l]));return Promise.all(c)}).then(function(a){return r.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,f=a.length;u<f;u++){const p=a[u];if(p){l.push(p);const A=new K;i.inverseBindMatrices!==void 0&&A.fromArray(i.inverseBindMatrices.array,u*16),h.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}c.bind(new ds(l,h),c.matrixWorld)}),r})}).then(function(r){e.add(r);const i=[];if(s.children){const a=s.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];i.push(Es(h,r,t,n))}}return Promise.all(i)})}function wi(o,e,t){const n=e.attributes,s=new Ir;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new Z(c[0],c[1],c[2]),new Z(l[0],l[1],l[2])),a.normalized){const h=ln(At[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new Z,c=new Z;for(let l=0,h=r.length;l<h;l++){const u=r[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,A=f.max;if(p!==void 0&&A!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(A[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(A[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(A[2]))),f.normalized){const B=ln(At[f.componentType]);c.multiplyScalar(B)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const i=new Rr;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=i}function jn(o,e,t){const n=e.attributes,s=[];function r(i,a){return t.getDependency("accessor",i).then(function(c){o.setAttribute(a,c)})}for(const i in n){const a=cn[i]||i.toLowerCase();a in o.attributes||s.push(r(n[i],a))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});s.push(i)}return be(o,e),wi(o,e,t),Promise.all(s).then(function(){return e.targets!==void 0?vi(o,e.targets,t):o})}function Qn(o,e){let t=o.getIndex();if(t===null){const i=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,s=[];if(e===cs)for(let i=1;i<=n;i++)s.push(t.getX(0)),s.push(t.getX(i)),s.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(s.push(t.getX(i)),s.push(t.getX(i+1)),s.push(t.getX(i+2))):(s.push(t.getX(i+2)),s.push(t.getX(i+1)),s.push(t.getX(i)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=o.clone();return r.setIndex(s),r}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Vn={},un=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))},ys=function(o){return new Worker(o)};try{URL.revokeObjectURL(un(""))}catch{un=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ys=function(e){return new Worker(e,{type:"module"})}}var Li=function(o,e,t,n,s){var r=ys(Vn[e]||(Vn[e]=un(o)));return r.onerror=function(i){return s(i.error,null)},r.onmessage=function(i){return s(null,i.data)},r.postMessage(t,n),r},P=Uint8Array,Y=Uint16Array,ve=Uint32Array,Ve=new P([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ye=new P([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dt=new P([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ms=function(o,e){for(var t=new Y(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var s=new ve(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},Ts=Ms(Ve,2),En=Ts[0],_t=Ts[1];En[28]=258,_t[258]=28;var vs=Ms(Ye,0),Is=vs[0],hn=vs[1],Bt=new Y(32768);for(var J=0;J<32768;++J){var De=(J&43690)>>>1|(J&21845)<<1;De=(De&52428)>>>2|(De&13107)<<2,De=(De&61680)>>>4|(De&3855)<<4,Bt[J]=((De&65280)>>>8|(De&255)<<8)>>>1}var he=function(o,e,t){for(var n=o.length,s=0,r=new Y(e);s<n;++s)++r[o[s]-1];var i=new Y(e);for(s=0;s<e;++s)i[s]=i[s-1]+r[s-1]<<1;var a;if(t){a=new Y(1<<e);var c=15-e;for(s=0;s<n;++s)if(o[s])for(var l=s<<4|o[s],h=e-o[s],u=i[o[s]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)a[Bt[u]>>>c]=l}else for(a=new Y(n),s=0;s<n;++s)o[s]&&(a[s]=Bt[i[o[s]-1]++]>>>15-o[s]);return a},Ie=new P(288);for(var J=0;J<144;++J)Ie[J]=8;for(var J=144;J<256;++J)Ie[J]=9;for(var J=256;J<280;++J)Ie[J]=7;for(var J=280;J<288;++J)Ie[J]=8;var je=new P(32);for(var J=0;J<32;++J)je[J]=5;var Rs=he(Ie,9,0),Gs=he(Ie,9,1),Ds=he(je,5,0),ws=he(je,5,1),Lt=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},le=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},St=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},gt=function(o){return(o/8|0)+(o&7&&1)},fe=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof Y?Y:o instanceof ve?ve:P)(t-e);return n.set(o.subarray(e,t)),n},Ft=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new P(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new P(n*3));var i=function(ie){var te=e.length;if(ie>te){var oe=new P(Math.max(te*2,ie));oe.set(e),e=oe}},a=t.f||0,c=t.p||0,l=t.b||0,h=t.l,u=t.d,f=t.m,p=t.n,A=n*8;do{if(!h){t.f=a=le(o,c,1);var B=le(o,c+1,3);if(c+=3,B)if(B==1)h=Gs,u=ws,f=9,p=5;else if(B==2){var d=le(o,c,31)+257,F=le(o,c+10,15)+4,v=d+le(o,c+5,31)+1;c+=14;for(var y=new P(v),M=new P(19),E=0;E<F;++E)M[dt[E]]=le(o,c+E*3,7);c+=F*3;for(var I=Lt(M),T=(1<<I)-1,R=he(M,I,1),E=0;E<v;){var D=R[le(o,c,T)];c+=D&15;var m=D>>>4;if(m<16)y[E++]=m;else{var G=0,w=0;for(m==16?(w=3+le(o,c,3),c+=2,G=y[E-1]):m==17?(w=3+le(o,c,7),c+=3):m==18&&(w=11+le(o,c,127),c+=7);w--;)y[E++]=G}}var L=y.subarray(0,d),O=y.subarray(d);f=Lt(L),p=Lt(O),h=he(L,f,1),u=he(O,p,1)}else throw"invalid block type";else{var m=gt(c)+4,C=o[m-4]|o[m-3]<<8,g=m+C;if(g>n){if(r)throw"unexpected EOF";break}s&&i(l+C),e.set(o.subarray(m,g),l),t.b=l+=C,t.p=c=g*8;continue}if(c>A){if(r)throw"unexpected EOF";break}}s&&i(l+131072);for(var H=(1<<f)-1,S=(1<<p)-1,k=c;;k=c){var G=h[St(o,c)&H],z=G>>>4;if(c+=G&15,c>A){if(r)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(z<256)e[l++]=z;else if(z==256){k=c,h=null;break}else{var V=z-254;if(z>264){var E=z-257,Q=Ve[E];V=le(o,c,(1<<Q)-1)+En[E],c+=Q}var ee=u[St(o,c)&S],W=ee>>>4;if(!ee)throw"invalid distance";c+=ee&15;var O=Is[W];if(W>3){var Q=Ye[W];O+=St(o,c)&(1<<Q)-1,c+=Q}if(c>A){if(r)throw"unexpected EOF";break}s&&i(l+131072);for(var _=l+V;l<_;l+=4)e[l]=e[l-O],e[l+1]=e[l+1-O],e[l+2]=e[l+2-O],e[l+3]=e[l+3-O];l=_}}t.l=h,t.p=k,t.b=l,h&&(a=1,t.m=f,t.d=u,t.n=p)}while(!a);return l==e.length?e:fe(e,0,l)},Ce=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8},Je=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8,o[n+2]|=t>>>16},xt=function(o,e){for(var t=[],n=0;n<o.length;++n)o[n]&&t.push({s:n,f:o[n]});var s=t.length,r=t.slice();if(!s)return[Te,0];if(s==1){var i=new P(t[0].s+1);return i[t[0].s]=1,[i,1]}t.sort(function(v,y){return v.f-y.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,h=1,u=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};h!=s-1;)a=t[t[l].f<t[u].f?l++:u++],c=t[l!=h&&t[l].f<t[u].f?l++:u++],t[h++]={s:-1,f:a.f+c.f,l:a,r:c};for(var f=r[0].s,n=1;n<s;++n)r[n].s>f&&(f=r[n].s);var p=new Y(f+1),A=Ut(t[h-1],p,0);if(A>e){var n=0,B=0,m=A-e,C=1<<m;for(r.sort(function(y,M){return p[M.s]-p[y.s]||y.f-M.f});n<s;++n){var g=r[n].s;if(p[g]>e)B+=C-(1<<A-p[g]),p[g]=e;else break}for(B>>>=m;B>0;){var d=r[n].s;p[d]<e?B-=1<<e-p[d]++-1:++n}for(;n>=0&&B;--n){var F=r[n].s;p[F]==e&&(--p[F],++B)}A=e}return[new P(p),A]},Ut=function(o,e,t){return o.s==-1?Math.max(Ut(o.l,e,t+1),Ut(o.r,e,t+1)):e[o.s]=t},fn=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new Y(++e),n=0,s=o[0],r=1,i=function(c){t[n++]=c},a=1;a<=e;++a)if(o[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)i(32754);r>2&&(i(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(i(s),--r;r>6;r-=6)i(8304);r>2&&(i(r-3<<5|8208),r=0)}for(;r--;)i(s);r=1,s=o[a]}return[t.subarray(0,n),e]},ke=function(o,e){for(var t=0,n=0;n<e.length;++n)t+=o[n]*e[n];return t},ft=function(o,e,t){var n=t.length,s=gt(e+2);o[s]=n&255,o[s+1]=n>>>8,o[s+2]=o[s]^255,o[s+3]=o[s+1]^255;for(var r=0;r<n;++r)o[s+r+4]=t[r];return(s+4+n)*8},pn=function(o,e,t,n,s,r,i,a,c,l,h){Ce(e,h++,t),++s[256];for(var u=xt(s,15),f=u[0],p=u[1],A=xt(r,15),B=A[0],m=A[1],C=fn(f),g=C[0],d=C[1],F=fn(B),v=F[0],y=F[1],M=new Y(19),E=0;E<g.length;++E)M[g[E]&31]++;for(var E=0;E<v.length;++E)M[v[E]&31]++;for(var I=xt(M,7),T=I[0],R=I[1],D=19;D>4&&!T[dt[D-1]];--D);var G=l+5<<3,w=ke(s,Ie)+ke(r,je)+i,L=ke(s,f)+ke(r,B)+i+14+3*D+ke(M,T)+(2*M[16]+3*M[17]+7*M[18]);if(G<=w&&G<=L)return ft(e,h,o.subarray(c,c+l));var O,H,S,k;if(Ce(e,h,1+(L<w)),h+=2,L<w){O=he(f,p,0),H=f,S=he(B,m,0),k=B;var z=he(T,R,0);Ce(e,h,d-257),Ce(e,h+5,y-1),Ce(e,h+10,D-4),h+=14;for(var E=0;E<D;++E)Ce(e,h+3*E,T[dt[E]]);h+=3*D;for(var V=[g,v],Q=0;Q<2;++Q)for(var ee=V[Q],E=0;E<ee.length;++E){var W=ee[E]&31;Ce(e,h,z[W]),h+=T[W],W>15&&(Ce(e,h,ee[E]>>>5&127),h+=ee[E]>>>12)}}else O=Rs,H=Ie,S=Ds,k=je;for(var E=0;E<a;++E)if(n[E]>255){var W=n[E]>>>18&31;Je(e,h,O[W+257]),h+=H[W+257],W>7&&(Ce(e,h,n[E]>>>23&31),h+=Ve[W]);var _=n[E]&31;Je(e,h,S[_]),h+=k[_],_>3&&(Je(e,h,n[E]>>>5&8191),h+=Ye[_])}else Je(e,h,O[n[E]]),h+=H[n[E]];return Je(e,h,O[256]),h+H[256]},Ls=new ve([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Te=new P(0),Ss=function(o,e,t,n,s,r){var i=o.length,a=new P(n+i+5*(1+Math.ceil(i/7e3))+s),c=a.subarray(n,a.length-s),l=0;if(!e||i<8)for(var h=0;h<=i;h+=65535){var u=h+65535;u<i?l=ft(c,l,o.subarray(h,u)):(c[h]=r,l=ft(c,l,o.subarray(h,i)))}else{for(var f=Ls[e-1],p=f>>>13,A=f&8191,B=(1<<t)-1,m=new Y(32768),C=new Y(B+1),g=Math.ceil(t/3),d=2*g,F=function(_e){return(o[_e]^o[_e+1]<<g^o[_e+2]<<d)&B},v=new ve(25e3),y=new Y(288),M=new Y(32),E=0,I=0,h=0,T=0,R=0,D=0;h<i;++h){var G=F(h),w=h&32767,L=C[G];if(m[w]=L,C[G]=w,R<=h){var O=i-h;if((E>7e3||T>24576)&&O>423){l=pn(o,c,0,v,y,M,I,T,D,h-D,l),T=E=I=0,D=h;for(var H=0;H<286;++H)y[H]=0;for(var H=0;H<30;++H)M[H]=0}var S=2,k=0,z=A,V=w-L&32767;if(O>2&&G==F(h-V))for(var Q=Math.min(p,O)-1,ee=Math.min(32767,h),W=Math.min(258,O);V<=ee&&--z&&w!=L;){if(o[h+S]==o[h+S-V]){for(var _=0;_<W&&o[h+_]==o[h+_-V];++_);if(_>S){if(S=_,k=V,_>Q)break;for(var ie=Math.min(V,_-2),te=0,H=0;H<ie;++H){var oe=h-V+H+32768&32767,ye=m[oe],ae=oe-ye+32768&32767;ae>te&&(te=ae,L=oe)}}}w=L,L=m[w],V+=w-L+32768&32767}if(k){v[T++]=268435456|_t[S]<<18|hn[k];var me=_t[S]&31,Ae=hn[k]&31;I+=Ve[me]+Ye[Ae],++y[257+me],++M[Ae],R=h+S,++E}else v[T++]=o[h],++y[o[h]]}}l=pn(o,c,r,v,y,M,I,T,D,h-D,l),!r&&l&7&&(l=ft(c,l+1,Te))}return fe(a,0,n+gt(l)+s)},xs=function(){for(var o=new ve(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),Ze=function(){var o=-1;return{p:function(e){for(var t=o,n=0;n<e.length;++n)t=xs[t&255^e[n]]^t>>>8;o=t},d:function(){return~o}}},yn=function(){var o=1,e=0;return{p:function(t){for(var n=o,s=e,r=t.length,i=0;i!=r;){for(var a=Math.min(i+2655,r);i<a;++i)s+=n+=t[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}o=n,e=s},d:function(){return o%=65521,e%=65521,(o&255)<<24|o>>>8<<16|(e&255)<<8|e>>>8}}},Oe=function(o,e,t,n,s){return Ss(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,n,!s)},Et=function(o,e){var t={};for(var n in o)t[n]=o[n];for(var n in e)t[n]=e[n];return t},Yn=function(o,e,t){for(var n=o(),s=o.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<n.length;++i){var a=n[i],c=r[i];if(typeof a=="function"){e+=";"+c+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var u in a.prototype)e+=";"+c+".prototype."+u+"="+a.prototype[u].toString()}else e+=l}else t[c]=a}return[e,t]},Rt=[],Si=function(o){var e=[];for(var t in o)(o[t]instanceof P||o[t]instanceof Y||o[t]instanceof ve)&&e.push((o[t]=new o[t].constructor(o[t])).buffer);return e},bs=function(o,e,t,n){var s;if(!Rt[t]){for(var r="",i={},a=o.length-1,c=0;c<a;++c)s=Yn(o[c],r,i),r=s[0],i=s[1];Rt[t]=Yn(o[a],r,i)}var l=Et({},Rt[t][1]);return Li(Rt[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,Si(l),n)},We=function(){return[P,Y,ve,Ve,Ye,dt,En,Is,Gs,ws,Bt,he,Lt,le,St,gt,fe,Ft,et,xe,Mn]},ze=function(){return[P,Y,ve,Ve,Ye,dt,_t,hn,Rs,Ie,Ds,je,Bt,Ls,Te,he,Ce,Je,xt,Ut,fn,ke,ft,pn,gt,fe,Ss,Oe,yt,xe]},Hs=function(){return[Tn,In,U,Ze,xs]},Ps=function(){return[vn,Us]},Os=function(){return[Rn,U,yn]},_s=function(){return[Js]},xe=function(o){return postMessage(o,[o.buffer])},Mn=function(o){return o&&o.size&&new P(o.size)},qe=function(o,e,t,n,s,r){var i=bs(t,n,s,function(a,c){i.terminate(),r(a,c)});return i.postMessage([o,e],e.consume?[o.buffer]:[]),function(){i.terminate()}},pe=function(o){return o.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return o.push(e.data[0],e.data[1])}},$e=function(o,e,t,n,s){var r,i=bs(o,n,s,function(a,c){a?(i.terminate(),e.ondata.call(e,a)):(c[1]&&i.terminate(),e.ondata.call(e,a,c[0],c[1]))});i.postMessage(t),e.push=function(a,c){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";i.postMessage([a,r=c],[a.buffer])},e.terminate=function(){i.terminate()}},$=function(o,e){return o[e]|o[e+1]<<8},j=function(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16|o[e+3]<<24)>>>0},Zt=function(o,e){return j(o,e)+j(o,e+4)*4294967296},U=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8},Tn=function(o,e){var t=e.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=e.level<2?4:e.level==9?2:0,o[9]=3,e.mtime!=0&&U(o,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){o[3]=8;for(var n=0;n<=t.length;++n)o[n+10]=t.charCodeAt(n)}},vn=function(o){if(o[0]!=31||o[1]!=139||o[2]!=8)throw"invalid gzip data";var e=o[3],t=10;e&4&&(t+=o[10]|(o[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!o[t++]);return t+(e&2)},Us=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},In=function(o){return 10+(o.filename&&o.filename.length+1||0)},Rn=function(o,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;o[0]=120,o[1]=n<<6|(n?32-2*n:1)},Js=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Gn(o,e){return!e&&typeof o=="function"&&(e=o,o={}),this.ondata=e,o}var Ee=function(){function o(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return o.prototype.p=function(e,t){this.ondata(Oe(e,this.o,0,0,!t),t)},o.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},o}(),ks=function(){function o(e,t){$e([ze,function(){return[pe,Ee]}],this,Gn.call(this,e,t),function(n){var s=new Ee(n.data);onmessage=pe(s)},6)}return o}();function Ks(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[ze],function(n){return xe(yt(n.data[0],n.data[1]))},0,t)}function yt(o,e){return Oe(o,e||{},0,0)}var se=function(){function o(e){this.s={},this.p=new P(0),this.ondata=e}return o.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new P(t+e.length);n.set(this.p),n.set(e,t),this.p=n},o.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ft(this.p,this.o,this.s);this.ondata(fe(n,t,this.s.b),this.d),this.o=fe(n,this.s.b-32768),this.s.b=this.o.length,this.p=fe(this.p,this.s.p/8|0),this.s.p&=7},o.prototype.push=function(e,t){this.e(e),this.c(t)},o}(),Dn=function(){function o(e){this.ondata=e,$e([We,function(){return[pe,se]}],this,0,function(){var t=new se;onmessage=pe(t)},7)}return o}();function wn(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[We],function(n){return xe(et(n.data[0],Mn(n.data[1])))},1,t)}function et(o,e){return Ft(o,e)}var Jt=function(){function o(e,t){this.c=Ze(),this.l=0,this.v=1,Ee.call(this,e,t)}return o.prototype.push=function(e,t){Ee.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Oe(e,this.o,this.v&&In(this.o),t&&8,!t);this.v&&(Tn(n,this.o),this.v=0),t&&(U(n,n.length-8,this.c.d()),U(n,n.length-4,this.l)),this.ondata(n,t)},o}(),Zn=function(){function o(e,t){$e([ze,Hs,function(){return[pe,Ee,Jt]}],this,Gn.call(this,e,t),function(n){var s=new Jt(n.data);onmessage=pe(s)},8)}return o}();function Wn(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[ze,Hs,function(){return[kt]}],function(n){return xe(kt(n.data[0],n.data[1]))},2,t)}function kt(o,e){e||(e={});var t=Ze(),n=o.length;t.p(o);var s=Oe(o,e,In(e),8),r=s.length;return Tn(s,e),U(s,r-8,t.d()),U(s,r-4,n),s}var Kt=function(){function o(e){this.v=1,se.call(this,e)}return o.prototype.push=function(e,t){if(se.prototype.e.call(this,e),this.v){var n=this.p.length>3?vn(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}se.prototype.c.call(this,t)},o}(),Ns=function(){function o(e){this.ondata=e,$e([We,Ps,function(){return[pe,se,Kt]}],this,0,function(){var t=new Kt;onmessage=pe(t)},9)}return o}();function Xs(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[We,Ps,function(){return[Nt]}],function(n){return xe(Nt(n.data[0]))},3,t)}function Nt(o,e){return Ft(o.subarray(vn(o),-8),e||new P(Us(o)))}var An=function(){function o(e,t){this.c=yn(),this.v=1,Ee.call(this,e,t)}return o.prototype.push=function(e,t){Ee.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e);var n=Oe(e,this.o,this.v&&2,t&&4,!t);this.v&&(Rn(n,this.o),this.v=0),t&&U(n,n.length-4,this.c.d()),this.ondata(n,t)},o}(),xi=function(){function o(e,t){$e([ze,Os,function(){return[pe,Ee,An]}],this,Gn.call(this,e,t),function(n){var s=new An(n.data);onmessage=pe(s)},10)}return o}();function bi(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[ze,Os,function(){return[dn]}],function(n){return xe(dn(n.data[0],n.data[1]))},4,t)}function dn(o,e){e||(e={});var t=yn();t.p(o);var n=Oe(o,e,2,4);return Rn(n,e),U(n,n.length-4,t.d()),n}var Xt=function(){function o(e){this.v=1,se.call(this,e)}return o.prototype.push=function(e,t){if(se.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}se.prototype.c.call(this,t)},o}(),js=function(){function o(e){this.ondata=e,$e([We,_s,function(){return[pe,se,Xt]}],this,0,function(){var t=new Xt;onmessage=pe(t)},11)}return o}();function Qs(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return qe(o,e,[We,_s,function(){return[mt]}],function(n){return xe(mt(n.data[0],Mn(n.data[1])))},5,t)}function mt(o,e){return Ft((Js(o),o.subarray(2,-4)),e)}var Vs=function(){function o(e){this.G=Kt,this.I=se,this.Z=Xt,this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new P(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=function(){s.ondata.apply(s,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},o}(),Hi=function(){function o(e){this.G=Ns,this.I=Dn,this.Z=js,this.ondata=e}return o.prototype.push=function(e,t){Vs.prototype.push.call(this,e,t)},o}();function Pi(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return o[0]==31&&o[1]==139&&o[2]==8?Xs(o,e,t):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?wn(o,e,t):Qs(o,e,t)}function Oi(o,e){return o[0]==31&&o[1]==139&&o[2]==8?Nt(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?et(o,e):mt(o,e)}var Ln=function(o,e,t,n){for(var s in o){var r=o[s],i=e+s;r instanceof P?t[i]=[r,n]:Array.isArray(r)?t[i]=[r[0],Et(n,r[1])]:Ln(r,i+"/",t,n)}},zn=typeof TextEncoder!="undefined"&&new TextEncoder,Bn=typeof TextDecoder!="undefined"&&new TextDecoder,Ys=0;try{Bn.decode(Te,{stream:!0}),Ys=1}catch{}var Zs=function(o){for(var e="",t=0;;){var n=o[t++],s=(n>127)+(n>223)+(n>239);if(t+s>o.length)return[e,fe(o,t-1)];s?s==3?(n=((n&15)<<18|(o[t++]&63)<<12|(o[t++]&63)<<6|o[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?e+=String.fromCharCode((n&31)<<6|o[t++]&63):e+=String.fromCharCode((n&15)<<12|(o[t++]&63)<<6|o[t++]&63):e+=String.fromCharCode(n)}},_i=function(){function o(e){this.ondata=e,Ys?this.t=new TextDecoder:this.p=Te}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new P(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var s=Zs(n),r=s[0],i=s[1];if(t){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(r,t)},o}(),Ui=function(){function o(e){this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Se(e),this.d=t||!1)},o}();function Se(o,e){if(e){for(var t=new P(o.length),n=0;n<o.length;++n)t[n]=o.charCodeAt(n);return t}if(zn)return zn.encode(o);for(var s=o.length,r=new P(o.length+(o.length>>1)),i=0,a=function(h){r[i++]=h},n=0;n<s;++n){if(i+5>r.length){var c=new P(i+8+(s-n<<1));c.set(r),r=c}var l=o.charCodeAt(n);l<128||e?a(l):l<2048?(a(192|l>>6),a(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|o.charCodeAt(++n)&1023,a(240|l>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|l&63)):(a(224|l>>12),a(128|l>>6&63),a(128|l&63))}return fe(r,0,i)}function Sn(o,e){if(e){for(var t="",n=0;n<o.length;n+=16384)t+=String.fromCharCode.apply(null,o.subarray(n,n+16384));return t}else{if(Bn)return Bn.decode(o);var s=Zs(o),r=s[0],i=s[1];if(i.length)throw"invalid utf-8 data";return r}}var Ws=function(o){return o==1?3:o<6?2:o==9?1:0},zs=function(o,e){return e+30+$(o,e+26)+$(o,e+28)},qs=function(o,e,t){var n=$(o,e+28),s=Sn(o.subarray(e+46,e+46+n),!($(o,e+8)&2048)),r=e+46+n,i=j(o,e+20),a=t&&i==4294967295?$s(o,r):[i,j(o,e+24),j(o,e+42)],c=a[0],l=a[1],h=a[2];return[$(o,e+10),c,l,s,r+$(o,e+30)+$(o,e+32),h]},$s=function(o,e){for(;$(o,e)!=1;e+=4+$(o,e+2));return[Zt(o,e+12),Zt(o,e+4),Zt(o,e+20)]},Le=function(o){var e=0;if(o)for(var t in o){var n=o[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Qe=function(o,e,t,n,s,r,i,a){var c=n.length,l=t.extra,h=a&&a.length,u=Le(l);U(o,e,i!=null?33639248:67324752),e+=4,i!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(r==null&&8),o[e++]=s&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(U(o,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(U(o,e,t.crc),U(o,e+4,r),U(o,e+8,t.size)),U(o,e+12,c),U(o,e+14,u),e+=16,i!=null&&(U(o,e,h),U(o,e+6,t.attrs),U(o,e+10,i),e+=14),o.set(n,e),e+=c,u)for(var A in l){var B=l[A],m=B.length;U(o,e,+A),U(o,e+2,m),o.set(B,e+4),e+=4+m}return h&&(o.set(a,e),e+=h),e},xn=function(o,e,t,n,s){U(o,e,101010256),U(o,e+8,t),U(o,e+10,t),U(o,e+12,n),U(o,e+16,s)},Ct=function(){function o(e){this.filename=e,this.c=Ze(),this.size=0,this.compression=0}return o.prototype.process=function(e,t){this.ondata(null,e,t)},o.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},o}(),Ji=function(){function o(e,t){var n=this;t||(t={}),Ct.call(this,e),this.d=new Ee(t,function(s,r){n.ondata(null,s,r)}),this.compression=8,this.flag=Ws(t.level)}return o.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},o.prototype.push=function(e,t){Ct.prototype.push.call(this,e,t)},o}(),ki=function(){function o(e,t){var n=this;t||(t={}),Ct.call(this,e),this.d=new ks(t,function(s,r,i){n.ondata(s,r,i)}),this.compression=8,this.flag=Ws(t.level),this.terminate=this.d.terminate}return o.prototype.process=function(e,t){this.d.push(e,t)},o.prototype.push=function(e,t){Ct.prototype.push.call(this,e,t)},o}(),Ki=function(){function o(e){this.ondata=e,this.u=[],this.d=1}return o.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=Se(e.filename),s=n.length,r=e.comment,i=r&&Se(r),a=s!=e.filename.length||i&&r.length!=i.length,c=s+Le(e.extra)+30;if(s>65535)throw"filename too long";var l=new P(c);Qe(l,0,e,n,a);var h=[l],u=function(){for(var m=0,C=h;m<C.length;m++){var g=C[m];t.ondata(null,g,!1)}h=[]},f=this.d;this.d=0;var p=this.u.length,A=Et(e,{f:n,u:a,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),f){var m=t.u[p+1];m?m.r():t.d=1}f=1}}),B=0;e.ondata=function(m,C,g){if(m)t.ondata(m,C,g),t.terminate();else if(B+=C.length,h.push(C),g){var d=new P(16);U(d,0,134695760),U(d,4,e.crc),U(d,8,B),U(d,12,e.size),h.push(d),A.c=B,A.b=c+B+16,A.crc=e.crc,A.size=e.size,f&&A.r(),f=1}else f&&u()},this.u.push(A)},o.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},o.prototype.e=function(){for(var e=0,t=0,n=0,s=0,r=this.u;s<r.length;s++){var i=r[s];n+=46+i.f.length+Le(i.extra)+(i.o?i.o.length:0)}for(var a=new P(n+22),c=0,l=this.u;c<l.length;c++){var i=l[c];Qe(a,e,i,i.f,i.u,i.c,t,i.o),e+=46+i.f.length+Le(i.extra)+(i.o?i.o.length:0),t+=i.b}xn(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},o.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},o}();function Ni(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Ln(o,"",n,e);var s=Object.keys(n),r=s.length,i=0,a=0,c=r,l=new Array(r),h=[],u=function(){for(var B=0;B<h.length;++B)h[B]()},f=function(){var B=new P(a+22),m=i,C=a-i;a=0;for(var g=0;g<c;++g){var d=l[g];try{var F=d.c.length;Qe(B,a,d,d.f,d.u,F);var v=30+d.f.length+Le(d.extra),y=a+v;B.set(d.c,y),Qe(B,i,d,d.f,d.u,F,a,d.m),i+=16+v+(d.m?d.m.length:0),a=y+F}catch(M){return t(M,null)}}xn(B,i,l.length,C,m),t(null,B)};r||f();for(var p=function(B){var m=s[B],C=n[m],g=C[0],d=C[1],F=Ze(),v=g.length;F.p(g);var y=Se(m),M=y.length,E=d.comment,I=E&&Se(E),T=I&&I.length,R=Le(d.extra),D=d.level==0?0:8,G=function(w,L){if(w)u(),t(w,null);else{var O=L.length;l[B]=Et(d,{size:v,crc:F.d(),c:L,f:y,m:I,u:M!=m.length||I&&E.length!=T,compression:D}),i+=30+M+R+O,a+=76+2*(M+R)+(T||0)+O,--r||f()}};if(M>65535&&G("filename too long",null),!D)G(null,g);else if(v<16e4)try{G(null,yt(g,d))}catch(w){G(w,null)}else h.push(Ks(g,d,G))},A=0;A<c;++A)p(A);return u}function Xi(o,e){e||(e={});var t={},n=[];Ln(o,"",t,e);var s=0,r=0;for(var i in t){var a=t[i],c=a[0],l=a[1],h=l.level==0?0:8,u=Se(i),f=u.length,p=l.comment,A=p&&Se(p),B=A&&A.length,m=Le(l.extra);if(f>65535)throw"filename too long";var C=h?yt(c,l):c,g=C.length,d=Ze();d.p(c),n.push(Et(l,{size:c.length,crc:d.d(),c:C,f:u,m:A,u:f!=i.length||A&&p.length!=B,o:s,compression:h})),s+=30+f+m+g,r+=76+2*(f+m)+(B||0)+g}for(var F=new P(r+22),v=s,y=r-s,M=0;M<n.length;++M){var u=n[M];Qe(F,u.o,u,u.f,u.u,u.c.length);var E=30+u.f.length+Le(u.extra);F.set(u.c,u.o+E),Qe(F,s,u,u.f,u.u,u.c.length,u.o,u.m),s+=16+E+(u.m?u.m.length:0)}return xn(F,s,n.length,y,v),F}var er=function(){function o(){}return o.prototype.push=function(e,t){this.ondata(null,e,t)},o.compression=0,o}(),ji=function(){function o(){var e=this;this.i=new se(function(t,n){e.ondata(null,t,n)})}return o.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},o.compression=8,o}(),Qi=function(){function o(e,t){var n=this;t<32e4?this.i=new se(function(s,r){n.ondata(null,s,r)}):(this.i=new Dn(function(s,r,i){n.ondata(s,r,i)}),this.terminate=this.i.terminate)}return o.prototype.push=function(e,t){this.i.terminate&&(e=fe(e,0)),this.i.push(e,t)},o.compression=8,o}(),Vi=function(){function o(e){this.onfile=e,this.k=[],this.o={0:er},this.p=Te}return o.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var i=0,a=0,c=void 0,l=void 0;this.p.length?e.length?(l=new P(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var h=l.length,u=this.c,f=u&&this.d,p=function(){var C,g=j(l,a);if(g==67324752){i=1,c=a,A.d=null,A.c=0;var d=$(l,a+6),F=$(l,a+8),v=d&2048,y=d&8,M=$(l,a+26),E=$(l,a+28);if(h>a+30+M+E){var I=[];A.k.unshift(I),i=2;var T=j(l,a+18),R=j(l,a+22),D=Sn(l.subarray(a+30,a+=30+M),!v);T==4294967295?(C=y?[-2]:$s(l,a),T=C[0],R=C[1]):y&&(T=-1),a+=E,A.c=T;var G,w={name:D,compression:F,start:function(){if(!w.ondata)throw"no callback";if(!T)w.ondata(null,Te,!0);else{var L=n.o[F];if(!L)throw"unknown compression type "+F;G=T<0?new L(D):new L(D,T,R),G.ondata=function(k,z,V){w.ondata(k,z,V)};for(var O=0,H=I;O<H.length;O++){var S=H[O];G.push(S,!1)}n.k[0]==I&&n.c?n.d=G:G.push(Te,!0)}},terminate:function(){G&&G.terminate&&G.terminate()}};T>=0&&(w.size=T,w.originalSize=R),A.onfile(w)}return"break"}else if(u){if(g==134695760)return c=a+=12+(u==-2&&8),i=3,A.c=0,"break";if(g==33639248)return c=a-=4,i=3,A.c=0,"break"}},A=this;a<h-4;++a){var B=p();if(B==="break")break}if(this.p=Te,u<0){var m=i?l.subarray(0,c-12-(u==-2&&8)-(j(l,c-16)==134695760&&4)):l.subarray(0,a);f?f.push(m,!!i):this.k[+(i==2)].push(m)}if(i&2)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},o.prototype.register=function(e){this.o[e.compression]=e},o}();function Yi(o,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var f=0;f<t.length;++f)t[f]()},s={},r=o.length-22;j(o,r)!=101010256;--r)if(!r||o.length-r>65558){e("invalid zip file",null);return}var i=$(o,r+8);i||e(null,{});var a=i,c=j(o,r+16),l=c==4294967295;if(l){if(r=j(o,r-12),j(o,r)!=101075792){e("invalid zip file",null);return}a=i=j(o,r+32),c=j(o,r+48)}for(var h=function(f){var p=qs(o,c,l),A=p[0],B=p[1],m=p[2],C=p[3],g=p[4],d=p[5],F=zs(o,d);c=g;var v=function(M,E){M?(n(),e(M,null)):(s[C]=E,--i||e(null,s))};if(!A)v(null,fe(o,F,F+B));else if(A==8){var y=o.subarray(F,F+B);if(B<32e4)try{v(null,et(y,new P(m)))}catch(M){v(M,null)}else t.push(wn(y,{size:m},v))}else v("unknown compression type "+A,null)},u=0;u<a;++u)h();return n}function Zi(o){for(var e={},t=o.length-22;j(o,t)!=101010256;--t)if(!t||o.length-t>65558)throw"invalid zip file";var n=$(o,t+8);if(!n)return{};var s=j(o,t+16),r=s==4294967295;if(r){if(t=j(o,t-12),j(o,t)!=101075792)throw"invalid zip file";n=j(o,t+32),s=j(o,t+48)}for(var i=0;i<n;++i){var a=qs(o,s,r),c=a[0],l=a[1],h=a[2],u=a[3],f=a[4],p=a[5],A=zs(o,p);if(s=f,!c)e[u]=fe(o,A,A+l);else if(c==8)e[u]=et(o.subarray(A,A+l),new P(h));else throw"unknown compression type "+c}return e}var Wi=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Ee,AsyncDeflate:ks,deflate:Ks,deflateSync:yt,Inflate:se,AsyncInflate:Dn,inflate:wn,inflateSync:et,Gzip:Jt,AsyncGzip:Zn,gzip:Wn,gzipSync:kt,Gunzip:Kt,AsyncGunzip:Ns,gunzip:Xs,gunzipSync:Nt,Zlib:An,AsyncZlib:xi,zlib:bi,zlibSync:dn,Unzlib:Xt,AsyncUnzlib:js,unzlib:Qs,unzlibSync:mt,compress:Wn,AsyncCompress:Zn,compressSync:kt,Compress:Jt,Decompress:Vs,AsyncDecompress:Hi,decompress:Pi,decompressSync:Oi,DecodeUTF8:_i,EncodeUTF8:Ui,strToU8:Se,strFromU8:Sn,ZipPassThrough:Ct,ZipDeflate:Ji,AsyncZipDeflate:ki,Zip:Ki,zip:Ni,zipSync:Xi,UnzipPassThrough:er,UnzipInflate:ji,AsyncUnzipInflate:Qi,Unzip:Vi,unzip:Yi,unzipSync:Zi},Symbol.toStringTag,{value:"Module"}));function tr(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let s=o,r=n,i=Math.floor((s+r)/2);for(;e<t[i]||e>=t[i+1];)e<t[i]?r=i:s=i,i=Math.floor((s+r)/2);return i}function zi(o,e,t,n){const s=[],r=[],i=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[o+1-a],i[a]=n[o+a]-e;let c=0;for(let l=0;l<a;++l){const h=i[l+1],u=r[a-l],f=s[l]/(h+u);s[l]=c+h*f,c=u*f}s[a]=c}return s}function qi(o,e,t,n){const s=tr(o,n,e),r=zi(s,n,o,e),i=new jt(0,0,0,0);for(let a=0;a<=o;++a){const c=t[s-o+a],l=r[a],h=c.w*l;i.x+=c.x*h,i.y+=c.y*h,i.z+=c.z*h,i.w+=c.w*l}return i}function $i(o,e,t,n,s){const r=[];for(let u=0;u<=t;++u)r[u]=0;const i=[];for(let u=0;u<=n;++u)i[u]=r.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=r.slice(0);a[0][0]=1;const c=r.slice(0),l=r.slice(0);for(let u=1;u<=t;++u){c[u]=e-s[o+1-u],l[u]=s[o+u]-e;let f=0;for(let p=0;p<u;++p){const A=l[p+1],B=c[u-p];a[u][p]=A+B;const m=a[p][u-1]/a[u][p];a[p][u]=f+A*m,f=B*m}a[u][u]=f}for(let u=0;u<=t;++u)i[0][u]=a[u][t];for(let u=0;u<=t;++u){let f=0,p=1;const A=[];for(let B=0;B<=t;++B)A[B]=r.slice(0);A[0][0]=1;for(let B=1;B<=n;++B){let m=0;const C=u-B,g=t-B;u>=B&&(A[p][0]=A[f][0]/a[g+1][C],m=A[p][0]*a[C][g]);const d=C>=-1?1:-C,F=u-1<=g?B-1:t-u;for(let y=d;y<=F;++y)A[p][y]=(A[f][y]-A[f][y-1])/a[g+1][C+y],m+=A[p][y]*a[C+y][g];u<=g&&(A[p][B]=-A[f][B-1]/a[g+1][u],m+=A[p][B]*a[u][g]),i[B][u]=m;const v=f;f=p,p=v}}let h=t;for(let u=1;u<=n;++u){for(let f=0;f<=t;++f)i[u][f]*=h;h*=t-u}return i}function eo(o,e,t,n,s){const r=s<o?s:o,i=[],a=tr(o,n,e),c=$i(a,n,o,r,e),l=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),f=u.w;u.x*=f,u.y*=f,u.z*=f,l[h]=u}for(let h=0;h<=r;++h){const u=l[a-o].clone().multiplyScalar(c[h][0]);for(let f=1;f<=o;++f)u.add(l[a-o+f].clone().multiplyScalar(c[h][f]));i[h]=u}for(let h=r+1;h<=s+1;++h)i[h]=new jt(0,0,0);return i}function to(o,e){let t=1;for(let s=2;s<=o;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=o-e;++s)n*=s;return t/n}function no(o){const e=o.length,t=[],n=[];for(let r=0;r<e;++r){const i=o[r];t[r]=new Z(i.x,i.y,i.z),n[r]=i.w}const s=[];for(let r=0;r<e;++r){const i=t[r].clone();for(let a=1;a<=r;++a)i.sub(s[r-a].clone().multiplyScalar(to(r,a)*n[a]));s[r]=i.divideScalar(n[0])}return s}function so(o,e,t,n,s){const r=eo(o,e,t,n,s);return no(r)}class qn extends Gr{constructor(e,t,n,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let i=0;i<n.length;++i){const a=n[i];this.controlPoints[i]=new jt(a.x,a.y,a.z,a.w)}}getPoint(e,t=new Z){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=qi(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new Z){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=so(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}}let x,X,ne;class ro extends He{constructor(e){super(e)}load(e,t,n,s){const r=this,i=r.path===""?Be.extractUrlBase(e):r.path,a=new Fe(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(c){try{t(r.parse(c,i))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}parse(e,t){if(uo(e))x=new lo().parse(e);else{const s=ir(e);if(!ho(s))throw new Error("THREE.FBXLoader: Unknown format.");if(es(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+es(s));x=new co().parse(s)}const n=new mn(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new io(n,this.manager).parse(x)}}class io{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){X=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),r=new oo().parse(s);return this.parseScene(s,r,n),ne}parseConnections(){const e=new Map;return"Connections"in x&&x.Connections.connections.forEach(function(n){const s=n[0],r=n[1],i=n[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:i};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const c={ID:s,relationship:i};e.get(r).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in x.Objects){const n=x.Objects.Video;for(const s in n){const r=n[s],i=parseInt(s);if(e[i]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,c=typeof r.Content=="string"&&r.Content!=="";if(a||c){const l=this.parseImage(n[s]);t[r.RelativeFilename||r.Filename]=l}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in x.Objects){const n=x.Objects.Texture;for(const s in n){const r=this.parseTexture(n[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,i=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(n.wrapS=i===0?Ne:sn,n.wrapT=a===0?Ne:sn,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){let n;const s=this.textureLoader.path,r=X.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new Ot):(c.setPath(this.textureLoader.path),i=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new Ot):i=this.textureLoader.load(n);return this.textureLoader.setPath(s),i}parseMaterials(e){const t=new Map;if("Material"in x.Objects){const n=x.Objects.Material;for(const s in n){const r=this.parseMaterial(n[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!X.has(n))return null;const i=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new ht;break;case"lambert":a=new Dr;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new ht;break}return a.setValues(i),a.name=s,a}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new N().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new N().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new N().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new N().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new N().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new N().fromArray(e.SpecularColor.value));const r=this;return X.get(n).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,i.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,i.ID),s.map!==void 0&&(s.map.encoding=re);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,i.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,i.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=re);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,i.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,i.ID),s.envMap!==void 0&&(s.envMap.mapping=wr,s.envMap.encoding=re);break;case"SpecularColor":s.specularMap=r.getTexture(t,i.ID),s.specularMap!==void 0&&(s.specularMap.encoding=re);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,i.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in x.Objects&&t in x.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=X.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in x.Objects){const n=x.Objects.Deformer;for(const s in n){const r=n[s],i=X.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(i,n);a.ID=s,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(i,n),a.id=s,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const i={ID:s.ID,indices:[],weights:[],transformLink:new K().fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],i=t[r.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=X.get(parseInt(r.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){ne=new Ke;const s=this.parseModels(e.skeletons,t,n),r=x.Objects.Model,i=this;s.forEach(function(c){const l=r[c.ID];i.setLookAtProperties(c,l),X.get(c.ID).parents.forEach(function(u){const f=s.get(u.ID);f!==void 0&&f.add(c)}),c.parent===null&&ne.add(c)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),ne.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=sr(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new ao().parse();ne.children.length===1&&ne.children[0].isGroup&&(ne.children[0].animations=a,ne=ne.children[0]),ne.animations=a}parseModels(e,t,n){const s=new Map,r=x.Objects.Model;for(const i in r){const a=parseInt(i),c=r[i],l=X.get(a);let h=this.buildSkeleton(l,e,a,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,t,n);break;case"NurbsCurve":h=this.createCurve(l,t);break;case"LimbNode":case"Root":h=new on;break;case"Null":default:h=new Ke;break}h.name=c.attrName?pt.sanitizeNodeName(c.attrName):"",h.ID=a}this.getTransformData(h,c),s.set(a,h)}return s}buildSkeleton(e,t,n,s){let r=null;return e.parents.forEach(function(i){for(const a in t){const c=t[a];c.rawBones.forEach(function(l,h){if(l.ID===i.ID){const u=r;r=new on,r.matrixWorld.copy(l.transformLink),r.name=s?pt.sanitizeNodeName(s):"",r.ID=n,c.bones[h]=r,u!==null&&r.add(u)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(s){const r=x.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new wt;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let i=1e3;n.FarPlane!==void 0&&(i=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const l=a/c;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new us(h,l,r,i),u!==null&&t.setFocalLength(u);break;case 1:t=new hs(-a/2,a/2,c/2,-c/2,r,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new wt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const r=x.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new wt;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new N().fromArray(n.Color.value));let i=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(i=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:t=new nn(r,i,a,c);break;case 1:t=new is(r,i);break;case 2:let l=Math.PI/3;n.InnerAngle!==void 0&&(l=de.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=de.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new rs(r,i,a,l,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new nn(r,i);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,r=null,i=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(r=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new ht({color:13421772}),a.push(i)),"color"in r.attributes&&a.forEach(function(c){c.vertexColors=!0}),r.FBX_Deformer?(s=new as(r,i),s.normalizeSkinWeights()):s=new bt(r,i),s}createCurve(e,t){const n=e.children.reduce(function(r,i){return t.has(i.ID)&&(r=t.get(i.ID)),r},null),s=new lt({color:3342591,linewidth:1});return new ls(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=rr(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&X.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=x.Objects.Model[s.ID];if("Lcl_Translation"in r){const i=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),ne.add(e.target)):e.lookAt(new Z().fromArray(i))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const r in e){const i=e[r];X.get(parseInt(i.ID)).parents.forEach(function(c){if(t.has(c.ID)){const l=c.ID;X.get(l).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new ds(i.bones),s[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in x.Objects){const t=x.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new K().fromArray(r.Matrix.a)}):e[s.Node]=new K().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in x&&"AmbientColor"in x.GlobalSettings){const e=x.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const r=new N(t,n,s);ne.add(new Lr(r,1))}}}}class oo{parse(e){const t=new Map;if("Geometry"in x.Objects){const n=x.Objects.Geometry;for(const s in n){const r=X.get(parseInt(s)),i=this.parseGeometry(r,n[s],e);t.set(parseInt(s),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,r=[],i=e.parents.map(function(u){return x.Objects.Model[u.ID]});if(i.length===0)return;const a=e.children.reduce(function(u,f){return s[f.ID]!==void 0&&(u=s[f.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&r.push(n.morphTargets[u.ID])});const c=i[0],l={};"RotationOrder"in c&&(l.eulerOrder=rr(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const h=sr(l);return this.genGeometry(t,a,r,h)}genGeometry(e,t,n,s){const r=new we;e.attrName&&(r.name=e.attrName);const i=this.parseGeoNode(e,t),a=this.genBuffers(i),c=new ue(a.vertex,3);if(c.applyMatrix4(s),r.setAttribute("position",c),a.colors.length>0&&r.setAttribute("color",new ue(a.colors,3)),t&&(r.setAttribute("skinIndex",new Sr(a.weightsIndices,4)),r.setAttribute("skinWeight",new ue(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const l=new xr().getNormalMatrix(s),h=new ue(a.normal,3);h.applyNormalMatrix(l),r.setAttribute("normal",h)}if(a.uvs.forEach(function(l,h){let u="uv"+(h+1).toString();h===0&&(u="uv"),r.setAttribute(u,new ue(a.uvs[h],2))}),i.material&&i.material.mappingType!=="AllSame"){let l=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,f){u!==l&&(r.addGroup(h,f-h,l),l=u,h=f)}),r.groups.length>0){const u=r.groups[r.groups.length-1],f=u.start+u.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,l)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,s),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(i,a){n.weightTable[i]===void 0&&(n.weightTable[i]=[]),n.weightTable[i].push({id:r,weight:s.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,r=!1,i=[],a=[],c=[],l=[],h=[],u=[];const f=this;return e.vertexIndices.forEach(function(p,A){let B,m=!1;p<0&&(p=p^-1,m=!0);let C=[],g=[];if(i.push(p*3,p*3+1,p*3+2),e.color){const d=Gt(A,n,p,e.color);c.push(d[0],d[1],d[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(d){g.push(d.weight),C.push(d.id)}),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const d=[0,0,0,0],F=[0,0,0,0];g.forEach(function(v,y){let M=v,E=C[y];F.forEach(function(I,T,R){if(M>I){R[T]=M,M=I;const D=d[T];d[T]=E,E=D}})}),C=d,g=F}for(;g.length<4;)g.push(0),C.push(0);for(let d=0;d<4;++d)h.push(g[d]),u.push(C[d])}if(e.normal){const d=Gt(A,n,p,e.normal);a.push(d[0],d[1],d[2])}e.material&&e.material.mappingType!=="AllSame"&&(B=Gt(A,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(d,F){const v=Gt(A,n,p,d);l[F]===void 0&&(l[F]=[]),l[F].push(v[0]),l[F].push(v[1])}),s++,m&&(f.genFace(t,e,i,B,a,c,l,h,u,s),n++,s=0,i=[],a=[],c=[],l=[],h=[],u=[])}),t}genFace(e,t,n,s,r,i,a,c,l,h){for(let u=2;u<h;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(u-1)*3]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[n[u*3]]),e.vertex.push(t.vertexPositions[n[u*3+1]]),e.vertex.push(t.vertexPositions[n[u*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(u-1)*4]),e.vertexWeights.push(c[(u-1)*4+1]),e.vertexWeights.push(c[(u-1)*4+2]),e.vertexWeights.push(c[(u-1)*4+3]),e.vertexWeights.push(c[u*4]),e.vertexWeights.push(c[u*4+1]),e.vertexWeights.push(c[u*4+2]),e.vertexWeights.push(c[u*4+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[u*4]),e.weightsIndices.push(l[u*4+1]),e.weightsIndices.push(l[u*4+2]),e.weightsIndices.push(l[u*4+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(u-1)*3]),e.colors.push(i[(u-1)*3+1]),e.colors.push(i[(u-1)*3+2]),e.colors.push(i[u*3]),e.colors.push(i[u*3+1]),e.colors.push(i[u*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(u-1)*3]),e.normal.push(r[(u-1)*3+1]),e.normal.push(r[(u-1)*3+2]),e.normal.push(r[u*3]),e.normal.push(r[u*3+1]),e.normal.push(r[u*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(u-1)*2]),e.uvs[p].push(a[p][(u-1)*2+1]),e.uvs[p].push(a[p][u*2]),e.uvs[p].push(a[p][u*2+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(i){i.rawTargets.forEach(function(a){const c=x.Objects.Geometry[a.geoID];c!==void 0&&r.genMorphGeometry(e,t,c,s,a.name)})})}genMorphGeometry(e,t,n,s,r){const i=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],l=e.attributes.position.count*3,h=new Float32Array(l);for(let A=0;A<c.length;A++){const B=c[A]*3;h[B]=a[A*3],h[B+1]=a[A*3+1],h[B+2]=a[A*3+2]}const u={vertexIndices:i,vertexPositions:h},f=this.genBuffers(u),p=new ue(f.vertex,3);p.name=r||n.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,r=[];for(let i=0;i<s.length;++i)r.push(i);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(qn===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new we;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new we;const n=t-1,s=e.KnotVector.a,r=[],i=e.Points.a;for(let u=0,f=i.length;u<f;u+=4)r.push(new jt().fromArray(i,u));let a,c;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,c=s.length-1-a;for(let u=0;u<n;++u)r.push(r[u])}const h=new qn(n,s,r,a,c).getPoints(r.length*12);return new we().setFromPoints(h)}}class ao{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],r=this.addClip(s);e.push(r)}return e}parseClips(){if(x.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=x.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=x.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(fo),values:t[n].KeyValueFloat.a},r=X.get(s.id);if(r!==void 0){const i=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=s:a.match(/Y/)?e.get(i).curves.y=s:a.match(/Z/)?e.get(i).curves.z=s:a.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=s)}}}parseAnimationLayers(e){const t=x.Objects.AnimationLayer,n=new Map;for(const s in t){const r=[],i=X.get(parseInt(s));i!==void 0&&(i.children.forEach(function(c,l){if(e.has(c.ID)){const h=e.get(c.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[l]===void 0){const u=X.get(c.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(u!==void 0){const f=x.Objects.Model[u.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const p={modelName:f.attrName?pt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ne.traverse(function(A){A.ID===f.id&&(p.transform=A.matrix,A.userData.transformData&&(p.eulerOrder=A.userData.transformData.eulerOrder))}),p.transform||(p.transform=new K),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[l]=p}}r[l]&&(r[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[l]===void 0){const u=X.get(c.ID).parents.filter(function(C){return C.relationship!==void 0})[0].ID,f=X.get(u).parents[0].ID,p=X.get(f).parents[0].ID,A=X.get(p).parents[0].ID,B=x.Objects.Model[A],m={modelName:B.attrName?pt.sanitizeNodeName(B.attrName):"",morphName:x.Objects.Deformer[u].attrName};r[l]=m}r[l][h.attr]=h}}}),n.set(parseInt(s),r))}return n}parseAnimStacks(e){const t=x.Objects.AnimationStack,n={};for(const s in t){const r=X.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(r[0].ID);n[s]={name:t[s].attrName,layer:i}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new As(e.name,-1,t)}generateTracks(e){const t=[];let n=new Z,s=new it,r=new Z;if(e.transform&&e.transform.decompose(n,s,r),n=n.toArray(),s=new ot().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,s){const r=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(r,t,n);return new fs(e+"."+s,r,i)}generateRotationTrack(e,t,n,s,r,i){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(de.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(de.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(de.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);s!==void 0&&(s=s.map(de.degToRad),s.push(i),s=new ot().fromArray(s),s=new it().setFromEuler(s)),r!==void 0&&(r=r.map(de.degToRad),r.push(i),r=new ot().fromArray(r),r=new it().setFromEuler(r).invert());const l=new it,h=new ot,u=[];for(let f=0;f<c.length;f+=3)h.set(c[f],c[f+1],c[f+2],i),l.setFromEuler(h),s!==void 0&&l.premultiply(s),r!==void 0&&l.multiply(r),l.toArray(u,f/3*4);return new rn(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),s=ne.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ps(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==s&&(t[n]=i,s=i,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,r=[];let i=-1,a=-1,c=-1;return e.forEach(function(l){if(t.x&&(i=t.x.times.indexOf(l)),t.y&&(a=t.y.times.indexOf(l)),t.z&&(c=t.z.times.indexOf(l)),i!==-1){const h=t.x.values[i];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(c!==-1){const h=t.z.values[c];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],s=e.values[t]-n,r=Math.abs(s);if(r>=180){const i=r/180,a=s/i;let c=n+a;const l=e.times[t-1],u=(e.times[t]-l)/i;let f=l+u;const p=[],A=[];for(;f<e.times[t];)p.push(f),f+=u,A.push(c),c+=a;e.times=ts(e.times,t,p),e.values=ts(e.values,t,A)}}}}class co{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new nr,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,r){const i=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(i||a)return;const c=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),l=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(s,c):l?t.parseNodeProperty(s,l,n[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},i=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),i.id!==""&&(a[n][i.id]=r)):typeof i.id=="number"?(a[n]={},a[n][i.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof i.id=="number"&&(r.id=i.id),i.name!==""&&(r.attrName=i.name),i.type!==""&&(r.attrType=i.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const c=r.split(",").slice(1),l=parseInt(c[0]),h=parseInt(c[1]);let u=r.split(",").slice(3);u=u.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[l,h],Ao(r,u),i[s]===void 0&&(i[s]=[])}s==="Node"&&(i.id=r),s in i&&Array.isArray(i[s])?i[s].push(r):s!=="a"?i[s]=r:i.a=r,this.setCurrentProp(i,s),s==="a"&&r.slice(-1)!==","&&(i.a=zt(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=zt(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],i=s[1],a=s[2],c=s[3];let l=s[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=zt(l);break}this.getPrevNode()[r]={type:i,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class lo{parse(e){const t=new $n(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new nr;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(s===0)return null;const c=[];for(let f=0;f<r;f++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",h=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(n.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=c,typeof l=="number"&&(n.id=l),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(r,i){i!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[s]={type:r,type2:i,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),i=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof Wi=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=mt(new Uint8Array(e.getArrayBuffer(i))),c=new $n(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class $n{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Be.decodeText(new Uint8Array(t))}}class nr{add(e,t){this[e]=t}}function uo(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===ir(o,0,e.length)}function ho(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(s){const r=o[s-1];return o=o.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function es(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function fo(o){return o/46186158e3}const po=[];function Gt(o,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=o;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const r=s*n.dataSize,i=r+n.dataSize;return Bo(po,n.buffer,r,i)}const Wt=new ot,Ue=new Z;function sr(o){const e=new K,t=new K,n=new K,s=new K,r=new K,i=new K,a=new K,c=new K,l=new K,h=new K,u=new K,f=new K,p=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(Ue.fromArray(o.translation)),o.preRotation){const T=o.preRotation.map(de.degToRad);T.push(o.eulerOrder),t.makeRotationFromEuler(Wt.fromArray(T))}if(o.rotation){const T=o.rotation.map(de.degToRad);T.push(o.eulerOrder),n.makeRotationFromEuler(Wt.fromArray(T))}if(o.postRotation){const T=o.postRotation.map(de.degToRad);T.push(o.eulerOrder),s.makeRotationFromEuler(Wt.fromArray(T)),s.invert()}o.scale&&r.scale(Ue.fromArray(o.scale)),o.scalingOffset&&a.setPosition(Ue.fromArray(o.scalingOffset)),o.scalingPivot&&i.setPosition(Ue.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(Ue.fromArray(o.rotationOffset)),o.rotationPivot&&l.setPosition(Ue.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(u.copy(o.parentMatrix),h.copy(o.parentMatrixWorld));const A=t.clone().multiply(n).multiply(s),B=new K;B.extractRotation(h);const m=new K;m.copyPosition(h);const C=m.clone().invert().multiply(h),g=B.clone().invert().multiply(C),d=r,F=new K;if(p===0)F.copy(B).multiply(A).multiply(g).multiply(d);else if(p===1)F.copy(B).multiply(g).multiply(A).multiply(d);else{const R=new K().scale(new Z().setFromMatrixScale(u)).clone().invert(),D=g.clone().multiply(R);F.copy(B).multiply(A).multiply(D).multiply(d)}const v=l.clone().invert(),y=i.clone().invert();let M=e.clone().multiply(c).multiply(l).multiply(t).multiply(n).multiply(s).multiply(v).multiply(a).multiply(i).multiply(r).multiply(y);const E=new K().copyPosition(M),I=h.clone().multiply(E);return f.copyPosition(I),M=f.clone().multiply(F),M.premultiply(h.invert()),M}function rr(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function zt(o){return o.split(",").map(function(t){return parseFloat(t)})}function ir(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),Be.decodeText(new Uint8Array(o,e,t))}function Ao(o,e){for(let t=0,n=o.length,s=e.length;t<s;t++,n++)o[n]=e[t]}function Bo(o,e,t,n){for(let s=t,r=0;s<n;s++,r++)o[r]=e[s];return o}function ts(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}const qt=new WeakMap;class mo extends He{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new Fe(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,i=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(i,a).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const l=t.attributeTypes[c];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=l.name)}const n=JSON.stringify(t);if(qt.has(e)){const c=qt.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,i=e.byteLength,a=this._getWorker(r,i).then(c=>(s=c,new Promise((l,h)=>{s._callbacks[r]={resolve:l,reject:h},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),qt.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new we;e.index&&t.setIndex(new Pt(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,i=s.array,a=s.itemSize;t.setAttribute(r,new Pt(i,a))}return t}_loadLibrary(e,t){const n=new Fe(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=Co.toString(),i=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const i=r.data;switch(i.type){case"decode":s._callbacks[i.id].resolve(i);break;case"error":s._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Co(){let o,e;onmessage=function(i){const a=i.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(h){o.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,l=a.taskConfig;e.then(h=>{const u=h.draco,f=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(c),c.byteLength);try{const A=t(u,f,p,l),B=A.attributes.map(m=>m.array.buffer);A.index&&B.push(A.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:A},B)}catch(A){console.error(A),self.postMessage({type:"error",id:a.id,error:A.message})}finally{u.destroy(p),u.destroy(f)}});break}};function t(i,a,c,l){const h=l.attributeIDs,u=l.attributeTypes;let f,p;const A=a.GetEncodedGeometryType(c);if(A===i.TRIANGULAR_MESH)f=new i.Mesh,p=a.DecodeBufferToMesh(c,f);else if(A===i.POINT_CLOUD)f=new i.PointCloud,p=a.DecodeBufferToPointCloud(c,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const B={index:null,attributes:[]};for(const m in h){const C=self[u[m]];let g,d;if(l.useUniqueIDs)d=h[m],g=a.GetAttributeByUniqueId(f,d);else{if(d=a.GetAttributeId(f,i[h[m]]),d===-1)continue;g=a.GetAttribute(f,d)}B.attributes.push(s(i,a,f,m,C,g))}return A===i.TRIANGULAR_MESH&&(B.index=n(i,a,f)),i.destroy(f),B}function n(i,a,c){const h=c.num_faces()*3,u=h*4,f=i._malloc(u);a.GetTrianglesUInt32Array(c,u,f);const p=new Uint32Array(i.HEAPF32.buffer,f,h).slice();return i._free(f),{array:p,itemSize:1}}function s(i,a,c,l,h,u){const f=u.num_components(),A=c.num_points()*f,B=A*h.BYTES_PER_ELEMENT,m=r(i,h),C=i._malloc(B);a.GetAttributeDataArrayForAllPoints(c,u,m,B,C);const g=new h(i.HEAPF32.buffer,C,A).slice();return i._free(C),{name:l,array:g,itemSize:f}}function r(i,a){switch(a){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}class go{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:s,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Fo=2,Eo=1,$t=new WeakMap;let en=0;class ge extends He{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new go,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new Fe(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new Fe(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const s=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,i])=>{const a=ge.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(ge.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ge.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ge.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=i,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})}),en>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),en++}return this.transcoderPending}load(e,t,n,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Fe(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const i=new Hn;return r.load(e,a=>{if($t.has(a))return $t.get(a).promise.then(t).catch(s);this._createTexture([a]).then(function(c){i.copy(c),i.needsUpdate=!0,t&&t(i)}).catch(s)},n,s),i}_createTextureFrom(e){const{mipmaps:t,width:n,height:s,format:r,type:i,error:a,dfdTransferFn:c,dfdFlags:l}=e;if(i==="error")return Promise.reject(a);const h=new Hn(t,n,s,r,br);return h.minFilter=t.length===1?Xe:gn,h.magFilter=Xe,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=c===Fo?re:ss,h.premultiplyAlpha=!!(l&Eo),h}_createTexture(e,t={}){const n=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(r=>this._createTextureFrom(r.data));return $t.set(e[0],{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),en--,this}}ge.BasisFormat={ETC1S:0,UASTC_4x4:1};ge.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};ge.EngineFormat={RGBAFormat:Bs,RGBA_ASTC_4x4_Format:Hr,RGBA_BPTC_Format:Pr,RGBA_ETC2_EAC_Format:Or,RGBA_PVRTC_4BPPV1_Format:_r,RGBA_S3TC_DXT5_Format:ms,RGB_ETC1_Format:Cs,RGB_ETC2_Format:Ur,RGB_PVRTC_4BPPV1_Format:Jr,RGB_S3TC_DXT1_Format:gs};ge.BasisWorker=function(){let o,e,t;const n=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(p){const A=p.data;switch(A.type){case"init":o=A.config,i(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:B,height:m,hasAlpha:C,mipmaps:g,format:d,dfdTransferFn:F,dfdFlags:v}=a(A.buffers[0]),y=[];for(let M=0;M<g.length;++M)y.push(g[M].data.buffer);self.postMessage({type:"transcode",id:A.id,width:B,height:m,hasAlpha:C,mipmaps:g,format:d,dfdTransferFn:F,dfdFlags:v},y)}catch(B){console.error(B),self.postMessage({type:"error",id:A.id,error:B.message})}});break}});function i(p){e=new Promise(A=>{t={wasmBinary:p,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(p){const A=new t.KTX2File(new Uint8Array(p));function B(){A.close(),A.delete()}if(!A.isValid())throw B(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const m=A.isUASTC()?r.UASTC_4x4:r.ETC1S,C=A.getWidth(),g=A.getHeight(),d=A.getLevels(),F=A.getHasAlpha(),v=A.getDFDTransferFunc(),y=A.getDFDFlags(),{transcoderFormat:M,engineFormat:E}=u(m,C,g,F);if(!C||!g||!d)throw B(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw B(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[];for(let T=0;T<d;T++){const R=A.getImageLevelInfo(T,0,0),D=R.origWidth,G=R.origHeight,w=new Uint8Array(A.getImageTranscodedSizeInBytes(T,0,0,M));if(!A.transcodeImage(w,T,0,0,M,0,-1,-1))throw B(),new Error("THREE.KTX2Loader: .transcodeImage failed.");I.push({data:w,width:D,height:G})}return B(),{width:C,height:g,hasAlpha:F,mipmaps:I,format:E,dfdTransferFn:v,dfdFlags:y}}const c=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=c.sort(function(p,A){return p.priorityETC1S-A.priorityETC1S}),h=c.sort(function(p,A){return p.priorityUASTC-A.priorityUASTC});function u(p,A,B,m){let C,g;const d=p===r.ETC1S?l:h;for(let F=0;F<d.length;F++){const v=d[F];if(!!o[v.if]&&!!v.basisFormat.includes(p)&&!(m&&v.transcoderFormat.length<2)&&!(v.needsPowerOfTwo&&!(f(A)&&f(B))))return C=v.transcoderFormat[m?1:0],g=v.engineFormat[m?1:0],{transcoderFormat:C,engineFormat:g}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),C=s.RGBA32,g=n.RGBAFormat,{transcoderFormat:C,engineFormat:g}}function f(p){return p<=2?!0:(p&p-1)===0&&p!==0}};class yo extends kr{constructor(e){super(e)}parse(e,t){const n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,r=131072,i=512,a=1024,c=2048,l=4096,h=8192,u=16384,f=32768;function p(_){return _.charCodeAt(0)+(_.charCodeAt(1)<<8)+(_.charCodeAt(2)<<16)+(_.charCodeAt(3)<<24)}function A(_){return String.fromCharCode(_&255,_>>8&255,_>>16&255,_>>24&255)}function B(_,ie,te,oe){const ye=te*oe*4,ae=new Uint8Array(_,ie,ye),me=new Uint8Array(ye);let Ae=0,Re=0;for(let _e=0;_e<oe;_e++)for(let bn=0;bn<te;bn++){const or=ae[Re];Re++;const ar=ae[Re];Re++;const cr=ae[Re];Re++;const lr=ae[Re];Re++,me[Ae]=cr,Ae++,me[Ae]=ar,Ae++,me[Ae]=or,Ae++,me[Ae]=lr,Ae++}return me}const m=p("DXT1"),C=p("DXT3"),g=p("DXT5"),d=p("ETC1"),F=31,v=0,y=1,M=2,E=3,I=4,T=7,R=21,D=22,G=23,w=24,L=25,O=26,H=28,S=new Int32Array(e,0,F);if(S[v]!==s)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;let k;const z=S[R];let V=!1;switch(z){case m:k=8,n.format=gs;break;case C:k=16,n.format=Kr;break;case g:k=16,n.format=ms;break;case d:k=8,n.format=Cs;break;default:if(S[D]===32&&S[G]&16711680&&S[w]&65280&&S[L]&255&&S[O]&4278190080)V=!0,k=64,n.format=Bs;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",A(z)),n}n.mipmapCount=1,S[M]&r&&t!==!1&&(n.mipmapCount=Math.max(1,S[T]));const Q=S[H];if(n.isCubemap=!!(Q&i),n.isCubemap&&(!(Q&a)||!(Q&c)||!(Q&l)||!(Q&h)||!(Q&u)||!(Q&f)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=S[I],n.height=S[E];let ee=S[y]+4;const W=n.isCubemap?6:1;for(let _=0;_<W;_++){let ie=n.width,te=n.height;for(let oe=0;oe<n.mipmapCount;oe++){let ye,ae;V?(ye=B(e,ee,ie,te),ae=ye.length):(ae=Math.max(4,ie)/4*Math.max(4,te)/4*k,ye=new Uint8Array(e,ee,ae));const me={data:ye,width:ie,height:te};n.mipmaps.push(me),ee+=ae,ie=Math.max(ie>>1,1),te=Math.max(te>>1,1)}}return n}}var Mo=function(){var o="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",e="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",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};var s=o;WebAssembly.validate(t)&&(s=e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));var r,i=WebAssembly.instantiate(a(s),{}).then(function(u){r=u.instance,r.exports.__wasm_call_ctors()});function a(u){for(var f=new Uint8Array(u.length),p=0;p<u.length;++p){var A=u.charCodeAt(p);f[p]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}for(var B=0,p=0;p<u.length;++p)f[B++]=f[p]<60?n[f[p]]:(f[p]-60)*64+f[++p];return f.buffer.slice(0,B)}function c(u,f,p,A,B,m){var C=r.exports.sbrk,g=p+3&-4,d=C(g*A),F=C(B.length),v=new Uint8Array(r.exports.memory.buffer);v.set(B,F);var y=u(d,p,A,F,B.length);if(y==0&&m&&m(d,g,A),f.set(v.subarray(d,d+p*A)),C(d-C(0)),y!=0)throw new Error("Malformed buffer data: "+y)}var l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeVertexBuffer:function(u,f,p,A,B){c(r.exports.meshopt_decodeVertexBuffer,u,f,p,A,r.exports[l[B]])},decodeIndexBuffer:function(u,f,p,A){c(r.exports.meshopt_decodeIndexBuffer,u,f,p,A)},decodeIndexSequence:function(u,f,p,A){c(r.exports.meshopt_decodeIndexSequence,u,f,p,A)},decodeGltfBuffer:function(u,f,p,A,B,m){c(r.exports[h[B]],u,f,p,A,r.exports[l[m]])}}}(),To=Object.defineProperty,vo=(o,e,t)=>e in o?To(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,q=(o,e,t)=>(vo(o,typeof e!="symbol"?e+"":e,t),t);const at=class extends He{constructor(o){super(o)}load(o,e,t,n){this.path!==void 0&&(o=this.path+o),this.manager.itemStart(o),o=this.manager.resolveURL(o);const s=Pn.get(o);if(s!==void 0)return setTimeout(()=>{e&&e(s),this.manager.itemEnd(o)},0),s;const r=document.createElement("video");return r.preload=at.preload,r.autoplay=at.autoplay,r.loop=at.loop,r.muted=at.muted,r.src=o,r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.zIndex="-1",document.body.appendChild(r),r.oncanplay=()=>{Pn.add(o,r),this.manager.itemEnd(o),e&&e(r)},r.onerror=i=>{this.manager.itemEnd(o),n&&n(i)},r}};let Mt=at;q(Mt,"autoplay",!0);q(Mt,"preload","auto");q(Mt,"muted",!0);q(Mt,"loop",!0);var ct=(o=>(o.BEFORELOAD="beforeLoad",o.LOADING="loading",o.DETAILLOADING="detailLoading",o.DETAILLOADED="detailLoaded",o.LOADED="loaded",o))(ct||{});class Io extends jr{constructor(e){super(),q(this,"resourceMap"),q(this,"loaderMap"),q(this,"urlList",[]),q(this,"loadTotal"),q(this,"loadSuccess"),q(this,"loadError"),q(this,"isError"),q(this,"isLoading"),q(this,"isLoaded"),q(this,"loadDetailMap"),q(this,"path",""),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new Nr,n=new Mt,s=new ti;s.setDRACOLoader(new mo),s.setKTX2Loader(new ge),s.setMeshoptDecoder(Mo),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new zr,mtl:new qr,mp4:n,webm:n,ogg:n,hdr:new ei,gltf:s,glb:s,fbx:new ro,dds:new yo},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:"loaded",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(t=>{t.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(t=>{t.setResponseType&&t.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var t;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:"beforeLoad",urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const n=this.resourceMap,s=this.loaderMap,r=this.loadDetailMap;for(const i of e){let a,c;typeof i=="string"?(a=i,c=((t=a.split(".").pop())==null?void 0:t.toLocaleLowerCase())||""):(a=i.url,c=i.ext.toLocaleLowerCase(),c.startsWith(".")&&(c=c.slice(1)));const l={url:a,progress:0,error:!1,message:a};if(r[a]=l,n.has(a)){l.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!c){l.message=`url: ${a} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(l.message),l.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const h=s[c];if(!h){l.message=`url: ${a} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(l.message),l.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const u=a.replace(/\\/g,"/").split("/"),f=u.pop(),p=this.path+u.join("/")+"/";h.setPath(p).loadAsync(f,A=>{l.progress=Number((A.loaded/A.total).toFixed(2)),this.dispatchEvent({type:"detailLoading",detail:l})}).then(A=>{l.progress=1,this.loadSuccess+=1,this.resourceMap.set(a,A),this.urlList.push(i),this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(A=>{l.error=!0,l.message=JSON.stringify(A),this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const Ro="@vis-three/plugin-loader-manager",Go=Xr(Ro),Lo=function(o){return{name:Go,install(e){const t=new Io(o);o!=null&&o.path&&t.setPath(o.path),e.loaderManager=t,e.loadResources=(n,s)=>{const r=i=>{s(void 0,i),t.removeEventListener(ct.LOADED,r)};try{t.addEventListener(ct.LOADED,r)}catch(i){s(i)}return t.load(n),e},e.loadResourcesAsync=n=>new Promise((s,r)=>{const i=a=>{s(a),t.removeEventListener(ct.LOADED,i)};try{t.addEventListener(ct.LOADED,i)}catch(a){r(a)}t.load(n)})},dispose(e){e.loaderManager.dispose(),delete e.loaderManager,delete e.loadResources,delete e.loadResourcesAsync}}};export{Lo as L,Go as a,ct as b};
