import{E as p}from"./vis-three.middleware.es.2e80d21b.js";import{W as c,C as l}from"./index.1d7ad8b9.js";import{E as m}from"./index.388dadd4.js";import{O as d}from"./index.763ed6df.js";import{S as g}from"./index.62992928.js";import{A as u}from"./index.a87f8394.js";import{G as w}from"./index.9a7b1aa5.js";import{V as S}from"./index.8de980d1.js";import{S as v,T as f}from"./index.f4f5b765.js";import{S as y}from"./index.9f3e0a95.js";import{K as P}from"./vis-three.plugin-keyboard-manager.es.9570acee.js";import{C as M,a as x}from"./index.dfadcd6f.js";import{C as E,a as b}from"./index.ddb76977.js";import{E as B}from"./index.b828c96c.js";import{O as C}from"./index.cfcd8596.js";import{O as F}from"./index.f7cac396.js";import{T as D}from"./index.9dfaa1ec.js";import{S as O}from"./index.484afc60.js";import{G as R}from"./index.29f340c8.js";import{T as W}from"./index.cfa4ec79.js";import{m as L,C as T,a as G}from"./index.ec2b829b.js";import{W as N}from"./index.aa7ffc23.js";import{T as A}from"./index.e327b72e.js";import{O as _}from"./vis-three.strategy-orbit-controls-support.es.7f0e9f15.js";import{p as I}from"./vis-three.library-parser.es.80d54b6a.js";import{t as V,b as k,a as s}from"./index.7d48aff8.js";import{a as H}from"./vis-three.plugin-pointer-manager.es.86f17451.js";import{O as U,bJ as j,q as n,M as Q,b2 as o,a9 as z,w as K,Q as h}from"./three.837c9bb0.js";import{M as q}from"./vis-three.strategy-multi-renderer.es.c7860e7e.js";var J=Object.defineProperty,X=(i,e,t)=>e in i?J(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,a=(i,e,t)=>(X(i,typeof e!="symbol"?e+"":e,t),t);const Y="@vis-three/plugin-path-drawing";class Z extends k{constructor(e){super(),a(this,"camera",new U(-window.innerWidth,window.innerWidth,window.innerHeight,-window.innerHeight,0,1e4)),a(this,"plane",new j(new n(0,0,1),0)),a(this,"boardOffset",20),a(this,"drawingBoard",new Q(new o(150,150),new z({transparent:!0,opacity:.2,color:"rgb(64, 255, 242)"}))),a(this,"relativeMatrixInvert",new K),a(this,"engine"),a(this,"cachePoint",new n),a(this,"cacheRelativePoint",new n),a(this,"begun",!1),a(this,"setScene",t=>{this.drawingBoard.parent&&t.scene.add(this.drawingBoard)}),a(this,"cacheBeginWriteFun",t=>{const r=this.engine.pointerManager;this.cacheWriteFun(t),r.addEventListener("mousedown",this.cacheWriteFun),r.addEventListener("pointermove",this.cacheMoveFun),r.removeEventListener("mousedown",this.cacheBeginWriteFun),this.begun=!0}),a(this,"cacheWriteFun",t=>{const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"write",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})}),a(this,"cacheMoveFun",t=>{const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"move",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})}),this.engine=e,this.drawingBoard.raycast=()=>{},this.drawingBoard.matrixAutoUpdate=!1,this.setDrawingBoardMatrix(),e.addEventListener(s.SETSCENE,this.setScene)}setDraingBoardSize(e,t){const r=new o(e,t);this.drawingBoard.geometry.copy(r),r.dispose()}offsetCamera(e){const t=e.length();return e.normalize().applyQuaternion(new h().setFromUnitVectors(new n(0,1,0),this.plane.normal)),this.camera.position.copy(this.plane.normal).multiplyScalar(this.plane.constant).add(e.multiplyScalar(t)),this.camera.zoom=(this.camera.top-this.camera.bottom)/(this.drawingBoard.geometry.parameters.height+this.boardOffset),this.camera.updateProjectionMatrix(),this.drawingBoard.position.add(e),this.drawingBoard.updateMatrix(),this.drawingBoard.updateMatrixWorld(!0),this}setRelativeObject(e){return this.relativeMatrixInvert.copy(e.matrixWorld).invert(),this}setDrawPlane(e,t=0){return this.plane.set(e,t),this.setDrawingBoardMatrix(),this}setDrawPlaneByFace(e){return this.plane.setFromCoplanarPoints(e.a,e.b,e.c),this.setDrawingBoardMatrix(),this}setDrawingBoardMatrix(){const e=this.drawingBoard;e.position.copy(this.plane.normal).multiplyScalar(this.plane.constant),e.applyQuaternion(new h().setFromUnitVectors(new n(0,0,1),this.plane.normal)),e.updateMatrix(),e.updateMatrixWorld(!0)}dispose(){this.drawingBoard.removeFromParent(),this.drawingBoard.geometry.dispose(),this.drawingBoard.material.dispose(),this.engine.removeEventListener(s.SETSCENE,this.setScene)}showDrawingBoard(e){return e?this.engine.scene.add(this.drawingBoard):this.engine.scene.remove(this.drawingBoard),this}setSketcherByPlane(e=new n(0,0,1),t=0,r=new n(0,50,0)){return this.setDrawPlane(e,t).offsetCamera(r)}setSketcherByFace(e,t=new n(0,50,0)){return this.setDrawPlaneByFace(e).offsetCamera(t)}setSketcherByFaceAndObject(e,t){const r=new n().setFromMatrixPosition(t.matrixWorld);return this.setRelativeObject(t),this.setSketcherByFace(e,r)}changeToDrawingView(){return this.engine.setCamera(this.camera),this}beginDraw(){return this.dispatchEvent({type:"begin"}),this.begun=!1,this.engine.pointerManager.addEventListener("mousedown",this.cacheBeginWriteFun),this}endDraw(e=!0){const t=this.engine.pointerManager;return t.removeEventListener("mousedown",this.cacheWriteFun),t.removeEventListener("pointermove",this.cacheMoveFun),this.dispatchEvent({type:"end"}),e&&(this.begun||this.engine.pointerManager.removeEventListener("mousedown",this.cacheBeginWriteFun),this.removeEvent("begin"),this.removeEvent("write"),this.removeEvent("move"),this.removeEvent("end")),this.begun=!1,this}}const $=V(Y),ee=function(){return{name:$,deps:[H],install(i){const e=new Z(i);i.pathSketcher=e},dispose(i){i.pathSketcher.dispose(),delete i.pathSketcher}}};class Oe extends p{constructor(){super();for(const e of Object.values(L))this.registModule(e);for(const e of Object.values(I))this.resourceManager.addParser(new e);this.install(c({antialias:!0,alpha:!0})).install(M()).install(E()).install(m({MSAA:!0})).install(d()).install(l()).install(v()).install(g()).install(u()).install(w()).install(S()).install(f()).install(y()).install(P()).install(ee()),this.exec(x()).exec(b()).exec(B()).exec(C()).exec(F()).exec(D()).exec(O()).exec(R()).exec(W()).exec(T()).exec(N()).exec(A()).exec(_()).exec(G()).exec(q())}}export{Oe as M};
