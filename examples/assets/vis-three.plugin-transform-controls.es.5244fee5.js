import{t as lt,b as A}from"./curve.0ba3d968.js";import{G as j,w as r,Q as b,aU as ct,I as R,am as G,au as B,a4 as pt,bO as v,B as f,J as F,K as N,M as a,L as l,c5 as Q,bv as Y,bL as L,bM as mt,O as dt,l as U,E as ut}from"./three.3f33d046.js";const wt="@vis-three/plugin-transform-controls";class _t extends j{constructor(){super(),this.enabled=!0,this.mode="position",this.space="local",this.gizmo={},this.picker={},this.helper={},this.axis="XYZ",this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null,this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.rotationAngle=0,this._tempVector=new r,this._identityQuaternion=new b,this._tempEuler=new ct,this._alignVector=new r(0,1,0),this._zeroVector=new r(0,0,0),this._lookAtMatrix=new R,this._tempQuaternion=new b,this._tempQuaternion2=new b,this._unitX=new r(1,0,0),this._unitY=new r(0,1,0),this._unitZ=new r(0,0,1),this.type="TransformControlsGizmo";const n=new G({depthTest:!1,depthWrite:!1,transparent:!0,side:B,fog:!1,toneMapped:!1}),e=new pt({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,toneMapped:!1}),o=n.clone();o.opacity=.15;const i=n.clone();i.opacity=.33;const t=n.clone();t.color.set(16711680);const c=n.clone();c.color.set(65280);const s=n.clone();s.color.set(255);const _=n.clone();_.opacity=.25;const I=_.clone();I.color.set(16776960);const W=_.clone();W.color.set(65535);const z=_.clone();z.color.set(16711935),n.clone().color.set(16776960);const X=e.clone();X.color.set(16711680);const Z=e.clone();Z.color.set(65280);const V=e.clone();V.color.set(255);const P=e.clone();P.color.set(65535);const E=e.clone();E.color.set(16711935);const S=e.clone();S.color.set(16776960);const T=e.clone();T.color.set(7895160);const u=S.clone();u.opacity=.25;const y=new v(0,.05,.2,12,1,!1),m=new f(.125,.125,.125),h=new F;h.setAttribute("position",new N([0,0,0,1,0,0],3));function O(w,C){const M=new F,x=[];for(let p=0;p<=64*C;++p)x.push(0,Math.cos(p/32*Math.PI)*w,Math.sin(p/32*Math.PI)*w);return M.setAttribute("position",new N(x,3)),M}function K(){const w=new F;return w.setAttribute("position",new N([0,0,0,1,1,1],3)),w}const $={X:[[new a(y,t),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new a(y,t),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new l(h,X)]],Y:[[new a(y,c),[0,1,0],null,null,"fwd"],[new a(y,c),[0,1,0],[Math.PI,0,0],null,"bwd"],[new l(h,Z),null,[0,0,Math.PI/2]]],Z:[[new a(y,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new a(y,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new l(h,V),null,[0,-Math.PI/2,0]]],XYZ:[[new a(new Q(.1,0),_.clone()),[0,0,0],[0,0,0]]],XY:[[new a(new Y(.295,.295),I.clone()),[.15,.15,0]],[new l(h,S),[.18,.3,0],null,[.125,1,1]],[new l(h,S),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a(new Y(.295,.295),W.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new l(h,P),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new l(h,P),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a(new Y(.295,.295),z.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new l(h,E),[.18,0,.3],null,[.125,1,1]],[new l(h,E),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},tt={X:[[new a(new v(.2,0,1,4,1,!1),o),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new a(new v(.2,0,1,4,1,!1),o),[0,.6,0]]],Z:[[new a(new v(.2,0,1,4,1,!1),o),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new a(new Q(.2,0),o)]],XY:[[new a(new Y(.4,.4),o),[.2,.2,0]]],YZ:[[new a(new Y(.4,.4),o),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new a(new Y(.4,.4),o),[.2,0,.2],[-Math.PI/2,0,0]]]},et={START:[[new a(new Q(.01,2),i),null,null,null,"helper"]],END:[[new a(new Q(.01,2),i),null,null,null,"helper"]],DELTA:[[new l(K(),i),null,null,null,"helper"]],X:[[new l(h,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l(h,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l(h,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},it={X:[[new l(O(1,.5),X)],[new a(new Q(.04,0),t),[0,0,.99],null,[1,3,1]]],Y:[[new l(O(1,.5),Z),null,[0,0,-Math.PI/2]],[new a(new Q(.04,0),c),[0,0,.99],null,[3,1,1]]],Z:[[new l(O(1,.5),V),null,[0,Math.PI/2,0]],[new a(new Q(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new l(O(1.25,1),u),null,[0,Math.PI/2,0]],[new a(new v(.03,0,.15,4,1,!1),u),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new a(new v(.03,0,.15,4,1,!1),u),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new a(new v(.03,0,.15,4,1,!1),u),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new a(new v(.03,0,.15,4,1,!1),u),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new l(O(1,1),T),null,[0,Math.PI/2,0]]]},nt={AXIS:[[new l(h,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},ot={X:[[new a(new L(1,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a(new L(1,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a(new L(1,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a(new L(1.25,.1,2,24),o)]],XYZE:[[new a(new mt(.7,10,8),o)]]},st={X:[[new a(m,t),[.8,0,0],[0,0,-Math.PI/2]],[new l(h,X),null,null,[.8,1,1]]],Y:[[new a(m,c),[0,.8,0]],[new l(h,Z),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new a(m,s),[0,0,.8],[Math.PI/2,0,0]],[new l(h,V),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new a(m,I),[.85,.85,0],null,[2,2,.2]],[new l(h,S),[.855,.98,0],null,[.125,1,1]],[new l(h,S),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a(m,W),[0,.85,.85],null,[.2,2,2]],[new l(h,P),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new l(h,P),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a(m,z),[.85,0,.85],null,[2,.2,2]],[new l(h,E),[.855,0,.98],null,[.125,1,1]],[new l(h,E),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new a(new f(.125,.125,.125),_.clone()),[1.1,0,0]]],XYZY:[[new a(new f(.125,.125,.125),_.clone()),[0,1.1,0]]],XYZZ:[[new a(new f(.125,.125,.125),_.clone()),[0,0,1.1]]]},at={X:[[new a(new v(.2,0,.8,4,1,!1),o),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new a(new v(.2,0,.8,4,1,!1),o),[0,.5,0]]],Z:[[new a(new v(.2,0,.8,4,1,!1),o),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new a(m,o),[.85,.85,0],null,[3,3,.2]]],YZ:[[new a(m,o),[0,.85,.85],null,[.2,3,3]]],XZ:[[new a(m,o),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new a(new f(.2,.2,.2),o),[1.1,0,0]]],XYZY:[[new a(new f(.2,.2,.2),o),[0,1.1,0]]],XYZZ:[[new a(new f(.2,.2,.2),o),[0,0,1.1]]]},rt={X:[[new l(h,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new l(h,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new l(h,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function g(w){const C=new j;for(const M in w)for(let x=w[M].length;x--;){const p=w[M][x][0].clone(),D=w[M][x][1],k=w[M][x][2],q=w[M][x][3],ht=w[M][x][4];p.name=M,p.tag=ht,D&&p.position.set(D[0],D[1],D[2]),k&&p.rotation.set(k[0],k[1],k[2]),q&&p.scale.set(q[0],q[1],q[2]),p.updateMatrix();const H=p.geometry.clone();H.applyMatrix4(p.matrix),p.geometry=H,p.renderOrder=1/0,p.position.set(0,0,0),p.rotation.set(0,0,0),p.scale.set(1,1,1),C.add(p)}return C}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.position=g($)),this.add(this.gizmo.rotation=g(it)),this.add(this.gizmo.scale=g(st)),this.add(this.picker.position=g(tt)),this.add(this.picker.rotation=g(ot)),this.add(this.picker.scale=g(at)),this.add(this.helper.position=g(et)),this.add(this.helper.rotation=g(nt)),this.add(this.helper.scale=g(rt)),this.picker.position.visible=!1,this.picker.rotation.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(n){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:this._identityQuaternion;this.gizmo.position.visible=this.mode==="position",this.gizmo.rotation.visible=this.mode==="rotation",this.gizmo.scale.visible=this.mode==="scale",this.helper.position.visible=this.mode==="position",this.helper.rotation.visible=this.mode==="rotation",this.helper.scale.visible=this.mode==="scale";let o=[];o=o.concat(this.picker[this.mode].children),o=o.concat(this.gizmo[this.mode].children),o=o.concat(this.helper[this.mode].children);for(let i=0;i<o.length;i++){const t=o[i];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let c;if(this.camera instanceof dt?c=(this.camera.top-this.camera.bottom)/this.camera.zoom:c=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(c*this.size/7),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(this._tempQuaternion.setFromEuler(this._tempEuler.set(0,0,0)),t.quaternion.copy(e).multiply(this._tempQuaternion),Math.abs(this._alignVector.copy(this._unitX).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(this._tempQuaternion.setFromEuler(this._tempEuler.set(0,0,Math.PI/2)),t.quaternion.copy(e).multiply(this._tempQuaternion),Math.abs(this._alignVector.copy(this._unitY).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(this._tempQuaternion.setFromEuler(this._tempEuler.set(0,Math.PI/2,0)),t.quaternion.copy(e).multiply(this._tempQuaternion),Math.abs(this._alignVector.copy(this._unitZ).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(this._tempQuaternion.setFromEuler(this._tempEuler.set(0,Math.PI/2,0)),this._alignVector.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(this._lookAtMatrix.lookAt(this._zeroVector,this._alignVector,this._unitY)),t.quaternion.multiply(this._tempQuaternion),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),this._tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this._tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(this._tempVector),t.visible=this.dragging):(t.quaternion.copy(e),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(e),this.mode==="position"||this.mode==="scale"?((t.name==="X"||t.name==="XYZX")&&Math.abs(this._alignVector.copy(this._unitX).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),(t.name==="Y"||t.name==="XYZY")&&Math.abs(this._alignVector.copy(this._unitY).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),(t.name==="Z"||t.name==="XYZZ")&&Math.abs(this._alignVector.copy(this._unitZ).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(this._alignVector.copy(this._unitZ).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(this._alignVector.copy(this._unitX).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(this._alignVector.copy(this._unitY).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name.search("X")!==-1&&(this._alignVector.copy(this._unitX).applyQuaternion(e).dot(this.eye)<0?t.tag==="fwd"?t.visible=!1:t.scale.x*=-1:t.tag==="bwd"&&(t.visible=!1)),t.name.search("Y")!==-1&&(this._alignVector.copy(this._unitY).applyQuaternion(e).dot(this.eye)<0?t.tag==="fwd"?t.visible=!1:t.scale.y*=-1:t.tag==="bwd"&&(t.visible=!1)),t.name.search("Z")!==-1&&(this._alignVector.copy(this._unitZ).applyQuaternion(e).dot(this.eye)<0?t.tag==="fwd"?t.visible=!1:t.scale.z*=-1:t.tag==="bwd"&&(t.visible=!1))):this.mode==="rotation"&&(this._tempQuaternion2.copy(e),this._alignVector.copy(this.eye).applyQuaternion(this._tempQuaternion.copy(e).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(this._lookAtMatrix.lookAt(this.eye,this._zeroVector,this._unitY)),t.name==="X"&&(this._tempQuaternion.setFromAxisAngle(this._unitX,Math.atan2(-this._alignVector.y,this._alignVector.z)),this._tempQuaternion.multiplyQuaternions(this._tempQuaternion2,this._tempQuaternion),t.quaternion.copy(this._tempQuaternion)),t.name==="Y"&&(this._tempQuaternion.setFromAxisAngle(this._unitY,Math.atan2(this._alignVector.x,this._alignVector.z)),this._tempQuaternion.multiplyQuaternions(this._tempQuaternion2,this._tempQuaternion),t.quaternion.copy(this._tempQuaternion)),t.name==="Z"&&(this._tempQuaternion.setFromAxisAngle(this._unitZ,Math.atan2(this._alignVector.y,this._alignVector.x)),this._tempQuaternion.multiplyQuaternions(this._tempQuaternion2,this._tempQuaternion),t.quaternion.copy(this._tempQuaternion))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._opacity=t.material._opacity||t.material.opacity,t.material._color=t.material._color||t.material.color.clone(),t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled?this.axis&&(t.name===this.axis?(t.material.opacity=1,t.material.color.lerp(new U(1,1,1),.5)):this.axis.split("").some(function(s){return t.name===s})?(t.material.opacity=1,t.material.color.lerp(new U(1,1,1),.5)):(t.material.opacity*=.25,t.material.color.lerp(new U(1,1,1),.5))):(t.material.opacity*=.5,t.material.color.lerp(new U(1,1,1),.5))}super.updateMatrixWorld(n)}}class yt extends a{constructor(){super(new Y(1e5,1e5,2,2),new G({visible:!1,wireframe:!0,side:B,transparent:!0,opacity:.1,toneMapped:!1})),this.enabled=!0,this.mode="position",this.space="local",this.gizmo={},this.picker={},this.helper={},this.axis="XYZ",this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null,this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.rotationAngle=0,this._tempVector=new r,this._identityQuaternion=new b,this._alignVector=new r(0,1,0),this._dirVector=new r,this._tempMatrix=new R,this._unitX=new r(1,0,0),this._unitY=new r(0,1,0),this._unitZ=new r(0,0,1),this._v1=new r,this._v2=new r,this._v3=new r,this.type="TransformControlsPlane"}updateMatrixWorld(n){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this._v1.copy(this._unitX).applyQuaternion(e==="local"?this.worldQuaternion:this._identityQuaternion),this._v2.copy(this._unitY).applyQuaternion(e==="local"?this.worldQuaternion:this._identityQuaternion),this._v3.copy(this._unitZ).applyQuaternion(e==="local"?this.worldQuaternion:this._identityQuaternion),this._alignVector.copy(this._v2),this.mode){case"position":case"scale":switch(this.axis){case"X":this._alignVector.copy(this.eye).cross(this._v1),this._dirVector.copy(this._v1).cross(this._alignVector);break;case"Y":this._alignVector.copy(this.eye).cross(this._v2),this._dirVector.copy(this._v2).cross(this._alignVector);break;case"Z":this._alignVector.copy(this.eye).cross(this._v3),this._dirVector.copy(this._v3).cross(this._alignVector);break;case"XY":this._dirVector.copy(this._v3);break;case"YZ":this._dirVector.copy(this._v1);break;case"XZ":this._alignVector.copy(this._v3),this._dirVector.copy(this._v2);break;case"XYZ":case"E":this._dirVector.set(0,0,0);break}break;case"rotation":default:this._dirVector.set(0,0,0)}this._dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this._tempMatrix.lookAt(this._tempVector.set(0,0,0),this._dirVector,this._alignVector),this.quaternion.setFromRotationMatrix(this._tempMatrix)),super.updateMatrixWorld(n)}}var J=(d=>(d.HOVER="hover",d.CHANGE="change",d.MOUSE_DOWN="mouseDown",d.OBJECT_CHANGE="objectChange",d.MOUSE_UP="mouseUp",d))(J||{});class bt extends j{constructor(n,e,o){super(),this.object=new j,this.enabled=!0,this.mode="position",this.space="local",this.axis="XYZ",this.translationSnap=0,this.rotationSnap=0,this.scaleSnap=0,this.size=1,this.dragging=!1,this.showX=!0,this.showY=!0,this.showZ=!0,this.cacheScene=null,this.transObjectSet=new Set,this.cacheObjects=new Map,this.rotationAngle=0,this._raycaster=new ut,this._offset=new r,this._startNorm=new r,this._endNorm=new r,this._cameraScale=new r,this._parentPosition=new r,this._parentQuaternion=new b,this._parentQuaternionInv=new b,this._parentScale=new r,this._worldScaleStart=new r,this._worldQuaternionInv=new b,this._worldScale=new r,this._positionStart=new r,this._quaternionStart=new b,this._scaleStart=new r,this._tempQuaternion=new b,this._tempVector=new r,this._tempVector2=new r,this._tempMatrix=new R,this._unit={X:new r(1,0,0),Y:new r(0,1,0),Z:new r(0,0,1)},e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document.body),this.domElement=e,this.cacheScene=o;const i=new _t;this.gizmo=i,this.add(i);const t=new yt;this.plane=t,this.add(t);const c=this;function s(u,y){let m=y;Object.defineProperty(c,u,{get:function(){return m!==void 0?m:y},set:function(h){m!==h&&(m=h,t[u]=h,i[u]=h)}}),c[u]=y,t[u]=y,i[u]=y}s("camera",n),s("object",this.object),s("enabled",!0),s("axis",null),s("mode","position"),s("translationSnap",0),s("rotationSnap",0),s("scaleSnap",0),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const _=new r,I=new r,W=new b,z=new b,X=new r,Z=new b,V=new r,P=new r,E=new r,S=0,T=new r;s("worldPosition",_),s("worldPositionStart",I),s("worldQuaternion",W),s("worldQuaternionStart",z),s("cameraPosition",X),s("cameraQuaternion",Z),s("pointStart",V),s("pointEnd",P),s("rotationAxis",E),s("rotationAngle",S),s("eye",T),this._getPointer=this.getPointer.bind(this),this._onPointerDown=this.onPointerDown.bind(this),this._onPointerHover=this.onPointerHover.bind(this),this._onPointerMove=this.onPointerMove.bind(this),this._onPointerUp=this.onPointerUp.bind(this)}setDom(n){return this.disconnect(),this.domElement=n,this.connect(),this}setScene(n){this.cacheScene=n}setCamera(n){return this.camera=n,this}getTransObjectSet(){return this.transObjectSet}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(!0)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.traverse(n=>{n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose()})}attach(){var n,e;return this.connect(),(n=this.cacheScene)==null||n.add(this.object),(e=this.cacheScene)==null||e.add(this),this}detach(){var n,e;return this.disconnect(),(n=this.cacheScene)==null||n.remove(this),(e=this.cacheScene)==null||e.remove(this.object),this.axis=null,this}setAttach(...n){if(this.transObjectSet.clear(),this.cacheObjects.clear(),!n.length||!n[0])return this.detach(),this;this.attach();const e=this.object;if(n.length===1){const c=n[0];c.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.updateMatrix(),e.updateMatrixWorld(),this.transObjectSet.add(c);const s=new j;return e.add(s),s.matrixWorld.copy(c.matrixWorld),this.applyMatrixToMatrixWorld(s.matrixWorld,s),this.cacheObjects.set(c,{matrixAutoUpdate:c.matrixAutoUpdate,virtual:s}),this}const o=[],i=[],t=[];return n.forEach(c=>{o.push(c.matrixWorld.elements[12]),i.push(c.matrixWorld.elements[13]),t.push(c.matrixWorld.elements[14])}),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.position.x=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),e.position.y=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),e.position.z=(Math.max(...t)-Math.min(...t))/2+Math.min(...t),e.updateMatrix(),e.updateMatrixWorld(),n.forEach(c=>{this.transObjectSet.add(c);const s=new j;e.add(s),s.matrixWorld.copy(c.matrixWorld),this.applyMatrixToMatrixWorld(s.matrixWorld,s),this.cacheObjects.set(c,{matrixAutoUpdate:c.matrixAutoUpdate,virtual:s})}),this}applyMatrixToMatrixWorld(n,e){e.matrixWorld.copy(n),e.matrix.multiplyMatrices(this._tempMatrix.copy(e.parent.matrixWorld).invert(),e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale)}getMode(){return this.mode}setMode(n){this.mode=n}setTranslationSnap(n){this.translationSnap=n}setRotationSnap(n){this.rotationSnap=n}setScaleSnap(n){this.scaleSnap=n}setSize(n){this.size=n}setSpace(n){this.space=n}intersectObjectWithRay(n,e,o){const i=e.intersectObject(n,!0);for(let t=0;t<i.length;t++)if(i[t].object.visible||o)return i[t];return!1}pointerHover(n){if(this.object===void 0||this.dragging===!0)return;this._raycaster.setFromCamera(n,this.camera);const e=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this._raycaster);e?(this.axis=e.object.name,this.gizmo.updateMatrixWorld(!0),this.plane.updateMatrixWorld(!0),this.dispatchEvent({type:"hover",axis:this.axis,mode:this.mode})):this.axis=null}pointerDown(n){if(!(this.object===void 0||this.dragging===!0||n.button!==0)&&this.axis!==null){this._raycaster.setFromCamera(n,this.camera);const e=this.intersectObjectWithRay(this.plane,this._raycaster,!0);if(e){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotation"){const i=this.rotationSnap;this.axis==="X"&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),this.axis==="Y"&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),this.axis==="Z"&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)}this.transObjectSet.forEach(o=>{o.matrixAutoUpdate=!1;const i=this.cacheObjects.get(o).virtual;i.matrixWorld.copy(o.matrixWorld),this.applyMatrixToMatrixWorld(i.matrixWorld,i)}),this.dragging=!0,this.dispatchEvent({type:"mouseDown",mode:this.mode})}}pointerMove(n){const e=this.axis,o=this.mode,i=this.object;let t=this.space;if(o==="scale"?t="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(t="world"),i===void 0||e===null||this.dragging===!1||n.button!==-1)return;this._raycaster.setFromCamera(n,this.camera);const c=this.intersectObjectWithRay(this.plane,this._raycaster,!0);if(c){if(this.pointEnd.copy(c.point).sub(this.worldPositionStart),o==="position")this._offset.copy(this.pointEnd).sub(this.pointStart),t==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),t==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(t==="local"&&(i.position.applyQuaternion(this._tempQuaternion.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),t==="world"&&(i.parent&&i.position.add(this._tempVector.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(this._tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if(o==="scale"){if(e.search("XYZ")!==-1){let s=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(s*=-1),this._tempVector2.set(s,s,s)}else this._tempVector.copy(this.pointStart),this._tempVector2.copy(this.pointEnd),this._tempVector.applyQuaternion(this._worldQuaternionInv),this._tempVector2.applyQuaternion(this._worldQuaternionInv),this._tempVector2.divide(this._tempVector),e.search("X")===-1&&(this._tempVector2.x=1),e.search("Y")===-1&&(this._tempVector2.y=1),e.search("Z")===-1&&(this._tempVector2.z=1);i.scale.copy(this._scaleStart).multiply(this._tempVector2),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotation"){this._offset.copy(this.pointEnd).sub(this.pointStart);const s=20/this.worldPosition.distanceTo(this._tempVector.setFromMatrixPosition(this.camera.matrixWorld));e==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(this._tempVector.copy(this.rotationAxis).cross(this.eye))*s):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(this._unit[e]),this._tempVector.copy(this._unit[e]),t==="local"&&this._tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(this._tempVector.cross(this.eye).normalize())*s),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),t==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(this._tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(this._tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.transObjectSet.forEach(s=>{const _=this.cacheObjects.get(s);this.applyMatrixToMatrixWorld(_.virtual.matrixWorld,s)}),this.dispatchEvent({type:"change",mode:this.mode,transObjectSet:this.transObjectSet}),this.dispatchEvent({type:"objectChange",mode:this.mode,transObjectSet:this.transObjectSet})}}pointerUp(n){n.button===0&&(this.dragging&&this.axis!==null&&(this.transObjectSet.forEach(e=>{const o=this.cacheObjects.get(e);e.matrixAutoUpdate=o.matrixAutoUpdate}),this.dispatchEvent({type:"mouseUp",mode:this.mode})),this.dragging=!1,this.axis=null)}getPointer(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=n.changedTouches?n.changedTouches[0]:n,o=this.domElement.getBoundingClientRect();return{x:(e.clientX-o.left)/o.width*2-1,y:-(e.clientY-o.top)/o.height*2+1,button:n.button}}}onPointerDown(n){this.enabled&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}onPointerHover(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}onPointerMove(n){this.enabled&&this.pointerMove(this._getPointer(n))}onPointerUp(n){this.enabled&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}}const vt=lt(wt),xt=function(){let d,n,e;return{name:vt,install(o){const i=new bt(o.camera,o.dom,o.scene);i.detach(),o.transformControls=i,o.transformControls.addEventListener(J.MOUSE_DOWN,()=>{o.transing=!0}),o.setTransformControls=function(t){return this.transformControls.visible=t,this.transformControls.enabled=t,this},n=t=>{t.options.transformControls&&i.setCamera(t.camera)},o.addEventListener(A.SETCAMERA,n),d=t=>{i.setDom(t.dom)},o.addEventListener(A.SETDOM,d),e=t=>{i.setScene(t.scene)},o.addEventListener(A.SETSCENE,e)},dispose(o){var i;o.removeEventListener(A.SETCAMERA,n),o.removeEventListener(A.SETDOM,d),o.removeEventListener(A.SETSCENE,e),(i=o.transformControls)==null||i.dispose(),delete o.transing,delete o.transformControls,delete o.setTransformControls}}};export{J as K,xt as M,vt as b};
