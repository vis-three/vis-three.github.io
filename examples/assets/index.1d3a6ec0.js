import{t as x,a as o}from"./index.202ebdec.js";import{W as I,h as C,O as D}from"./three.237d835c.js";const z="@vis-three/plugin-webgl-renderer",N=x(z),W=function(h){let n,i,d;return{name:N,install(e){e.webGLRenderer=new I(h);const r=e.webGLRenderer.domElement;r.style.position="absolute",r.style.top="0",r.style.left="0",r.classList.add("vis-webgl"),e.getScreenshot=async function(t={}){const a={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let E="";const R=this.webGLRenderer.getContext(),l=R.getParameter(R.MAX_RENDERBUFFER_SIZE)/4;if(t.width>l||t.height>l){const L=[],S=Math.ceil(t.width/l),v=Math.ceil(t.height/l),w=t.width/S,f=t.height/v,m=document.createElement("canvas");m.setAttribute("width",t.width.toString()),m.setAttribute("height",t.height.toString());const b=m.getContext("2d");if(!b)return console.warn("can not support canvas 2d;"),E;this.setSize(w,f);for(let s=0;s<S;s+=1)for(let c=0;c<v;c+=1)L.push({x:w*s,y:f*c});const g=[];L.forEach(s=>{this.camera.setViewOffset(t.width,t.height,s.x,s.y,w,f),this.webGLRenderer.render(this.scene,this.camera);const c=this.webGLRenderer.domElement.toDataURL(t.mine);g.push(new Promise((G,A)=>{const u=new Image;u.src=c,u.onload=()=>{b.drawImage(u,s.x,s.y,w,f),G(null)}}))}),this.setSize(a.width,a.height),await Promise.all(g).catch(s=>{console.warn(s)}),E=m.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.webGLRenderer.render(this.scene,this.camera),E=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(a.width,a.height);return E},n=t=>{t.dom.appendChild(e.webGLRenderer.domElement)},e.addEventListener(o.SETDOM,n),i=t=>{e.webGLRenderer.setSize(t.width,t.height,!0)},e.addEventListener(o.SETSIZE,i),d=()=>{e.webGLRenderer.render(e.scene,e.camera)},e.addEventListener(o.RENDER,d)},dispose(e){e.removeEventListener(o.SETDOM,n),e.removeEventListener(o.SETSIZE,i),e.removeEventListener(o.RENDER,d),e.webGLRenderer.dispose(),delete e.webGLRenderer,delete e.getScreenshot}}},p=function(){let h,n;return{name:"CameraAdaptivePlugin",install(i){const d=(e,r,t)=>{e instanceof C?(e.aspect=r/t,e.updateProjectionMatrix()):e instanceof D&&(e.left=-r,e.right=r,e.top=t,e.bottom=-t,e.updateProjectionMatrix())};h=e=>{d(i.camera,e.width,e.height)},i.addEventListener(o.SETSIZE,h),n=e=>{d(i.camera,i.dom.offsetWidth,i.dom.offsetHeight)},i.addEventListener(o.SETCAMERA,n)},dispose(i){i.removeEventListener(o.SETSIZE,h),i.removeEventListener(o.SETCAMERA,n)}}};export{p as C,W,N as a};
