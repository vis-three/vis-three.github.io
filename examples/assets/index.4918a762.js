var Xt=Object.defineProperty;var Yt=(l,i,t)=>i in l?Xt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t;var Q=(l,i,t)=>(Yt(l,typeof i!="symbol"?i+"":i,t),t);import{t as U,a as B,b as Gt}from"./index.f2ecf0d4.js";import{bI as Qt,h as At,O as Bt,u as Zt,q as g,Q as F,v as mt,aG as Ft,w as It,a5 as Lt,z as Ut,bd as X,B as O,k as Et,l as xt,M as f,bD as ct,L as N,bf as qt,bg as et,b2 as Nt,ak as jt}from"./three.9c0f0dc6.js";import{d as Wt}from"./index.8d7364ed.js";import{a as $t}from"./index.e11efb4f.js";import{a as Vt}from"./index.24c0872b.js";import{c as bt}from"./Antdv.6be70e33.js";const Jt="@vis-three/plugin-selection",te="selected",ee=U(Jt),He=function(){return{name:ee,install(l){l.selectionBox=new Set,l.setSelectionBox=function(i){this.selectionBox.clear();for(const t of i)this.selectionBox.add(t);return l.dispatchEvent({type:te,objects:Array.from(this.selectionBox)}),this}},dispose(l){l.selectionBox.clear(),delete l.selectionBox,delete l.setSelectionBox}}},ne="@vis-three/plugin-axes-helper",ie=U(ne),ze=function(l){let i;return{name:ie,install(t){const o=new Qt((l==null?void 0:l.length)||500);o.matrixAutoUpdate=!1,o.raycast=()=>{},t.axesHelper=o,t.scene.add(o),t.setAxesHelper=function(h,d){return h?t.scene.add(o):t.scene.remove(o),this},i=h=>{h.scene.add(o)},t.addEventListener(B.SETSCENE,i)},dispose(t){delete t.setAxesHelper,t.axesHelper.dispose(),delete t.axesHelper,t.removeEventListener(B.SETSCENE,i)}}},se="@vis-three/plugin-viewpoint";var K;(function(l){l.DEFAULT="default",l.TOP="top",l.BOTTOM="bottom",l.LEFT="left",l.RIGHT="right",l.FRONT="front",l.BACK="back"})(K||(K={}));const J="setViewpoint",gt=U(se),Xe=function(l={}){var s;!l.perspective&&(l.perspective={}),!l.perspective.position&&(l.perspective.position={x:60,y:60,z:60}),!l.perspective.lookAt&&(l.perspective.lookAt={x:0,y:0,z:0}),!l.perspective.up&&(l.perspective.up={x:0,y:1,z:0}),!l.orthograpbic&&(l.orthograpbic={}),!l.orthograpbic.up&&(l.orthograpbic.up={x:0,y:1,z:0});const i=new At;i.position.set(l.perspective.position.x,l.perspective.position.y,l.perspective.position.z),i.lookAt(l.perspective.lookAt.x,l.perspective.lookAt.y,l.perspective.lookAt.z),i.up.set(l.perspective.up.x,l.perspective.up.y,l.perspective.up.z);const t=l.orthograpbic.distance||1e4,o=new Bt(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);o.up.set(l.perspective.up.x,l.perspective.up.y,l.perspective.up.z),(s=l.orthograpbic.allowRotate)!=null;let h,d;return{name:gt,install(u){u.setViewpoint=function(_){return this.dispatchEvent({type:J,viewpoint:_}),this},h=_=>{const v=_.width,m=_.height,E=v/m;i.aspect=E,i.updateProjectionMatrix(),o.left=-t*E,o.right=t*E,o.top=t,o.bottom=-t,o.zoom=t/m*5,o.updateProjectionMatrix()},u.addEventListener(B.SETSIZE,h),d=_=>{const v=_.viewpoint;if(v===K.DEFAULT){u.setCamera(i);return}v===K.TOP?o.position.set(0,t/2,0):v===K.BOTTOM?o.position.set(0,-t/2,0):v===K.RIGHT?o.position.set(t/2,0,0):v===K.LEFT?o.position.set(-t/2,0,0):v===K.FRONT?o.position.set(0,0,t/2):v===K.BACK&&o.position.set(0,0,-t/2),o.lookAt(0,0,0),u.setCamera(o)},u.addEventListener(J,d)},dispose(u){u.removeEventListener(B.SETSIZE,h),u.removeEventListener(J,d)}}},oe="@vis-three/plugin-transform-controls",W=new Zt,Y=new g,j=new g,S=new F,Mt={X:new g(1,0,0),Y:new g(0,1,0),Z:new g(0,0,1)},wt={type:"change"},St={type:"mouseDown"},Kt={type:"mouseUp",mode:null},Ct={type:"objectChange"};class re extends mt{constructor(i,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const o=new pe;this._gizmo=o,this.add(o);const h=new ue;this._plane=h,this.add(h);const d=this;function s(c,e){let r=e;Object.defineProperty(d,c,{get:function(){return r!==void 0?r:e},set:function(a){r!==a&&(r=a,h[c]=a,o[c]=a,d.dispatchEvent({type:c+"-changed",value:a}),d.dispatchEvent(wt))}}),d[c]=e,h[c]=e,o[c]=e}s("camera",i),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const u=new g,_=new g,v=new F,m=new F,E=new g,x=new F,P=new g,H=new g,T=new g,w=0,n=new g;s("worldPosition",u),s("worldPositionStart",_),s("worldQuaternion",v),s("worldQuaternionStart",m),s("cameraPosition",E),s("cameraQuaternion",x),s("pointStart",P),s("pointEnd",H),s("rotationAxis",T),s("rotationAngle",w),s("eye",n),this._offset=new g,this._startNorm=new g,this._endNorm=new g,this._cameraScale=new g,this._parentPosition=new g,this._parentQuaternion=new F,this._parentQuaternionInv=new F,this._parentScale=new g,this._worldScaleStart=new g,this._worldQuaternionInv=new F,this._worldScale=new g,this._positionStart=new g,this._quaternionStart=new F,this._scaleStart=new g,this._getPointer=ae.bind(this),this._onPointerDown=le.bind(this),this._onPointerHover=he.bind(this),this._onPointerMove=ce.bind(this),this._onPointerUp=de.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(i){if(this.object===void 0||this.dragging===!0)return;W.setFromCamera(i,this.camera);const t=vt(this._gizmo.picker[this.mode],W);t?this.axis=t.object.name:this.axis=null}pointerDown(i){if(!(this.object===void 0||this.dragging===!0||i.button!==0)&&this.axis!==null){W.setFromCamera(i,this.camera);const t=vt(this._plane,W,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,St.mode=this.mode,this.dispatchEvent(St)}}pointerMove(i){const t=this.axis,o=this.mode,h=this.object;let d=this.space;if(o==="scale"?d="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(d="world"),h===void 0||t===null||this.dragging===!1||i.button!==-1)return;W.setFromCamera(i,this.camera);const s=vt(this._plane,W,!0);if(!!s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),d==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),d==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),h.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(d==="local"&&(h.position.applyQuaternion(S.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(h.position.x=Math.round(h.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(h.position.y=Math.round(h.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(h.position.z=Math.round(h.position.z/this.translationSnap)*this.translationSnap),h.position.applyQuaternion(this._quaternionStart)),d==="world"&&(h.parent&&h.position.add(Y.setFromMatrixPosition(h.parent.matrixWorld)),t.search("X")!==-1&&(h.position.x=Math.round(h.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(h.position.y=Math.round(h.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(h.position.z=Math.round(h.position.z/this.translationSnap)*this.translationSnap),h.parent&&h.position.sub(Y.setFromMatrixPosition(h.parent.matrixWorld))));else if(o==="scale"){if(t.search("XYZ")!==-1){let u=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(u*=-1),j.set(u,u,u)}else Y.copy(this.pointStart),j.copy(this.pointEnd),Y.applyQuaternion(this._worldQuaternionInv),j.applyQuaternion(this._worldQuaternionInv),j.divide(Y),t.search("X")===-1&&(j.x=1),t.search("Y")===-1&&(j.y=1),t.search("Z")===-1&&(j.z=1);h.scale.copy(this._scaleStart).multiply(j),this.scaleSnap&&(t.search("X")!==-1&&(h.scale.x=Math.round(h.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(h.scale.y=Math.round(h.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(h.scale.z=Math.round(h.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const u=20/this.worldPosition.distanceTo(Y.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Y.copy(this.rotationAxis).cross(this.eye))*u):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Mt[t]),Y.copy(Mt[t]),d==="local"&&Y.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Y.cross(this.eye).normalize())*u),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),d==="local"&&t!=="E"&&t!=="XYZE"?(h.quaternion.copy(this._quaternionStart),h.quaternion.multiply(S.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),h.quaternion.copy(S.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),h.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(wt),this.dispatchEvent(Ct)}}pointerUp(i){i.button===0&&(this.dragging&&this.axis!==null&&(Kt.mode=this.mode,this.dispatchEvent(Kt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(i){i.geometry&&i.geometry.dispose(),i.material&&i.material.dispose()})}attach(i){return this.object=i,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(wt),this.dispatchEvent(Ct),this.pointStart.copy(this.pointEnd))}getRaycaster(){return W}getMode(){return this.mode}setMode(i){this.mode=i}setTranslationSnap(i){this.translationSnap=i}setRotationSnap(i){this.rotationSnap=i}setScaleSnap(i){this.scaleSnap=i}setSize(i){this.size=i}setSpace(i){this.space=i}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function ae(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const i=this.domElement.getBoundingClientRect();return{x:(l.clientX-i.left)/i.width*2-1,y:-(l.clientY-i.top)/i.height*2+1,button:l.button}}}function he(l){if(!!this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function le(l){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function ce(l){!this.enabled||this.pointerMove(this._getPointer(l))}function de(l){!this.enabled||(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function vt(l,i,t){const o=i.intersectObject(l,!0);for(let h=0;h<o.length;h++)if(o[h].object.visible||t)return o[h];return!1}const dt=new Ft,M=new g(0,1,0),Pt=new g(0,0,0),Tt=new It,pt=new F,yt=new F,Z=new g,kt=new It,st=new g(1,0,0),$=new g(0,1,0),ot=new g(0,0,1),ut=new g,nt=new g,it=new g;class pe extends mt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const i=new Lt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Ut({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=i.clone();o.opacity=.15;const h=t.clone();h.opacity=.5;const d=i.clone();d.color.setHex(16711680);const s=i.clone();s.color.setHex(65280);const u=i.clone();u.color.setHex(255);const _=i.clone();_.color.setHex(16711680),_.opacity=.5;const v=i.clone();v.color.setHex(65280),v.opacity=.5;const m=i.clone();m.color.setHex(255),m.opacity=.5;const E=i.clone();E.opacity=.25;const x=i.clone();x.color.setHex(16776960),x.opacity=.25,i.clone().color.setHex(16776960);const H=i.clone();H.color.setHex(7895160);const T=new X(0,.04,.1,12);T.translate(0,.05,0);const w=new O(.08,.08,.08);w.translate(0,.04,0);const n=new Et;n.setAttribute("position",new xt([0,0,0,1,0,0],3));const c=new X(.0075,.0075,.5,3);c.translate(0,.25,0);function e(I,D){const L=new et(I,.0075,3,64,D*Math.PI*2);return L.rotateY(Math.PI/2),L.rotateX(Math.PI/2),L}function r(){const I=new Et;return I.setAttribute("position",new xt([0,0,0,1,1,1],3)),I}const a={X:[[new f(T,d),[.5,0,0],[0,0,-Math.PI/2]],[new f(T,d),[-.5,0,0],[0,0,Math.PI/2]],[new f(c,d),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new f(T,s),[0,.5,0]],[new f(T,s),[0,-.5,0],[Math.PI,0,0]],[new f(c,s)]],Z:[[new f(T,u),[0,0,.5],[Math.PI/2,0,0]],[new f(T,u),[0,0,-.5],[-Math.PI/2,0,0]],[new f(c,u),null,[Math.PI/2,0,0]]],XYZ:[[new f(new ct(.1,0),E.clone()),[0,0,0]]],XY:[[new f(new O(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new f(new O(.15,.15,.01),_.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f(new O(.15,.15,.01),v.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},p={X:[[new f(new X(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new f(new X(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new f(new X(.2,0,.6,4),o),[0,.3,0]],[new f(new X(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new f(new X(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new f(new X(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new f(new ct(.2,0),o)]],XY:[[new f(new O(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new f(new O(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f(new O(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},y={START:[[new f(new ct(.01,2),h),null,null,null,"helper"]],END:[[new f(new ct(.01,2),h),null,null,null,"helper"]],DELTA:[[new N(r(),h),null,null,null,"helper"]],X:[[new N(n,h.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new N(n,h.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new N(n,h.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={XYZE:[[new f(e(.5,1),H),null,[0,Math.PI/2,0]]],X:[[new f(e(.5,.5),d)]],Y:[[new f(e(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new f(e(.5,.5),u),null,[0,Math.PI/2,0]]],E:[[new f(e(.75,1),x),null,[0,Math.PI/2,0]]]},k={AXIS:[[new N(n,h.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},C={XYZE:[[new f(new qt(.25,10,8),o)]],X:[[new f(new et(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new f(new et(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new f(new et(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new f(new et(.75,.1,2,24),o)]]},z={X:[[new f(w,d),[.5,0,0],[0,0,-Math.PI/2]],[new f(c,d),[0,0,0],[0,0,-Math.PI/2]],[new f(w,d),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new f(w,s),[0,.5,0]],[new f(c,s)],[new f(w,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new f(w,u),[0,0,.5],[Math.PI/2,0,0]],[new f(c,u),[0,0,0],[Math.PI/2,0,0]],[new f(w,u),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new f(new O(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new f(new O(.15,.15,.01),_),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f(new O(.15,.15,.01),v),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new f(new O(.1,.1,.1),E.clone())]]},G={X:[[new f(new X(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new f(new X(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new f(new X(.2,0,.6,4),o),[0,.3,0]],[new f(new X(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new f(new X(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new f(new X(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new f(new O(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new f(new O(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f(new O(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new f(new O(.2,.2,.2),o),[0,0,0]]]},tt={X:[[new N(n,h.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new N(n,h.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new N(n,h.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function A(I){const D=new mt;for(const L in I)for(let q=I[L].length;q--;){const R=I[L][q][0].clone(),at=I[L][q][1],ht=I[L][q][2],lt=I[L][q][3],zt=I[L][q][4];R.name=L,R.tag=zt,at&&R.position.set(at[0],at[1],at[2]),ht&&R.rotation.set(ht[0],ht[1],ht[2]),lt&&R.scale.set(lt[0],lt[1],lt[2]),R.updateMatrix();const _t=R.geometry.clone();_t.applyMatrix4(R.matrix),R.geometry=_t,R.renderOrder=1/0,R.position.set(0,0,0),R.rotation.set(0,0,0),R.scale.set(1,1,1),D.add(R)}return D}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=A(a)),this.add(this.gizmo.rotate=A(b)),this.add(this.gizmo.scale=A(z)),this.add(this.picker.translate=A(p)),this.add(this.picker.rotate=A(C)),this.add(this.picker.scale=A(G)),this.add(this.helper.translate=A(y)),this.add(this.helper.rotate=A(k)),this.add(this.helper.scale=A(tt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(i){const o=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:yt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let h=[];h=h.concat(this.picker[this.mode].children),h=h.concat(this.gizmo[this.mode].children),h=h.concat(this.helper[this.mode].children);for(let d=0;d<h.length;d++){const s=h[d];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let u;if(this.camera.isOrthographicCamera?u=(this.camera.top-this.camera.bottom)/this.camera.zoom:u=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(u*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.position.copy(this.worldPositionStart),s.visible=!!this.axis,this.axis==="X"&&(S.setFromEuler(dt.set(0,0,0)),s.quaternion.copy(o).multiply(S),Math.abs(M.copy(st).applyQuaternion(o).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(S.setFromEuler(dt.set(0,0,Math.PI/2)),s.quaternion.copy(o).multiply(S),Math.abs(M.copy($).applyQuaternion(o).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(S.setFromEuler(dt.set(0,Math.PI/2,0)),s.quaternion.copy(o).multiply(S),Math.abs(M.copy(ot).applyQuaternion(o).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(S.setFromEuler(dt.set(0,Math.PI/2,0)),M.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(Tt.lookAt(Pt,M,$)),s.quaternion.multiply(S),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),Y.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Y.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(Y),s.visible=this.dragging):(s.quaternion.copy(o),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(o),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(M.copy(st).applyQuaternion(o).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(M.copy($).applyQuaternion(o).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(M.copy(ot).applyQuaternion(o).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(M.copy(ot).applyQuaternion(o).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(M.copy(st).applyQuaternion(o).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(M.copy($).applyQuaternion(o).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(pt.copy(o),M.copy(this.eye).applyQuaternion(S.copy(o).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(Tt.lookAt(this.eye,Pt,$)),s.name==="X"&&(S.setFromAxisAngle(st,Math.atan2(-M.y,M.z)),S.multiplyQuaternions(pt,S),s.quaternion.copy(S)),s.name==="Y"&&(S.setFromAxisAngle($,Math.atan2(M.x,M.z)),S.multiplyQuaternions(pt,S),s.quaternion.copy(S)),s.name==="Z"&&(S.setFromAxisAngle(ot,Math.atan2(M.y,M.x)),S.multiplyQuaternions(pt,S),s.quaternion.copy(S))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(_){return s.name===_}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(i)}}class ue extends f{constructor(){super(new Nt(1e5,1e5,2,2),new Lt({visible:!1,wireframe:!0,side:jt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(i){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),ut.copy(st).applyQuaternion(t==="local"?this.worldQuaternion:yt),nt.copy($).applyQuaternion(t==="local"?this.worldQuaternion:yt),it.copy(ot).applyQuaternion(t==="local"?this.worldQuaternion:yt),M.copy(nt),this.mode){case"translate":case"scale":switch(this.axis){case"X":M.copy(this.eye).cross(ut),Z.copy(ut).cross(M);break;case"Y":M.copy(this.eye).cross(nt),Z.copy(nt).cross(M);break;case"Z":M.copy(this.eye).cross(it),Z.copy(it).cross(M);break;case"XY":Z.copy(it);break;case"YZ":Z.copy(ut);break;case"XZ":M.copy(it),Z.copy(nt);break;case"XYZ":case"E":Z.set(0,0,0);break}break;case"rotate":default:Z.set(0,0,0)}Z.length()===0?this.quaternion.copy(this.cameraQuaternion):(kt.lookAt(Y.set(0,0,0),Z,M),this.quaternion.setFromRotationMatrix(kt)),super.updateMatrixWorld(i)}}var V;(function(l){l.CHANGED="changed",l.MOUSE_DOWN="mouseDown",l.CHANGEING="objectChange",l.MOUSE_UP="mouseUp"})(V||(V={}));class fe extends re{constructor(t,o){!t&&(t=new At),!o&&(o=document.body);super(t,o);Q(this,"target");Q(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=v=>{var m;!this.enabled||!((m=this.object)!=null&&m.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(v)),this.pointerDown(this._getPointer(v)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new mt,this.transObjectSet=new Set;let h="";const d=this.target,s=this.transObjectSet,u={x:0,y:0,z:0},_=new WeakMap;this.addEventListener(V.MOUSE_DOWN,v=>{h=v.target.mode,h==="translate"&&(h="position"),h==="rotate"&&(h="rotation"),u.x=d[h].x,u.y=d[h].y,u.z=d[h].z,s.forEach(m=>{_.set(m,m.matrixAutoUpdate),m.matrixAutoUpdate=!1})}),this.addEventListener(V.CHANGEING,v=>{const m=d[h].x-u.x,E=d[h].y-u.y,x=d[h].z-u.z;u.x=d[h].x,u.y=d[h].y,u.z=d[h].z,s.forEach(P=>{P[h].x+=m,P[h].y+=E,P[h].z+=x,P.updateMatrix(),P.updateMatrixWorld()}),this.dispatchEvent({type:V.CHANGED,transObjectSet:s,mode:h,target:d})}),this.addEventListener(V.MOUSE_UP,v=>{s.forEach(m=>{m.matrixAutoUpdate=_.get(m),_.delete(m)})})}setDom(t){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointermove",this._onPointerHover),t.addEventListener("pointerup",this._onPointerUp),this.domElement=t,this}setCamera(t){return this.camera=t,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...t){if(this.transObjectSet.clear(),!t.length||!t[0])return this.detach(),this;this.attach(this.target);const o=this.target;if(t.length===1){const u=t[0];return u.matrixWorld.decompose(o.position,o.quaternion,o.scale),o.updateMatrix(),o.updateMatrixWorld(),this.transObjectSet.add(u),this}const h=[],d=[],s=[];return t.forEach(u=>{h.push(u.matrixWorld.elements[12]),d.push(u.matrixWorld.elements[13]),s.push(u.matrixWorld.elements[14])}),o.rotation.set(0,0,0),o.scale.set(0,0,0),o.position.x=(Math.max(...h)-Math.min(...h))/2+Math.min(...h),o.position.y=(Math.max(...d)-Math.min(...d))/2+Math.min(...d),o.position.z=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),o.updateMatrix(),o.updateMatrixWorld(),t.forEach(u=>{this.transObjectSet.add(u)}),this}}const Rt=U(oe),Ye=function(){let l,i,t;return{name:Rt,install(o){const h=new fe(o.camera,o.dom);h.detach(),o.transformControls=h,o.scene.add(h),o.scene.add(h.target),o.transformControls.addEventListener(V.MOUSE_DOWN,()=>{o.transing=!0}),o.setTransformControls=function(d){return d?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},i=d=>{d.options.transformControls&&h.setCamera(d.camera)},o.addEventListener(B.SETCAMERA,i),l=d=>{h.setDom(d.dom)},o.addEventListener(B.SETDOM,l),t=d=>{const s=d.scene;s.add(h.target),s.add(h)},o.addEventListener(B.SETSCENE,t)},dispose(o){var h;o.removeEventListener(B.SETCAMERA,i),o.removeEventListener(B.SETDOM,l),o.removeEventListener(B.SETSCENE,t),(h=o.transformControls)==null||h.dispose(),delete o.transing,delete o.transformControls,delete o.setTransformControls}}};var rt=function(){var l=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(m){m.preventDefault(),o(++l%i.children.length)},!1);function t(m){return i.appendChild(m.dom),m}function o(m){for(var E=0;E<i.children.length;E++)i.children[E].style.display=E===m?"block":"none";l=m}var h=(performance||Date).now(),d=h,s=0,u=t(new rt.Panel("FPS","#0ff","#002")),_=t(new rt.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var v=t(new rt.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:i,addPanel:t,showPanel:o,begin:function(){h=(performance||Date).now()},end:function(){s++;var m=(performance||Date).now();if(_.update(m-h,200),m>=d+1e3&&(u.update(s*1e3/(m-d),100),d=m,s=0,v)){var E=performance.memory;v.update(E.usedJSHeapSize/1048576,E.jsHeapSizeLimit/1048576)}return m},update:function(){h=this.end()},domElement:i,setMode:o}};rt.Panel=function(l,i,t){var o=1/0,h=0,d=Math.round,s=d(window.devicePixelRatio||1),u=80*s,_=48*s,v=3*s,m=2*s,E=3*s,x=15*s,P=74*s,H=30*s,T=document.createElement("canvas");T.width=u,T.height=_,T.style.cssText="width:80px;height:48px";var w=T.getContext("2d");return w.font="bold "+9*s+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=t,w.fillRect(0,0,u,_),w.fillStyle=i,w.fillText(l,v,m),w.fillRect(E,x,P,H),w.fillStyle=t,w.globalAlpha=.9,w.fillRect(E,x,P,H),{dom:T,update:function(n,c){o=Math.min(o,n),h=Math.max(h,n),w.fillStyle=t,w.globalAlpha=1,w.fillRect(0,0,u,x),w.fillStyle=i,w.fillText(d(n)+" "+l+" ("+d(o)+"-"+d(h)+")",v,m),w.drawImage(T,E+s,x,P-s,H,E,x,P-s,H),w.fillRect(E+P-s,x,s,H),w.fillStyle=t,w.globalAlpha=.9,w.fillRect(E+P-s,x,s,d((1-n/c)*H))}}};class ye{constructor(i){Q(this,"REVISION");Q(this,"dom");Q(this,"addPanel");Q(this,"showPanel");Q(this,"begin");Q(this,"end");Q(this,"update");Q(this,"domElement");Q(this,"setMode");const t=rt();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const o=this.domElement;o.style.position="absolute",o.style.top="0",o.style.left="35px",i&&(o.style.top=`${i.top}px`,o.style.left=`${i.left}px`,o.style.right=`${i.right}px`,o.style.bottom=`${i.bottom}px`)}}const me="@vis-three/plugin-stats",Dt=U(me),Ge=function(l){let i;return{name:Dt,install(t){const o=new ye(l);t.stats=o,t.setStats=function(h){if(h)t.dom.appendChild(o.domElement);else try{t.dom.removeChild(o.domElement)}catch{}return this},i=h=>{o.update()},t.addEventListener(B.RENDER,i)},dispose(t){t.removeEventListener(B.RENDER,i),delete t.stats,delete t.setStats}}};var Ot={exports:{}};(function(l,i){(function(t,o){l.exports=o()})(bt,function(){function t(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(c){return typeof c}:t=function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},t(n)}function o(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function h(n,c){for(var e=0;e<c.length;e++){var r=c[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function d(n,c,e){return c&&h(n.prototype,c),e&&h(n,e),n}function s(n){return u(n)||_(n)||v(n)||E()}function u(n){if(Array.isArray(n))return m(n)}function _(n){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(n))return Array.from(n)}function v(n,c){if(!!n){if(typeof n=="string")return m(n,c);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return m(n,c)}}function m(n,c){(c==null||c>n.length)&&(c=n.length);for(var e=0,r=new Array(c);e<c;e++)r[e]=n[e];return r}function E(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=function(){function n(c){o(this,n),this.sourceStr=c,this.subCombos=n.parseComboStr(c),this.keyNames=this.subCombos.reduce(function(e,r){return e.concat(r)},[])}return d(n,[{key:"check",value:function(e){for(var r=0,a=0;a<this.subCombos.length;a+=1)if(r=this._checkSubCombo(this.subCombos[a],r,e),r===-1)return!1;return!0}},{key:"isEqual",value:function(e){if(!e||typeof e!="string"&&t(e)!=="object"||(typeof e=="string"&&(e=new n(e)),this.subCombos.length!==e.subCombos.length))return!1;for(var r=0;r<this.subCombos.length;r+=1)if(this.subCombos[r].length!==e.subCombos[r].length)return!1;for(var a=0;a<this.subCombos.length;a+=1){for(var p=this.subCombos[a],y=e.subCombos[a].slice(0),b=0;b<p.length;b+=1){var k=p[b],C=y.indexOf(k);C>-1&&y.splice(C,1)}if(y.length!==0)return!1}return!0}},{key:"_checkSubCombo",value:function(e,r,a){e=e.slice(0),a=a.slice(r);for(var p=r,y=0;y<e.length;y+=1){var b=e[y];if(b[0]==="\\"){var k=b.slice(1);(k===n.comboDeliminator||k===n.keyDeliminator)&&(b=k)}var C=a.indexOf(b);if(C>-1&&(e.splice(y,1),y-=1,C>p&&(p=C),e.length===0))return p}return-1}}]),n}();x.comboDeliminator=">",x.keyDeliminator="+",x.parseComboStr=function(n){for(var c=x._splitStr(n,x.comboDeliminator),e=[],r=0;r<c.length;r+=1)e.push(x._splitStr(c[r],x.keyDeliminator));return e},x._splitStr=function(n,c){for(var e=n,r=c,a="",p=[],y=0;y<e.length;y+=1)y>0&&e[y]===r&&e[y-1]!=="\\"&&(p.push(a.trim()),a="",y+=1),a+=e[y];return a&&p.push(a.trim()),p};var P=function(){function n(c){o(this,n),this.localeName=c,this.activeTargetKeys=[],this.pressedKeys=[],this._appliedMacros=[],this._keyMap={},this._killKeyCodes=[],this._macros=[]}return d(n,[{key:"bindKeyCode",value:function(e,r){typeof r=="string"&&(r=[r]),this._keyMap[e]=r}},{key:"bindMacro",value:function(e,r){typeof r=="string"&&(r=[r]);var a=null;typeof r=="function"&&(a=r,r=null);var p={keyCombo:new x(e),keyNames:r,handler:a};this._macros.push(p)}},{key:"getKeyCodes",value:function(e){var r=[];for(var a in this._keyMap){var p=this._keyMap[a].indexOf(e);p>-1&&r.push(a|0)}return r}},{key:"getKeyNames",value:function(e){return this._keyMap[e]||[]}},{key:"setKillKey",value:function(e){if(typeof e=="string"){for(var r=this.getKeyCodes(e),a=0;a<r.length;a+=1)this.setKillKey(r[a]);return}this._killKeyCodes.push(e)}},{key:"pressKey",value:function(e){if(typeof e=="string"){for(var r=this.getKeyCodes(e),a=0;a<r.length;a+=1)this.pressKey(r[a]);return}this.activeTargetKeys.length=0;for(var p=this.getKeyNames(e),y=0;y<p.length;y+=1)this.activeTargetKeys.push(p[y]),this.pressedKeys.indexOf(p[y])===-1&&this.pressedKeys.push(p[y]);this._applyMacros()}},{key:"releaseKey",value:function(e){if(typeof e=="string")for(var r=this.getKeyCodes(e),a=0;a<r.length;a+=1)this.releaseKey(r[a]);else{var p=this.getKeyNames(e),y=this._killKeyCodes.indexOf(e);if(y!==-1)this.pressedKeys.length=0;else for(var b=0;b<p.length;b+=1){var k=this.pressedKeys.indexOf(p[b]);k>-1&&this.pressedKeys.splice(k,1)}this.activeTargetKeys.length=0,this._clearMacros()}}},{key:"_applyMacros",value:function(){for(var e=this._macros.slice(0),r=0;r<e.length;r+=1){var a=e[r];if(a.keyCombo.check(this.pressedKeys)){a.handler&&(a.keyNames=a.handler(this.pressedKeys));for(var p=0;p<a.keyNames.length;p+=1)this.pressedKeys.indexOf(a.keyNames[p])===-1&&this.pressedKeys.push(a.keyNames[p]);this._appliedMacros.push(a)}}}},{key:"_clearMacros",value:function(){for(var e=0;e<this._appliedMacros.length;e+=1){var r=this._appliedMacros[e];if(!r.keyCombo.check(this.pressedKeys)){for(var a=0;a<r.keyNames.length;a+=1){var p=this.pressedKeys.indexOf(r.keyNames[a]);p>-1&&this.pressedKeys.splice(p,1)}r.handler&&(r.keyNames=null),this._appliedMacros.splice(e,1),e-=1}}}}]),n}(),H=function(){function n(c,e,r,a){o(this,n),this._locale=null,this._currentContext="",this._contexts={},this._listeners=[],this._appliedListeners=[],this._locales={},this._targetElement=null,this._targetWindow=null,this._targetPlatform="",this._targetUserAgent="",this._isModernBrowser=!1,this._targetKeyDownBinding=null,this._targetKeyUpBinding=null,this._targetResetBinding=null,this._paused=!1,this._contexts.global={listeners:this._listeners,targetWindow:c,targetElement:e,targetPlatform:r,targetUserAgent:a},this.setContext("global")}return d(n,[{key:"setLocale",value:function(e,r){var a=null;return typeof e=="string"?r?(a=new P(e),r(a,this._targetPlatform,this._targetUserAgent)):a=this._locales[e]||null:(a=e,e=a._localeName),this._locale=a,this._locales[e]=a,a&&(this._locale.pressedKeys=a.pressedKeys),this}},{key:"getLocale",value:function(e){return e||(e=this._locale.localeName),this._locales[e]||null}},{key:"bind",value:function(e,r,a,p){if((e===null||typeof e=="function")&&(p=a,a=r,r=e,e=null),e&&t(e)==="object"&&typeof e.length=="number"){for(var y=0;y<e.length;y+=1)this.bind(e[y],r,a);return this}return this._listeners.push({keyCombo:e?new x(e):null,pressHandler:r||null,releaseHandler:a||null,preventRepeat:!1,preventRepeatByDefault:p||!1,executingHandler:!1}),this}},{key:"addListener",value:function(e,r,a,p){return this.bind(e,r,a,p)}},{key:"on",value:function(e,r,a,p){return this.bind(e,r,a,p)}},{key:"bindPress",value:function(e,r,a){return this.bind(e,r,null,a)}},{key:"bindRelease",value:function(e,r){return this.bind(e,null,r,preventRepeatByDefault)}},{key:"unbind",value:function(e,r,a){if((e===null||typeof e=="function")&&(a=r,r=e,e=null),e&&t(e)==="object"&&typeof e.length=="number"){for(var p=0;p<e.length;p+=1)this.unbind(e[p],r,a);return this}for(var y=0;y<this._listeners.length;y+=1){var b=this._listeners[y],k=!e&&!b.keyCombo||b.keyCombo&&b.keyCombo.isEqual(e),C=!r&&!a||!r&&!b.pressHandler||r===b.pressHandler,z=!r&&!a||!a&&!b.releaseHandler||a===b.releaseHandler;k&&C&&z&&(this._listeners.splice(y,1),y-=1)}return this}},{key:"removeListener",value:function(e,r,a){return this.unbind(e,r,a)}},{key:"off",value:function(e,r,a){return this.unbind(e,r,a)}},{key:"setContext",value:function(e){if(this._locale&&this.releaseAllKeys(),!this._contexts[e]){var r=this._contexts.global;this._contexts[e]={listeners:[],targetWindow:r.targetWindow,targetElement:r.targetElement,targetPlatform:r.targetPlatform,targetUserAgent:r.targetUserAgent}}var a=this._contexts[e];return this._currentContext=e,this._listeners=a.listeners,this.stop(),this.watch(a.targetWindow,a.targetElement,a.targetPlatform,a.targetUserAgent),this}},{key:"getContext",value:function(){return this._currentContext}},{key:"withContext",value:function(e,r){var a=this.getContext();return this.setContext(e),r(),this.setContext(a),this}},{key:"watch",value:function(e,r,a,p){var y=this;this.stop();var b=typeof globalThis!="undefined"?globalThis:typeof bt!="undefined"?bt:typeof window!="undefined"?window:{};if(!e){if(!b.addEventListener&&!b.attachEvent){if(this._currentContext==="global")return;throw new Error("Cannot find window functions addEventListener or attachEvent.")}e=b}if(typeof e.nodeType=="number"&&(p=a,a=r,r=e,e=b),!e.addEventListener&&!e.attachEvent)throw new Error("Cannot find addEventListener or attachEvent methods on targetWindow.");this._isModernBrowser=!!e.addEventListener;var k=e.navigator&&e.navigator.userAgent||"",C=e.navigator&&e.navigator.platform||"";r&&r!==null||(r=e.document),a&&a!==null||(a=C),p&&p!==null||(p=k),this._targetKeyDownBinding=function(G){y.pressKey(G.keyCode,G),y._handleCommandBug(G,C)},this._targetKeyUpBinding=function(G){y.releaseKey(G.keyCode,G)},this._targetResetBinding=function(G){y.releaseAllKeys(G)},this._bindEvent(r,"keydown",this._targetKeyDownBinding),this._bindEvent(r,"keyup",this._targetKeyUpBinding),this._bindEvent(e,"focus",this._targetResetBinding),this._bindEvent(e,"blur",this._targetResetBinding),this._targetElement=r,this._targetWindow=e,this._targetPlatform=a,this._targetUserAgent=p;var z=this._contexts[this._currentContext];return z.targetWindow=this._targetWindow,z.targetElement=this._targetElement,z.targetPlatform=this._targetPlatform,z.targetUserAgent=this._targetUserAgent,this}},{key:"stop",value:function(){if(!(!this._targetElement||!this._targetWindow))return this._unbindEvent(this._targetElement,"keydown",this._targetKeyDownBinding),this._unbindEvent(this._targetElement,"keyup",this._targetKeyUpBinding),this._unbindEvent(this._targetWindow,"focus",this._targetResetBinding),this._unbindEvent(this._targetWindow,"blur",this._targetResetBinding),this._targetWindow=null,this._targetElement=null,this}},{key:"pressKey",value:function(e,r){if(this._paused)return this;if(!this._locale)throw new Error("Locale not set");return this._locale.pressKey(e),this._applyBindings(r),this}},{key:"releaseKey",value:function(e,r){if(this._paused)return this;if(!this._locale)throw new Error("Locale not set");return this._locale.releaseKey(e),this._clearBindings(r),this}},{key:"releaseAllKeys",value:function(e){if(this._paused)return this;if(!this._locale)throw new Error("Locale not set");return this._locale.pressedKeys.length=0,this._clearBindings(e),this}},{key:"pause",value:function(){return this._paused?this:(this._locale&&this.releaseAllKeys(),this._paused=!0,this)}},{key:"resume",value:function(){return this._paused=!1,this}},{key:"reset",value:function(){return this.releaseAllKeys(),this._listeners.length=0,this}},{key:"_bindEvent",value:function(e,r,a){return this._isModernBrowser?e.addEventListener(r,a,!1):e.attachEvent("on"+r,a)}},{key:"_unbindEvent",value:function(e,r,a){return this._isModernBrowser?e.removeEventListener(r,a,!1):e.detachEvent("on"+r,a)}},{key:"_getGroupedListeners",value:function(){var e=[],r=[],a=this._listeners;return this._currentContext!=="global"&&(a=[].concat(s(a),s(this._contexts.global.listeners))),a.sort(function(p,y){return(y.keyCombo?y.keyCombo.keyNames.length:0)-(p.keyCombo?p.keyCombo.keyNames.length:0)}).forEach(function(p){for(var y=-1,b=0;b<r.length;b+=1)(r[b]===null&&p.keyCombo===null||r[b]!==null&&r[b].isEqual(p.keyCombo))&&(y=b);y===-1&&(y=r.length,r.push(p.keyCombo)),e[y]||(e[y]=[]),e[y].push(p)}),e}},{key:"_applyBindings",value:function(e){var r=this,a=!1;e||(e={}),e.preventRepeat=function(){a=!0},e.pressedKeys=this._locale.pressedKeys.slice(0);for(var p=this._locale.activeTargetKeys,y=this._locale.pressedKeys.slice(0),b=this._getGroupedListeners(),k=function(G){var tt=b[G],A=tt[0].keyCombo;if(A===null||A.check(y)&&p.some(function(R){return A.keyNames.includes(R)})){for(var I=0;I<tt.length;I+=1){var D=tt[I];!D.executingHandler&&D.pressHandler&&!D.preventRepeat&&(D.executingHandler=!0,D.pressHandler.call(r,e),D.executingHandler=!1,(a||D.preventRepeatByDefault)&&(D.preventRepeat=!0,a=!1)),r._appliedListeners.indexOf(D)===-1&&r._appliedListeners.push(D)}if(A)for(var L=0;L<A.keyNames.length;L+=1){var q=y.indexOf(A.keyNames[L]);q!==-1&&(y.splice(q,1),L-=1)}}},C=0;C<b.length;C+=1)k(C)}},{key:"_clearBindings",value:function(e){e||(e={}),e.pressedKeys=this._locale.pressedKeys.slice(0);for(var r=0;r<this._appliedListeners.length;r+=1){var a=this._appliedListeners[r],p=a.keyCombo;(p===null||!p.check(this._locale.pressedKeys))&&(a.preventRepeat=!1,(p!==null||e.pressedKeys.length===0)&&(this._appliedListeners.splice(r,1),r-=1),!a.executingHandler&&a.releaseHandler&&(a.executingHandler=!0,a.releaseHandler.call(this,e),a.executingHandler=!1))}}},{key:"_handleCommandBug",value:function(e,r){var a=["shift","ctrl","alt","capslock","tab","command"];r.match("Mac")&&this._locale.pressedKeys.includes("command")&&!a.includes(this._locale.getKeyNames(e.keyCode)[0])&&this._targetKeyUpBinding(e)}}]),n}();function T(n,c,e){n.bindKeyCode(3,["cancel"]),n.bindKeyCode(8,["backspace"]),n.bindKeyCode(9,["tab"]),n.bindKeyCode(12,["clear"]),n.bindKeyCode(13,["enter"]),n.bindKeyCode(16,["shift"]),n.bindKeyCode(17,["ctrl"]),n.bindKeyCode(18,["alt","menu"]),n.bindKeyCode(19,["pause","break"]),n.bindKeyCode(20,["capslock"]),n.bindKeyCode(27,["escape","esc"]),n.bindKeyCode(32,["space","spacebar"]),n.bindKeyCode(33,["pageup"]),n.bindKeyCode(34,["pagedown"]),n.bindKeyCode(35,["end"]),n.bindKeyCode(36,["home"]),n.bindKeyCode(37,["left"]),n.bindKeyCode(38,["up"]),n.bindKeyCode(39,["right"]),n.bindKeyCode(40,["down"]),n.bindKeyCode(41,["select"]),n.bindKeyCode(42,["printscreen"]),n.bindKeyCode(43,["execute"]),n.bindKeyCode(44,["snapshot"]),n.bindKeyCode(45,["insert","ins"]),n.bindKeyCode(46,["delete","del"]),n.bindKeyCode(47,["help"]),n.bindKeyCode(145,["scrolllock","scroll"]),n.bindKeyCode(188,["comma",","]),n.bindKeyCode(190,["period","."]),n.bindKeyCode(191,["slash","forwardslash","/"]),n.bindKeyCode(192,["graveaccent","`"]),n.bindKeyCode(219,["openbracket","["]),n.bindKeyCode(220,["backslash","\\"]),n.bindKeyCode(221,["closebracket","]"]),n.bindKeyCode(222,["apostrophe","'"]),n.bindKeyCode(48,["zero","0"]),n.bindKeyCode(49,["one","1"]),n.bindKeyCode(50,["two","2"]),n.bindKeyCode(51,["three","3"]),n.bindKeyCode(52,["four","4"]),n.bindKeyCode(53,["five","5"]),n.bindKeyCode(54,["six","6"]),n.bindKeyCode(55,["seven","7"]),n.bindKeyCode(56,["eight","8"]),n.bindKeyCode(57,["nine","9"]),n.bindKeyCode(96,["numzero","num0"]),n.bindKeyCode(97,["numone","num1"]),n.bindKeyCode(98,["numtwo","num2"]),n.bindKeyCode(99,["numthree","num3"]),n.bindKeyCode(100,["numfour","num4"]),n.bindKeyCode(101,["numfive","num5"]),n.bindKeyCode(102,["numsix","num6"]),n.bindKeyCode(103,["numseven","num7"]),n.bindKeyCode(104,["numeight","num8"]),n.bindKeyCode(105,["numnine","num9"]),n.bindKeyCode(106,["nummultiply","num*"]),n.bindKeyCode(107,["numadd","num+"]),n.bindKeyCode(108,["numenter"]),n.bindKeyCode(109,["numsubtract","num-"]),n.bindKeyCode(110,["numdecimal","num."]),n.bindKeyCode(111,["numdivide","num/"]),n.bindKeyCode(144,["numlock","num"]),n.bindKeyCode(112,["f1"]),n.bindKeyCode(113,["f2"]),n.bindKeyCode(114,["f3"]),n.bindKeyCode(115,["f4"]),n.bindKeyCode(116,["f5"]),n.bindKeyCode(117,["f6"]),n.bindKeyCode(118,["f7"]),n.bindKeyCode(119,["f8"]),n.bindKeyCode(120,["f9"]),n.bindKeyCode(121,["f10"]),n.bindKeyCode(122,["f11"]),n.bindKeyCode(123,["f12"]),n.bindKeyCode(124,["f13"]),n.bindKeyCode(125,["f14"]),n.bindKeyCode(126,["f15"]),n.bindKeyCode(127,["f16"]),n.bindKeyCode(128,["f17"]),n.bindKeyCode(129,["f18"]),n.bindKeyCode(130,["f19"]),n.bindKeyCode(131,["f20"]),n.bindKeyCode(132,["f21"]),n.bindKeyCode(133,["f22"]),n.bindKeyCode(134,["f23"]),n.bindKeyCode(135,["f24"]),n.bindMacro("shift + `",["tilde","~"]),n.bindMacro("shift + 1",["exclamation","exclamationpoint","!"]),n.bindMacro("shift + 2",["at","@"]),n.bindMacro("shift + 3",["number","#"]),n.bindMacro("shift + 4",["dollar","dollars","dollarsign","$"]),n.bindMacro("shift + 5",["percent","%"]),n.bindMacro("shift + 6",["caret","^"]),n.bindMacro("shift + 7",["ampersand","and","&"]),n.bindMacro("shift + 8",["asterisk","*"]),n.bindMacro("shift + 9",["openparen","("]),n.bindMacro("shift + 0",["closeparen",")"]),n.bindMacro("shift + -",["underscore","_"]),n.bindMacro("shift + =",["plus","+"]),n.bindMacro("shift + [",["opencurlybrace","opencurlybracket","{"]),n.bindMacro("shift + ]",["closecurlybrace","closecurlybracket","}"]),n.bindMacro("shift + \\",["verticalbar","|"]),n.bindMacro("shift + ;",["colon",":"]),n.bindMacro("shift + '",["quotationmark","'"]),n.bindMacro("shift + !,",["openanglebracket","<"]),n.bindMacro("shift + .",["closeanglebracket",">"]),n.bindMacro("shift + /",["questionmark","?"]),c.match("Mac")?n.bindMacro("command",["mod","modifier"]):n.bindMacro("ctrl",["mod","modifier"]);for(var r=65;r<=90;r+=1){var a=String.fromCharCode(r+32),p=String.fromCharCode(r);n.bindKeyCode(r,a),n.bindMacro("shift + "+a,p),n.bindMacro("capslock + "+a,p)}var y=e.match("Firefox")?59:186,b=e.match("Firefox")?173:189,k=e.match("Firefox")?61:187,C,z;c.match("Mac")&&(e.match("Safari")||e.match("Chrome"))?(C=91,z=93):c.match("Mac")&&e.match("Opera")?(C=17,z=17):c.match("Mac")&&e.match("Firefox")&&(C=224,z=224),n.bindKeyCode(y,["semicolon",";"]),n.bindKeyCode(b,["dash","-"]),n.bindKeyCode(k,["equal","equalsign","="]),n.bindKeyCode(C,["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"]),n.bindKeyCode(z,["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"]),n.setKillKey("command")}var w=new H;return w.setLocale("us",T),w.Keyboard=H,w.Locale=P,w.KeyCombo=x,w})})(Ot);var ft=Ot.exports,be=Object.defineProperty,we=(l,i,t)=>i in l?be(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t,ve=(l,i,t)=>(we(l,typeof i!="symbol"?i+"":i,t),t);const ge="@vis-three/plugin-keyboard-manager";class _e extends Gt{constructor(){super(),ve(this,"map",new Map)}generateSymbol(i){return Array.isArray(i)?i.join(" + "):i.shortcutKey.join(" + ")}watch(i){return i?ft.watch(void 0,i):ft.watch(),this}register(i){const t=this.generateSymbol(i);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(ft.bind(t,i.keydown||null,i.keyup),this.map.set(t,i),this)}update(i){const t=this.generateSymbol(i);return this.map.has(t)?(this.cancel(i.shortcutKey),this.register(i),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(i),this)}cancel(i){const t=this.generateSymbol(i);if(this.map.has(t)){const o=this.map.get(t);ft.unbind(t,o.keydown||null,o.keyup),this.map.delete(t)}return this}checkRepeat(i){const t=this.generateSymbol(i);return this.map.has(t)}getDocs(){const i=[];return this.map.forEach(t=>{i.push({shortcutKey:[].concat(t.shortcutKey),desp:t.desp})}),i}}const Ht=U(ge),Qe=function(l){return{name:Ht,install(i){i.keyboardManager=new _e,l&&l.keyboards&&l.keyboards.forEach(t=>{i.keyboardManager.register(t)})},dispose(i){i.keyboardManager.clear(),delete i.keyboardManager}}},Ee="@vis-three/strategy-orbit-viewpoint",xe=U(Ee),Be=function(){let l;return{name:xe,condition:[Wt,gt],exec(i){const t=()=>{i.orbitControls.enableRotate=!1},o={[K.DEFAULT]:()=>{i.orbitControls.enableRotate=!0},[K.TOP]:t,[K.BOTTOM]:t,[K.RIGHT]:t,[K.LEFT]:t,[K.FRONT]:t,[K.BACK]:t};l=h=>{const d=h.viewpoint;i.orbitControls.target.set(0,0,0),o[d]&&o[d]()},i.addEventListener(J,l)},rollback(i){i.removeEventListener(J,l)}}},Me="@vis-three/strategy-stats-render",Se=U(Me),Ze=function(){let l,i;return{name:Se,condition:[$t,Dt],exec(t){l=()=>{t.stats.update()},i=t.setStats,t.setStats=function(o){return i(o),o?this.renderManager.addEventListener("render",l):this.renderManager.removeEventListener("render",l),this}},rollback(t){t.setStats=i}}},Ke="@vis-three/strategy-grid-viewpoint",Ce=U(Ke),Fe=function(){let l;return{name:Ce,condition:[gt,Vt],exec(i){const t=i.gridHelper,o=()=>{t.rotation.set(0,0,0)},h=()=>{t.rotation.set(0,0,Math.PI/2)},d=()=>{t.rotation.set(Math.PI/2,0,0)},s={[K.DEFAULT]:o,[K.TOP]:o,[K.BOTTOM]:o,[K.RIGHT]:h,[K.LEFT]:h,[K.FRONT]:d,[K.BACK]:d};l=u=>{const _=u.viewpoint;s[_]&&s[_](),t.updateMatrix(),t.updateMatrixWorld()},i.addEventListener(J,l)},rollback(i){i.removeEventListener(J,l)}}},Pe="@vis-three/strategy-transform-keyboard",Te=U(Pe),Ue=function(){return{name:Te,condition:[Ht,Rt],exec(l){const i=l.transformControls;l.keyboardManager.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:t=>{t==null||t.preventDefault(),i.translationSnap=null,i.rotationSnap=null,i.scaleSnap=null},keydown:t=>{t==null||t.preventDefault(),t==null||t.preventRepeat(),i.translationSnap=5,i.rotationSnap=Math.PI/180*10,i.scaleSnap=.1}}).register({shortcutKey:["r"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u65CB\u8F6C",keyup:t=>{t==null||t.preventDefault(),i&&(i.mode="rotate")}}).register({shortcutKey:["t"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u79FB\u52A8",keyup:t=>{t==null||t.preventDefault(),i&&(i.mode="translate")}}).register({shortcutKey:["e"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u7F29\u653E",keyup:t=>{t==null||t.preventDefault(),i.mode="scale"}}).register({shortcutKey:["x"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ax",keyup:t=>{t==null||t.preventDefault(),i.showX=!i.showX}}).register({shortcutKey:["y"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ay",keyup:t=>{t==null||t.preventDefault(),!(t!=null&&t.ctrlKey)&&(i.showY=!i.showY)}}).register({shortcutKey:["z"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Az",keyup:t=>{t==null||t.preventDefault(),!(t!=null&&t.ctrlKey)&&(i.showZ=!i.showZ)}}).register({shortcutKey:["space"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u53D8\u6362\u7A7A\u95F4",keyup:t=>{t==null||t.preventDefault(),i.space=i.space==="local"?"world":"local"}})},rollback(l){l.keyboardManager.cancel(["shift"]).cancel(["r"]).cancel(["t"]).cancel(["e"]).cancel(["x"]).cancel(["y"]).cancel(["z"]).cancel(["space"])}}};export{ze as A,Fe as G,Qe as K,Be as O,ee as S,Rt as T,Xe as V,te as a,He as b,Ye as c,Ge as d,Ze as e,Ue as f,V as g};
