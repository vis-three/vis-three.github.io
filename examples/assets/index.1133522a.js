import{E as p}from"./vis-three.tdcm.es.ba892fff.js";import{O as s,br as m,w as i,M as l,bv as o,am as d,I as g,Q as n,l as u}from"./three.3f33d046.js";import{W as w,C as S}from"./index.c0df7946.js";import{E as f}from"./index.0317c091.js";import{x as v}from"./vis-three.plugin-orbit-controls.es.1508a7f8.js";import{S as y}from"./index.98a0d82e.js";import{A as P}from"./index.bdebbb5d.js";import{G as x}from"./index.5b5c1015.js";import{V as M}from"./index.336b965b.js";import{M as B}from"./vis-three.plugin-transform-controls.es.5244fee5.js";import{S as E}from"./index.9b9e13dd.js";import{m as b}from"./vis-three.plugin-keyboard-manager.es.16e92de2.js";import{C,a as F}from"./index.fd7db63a.js";import{C as W,a as D}from"./index.fe593856.js";import{S as R}from"./index.ca8957d4.js";import{E as L}from"./index.cee1ad1a.js";import{O}from"./index.e2e75f8b.js";import{O as k}from"./index.f411c2bc.js";import{T as V}from"./index.457fa50b.js";import{S as T}from"./index.2c9e736c.js";import{G}from"./index.bbdc45c2.js";import{T as A}from"./index.e7386c00.js";import{C as Q,a as j}from"./index.82f2a702.js";import{W as z}from"./index.82346856.js";import{T as I}from"./index.f17582aa.js";import{L as _}from"./vis-three.strategy-orbit-controls-support.es.bfc29c0d.js";import{m as H}from"./index.4caff7a1.js";import{p as N}from"./vis-three.library-parser.es.0233fa92.js";import{t as U,m as K,b as h}from"./curve.0ba3d968.js";import{w as $}from"./vis-three.plugin-pointer-manager.es.28277630.js";import{S as q}from"./vis-three.strategy-multi-renderer.es.91c74cfe.js";import{G as J}from"./vis-three.strategy-selection-prompt.es.9e058aa8.js";const X="@vis-three/plugin-path-drawing";class Y extends K{constructor(e){super(),this.camera=new s(-window.innerWidth,window.innerWidth,window.innerHeight,-window.innerHeight,0,1e4),this.plane=new m(new i(0,0,1),0),this.boardOffset=20,this.drawingBoard=new l(new o(150,150),new d({transparent:!0,opacity:.2,color:"rgb(64, 255, 242)"})),this.relativeMatrixInvert=new g,this.cachePoint=new i,this.cacheRelativePoint=new i,this._tempVector=new i,this._tempVector2=new i,this._tempQuaternion=new n,this.begun=!1,this.autoPlane=!1,this.setScene=t=>{this.drawingBoard.parent&&t.scene.add(this.drawingBoard)},this.cacheBeginWriteFun=t=>{const r=this.engine.pointerManager;this.cacheWriteFun(t),r.addEventListener("mousedown",this.cacheWriteFun),r.addEventListener("pointermove",this.cacheMoveFun),r.removeEventListener("mousedown",this.cacheBeginWriteFun),this.begun=!0},this.cacheWriteFun=t=>{this.autoPlane&&this.autoCalcPlane();const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"write",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})},this.cacheMoveFun=t=>{this.autoPlane&&this.autoCalcPlane();const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"move",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})},this.engine=e,this.drawingBoard.raycast=()=>{},this.drawingBoard.matrixAutoUpdate=!1,this.setDrawingBoardMatrix(),e.addEventListener(h.SETSCENE,this.setScene)}autoCalcPlane(){const e=this.plane,t=this.camera,r=this._tempVector.set(0,0,0),c=this._tempQuaternion;e.normal.set(0,0,1).applyQuaternion(t.getWorldQuaternion(c)).normalize(),r.set(0,0,0).project(t),r.x>1||r.x<-1||r.y>1||r.y<-1||r.z>1||r.z<-1?e.constant=t.getWorldPosition(r).length()+50:e.constant=0}setCamera(e){return this.camera=e,this}setAutoPlane(e){return this.autoPlane=e,this}setDraingBoardSize(e,t){const r=new o(e,t);this.drawingBoard.geometry.copy(r),r.dispose()}offsetCamera(e){const t=e.length();return e.normalize().applyQuaternion(new n().setFromUnitVectors(new i(0,1,0),this.plane.normal)),this.camera.position.copy(this.plane.normal).multiplyScalar(this.plane.constant).add(e.multiplyScalar(t)),this.camera instanceof s&&(this.camera.zoom=(this.camera.top-this.camera.bottom)/(this.drawingBoard.geometry.parameters.height+this.boardOffset)),this.camera.updateProjectionMatrix(),this.drawingBoard.position.add(e),this.drawingBoard.updateMatrix(),this.drawingBoard.updateMatrixWorld(!0),this}setRelativeObject(e){return this.relativeMatrixInvert.copy(e.matrixWorld).invert(),this}setDrawPlane(e,t=0){return this.plane.set(e,t),this.setDrawingBoardMatrix(),this}setDrawPlaneByFace(e){return this.plane.setFromCoplanarPoints(e.a,e.b,e.c),this.setDrawingBoardMatrix(),this}setDrawingBoardMatrix(){const e=this.drawingBoard;e.position.copy(this.plane.normal).multiplyScalar(this.plane.constant),e.applyQuaternion(new n().setFromUnitVectors(new i(0,0,1),this.plane.normal)),e.updateMatrix(),e.updateMatrixWorld(!0)}dispose(){this.drawingBoard.removeFromParent(),this.drawingBoard.geometry.dispose(),this.drawingBoard.material.dispose(),this.engine.removeEventListener(h.SETSCENE,this.setScene)}showDrawingBoard(e){return e?this.engine.scene.add(this.drawingBoard):this.engine.scene.remove(this.drawingBoard),this}setSketcherByPlane(e=new i(0,0,1),t=0,r=new i(0,50,0)){return this.setDrawPlane(e,t).offsetCamera(r)}setSketcherByFace(e,t=new i(0,50,0)){return this.setDrawPlaneByFace(e).offsetCamera(t)}setSketcherByFaceAndObject(e,t){const r=new i().setFromMatrixPosition(t.matrixWorld);return this.setRelativeObject(t),this.setSketcherByFace(e,r)}changeToDrawingView(){return this.engine.setCamera(this.camera),this}beginDraw(){return this.dispatchEvent({type:"begin"}),this.begun=!1,this.engine.pointerManager.addEventListener("mousedown",this.cacheBeginWriteFun),this}endDraw(e=!0){const t=this.engine.pointerManager;return t.removeEventListener("mousedown",this.cacheWriteFun),t.removeEventListener("pointermove",this.cacheMoveFun),this.dispatchEvent({type:"end"}),e&&(this.begun||this.engine.pointerManager.removeEventListener("mousedown",this.cacheBeginWriteFun),this.removeEvent("begin"),this.removeEvent("write"),this.removeEvent("move"),this.removeEvent("end")),this.begun=!1,this}}const Z=U(X),ee=function(){return{name:Z,deps:[$],install(a){const e=new Y(a);a.pathSketcher=e},dispose(a){a.pathSketcher.dispose(),delete a.pathSketcher}}};class Oe extends p{constructor(e={}){super(e),this.install(w(e.WebGLRendererPlugin||{antialias:!0,alpha:!0})).install(C()).install(W()).install(f(e.EffectComposerPlugin||{MSAA:!0})).install(v()).install(S()).install(R()).install(y()).install(P()).install(x()).install(M()).install(B()).install(E()).install(b()).install(ee());for(const t of Object.values(N))this.resourceManager.addParser(new t);for(const t of H)this.useModule(t);this.exec(F()).exec(D()).exec(L()).exec(O()).exec(k()).exec(V()).exec(T()).exec(G()).exec(A()).exec(Q()).exec(z()).exec(I()).exec(_()).exec(j()).exec(q()).exec(J(e.SelectionPromptStrategy||{visibleEdgeColor:new u("rgb(236, 65, 118)"),edgeStrength:5,edgeThickness:2,downSampleRatio:1.5}))}}export{Oe as M};
