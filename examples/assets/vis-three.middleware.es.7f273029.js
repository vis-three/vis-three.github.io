import{b as I,E as He,s as We,a as Fe,i as b,c as x,e as ne}from"./index.202ebdec.js";import{L as qe,a as De,b as q}from"./vis-three.plugin-loader-manager.es.c1771985.js";import{P as Xe}from"./vis-three.plugin-pointer-manager.es.640cfa1a.js";import{E as ze}from"./index.c35e5a3e.js";import{R as Ze}from"./index.e6be8a02.js";import{_ as K,a as U,b as B,c as k}from"./G6.d44f13fb.js";var P,Ke=new Uint8Array(16);function Qe(){if(!P&&(P=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!P))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return P(Ke)}var Ye=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function oe(r){return typeof r=="string"&&Ye.test(r)}var f=[];for(var X=0;X<256;++X)f.push((X+256).toString(16).substr(1));function et(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(f[r[e+0]]+f[r[e+1]]+f[r[e+2]]+f[r[e+3]]+"-"+f[r[e+4]]+f[r[e+5]]+"-"+f[r[e+6]]+f[r[e+7]]+"-"+f[r[e+8]]+f[r[e+9]]+"-"+f[r[e+10]]+f[r[e+11]]+f[r[e+12]]+f[r[e+13]]+f[r[e+14]]+f[r[e+15]]).toLowerCase();if(!oe(t))throw TypeError("Stringified UUID is invalid");return t}function $e(r,e,t){r=r||{};var n=r.random||(r.rng||Qe)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var o=0;o<16;++o)e[t+o]=n[o];return e}return et(n)}function v(r){return typeof r=="function"}function je(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var z=je(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Q(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var V=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,o,s;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=K(i),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else i.remove(this);var h=this.initialTeardown;if(v(h))try{h()}catch(d){s=d instanceof z?d.errors:[d]}var L=this._finalizers;if(L){this._finalizers=null;try{for(var w=K(L),M=w.next();!M.done;M=w.next()){var R=M.value;try{ve(R)}catch(d){s=s!=null?s:[],d instanceof z?s=U(U([],B(s)),B(d.errors)):s.push(d)}}}catch(d){n={error:d}}finally{try{M&&!M.done&&(o=w.return)&&o.call(w)}finally{if(n)throw n.error}}}if(s)throw new z(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)ve(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Q(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&Q(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),Le=V.EMPTY;function Re(r){return r instanceof V||r&&"closed"in r&&v(r.remove)&&v(r.add)&&v(r.unsubscribe)}function ve(r){v(r)?r():r.unsubscribe()}var se={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Y={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var o=Y.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,U([r,e],B(t))):setTimeout.apply(void 0,U([r,e],B(t)))},clearTimeout:function(r){var e=Y.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function tt(r){Y.setTimeout(function(){throw r})}function Me(){}var N=null;function _(r){if(se.useDeprecatedSynchronousErrorHandling){var e=!N;if(e&&(N={errorThrown:!1,error:null}),r(),e){var t=N,n=t.errorThrown,o=t.error;if(N=null,n)throw o}}else r()}var Pe=function(r){k(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Re(t)&&t.add(n)):n.destination=st,n}return e.create=function(t,n,o){return new ee(t,n,o)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(V),rt=Function.prototype.bind;function Z(r,e){return rt.call(r,e)}var nt=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){T(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){T(n)}else T(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){T(t)}},r}(),ee=function(r){k(e,r);function e(t,n,o){var s=r.call(this)||this,i;if(v(t)||!t)i={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:o!=null?o:void 0};else{var a;s&&se.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&Z(t.next,a),error:t.error&&Z(t.error,a),complete:t.complete&&Z(t.complete,a)}):i=t}return s.destination=new nt(i),s}return e}(Pe);function T(r){tt(r)}function ot(r){throw r}var st={closed:!0,next:Me,error:ot,complete:Me},it=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function at(r){return r}function ct(r){return r.length===0?at:r.length===1?r[0]:function(t){return r.reduce(function(n,o){return o(n)},t)}}var Se=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var o=this,s=lt(e)?e:new ee(e,t,n);return _(function(){var i=o,a=i.operator,c=i.source;s.add(a?a.call(s,c):c?o._subscribe(s):o._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=Oe(t),new t(function(o,s){var i=new ee({next:function(a){try{e(a)}catch(c){s(c),i.unsubscribe()}},error:s,complete:o});n.subscribe(i)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[it]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ct(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=Oe(e),new e(function(n,o){var s;t.subscribe(function(i){return s=i},function(i){return o(i)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function Oe(r){var e;return(e=r!=null?r:se.Promise)!==null&&e!==void 0?e:Promise}function ut(r){return r&&v(r.next)&&v(r.error)&&v(r.complete)}function lt(r){return r&&r instanceof Pe||ut(r)&&Re(r)}var ft=je(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ie=function(r){k(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new we(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new ft},e.prototype.next=function(t){var n=this;_(function(){var o,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var i=K(n.currentObservers),a=i.next();!a.done;a=i.next()){var c=a.value;c.next(t)}}catch(l){o={error:l}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}}})},e.prototype.error=function(t){var n=this;_(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var o=n.observers;o.length;)o.shift().error(t)}})},e.prototype.complete=function(){var t=this;_(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,o=this,s=o.hasError,i=o.isStopped,a=o.observers;return s||i?Le:(this.currentObservers=null,a.push(t),new V(function(){n.currentObservers=null,Q(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,o=n.hasError,s=n.thrownError,i=n.isStopped;o?t.error(s):i&&t.complete()},e.prototype.asObservable=function(){var t=new Se;return t.source=this,t},e.create=function(t,n){return new we(t,n)},e}(Se),we=function(r){k(e,r);function e(t,n){var o=r.call(this)||this;return o.destination=t,o.source=n,o}return e.prototype.next=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,t)},e.prototype.error=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&o!==void 0?o:Le},e}(ie),pt=Object.defineProperty,ht=(r,e,t)=>e in r?pt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,u=(r,e,t)=>(ht(r,typeof e!="symbol"?e+"":e,t),t);const O={},Ee={},ae={},H={},Ne={},te={},ce=r=>Ne[r]||null,dt=r=>H[r],yt=r=>{const e=ce(r);return e?dt(e):!1},Te=function(r,e){te[r.type]=r,ae[r.type.toLocaleUpperCase()]=r.type,O[r.type]=r.config,Ne[r.type]=e},m={proxy:{expand:void 0,timing:"before",toRaw:void 0,ignore:{}},symbol:{generator:$e,validator:oe}},sr=function(r){r.proxy&&Object.assign(m.proxy,r.proxy),r.symbol&&Object.assign(m.symbol,r.symbol)},C=(r,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,ue=(r,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,j=r=>JSON.parse(JSON.stringify(r,C),ue);class _e{constructor(e){u(this,"config"),this.config=e}pipe(e){return this.config=e(this.config),this}get(){return this.config}}var A={stringify:C,parse:ue,clone:j,Pipeline:_e},ir=Object.freeze(Object.defineProperty({__proto__:null,stringify:C,parse:ue,clone:j,Pipeline:_e,default:A},Symbol.toStringTag,{value:"Module"}));const y=function(r,e,t={observer:!0,strict:!0,warn:!0}){if(t.observer===void 0&&(t.observer=!0),t.strict===void 0&&(t.strict=!0),t.warn===void 0&&(t.warn=!0),t.handler===void 0&&(t.handler=m.proxy.expand),!O[r])return console.error(`type: ${r} can not be found in configList.`),{vid:"",type:r};const n=(i,a)=>{for(const c in a){if(i[c]===void 0){!t.strict&&(i[c]=a[c]),t.strict&&t.warn&&console.warn(`'${r}' config can not set key: ${c}`);continue}typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?(i[c]===null&&(i[c]={...a[c]}),n(i[c],a[c])):i[c]=a[c]}};let o=O[r]();if(o.vid===""&&(o.vid=m.symbol.generator()),e&&n(o,e),t.observer===!1)return o;t.handler&&m.proxy.timing==="before"&&(o=t.handler(o));let s=_t(o);if(t.handler&&m.proxy.timing==="after"&&(s=t.handler(s)),y.autoInject&&y.injectEngine){const i=y.injectEngine;if(i.applyConfig(s),y.injectScene&&yt(o.type)&&o.type!==ae.SCENE){let a=null;typeof y.injectScene=="boolean"?a=i.getObjectConfig(i.scene):typeof y.injectScene=="string"&&(a=i.getConfigBySymbol(y.injectScene)),a?a.children.push(o.vid):console.warn("current engine scene can not found it config",i,i.scene)}return s}return s};y.autoInject=!0;y.injectScene=!1;y.injectEngine=null;const Je=(r,e={})=>{let t=JSON.stringify(r,A.stringify);const n={};!e.filter&&(e.filter=["assets"]);const o=Object.keys(r).filter(i=>!e.filter.includes(i));for(const i of o)for(const a of r[i]){const c=a.vid,l=$e();t=t.replace(new RegExp(c,"g"),l),e.detail&&(n[c]=l)}const s=JSON.parse(t,A.parse);if(e.fillName)if(typeof e.fillName=="function")for(const i of o)for(const a of s[i])a.name||(a.name=e.fillName(a));else for(const i of o)for(const a of s[i])a.name||(a.name=`${a.type}-${a.vid.slice(-2)}`);return e.detail?{config:s,detail:n}:s},le=(r,e,t={filter:["assets"],clone:!0})=>{const n=t.clone?A.clone(r):r;!t.filter&&(t.filter=["assets"]);const o=Object.keys(n).filter(s=>!t.filter.includes(s));for(const s of o)n[s].forEach((a,c,l)=>{l[c]=e(a)});return n},Ue=function(r){const e={};for(const t of Object.keys(r))for(const n of r[t])e[n.name]=n;return e},Be=function(r,e){return typeof r=="string"&&(r=JSON.parse(r,A.parse)),le(A.clone(r),t=>(t=y(t.type,t,{strict:!1}),e?e(t):t))};var gt={clone:Je,handler:le,planish:Ue,observable:Be},ar=Object.freeze(Object.defineProperty({__proto__:null,clone:Je,handler:le,planish:Ue,observable:Be,default:gt},Symbol.toStringTag,{value:"Module"}));class mt{constructor(){u(this,"list",[]),u(this,"timer"),u(this,"time",0)}exec(e){if(e(!1))return;this.list.includes(e)||this.list.push(e);let t=0;const n=()=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const o=[];for(const s of this.list)s(!1)||o.push(s);if(o.length)if(o.length===t){for(const s of o)s(!0);this.list=[]}else t=o.length,this.list=o,n();else this.list=[]},this.time)};n()}append(e){this.list.length&&!this.list.includes(e)?this.list.push(e):this.exec(e)}nextTick(e){setTimeout(()=>{e()},this.time)}}const cr=new mt;class fe{constructor(){u(this,"map",new WeakMap)}create(e){if(this.map.has(e)){console.warn("object is exist.",e);return}this.map.set(e,new I)}dispose(e){this.map.delete(e)}check(e){return this.map.has(e)}emit(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).emit(t,n)}on(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).on(t,n)}off(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).off(t,n)}}const E=new fe,bt=new fe;var ur=Object.freeze(Object.defineProperty({__proto__:null,Bus:fe,compilerEvent:E,configEvent:bt},Symbol.toStringTag,{value:"Module"}));class vt{constructor(){u(this,"condition",{})}registerModule(e){return this.condition[e]=!1,this}updateCondition(e){return typeof this.condition[e]!="undefined"&&(this.condition[e]=!0),this}reset(){Object.keys(this.condition).forEach(e=>{this.condition[e]=!1})}test(){return!Object.values(this.condition).includes(!1)}trig(){}}class Mt extends vt{constructor(){super(),u(this,"triggerList",[])}registerModule(e){return H[e]?super.registerModule(e):this}registerExec(e){e(!0)||this.triggerList.push(e)}trig(){const e=this.triggerList;for(const t of e)t();this.reset()}reset(){this.triggerList=[],super.reset()}}const St=new Mt,lr=function(){return m.symbol.generator()};var Ot=(r=>(r.ADD="compiler.add",r.REMOVE="compiler.remove",r.COMPILE="compiler.compile",r.UPDATE="compiler.update",r))(Ot||{});class fr{constructor(){u(this,"MODULE",""),u(this,"processors",new Map),u(this,"target",{}),u(this,"map",new Map),u(this,"weakMap",new WeakMap),u(this,"engine"),u(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!this.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const n=this.processors.get(e.type).create(e,this.engine,this);return this.map.set(e.vid,n),this.weakMap.set(n,e.vid),E.create(n),E.emit(n,"compiler.add"),n}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!this.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const n=this.map.get(t);return this.processors.get(e.type).dispose(n,this.engine,this),this.map.delete(t),this.weakMap.delete(n),E.emit(n,"compiler.remove"),E.dispose(n),this.cacheCompile&&this.cacheCompile.vid===t&&(this.cacheCompile=void 0),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{We(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const n=this.cacheCompile;let o,s,i;if(n&&n.vid===e)o=n.target,s=n.config,i=n.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(o=this.map.get(e),s=this.target[e],!this.processors.has(s.type))return console.warn(`PassCompiler can not support this type: ${s.type}`),this;i=this.processors.get(s.type),this.cacheCompile={target:o,config:s,processor:i,vid:e}}i.process({config:s,target:o,engine:this.engine,processor:i,compiler:this,...t});const a=t.path.join(".");return E.emit(o,`compiler.compile:${a&&a+"."}${t.key}`),E.emit(o,"compiler.update"),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!this.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}this.processors.get(e.type).dispose(t,this.engine,this)}return this.map.clear(),this.target={},this}reigstProcessor(e,t){return this.processors.has(e.type)?(console.warn(`${this.MODULE} compiler has already exist this processor ${e.type}, that will be cover.`),this):(this.processors.set(e.type,e),Te(e,this.MODULE),t(this),this)}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}}const wt=function(r,e,t){return class extends e{constructor(){super(),u(this,"MODULE",r);for(const n of t)this.processors.set(n.type,n)}}},re="vis.father",D="vis.key",pe="vis.observer",Ge=new WeakMap,J=function(r){Array.isArray(r)&&Ge.set(r,r.concat([]))},Et=function(r){return Ge.get(r)},he=function(r){let e="";const t=n=>{n[Symbol.for(D)]!==void 0&&(e=`${n[Symbol.for(D)]}${e?`.${e}`:""}`,n[Symbol.for(re)]&&t(n[Symbol.for(re)]))};return t(r),e},xt=function(r){if(r.length&&b(r[0])){const e=r.length;for(let t=0;t<e;t+=1)r[t][Symbol.for(D)]=t}},de=function(r){return r[Symbol.for(pe)]},Ie=function(r){return Boolean(r[Symbol.for(pe)])},xe=function(r,e,t){return Reflect.get(r,e,t)},Ce=function(r,e,t,n,o){if(typeof e=="symbol")return Reflect.set(r,e,t,n);if(r[e]===void 0){const s=Reflect.set(r,e,t);return o.add(t),o.next({operate:"add",path:e,key:e,value:t}),s}else{const s=Reflect.set(r,e,t);return o.remove(t.vid),o.add(t),o.next({operate:"set",path:e,key:e,value:t}),s}},Ae=function(r,e,t){if(typeof e=="symbol")return Reflect.deleteProperty(r,e);const n=r[e],o=Reflect.deleteProperty(r,e);return t.next({operate:"delete",path:e,key:e,value:n}),t.remove(n.vid),o};class Ct extends ie{constructor(){super(),u(this,"container"),u(this,"subscriptions",new Map);const e=m.proxy.expand?(t={})=>m.proxy.expand(t):(t={})=>t;m.proxy.timing==="before"?this.container=new Proxy(e(),{get:xe,set:(t,n,o,s)=>Ce(t,n,o,s,this),deleteProperty:(t,n)=>Ae(t,n,this)}):this.container=e(new Proxy({},{get:xe,set:(t,n,o,s)=>Ce(t,n,o,s,this),deleteProperty:(t,n)=>Ae(t,n,this)}))}add(e){const t=de(e);if(!t){console.error("DataContainer: this config can not observer",e);return}this.subscriptions.set(t.target.vid,t.subscribe(n=>{this.next({operate:n.operate,path:ne(t.target.vid,n.path),key:n.key,value:n.value})}))}remove(e){this.subscriptions.delete(e)}}class At{constructor(){u(this,"rule",()=>{}),u(this,"members",[])}apply(e){return this.members.includes(e)||this.members.push(e),this}cancel(e){return this.members.includes(e)&&this.members.splice(this.members.indexOf(e),1),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;for(const n of this.members)t(e,n);return this}}class Dt{constructor(e,t=[]){u(this,"MODULE",""),u(this,"dataContainer",new Ct),u(this,"translater"),this.translater=new At().setRule(e),this.dataContainer.subscribe(n=>{this.translater.translate(n)});for(const n of t)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(e){return Boolean(this.dataContainer.container[e])}addConfig(e){return this.dataContainer.container[e.vid]=e,this}getConfig(e){return this.dataContainer.container[e]}removeConfig(e){const t=this.dataContainer.container;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.dataContainer.container),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),C):JSON.stringify(Object.values(this.dataContainer.container),C)}exportConfig(e=!0){if(e){const t=this.dataContainer.container,n=[],o={},s=(i,a,c={})=>{for(const l in i){if(["vid","type"].includes(l)){c[l]=i[l];continue}if(typeof i[l]=="object"&&i[l]!==null){if(Array.isArray(i[l])){if(!i[l].length)continue;c[l]=i[l].map(h=>typeof h=="object"&&h!==null?j(h):h);continue}c[l]={},a[l]?(s(i[l],a[l],c[l]),Object.keys(c[l]).length===0&&delete c[l]):c[l]=j(i[l])}else a[l]!==i[l]&&(c[l]=i[l])}};for(const i of Object.values(t)){if(!o[i.type]){if(!O[i.type]){console.error(`can not font some config with: ${i.type}`);continue}o[i.type]=O[i.type]()}const a={};s(i,o[i.type],a),n.push(a)}return n}else return Object.values(j(this.dataContainer.container))}load(e){const t=this.dataContainer.container,n={},o=(s,i)=>{for(const a in i)typeof s[a]=="object"&&s[a]!==null&&typeof i[a]=="object"&&i[a]!==null?o(s[a],i[a]):s[a]===void 0&&(s[a]=i[a])};for(const s of e){if(!n[s.type]){if(!O[s.type]){console.error(`can not font some config with: ${s.type}`);continue}n[s.type]=O[s.type]()}o(s,n[s.type]),t[s.vid]=s}return this}remove(e){const t=this.dataContainer.container;for(const n of e)t[n.vid]!==void 0&&delete t[n.vid];return this}}const $t=function(r,e){return class extends Dt{constructor(t=[]){super(e,t),u(this,"MODULE",r)}}},jt=["push","pop","shift","unshift","splice","sort","reverse"],$=new WeakSet,Lt=function(r,e,t){return Array.isArray(r)&&jt.includes(e)&&$.add(r),Reflect.get(r,e,t)},Rt=function(r,e,t,n){const o=he(r),s=de(r);if(typeof e=="symbol"||s.isIgnore(ne(o,e)))return Reflect.set(r,e,t,n);if(b(t)&&!Ie(t)&&(t=G(s,t,r,e)),r[e]===void 0){b(t)&&(t[Symbol.for(D)]=e,x(t)&&J(t)),x(r)&&$.delete(r);const c=Reflect.set(r,e,t);return x(r)&&J(r),s.next({operate:"add",path:o,key:e,value:t}),c}const i=r[e],a=Reflect.set(r,e,t);if(x(r)){if($.has(r)&&e==="length"){const c=Et(r);if(!c)return Array.isArray(i)&&console.error("array value is not be cached:",r),a;xt(r);const l=Math.abs(c.length-r.length),h=c.length>=r.length?"delete":"add",L=c.length>=r.length?r:c;let w=0,M=0;for(const R of h==="delete"?c:r){if(!L.includes(R)&&(s.next({operate:h,path:o,key:M.toString(),value:R}),w+=1,w===l))break;M+=1}return J(r),$.delete(r),a}else if($.has(r)||e==="length")return a}return s.next({operate:"set",path:o,key:e,value:t}),a},Pt=function(r,e){const t=he(r),n=de(r);if(typeof e=="symbol"||n.isIgnore(t))return Reflect.deleteProperty(r,e);const o=r[e],s=Reflect.deleteProperty(r,e);return x(r)||n.next({operate:"delete",path:t,key:e,value:o}),s},Nt={get:Lt,set:Rt,deleteProperty:Pt},G=function(r,e,t,n){if(!b(e)||Ie(e))return e;const o=t?he(t):"";if(r.isIgnore(o))return e;t&&(e[Symbol.for(re)]=t),e[Symbol.for(pe)]=r;for(const i in e){const a=ne(o,i);if(!r.isIgnore(a)&&b(e[i])){if(x(e[i])){const c=e[i];e[i]=G(r,e[i],e),J(c)}else e[i]=G(r,e[i],e);e[i][Symbol.for(D)]=i}}return n&&(e[Symbol.for(D)]=n),new Proxy(e,Nt)};class Tt extends ie{constructor(e,t){super(),u(this,"ignore",{}),u(this,"target"),t?this.ignore=t:this.ignore=Object.assign({meta:!0,alias:!0},m.proxy.ignore||{}),this.target=G(this,e)}isIgnore(e){let t=this.ignore;for(const n of e.split(".")){if(t[n]===void 0)return!1;if(typeof t[n]=="boolean"&&t[n])return!0;t=t[n]}return!1}setIgnore(e){this.ignore=e}mergeIgnore(e){this.ignore=Object.assign(this.ignore,e)}}const _t=function(r,e){return new Tt(r,e).target};class Jt{constructor(e){u(this,"type"),u(this,"config"),u(this,"commands"),u(this,"create"),u(this,"dispose"),this.type=e.type,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose,this.config=()=>{const t=e.config();return t.type=this.type,t},ae[this.type.toLocaleUpperCase()]=this.type,O[this.type]=this.config}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const n of[].concat(e.path,e.key))if(!t[n]&&!t.$reg){this[e.operate](e);return}else if(t[n])if(typeof t[n]=="function"){t[n](e);return}else t=t[n];else if(t.$reg){for(const o of t.$reg)if(o.reg.test(n)){o.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}expand(e){const t=function(n,o){for(const s in o)b(o[s])&&b(n[s])?t(n[s],o[s]):(b(o[s])&&!n[s]||!b(o[s])&&!n[s])&&(n[s]=o[s])};return this.commands||(this.commands={}),t(this.commands,e),this}}const pr=r=>new Jt(r),hr=(r,e,t=oe)=>{const{operate:n,key:o,path:s,value:i}=r;let a=o;const c=s.split(".");if(c.length&&(a=c.shift()),!t(a)){console.warn(`${e.MODULE} Rule: vid is illeage: ${a}`);return}if(n==="add"&&!c.length&&a===o){e.add(i);return}if(r.operate==="delete"&&!c.length){e.remove(i);return}if(r.operate==="set"&&!c.length&&o===a){e.cover(i);return}e.compile(a,{operate:n,key:o,path:c,value:i})},dr=function(){return{vid:"",type:"",name:"",alias:"",meta:{}}},yr=function(r){return`DEFUALT-${r}`},gr=function(){};class Ut extends I{constructor(){super(),u(this,"compilerMap",new Map)}extend(e,t=!1){this.compilerMap.has(e.MODULE)?(console.warn("compiler manager has exist this compiler",e),t&&this.compilerMap.set(e.MODULE,e)):this.compilerMap.set(e.MODULE,e)}getCompiler(e){return this.compilerMap.has(e)?this.compilerMap.get(e):(console.warn(`can not found this type in compiler manager: ${e}`),null)}getObjectSymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectSymbol(e);if(n)return n}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectBySymbol(e);if(n)return n}return null}getObjectfromModule(e,t){return this.compilerMap.has(e)?this.compilerMap.get(e).map.get(t)||null:(console.warn(`compiler manager can not found this module: ${e}`),null)}getObjectfromModules(e,t){Array.isArray(e)||(e=Object.keys(e));for(const n of e){if(!this.compilerMap.has(n)){console.warn(`compiler manager can not found this module: ${n}`);continue}const o=this.compilerMap.get(n);if(o.map.has(t))return o.map.get(t)}return null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const ye="CompilerManagerPlugin",Bt=function(){return{name:ye,install(r){const e=new Ut;r.compilerManager=e,r.getObjectSymbol=function(t){return e.getObjectSymbol(t)},r.getObjectBySymbol=function(t){return e.getObjectBySymbol(t)},r.getObjectfromModule=function(t,n){return e.getObjectfromModule(t,n)},r.getObjectfromModules=function(t,n){return e.getObjectfromModules(t,n)},r.getObject3D=function(t){return e.getObjectfromModules(H,t)}},dispose(r){r.compilerManager.dispose(),delete r.compilerManager,delete r.getObjectSymbol,delete r.getObjectBySymbol,delete r.getObjectfromModule,delete r.getObjectfromModules,delete r.getObject3D}}};class Gt extends I{constructor(){super(),u(this,"dataSupportMap",new Map)}extend(e,t=!1){this.dataSupportMap.has(e.MODULE)?(console.warn("dataSupport manager has exist this dataSupport",e),t&&this.dataSupportMap.set(e.MODULE,e)):this.dataSupportMap.set(e.MODULE,e)}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const n of t){const o=n.getConfig(e);if(o)return o}return null}getConfigfromModule(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getConfig(t)||null:(console.warn(`data support manager can not found this module: ${e}`),null)}getConfigfromModules(e,t){Array.isArray(e)||(e=Object.keys(e));for(const n of e){if(!this.dataSupportMap.has(n)){console.warn(`data support manager can not found this module: ${n}`);continue}const s=this.dataSupportMap.get(n).getConfig(t);if(s)return s}return null}removeConfigBySymbol(...e){for(const t of e)for(const n of this.dataSupportMap.values())if(n.existSymbol(t)){n.removeConfig(t);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const n of t)if(n.existSymbol(e))return n.MODULE;return null}applyConfig(...e){for(const t of e){const n=ce(t.type);n?this.dataSupportMap.get(n).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}load(e){return this.dataSupportMap.forEach((n,o)=>{e[o]&&n.load(e[o])}),this}loadByModule(e,t){const n=this.dataSupportMap.get(t);return n?(n.load(e),this):(console.warn(`DataSupportManager can not support this module: ${t}`),this)}remove(e){return this.dataSupportMap.forEach((n,o)=>{e[o]&&n.remove(e[o])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),C)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((o,s)=>{e[s]=o.exportConfig(t)}),e}}const W="DataSupportManagerPlugin",It=function(){return{name:W,install(r){const e=new Gt;r.dataSupportManager=e,r.applyConfig=function(...t){return e.applyConfig(...t),r},r.getConfigBySymbol=function(t){return e.getConfigBySymbol(t)},r.getConfigfromModule=function(t,n){return e.getConfigfromModule(t,n)},r.getConfigfromModules=function(t,n){return e.getConfigfromModules(t,n)},r.removeConfigBySymbol=function(...t){return e.removeConfigBySymbol(...t),r},r.toJSON=function(){return e.toJSON()},r.exportConfig=function(){return e.exportConfig()}},dispose(r){delete r.dataSupportManager,delete r.applyConfig,delete r.getConfigBySymbol,delete r.removeConfigBySymbol,delete r.toJSON,delete r.exportConfig}}};class kt{}class ge extends kt{constructor(){super(...arguments),u(this,"selector",(e,t,n)=>n.get(ge)||null)}parse({url:e,resource:t,configMap:n,resourceMap:o}){o.set(e,t)}}var me=(r=>(r.MAPPED="mapped",r))(me||{});class Vt extends I{constructor(e={}){super(),u(this,"configMap",new Map),u(this,"resourceMap",new Map),u(this,"paserMap",new Map),u(this,"defalutParser",new ge);const t=new Map;for(const n in e)t.has(n)&&console.warn(`resourceManager construct params rescource already exist: ${n}, that will be cover.`),t.set(n,e[n]);this.mappingResource(t)}addParser(e){return this.paserMap.has(e.constructor)?this:(this.paserMap.set(e.constructor,e),this)}mappingResource(e,t){const n=this.configMap,o=this.resourceMap,s=[...this.paserMap.values()],i={};for(const[a,c]of e.entries()){if((t==null?void 0:t.parser)&&t.parser[a]){t.parser[a].parse({url:a,resource:c,configMap:n,resourceMap:o});continue}if((t==null?void 0:t.selector)&&t.selector[a]){const h=t.selector[a](a,c,this.paserMap);if(!h){console.warn("resource manager hanlder can not found this resource parser: ",c,t.selector[a]);continue}h.parse({url:a,resource:c,configMap:n,resourceMap:o}),i[a]=this.getResourceConfig(a);continue}let l=null;for(const h of s)if(l=h.selector(a,c,this.paserMap),l)break;if(!l){console.warn("resouce manager can not found some handler to parser this resource, that will use default parser do it:",c),this.defalutParser.parse({url:a,resource:c,configMap:n,resourceMap:o});continue}l.parse({url:a,resource:c,configMap:n,resourceMap:o}),i[a]=this.getResourceConfig(a)}return this.dispatchEvent({type:"mapped",configMap:n,resourceMap:o,resourceConfig:i}),this}getResourceConfig(e){const t=this.configMap,n={};return[...t.keys()].filter(o=>o.startsWith(e)).forEach(o=>{const s=t.get(o);if(!s)console.error(`unknow error: can not found config by url: ${o}`);else{const i=ce(s.type);i?(!n[i]&&(n[i]=[]),n[i].push(s)):console.error(`unknow error: can not found module by type: ${s.type}`,s)}}),n}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,n=this.resourceMap;return[...t.keys()].filter(o=>o.startsWith(e)).forEach(o=>{t.delete(o);const s=n.get(o);s.dispose&&s.dispose(),n.delete(o)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const ke="ResourceManagerPlugin",Ht=function(r={}){return{name:ke,install(e){const t=new Vt(r.resources);e.resourceManager=t,e.registerResources=n=>{const o=new Map;return Object.keys(n).forEach(s=>{o.set(s,n[s])}),t.mappingResource(o),e}},dispose(e){e.addEventListener(Fe.DISPOSE,()=>{e.resourceManager.dispose()})}}},Wt="LoaderDataSupportStrategy",Ft=function(){let r,e;return{name:Wt,condition:[W,De],exec(t){r=t.toJSON,t.toJSON=function(){const n={assets:JSON.parse(t.loaderManager.toJSON())};return t.dataSupportManager.toJSON(n)},e=t.exportConfig,t.exportConfig=function(){let n={};return n={assets:t.loaderManager.exportConfig()},t.dataSupportManager.exportConfig(n)}},rollback(t){t.toJSON=r,t.exportConfig=e}}},qt="LoaderMappingStrategy",Xt=function(){let r,e;return{name:qt,condition:[ke,De],exec(t){r=t.loadResources,t.loadResources=(n,o)=>{const s=i=>{o(void 0,i),t.resourceManager.removeEventListener(q.LOADED,s)};try{t.resourceManager.addEventListener(q.LOADED,s)}catch(i){o(i)}return t.loaderManager.reset().load(n),t},e=t.loadResourcesAsync,t.loadResourcesAsync=n=>new Promise((o,s)=>{try{t.loaderManager.once(q.LOADED,i=>{t.resourceManager.once(me.MAPPED,c=>{o(c)});const a=new Map;n.forEach(c=>{typeof c=="string"?a.set(c,i.resourceMap.get(c)):a.set(c.url,i.resourceMap.get(c.url))}),t.resourceManager.mappingResource(a)})}catch(i){s(i)}t.loaderManager.reset().load(n)})},rollback(t){t.loadResources=r,t.loadResourcesAsync=e}}},zt="CompilerSupportStrategy",Zt=function(){return{name:zt,condition:[ye,W],exec(r){r.compilerManager.compilerMap.forEach((e,t)=>{var n;e.useEngine(r),(n=r.dataSupportManager.dataSupportMap.get(t))==null||n.addCompiler(e)})},rollback(){}}};var Kt=(r=>(r[r.ZERO=0]="ZERO",r[r.ONE=100]="ONE",r[r.TWO=200]="TWO",r[r.THREE=300]="THREE",r[r.FOUR=400]="FOUR",r[r.FIVE=500]="FIVE",r[r.SIX=600]="SIX",r[r.SEVEN=700]="SEVEN",r[r.EIGHT=800]="EIGHT",r[r.NINE=900]="NINE",r))(Kt||{});class Qt extends He{constructor(e={}){super(),u(this,"moduleLifeCycle",[]),u(this,"moduleTriggers",[St]),u(this,"processorExpands",[]),this.install(qe(e.LoaderManagerPlugin)).install(Xe(e.PointerManagerPlugin)).install(ze(e.EventManagerPlugin)).install(Ze(e.RenderManagerPlugin)).install(Ht(e.ResourceManagerPlugin)).install(It(e.DataSupportManagerPlugin)).install(Bt(e.CompilerManagerPlugin)),this.exec(Ft()).exec(Xt()).exec(Zt())}loadLifeCycle(e){const t=this.dataSupportManager,n=this.moduleTriggers,o=this.moduleLifeCycle.sort((s,i)=>s.order-i.order);for(const{module:s}of o){e[s]&&t.loadByModule(e[s],s);for(const i of n)i.updateCondition(s),i.test()&&i.trig()}}removeLifeCycle(e){const t=this.dataSupportManager,n=this.moduleLifeCycle.sort((a,c)=>c.order-a.order);for(const{module:a}of n)e[a]&&t.remove({[a]:e[a]});const o=e.assets||[],s=this.resourceManager,i=this.loaderManager;o.forEach(a=>{s.remove(a),i.remove(a)})}loadConfig(e,t){const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),e.assets&&e.assets.length){const o=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),t&&t(s),n?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),n?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e,t){return new Promise((n,o)=>{const s=this.renderManager.hasRendering();s&&this.renderManager.stop(),e.assets&&e.assets.length?this.loadResourcesAsync(e.assets).then(i=>{delete e.assets,this.loadLifeCycle(e),s?this.renderManager.play():this.renderManager.render(),n(i)}):(this.loadLifeCycle(e),s?this.renderManager.play():this.renderManager.render(),n({type:me.MAPPED,configMap:this.resourceManager.configMap,resourceMap:this.resourceManager.resourceMap,resourceConfig:{}}))})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}registModule(e){if(Ee[e.type.toLocaleUpperCase()])return console.warn(`module ${e.type} is already exist.`),this;Ee[e.type.toLocaleUpperCase()]=e.type,e.object&&(H[e.type]=!0);const t=$t(e.type,e.rule),n=wt(e.type,e.compiler,e.processors);for(const i of e.processors)Te(i,e.type);const o=new n,s=new t([]);this.dataSupportManager.extend(s),this.compilerManager.extend(o),o.useEngine(this),s.addCompiler(o),e.extend&&e.extend(this),e.processors.forEach(i=>{}),e.expand&&this.processorExpands.push(...e.expand);for(const i of this.processorExpands)Array.isArray(i.processors)?Object.values(te).forEach(a=>{i.processors.includes(a.type)&&a.expand(i.command)}):Object.values(te).forEach(a=>{i.processors.test(a.type)&&a.expand(i.command)});return this.moduleLifeCycle.push({module:e.type,order:e.lifeOrder||0}),this.moduleTriggers.forEach(i=>{i.registerModule(e.type)}),this}}const mr=function(r,e={}){const t=new Qt(e);return r.modules&&r.modules.forEach(n=>{t.registModule(n)}),r.plugins&&r.plugins.forEach(n=>{t.install(n)}),r.strategy&&r.strategy.forEach(n=>{t.exec(n)}),t},g=class{static generateConfig(r,e){if(!g.configLibrary.has(r))return console.warn(`event library can not found config by name: ${r}`),{name:""};const t=(o,s)=>{for(const i in s)o[i]!==void 0&&(typeof s[i]=="object"&&s[i]!==null&&!Array.isArray(s[i])?t(o[i],s[i]):o[i]=s[i])},n=JSON.parse(JSON.stringify(g.configLibrary.get(r)));return t(n,e),n}static generateScript(r,e,t,n){return g.generatorLibrary.has(n.name)?g.generatorLibrary.get(n.name)(r,e,t,n):(console.error(`event library can not found generator by name: ${n.name}`),()=>{})}static has(r){return g.configLibrary.has(r)}};let be=g;u(be,"configLibrary",new Map);u(be,"generatorLibrary",new Map);u(be,"register",function({config:r,generator:e}){return g.configLibrary.has(r.name)?(console.warn(`EventLibrary has already exist this event generator: ${r.name}, that will be cover.`),g):(g.configLibrary.set(r.name,JSON.parse(JSON.stringify(r))),g.generatorLibrary.set(r.name,e),g)});const p=class{static generateConfig(r,e){if(!p.configLibrary.has(r))return console.warn(`event library can not found config by name: ${r}`),null;const t=(o,s)=>{for(const i in s)typeof s[i]=="object"&&s[i]!==null&&!Array.isArray(s[i])?t(o[i],s[i]):o[i]=s[i]},n=JSON.parse(JSON.stringify(p.configLibrary.get(r)));return t(n,e),n}static generateEvent(r,e){return p.generatorLibrary.has(r.name)?p.generatorLibrary.get(r.name)(e,r):(console.error(`event library can not found generator by name: ${r.name}`),()=>{})}static has(r){return p.configLibrary.has(r)}static useEngine(r){p.engine=r}static createEvent(r,e,t){if(!p.engine&&!t)return console.error("EventGenerator Manager createEvent must provide an engine, you can use 'useEngine' to set it."),null;const n=p.generateConfig(r,e);return n?p.generateEvent(n,t||p.engine):null}};let F=p;u(F,"engine");u(F,"configLibrary",new Map);u(F,"generatorLibrary",new Map);u(F,"register",function({config:r,generator:e}){return p.configLibrary.has(r.name)?(console.warn(`EventGeneratorManager has already exist this event generator: ${r.name}, that will be cover.`),p):(p.configLibrary.set(r.name,JSON.parse(JSON.stringify(r))),p.generatorLibrary.set(r.name,e),p)});const S=class{static getShader(r){return S.library.has(r)?S.cloneShader(S.library.get(r)):(console.warn(`con not found shader in shader library: ${r}`),null)}static generateConfig(r,e){if(!S.library.has(r))return console.warn(`con not found shader in shader library: ${r}`),{shader:r,uniforms:{}};const t=S.library.get(r),n={shader:r,uniforms:{}};if(t.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(t.uniforms))),e){const o=(s,i)=>{for(const a in i)s[a]!==void 0&&(typeof i[a]=="object"&&i[a]!==null&&!Array.isArray(i[a])?(s[a]===null&&(s[a]={...i[a]}),o(s[a],i[a])):s[a]=i[a])};o(n.uniforms,e)}return n}static cloneShader(r){const e={name:r.name};return r.vertexShader&&(e.vertexShader=r.vertexShader),r.fragmentShader&&(e.fragmentShader=r.fragmentShader),r.uniforms&&(e.uniforms=JSON.parse(JSON.stringify(r.uniforms))),e}};let Ve=S;u(Ve,"library",new Map);u(Ve,"register",function(r){S.library.has(r.name)&&console.warn(`shader library has exist shader: ${r.name} that will be cover.`),S.library.set(r.name,r)});const br=[ye,W];export{be as A,ur as B,ye as C,W as D,Qt as E,ir as J,Ee as M,H as O,br as P,hr as R,Kt as S,ae as a,fr as b,dr as c,pr as d,kt as e,O as f,y as g,$e as h,cr as i,gr as j,F as k,St as l,Ot as m,Ve as n,lr as o,yt as p,mr as q,_t as r,de as s,ar as t,yr as u,oe as v,sr as w};
