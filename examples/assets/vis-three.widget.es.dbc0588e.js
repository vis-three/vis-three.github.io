import{E as re,l as Y,o as _,O as D,g as ie}from"./vis-three.tdcm.es.ba892fff.js";import{m as ce,b as j,i as le}from"./curve.0ba3d968.js";import{s as ue,E as pe,p as ae,R as Q,i as fe,j as B,k as H,l as $,m as Z,n as L,N as he,o as de,q as me,t as ge,u as ve,v as ye,w as we,x as Ee,y as J}from"./Antdv.7b6104cc.js";const Ce="0.7.0",G=function(n,e=null,t={}){return{_isVNode:!0,type:n,props:e,config:null,component:null,el:null,key:t.key||null,ref:t.ref||null,raw:t.raw||null,children:null}},w=function(n){return typeof n=="object"?!!n._isVNode:!1},N=function(n){return/^on[A-Z]/.test(n)},be=function(n){const e=n.props,t={};for(const o in e)N(o)&&(t[o]=e[o]);return t};var I=(n=>(n.STATIC="static",n.VIF="vif",n.VFOR="vfor",n))(I||{});const p=function(n,e=null){const t=G(n,e,{key:e&&e.key||null,ref:e&&e.ref||null,raw:e&&e.raw||null});return p.add(t),t};p.reset=function(){p.el=null,p.scope="static",p.vnodes=[]};p.add=function(n){if(n.el=p.el,p.scope!=="static"){const e=p.vnodes[p.vnodes.length-1];p.scope==="vfor"&&(n.key||(n.key=e.vnodes.length),e.keyMap.set(n.key,n)),e.vnodes.push(n)}else p.vnodes.push(n);return p.vnodes};const Le=function(n,e=null){return p(n,e)},Ie=function(n){p.scope="vif",p.vnodes.push({scope:p.scope,vnodes:[],keyMap:new Map}),n(),p.scope="static"},Ue=function(n){p.scope="vfor",p.vnodes.push({scope:p.scope,vnodes:[],keyMap:new Map}),n(),p.scope="static"};var A=(n=>(n.MOUNTED="mounted",n.BEFORE_DISTORY="beforeDistory",n.UPDATE="update",n.FRAME="frame",n.CAMERA_CHANGE="cameraChange",n.SCENE_CHANGE="sceneCHange",n))(A||{});const Ve=function(n=()=>{}){h.currentComponent&&h.currentComponent.on("mounted",e=>n())},qe=function(n=()=>{}){h.currentComponent&&h.currentComponent.on("frame",e=>n(e.delta,e.total))};let P=!1,U=!1;const m=[];let y=0;const M=[];let g=null,b=0;const Se=Promise.resolve();function Re(n){let e=y+1,t=m.length;for(;e<t;){const o=e+t>>>1,r=m[o],i=k(r);i<n||i===n&&r.pre?e=o+1:t=o}return e}function X(n){(!m.length||!m.includes(n,P&&n.allowRecurse?y+1:y))&&(n.id==null?m.push(n):m.splice(Re(n.id),0,n),z())}function z(){!P&&!U&&(U=!0,Se.then(ee))}function V(n){Array.isArray(n)?M.push(...n):(!g||!g.includes(n,n.allowRecurse?b+1:b))&&M.push(n),z()}function Oe(){if(M.length){const n=[...new Set(M)];if(M.length=0,g){g.push(...n);return}for(g=n,g.sort((e,t)=>k(e)-k(t)),b=0;b<g.length;b++)g[b]();g=null,b=0}}const k=n=>n.id==null?1/0:n.id,Me=(n,e)=>{const t=k(n)-k(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t};function ee(){U=!1,P=!0,m.sort(Me);try{for(y=0;y<m.length;y++){const n=m[y];if(n&&n.active!==!1)try{n()}catch(e){console.error(e)}}}finally{y=0,m.length=0,Oe(),P=!1,(m.length||M.length)&&ee()}}const S=Symbol.for("vis.widget.event"),ke=function(n){const e=function(t){e.value(t)};return e.value=n,e},W=/Once$/;function K(n){let e={};if(W.test(n)){e={};let t;for(;t=n.match(W);)n=n.slice(0,n.length-t[0].length),e[t[0].toLowerCase()]=!0}return[n.slice(2).toLowerCase(),e]}const Te=function(n,e,t){if(e[S]){console.error("config has already create events",e);return}const o=be(n);for(const r in o){o[r]=ke(o[r]);const[i,c]=K(r);t.addEventListener(i,o[r])}e[S]=o},je=function(n){const e=n.props,t=n.config;if(!t[S])return;const o=t[S];for(const r in o){const i=o[r];i&&i.value!==e[r]&&(i.value=e[r])}},xe=function(n,e){const t=n.config;if(!t[S])return;const o=t[S];for(const r in o){const i=o[r];if(i){const[c,l]=K(r);e.removeEventListener(c,i)}}t[S]=void 0};class h extends ce{constructor(e,t){super(),this.cid=Y(),this.name="",this.el="",this.isMounted=!1,this.props=ue(Object.create(Object.prototype)),this.scope=new pe(!0),this.subTree=null,this.cacheResources=Object.create(Object.prototype),this.resourcesKeyEnum=Object.create(Object.prototype),this.cacheEvent={},this.vnode=e;const o=e.type;o.name&&(this.name=o.name),this.el=o.el,this.options=o,this.renderer=t,this.engine=t.engine,this.ctx=t.context,this.createProps(),this.createSetup(),this.createResources(),this.createRender(),this.createEffect()}static setCurrentComponent(e){h.currentComponent=e,e.scope.on()}static unsetCurrentComponent(){h.currentComponent&&h.currentComponent.scope.off(),h.currentComponent=null}renderTree(){return p.reset(),p.el=this.el,this.render.call({...this.setupState,...this.props},{components:this.options.components||{},resources:this.resourcesKeyEnum}),p.vnodes}createResources(){if(!this.options.resources)return;const e=this.options.resources.call(this.setupState);this.engine.registerResources(e),this.cacheResources=e;for(const t in e)this.resourcesKeyEnum[t]=t}createProps(){const e=this.options.props||{},t=this.vnode.props||{},o=this.props,r=this.options.emits||{},i={};for(const c in t)if(N(c)){const[l,s]=K(c);r[l]?this[s.once?"once":"on"](l,t[c]):console.warn(`widget Component: you not declare attribute  ${c}  in emits options`,this.options)}else i[c]=t[c];for(const c in e){const l=e[c];if(l.required&&typeof i[c]>"u"){console.error("widget component: component prop is required.",{component:this,props:i,key:c});return}let s;if(typeof i[c]<"u"?s=i[c]:l.default&&(s=typeof l.default=="function"?l.default():l.default),s.constructor!==l.type){console.error("widget component: component prop is not instance of type.",{component:this,props:i,key:c,value:s,type:l.type});return}o[c]=s}}createSetup(){if(!this.options.setup)return;h.setCurrentComponent(this);const e=this.options.setup({engine:this.engine,props:this.props,emit:this.emit.bind(this)})||{};this.setupState=ae(e),this.rawSetupState=e,h.unsetCurrentComponent()}createRender(){this.render=this.options.render}createEffect(){const e=new Q(()=>{if(this.isMounted){const o=this.renderTree(),r=this.subTree;if(r.length!==o.length){console.error("widget component render: tree render error",{nextTree:o,prevTree:r});return}for(let i=0;i<o.length;i+=1)if(w(r[i])&&w(o[i]))this.renderer.patch(r[i],o[i]);else{const c=o[i],l=r[i];if(c.scope!==l.scope){console.error("widget component render: tree render error",{nextTree:o,prevTree:r});return}if(c.scope===I.VIF){for(const s of l.vnodes)this.renderer.patch(s,null);for(const s of c.vnodes)this.renderer.patch(null,s)}else if(c.scope===I.VFOR){for(const s of c.keyMap.keys())l.keyMap.has(s)?(this.renderer.patch(l.keyMap.get(s),c.keyMap.get(s)),l.keyMap.delete(s)):this.renderer.patch(null,c.keyMap.get(s));for(const s of l.keyMap.values())this.renderer.unmountElement(s)}else console.warn(`widget component render: unknow scope type: ${c.scope}`)}this.subTree=o}else{const o=this.rawSetupState,r=s=>{s.ref&&typeof o[s.ref]<"u"&&(o[s.ref].value=s.component?s.component:s.config||null)},i=s=>{if(s.raw&&typeof o[s.raw]<"u")if(s.config){const u=this.engine.getObjectBySymbol(s.config.vid);u||console.warn("can not found raw object in engine",{component:this,vnode:s}),o[s.raw].value=u||null}else{console.warn("component raw object is not a native config",{component:this,vnode:s});return}},c=this.subTree=this.renderTree();for(const s of c)if(w(s))this.renderer.patch(null,s),r(s),i(s);else for(const u of s.vnodes)this.renderer.patch(null,u),r(u),i(u);this.isMounted=!0,V(()=>this.emit(A.MOUNTED));const l=s=>{this.emit(A.FRAME,s)};this.engine.renderManager.addEventListener(j.RENDER,l),this.cacheEvent[j.RENDER]=l}},()=>X(t),void 0,this.scope),t=()=>e.run();t(),this.effect=e,this.update=t}distory(){this.engine.removeEventListener(j.RENDER,this.cacheEvent[j.RENDER]),this.emit(A.BEFORE_DISTORY),this.scope.stop(),this.effect.active=!1,this.effect.stop();const e=this.subTree||[];for(let t=0;t<e.length;t+=1)if(w(e[t]))this.renderer.patch(e[t],null),e[t].config=null,e[t].raw=null;else for(const o of e[t].vnodes)this.renderer.patch(o,null),o.config=null,o.raw=null}updateProps(e){const t=this.props;for(const o in e)t[o]=e[o]}getState(e=!0){return e?this.rawSetupState:this.setupState}}const Ke=function(n){return n},ne=n=>{if(typeof n=="object"){if(w(n))return n.config.vid;for(const e in n)n[e]=ne(n[e]);return n}else return n};class Ae{constructor(e){this.context=e,this.engine=e.engine}log(e,t,o){t?console[e](`Widget renderer: ${t}`,o):console.info(`Widget renderer: ${e}`)}patch(e,t){if(!e&&!t){console.error("widget renderer: patch prarams all of null");return}e!==t&&(t&&typeof t.type=="string"||e&&typeof e.type=="string"?this.processElement(e,t):this.processComponent(e,t))}render(e){this.patch(null,e)}processElement(e,t){if(!e&&!t){console.error("widget renderer: processElement prarams all of null");return}e===null?this.mountElement(t):t===null?this.unmountElement(e):this.patchElement(e,t)}unmountElement(e){if(_(e.type)){if(e.config.parent){const o=this.engine.getConfigFromModules(D,e.config.parent);if(!o){console.error("widget renderer: can not found parent config with: ",e);return}o.children.splice(o.children.indexOf(e.config.vid),1)}else if(!e.el){const o=this.engine.getObjectBySymbol(e.config.vid);o||console.error("widget renderer: can not found Three object with: ",e),o.removeFromParent()}const t=this.engine.getObjectBySymbol(e.config.vid);xe(e,t)}this.engine.removeConfigBySymbol(e.config.vid)}mountElement(e){const{element:t,onProps:o}=this.createElement(e);if(this.engine.applyConfig(t),_(t.type)){if(!e.el)this.engine.scene.add(this.engine.getObjectFromModules(D,t.vid));else{const i=this.engine.getConfigFromModules(D,e.el);if(!i){console.error(`widget renderer: can not found parent config with: ${e.el}`);return}i.children.push(t.vid)}const r=this.engine.getObjectBySymbol(t.vid);Te(e,t,r)}}patchElement(e,t){if(e.type!==t.type)this.unmountElement(e),this.mountElement(t);else{t.config=e.config;const o=e.config;o||console.error("widget renderer: can not found  config with: ",e);let r={};const i=t.props;let c=!1;for(const s in e.props){if(N(s)){c=!0;continue}r[s]=e.props[s]}const l=(s,u,v)=>{for(const a in s)w(s[a])?w(u[a])&&u[a].config.vid!==s[a].config.vid?v[a]=u[a].config.vid:w(u[a])||(v[a]=u[a]):le(s[a])?l(s[a],u[a],v[a]):u[a]!==s[a]&&(v[a]=u[a])};l(r,i,o),c&&je(t)}}createElement(e){const t=e.props,o={},r={};for(const c in t)["ref","index"].includes(c)||(N(c)?r[c]=t[c]:o[c]=ne(t[c]));const i=ie(e.type,o,{strict:!1,warn:!1});return e.config=i,{element:i,onProps:r}}processComponent(e,t){if(!e&&!t){console.error("widget renderer: processElement prarams all of null");return}e===null?this.mountComponent(t):t===null?this.unmountComponent(e):this.patchComponent(e,t)}mountComponent(e){e.component=new h(e,this)}unmountComponent(e){var t;(t=e.component)==null||t.distory(),e.component=null}patchComponent(e,t){const o=e.component;t.component=o,o.vnode=t;const r=e.props||{},i=t.props||{},c={};let l=!1;for(const s in i)i[s]!==r[s]&&(c[s]=i[s],l=!0);l&&(o.updateProps(c),o.update())}}class Fe{constructor(e,t){this.wid=Y(),this.version=Ce,this.components={},this.instance=null,this.engine=e,this.root=t,this.renderer=new Ae(this)}component(e,t){if(typeof e=="object"){if(t=e,!t.name){console.error("widget register component must be provide a name",t);return}e=t.name}if(!t){console.error("widget register component must be provide a component not a null",e);return}if(this.components[e]){console.warn(`A component with this name already exists: ${e}`);return}this.components[e]=t}mount(){const e=G(this.root);return this.renderer.render(e),this.instance=e.component,this}getState(){var e;return(e=this.instance)==null?void 0:e.getState(!0)}unmount(){var e;(e=this.instance)==null||e.distory()}use(){}}class Ne extends re{constructor(e={}){super(e)}createWidget(e){return new Fe(this,e)}}const _e=function(n,e={}){const t=new Ne;return n.modules&&n.modules.forEach(o=>{t.registModule(o)}),n.plugins&&n.plugins.forEach(o=>{t.install(o)}),n.strategy&&n.strategy.forEach(o=>{t.exec(o)}),n.wdigets&&n.wdigets.forEach(o=>{t.createWidget(o)}),t},He=function(n){return{value:n}};function F(n,e,t){let o;try{o=t?n(...t):n()}catch(r){console.error(r)}return o}function q(n,e,t){if(L(n)){const r=F(n,e,t);return r&&Ee(r)&&r.catch(i=>{console.error(i)}),r}const o=[];for(let r=0;r<n.length;r++)o.push(q(n[r],e,t));return o}const x={};function Je(n,e,t){return Pe(n,e,t)}function Pe(n,e,{immediate:t,deep:o,flush:r,onTrack:i,onTrigger:c}=me){var l;const s=fe()===((l=h.currentComponent)==null?void 0:l.scope)?h.currentComponent:null;let u,v=!1,a=!1;if(B(n)?(u=()=>n.value,v=H(n)):$(n)?(u=()=>n,o=!0):Z(n)?(a=!0,v=n.some(f=>$(f)||H(f)),u=()=>n.map(f=>{if(B(f))return f.value;if($(f))return O(f);if(L(f))return F(f)})):L(n)?e?u=()=>F(n):u=()=>{if(!(s&&!s.isMounted))return R&&R(),q(n,s)}:u=he,e&&o){const f=u;u=()=>O(f())}let R,te=f=>{R=d.onStop=()=>{F(f),R=d.onStop=void 0}},E=a?new Array(n.length).fill(x):x;const C=()=>{if(d.active)if(e){const f=d.run();(o||v||(a?f.some((oe,se)=>J(oe,E[se])):J(f,E)))&&(R&&R(),q(e,s,[f,E===x?void 0:a&&E[0]===x?[]:E,te]),E=f)}else d.run()};C.allowRecurse=!!e;let T;r==="sync"?T=C:r==="post"?T=()=>V(C):(C.pre=!0,s&&(C.id=s.cid),T=()=>X(C));const d=new Q(u,T);return e?t?C():E=d.run():r==="post"?V(d.run.bind(d)):d.run(),()=>{d.stop(),s&&s.scope&&de(s.scope.effects,d)}}function O(n,e){if(!ge(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),B(n))O(n.value,e);else if(Z(n))for(let t=0;t<n.length;t++)O(n[t],e);else if(ve(n)||ye(n))n.forEach(t=>{O(t,e)});else if(we(n))for(const t in n)O(n[t],e);return n}export{_e as H,Ie as J,Ke as K,Ve as L,Je as Q,Ue as U,qe as Y,He as Z,Le as q,Ne as x};
