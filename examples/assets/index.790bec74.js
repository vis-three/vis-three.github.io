import{E as p}from"./vis-three.middleware.es.7f273029.js";import{O as c,b4 as l,n,M as m,b5 as s,a8 as d,v as g,Q as o,m as u}from"./three.237d835c.js";import{W as w,C as S}from"./index.1d3a6ec0.js";import{E as v}from"./index.2e2f06f6.js";import{O as f}from"./vis-three.plugin-orbit-controls.es.9991f892.js";import{S as P}from"./index.f318ae8c.js";import{A as y}from"./index.ea2b9d59.js";import{G as M}from"./index.591a8368.js";import{V as E}from"./index.a30a6c1f.js";import{T as x}from"./index.12fd638d.js";import{S as b}from"./index.32dc3bb0.js";import{K as B}from"./vis-three.plugin-keyboard-manager.es.417ffa7e.js";import{C,a as F}from"./index.edc751ad.js";import{C as D,a as R}from"./index.2f498209.js";import{S as W}from"./index.4ec3bfd2.js";import{E as O}from"./index.117a61e1.js";import{O as L}from"./index.3b8dbf96.js";import{O as T}from"./index.c0475655.js";import{T as G}from"./index.2328f892.js";import{S as N}from"./index.cd2c2c2e.js";import{G as A}from"./index.a089cc34.js";import{T as _}from"./index.bca5cc71.js";import{C as k,a as I}from"./index.692e1021.js";import{W as V}from"./index.90db9154.js";import{T as H}from"./index.bdaae9f1.js";import{O as U}from"./vis-three.strategy-orbit-controls-support.es.706978dc.js";import{M as j}from"./index.d3463d42.js";import{p as Q}from"./vis-three.library-parser.es.5c9e4dac.js";import{t as z,b as K,a as h}from"./index.202ebdec.js";import{a as q}from"./vis-three.plugin-pointer-manager.es.640cfa1a.js";import{M as J}from"./vis-three.strategy-multi-renderer.es.a35ffd0a.js";import{S as X}from"./vis-three.strategy-selection-prompt.es.fc4c19e4.js";var Y=Object.defineProperty,Z=(i,e,t)=>e in i?Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,a=(i,e,t)=>(Z(i,typeof e!="symbol"?e+"":e,t),t);const $="@vis-three/plugin-path-drawing";class ee extends K{constructor(e){super(),a(this,"camera",new c(-window.innerWidth,window.innerWidth,window.innerHeight,-window.innerHeight,0,1e4)),a(this,"plane",new l(new n(0,0,1),0)),a(this,"boardOffset",20),a(this,"drawingBoard",new m(new s(150,150),new d({transparent:!0,opacity:.2,color:"rgb(64, 255, 242)"}))),a(this,"relativeMatrixInvert",new g),a(this,"engine"),a(this,"cachePoint",new n),a(this,"cacheRelativePoint",new n),a(this,"begun",!1),a(this,"setScene",t=>{this.drawingBoard.parent&&t.scene.add(this.drawingBoard)}),a(this,"cacheBeginWriteFun",t=>{const r=this.engine.pointerManager;this.cacheWriteFun(t),r.addEventListener("mousedown",this.cacheWriteFun),r.addEventListener("pointermove",this.cacheMoveFun),r.removeEventListener("mousedown",this.cacheBeginWriteFun),this.begun=!0}),a(this,"cacheWriteFun",t=>{const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"write",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})}),a(this,"cacheMoveFun",t=>{const r=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!r){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"move",point:r,relativePoint:this.cacheRelativePoint.copy(r).applyMatrix4(this.relativeMatrixInvert)})}),this.engine=e,this.drawingBoard.raycast=()=>{},this.drawingBoard.matrixAutoUpdate=!1,this.setDrawingBoardMatrix(),e.addEventListener(h.SETSCENE,this.setScene)}setDraingBoardSize(e,t){const r=new s(e,t);this.drawingBoard.geometry.copy(r),r.dispose()}offsetCamera(e){const t=e.length();return e.normalize().applyQuaternion(new o().setFromUnitVectors(new n(0,1,0),this.plane.normal)),this.camera.position.copy(this.plane.normal).multiplyScalar(this.plane.constant).add(e.multiplyScalar(t)),this.camera.zoom=(this.camera.top-this.camera.bottom)/(this.drawingBoard.geometry.parameters.height+this.boardOffset),this.camera.updateProjectionMatrix(),this.drawingBoard.position.add(e),this.drawingBoard.updateMatrix(),this.drawingBoard.updateMatrixWorld(!0),this}setRelativeObject(e){return this.relativeMatrixInvert.copy(e.matrixWorld).invert(),this}setDrawPlane(e,t=0){return this.plane.set(e,t),this.setDrawingBoardMatrix(),this}setDrawPlaneByFace(e){return this.plane.setFromCoplanarPoints(e.a,e.b,e.c),this.setDrawingBoardMatrix(),this}setDrawingBoardMatrix(){const e=this.drawingBoard;e.position.copy(this.plane.normal).multiplyScalar(this.plane.constant),e.applyQuaternion(new o().setFromUnitVectors(new n(0,0,1),this.plane.normal)),e.updateMatrix(),e.updateMatrixWorld(!0)}dispose(){this.drawingBoard.removeFromParent(),this.drawingBoard.geometry.dispose(),this.drawingBoard.material.dispose(),this.engine.removeEventListener(h.SETSCENE,this.setScene)}showDrawingBoard(e){return e?this.engine.scene.add(this.drawingBoard):this.engine.scene.remove(this.drawingBoard),this}setSketcherByPlane(e=new n(0,0,1),t=0,r=new n(0,50,0)){return this.setDrawPlane(e,t).offsetCamera(r)}setSketcherByFace(e,t=new n(0,50,0)){return this.setDrawPlaneByFace(e).offsetCamera(t)}setSketcherByFaceAndObject(e,t){const r=new n().setFromMatrixPosition(t.matrixWorld);return this.setRelativeObject(t),this.setSketcherByFace(e,r)}changeToDrawingView(){return this.engine.setCamera(this.camera),this}beginDraw(){return this.dispatchEvent({type:"begin"}),this.begun=!1,this.engine.pointerManager.addEventListener("mousedown",this.cacheBeginWriteFun),this}endDraw(e=!0){const t=this.engine.pointerManager;return t.removeEventListener("mousedown",this.cacheWriteFun),t.removeEventListener("pointermove",this.cacheMoveFun),this.dispatchEvent({type:"end"}),e&&(this.begun||this.engine.pointerManager.removeEventListener("mousedown",this.cacheBeginWriteFun),this.removeEvent("begin"),this.removeEvent("write"),this.removeEvent("move"),this.removeEvent("end")),this.begun=!1,this}}const te=z($),re=function(){return{name:te,deps:[q],install(i){const e=new ee(i);i.pathSketcher=e},dispose(i){i.pathSketcher.dispose(),delete i.pathSketcher}}};class Ge extends p{constructor(e={}){super(e);for(const t of Object.values(j))this.registModule(t);for(const t of Object.values(Q))this.resourceManager.addParser(new t);this.install(w(e.WebGLRendererPlugin||{antialias:!0,alpha:!0})).install(C()).install(D()).install(v(e.EffectComposerPlugin||{MSAA:!0})).install(f()).install(S()).install(W()).install(P()).install(y()).install(M()).install(E()).install(x()).install(b()).install(B()).install(re()),this.exec(F()).exec(R()).exec(O()).exec(L()).exec(T()).exec(G()).exec(N()).exec(A()).exec(_()).exec(k()).exec(V()).exec(H()).exec(U()).exec(I()).exec(J()).exec(X(e.SelectionPromptStrategy||{visibleEdgeColor:new u("rgb(236, 65, 118)"),edgeStrength:5,edgeThickness:2,downSampleRatio:1.5}))}}export{Ge as M};
