import{t as p,a as u,b as v}from"./index.f2ecf0d4.js";import{V as E,q as d,h as m,O as c,t as H}from"./three.9c0f0dc6.js";var f=Object.defineProperty,w=(a,e,t)=>e in a?f(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,i=(a,e,t)=>(w(a,typeof e!="symbol"?e+"":e,t),t);class M extends v{constructor(e){super(),i(this,"dom"),i(this,"mouse"),i(this,"canMouseMove"),i(this,"mouseEventTimer"),i(this,"throttleTime"),i(this,"pointerDownHandler"),i(this,"pointerMoveHandler"),i(this,"pointerUpHandler"),i(this,"mouseDownHandler"),i(this,"mouseUpHandler"),i(this,"clickHandler"),i(this,"dblclickHandler"),i(this,"contextmenuHandler"),this.dom=e.dom,this.mouse=new E,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=o=>{const r={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const l in o)r[l]=o[l];return r},s=o=>{o.preventDefault(),this.dispatchEvent(t(o))},n=o=>{this.dispatchEvent(t(o))};this.pointerMoveHandler=o=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const r=this.mouse,l=this.dom,h=l.getBoundingClientRect();r.x=(o.clientX-h.left)/l.offsetWidth*2-1,r.y=-((o.clientY-h.top)/l.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(o))},this.throttleTime))},this.mouseDownHandler=n,this.mouseUpHandler=n,this.pointerDownHandler=n,this.pointerUpHandler=n,this.clickHandler=n,this.dblclickHandler=n,this.contextmenuHandler=s}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}getWorldPosition(e,t,s){if(!s&&(s=new d),e instanceof m){const n=new d(this.mouse.x,this.mouse.y,1).unproject(e).sub(s.setFromMatrixPosition(e.matrixWorld)).normalize();s.add(n.multiplyScalar(t))}else if(e instanceof c){const n=new d(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);s.set(0,0,-1).transformDirection(e.matrixWorld).add(n.multiplyScalar(t))}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return s}intersectPlane(e,t,s){!s&&(s=new d);const n=new d,o=new H;if(e instanceof m){const r=new d().setFromMatrixPosition(e.matrixWorld);n.set(this.mouse.x,this.mouse.y,1).unproject(e).sub(r).normalize(),o.set(r,n)}else if(e instanceof c){n.set(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);const r=new d().set(0,0,-1).transformDirection(e.matrixWorld);o.set(n,r)}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return o.intersectPlane(t,s)}}const x="@vis-three/plugin-pointer-manager",L=p(x),P=function(a){let e;return{name:L,install(t){const s=new M(Object.assign(a||{},{dom:t.dom}));e=n=>{s.setDom(n.dom)},t.addEventListener(u.SETDOM,e),t.pointerManager=s},dispose(t){t.removeEventListener(u.SETDOM,e),e=void 0}}};export{P,L as a};
