var It=Object.defineProperty;var At=(h,o,i)=>o in h?It(h,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[o]=i;var it=(h,o,i)=>(At(h,typeof o!="symbol"?o+"":o,i),i);import{t as Tt,a as j}from"./index.202ebdec.js";import{r as Qt,n as l,Q as b,u as nt,aH as Xt,v as wt,a8 as yt,K as Lt,bm as y,B as u,i as rt,j as ht,M as s,bI as K,L as Q,bo as Yt,bp as W,b5 as Zt,an as Dt,h as Ct}from"./three.237d835c.js";const zt="@vis-three/plugin-transform-controls",D=new Qt,E=new l,X=new l,p=new b,lt={X:new l(1,0,0),Y:new l(0,1,0),Z:new l(0,0,1)},ot={type:"change"},ct={type:"mouseDown"},pt={type:"mouseUp",mode:null},dt={type:"objectChange"};class Ht extends nt{constructor(o,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const n=new Gt;this._gizmo=n,this.add(n);const e=new Rt;this._plane=e,this.add(e);const a=this;function t(m,P){let H=P;Object.defineProperty(a,m,{get:function(){return H!==void 0?H:P},set:function(Z){H!==Z&&(H=Z,e[m]=Z,n[m]=Z,a.dispatchEvent({type:m+"-changed",value:Z}),a.dispatchEvent(ot))}}),a[m]=P,e[m]=P,n[m]=P}t("camera",o),t("object",void 0),t("enabled",!0),t("axis",null),t("mode","translate"),t("translationSnap",null),t("rotationSnap",null),t("scaleSnap",null),t("space","world"),t("size",1),t("dragging",!1),t("showX",!0),t("showY",!0),t("showZ",!0);const r=new l,_=new l,f=new b,d=new b,L=new l,Y=new b,T=new l,U=new l,g=new l,I=0,x=new l;t("worldPosition",r),t("worldPositionStart",_),t("worldQuaternion",f),t("worldQuaternionStart",d),t("cameraPosition",L),t("cameraQuaternion",Y),t("pointStart",T),t("pointEnd",U),t("rotationAxis",g),t("rotationAngle",I),t("eye",x),this._offset=new l,this._startNorm=new l,this._endNorm=new l,this._cameraScale=new l,this._parentPosition=new l,this._parentQuaternion=new b,this._parentQuaternionInv=new b,this._parentScale=new l,this._worldScaleStart=new l,this._worldQuaternionInv=new b,this._worldScale=new l,this._positionStart=new l,this._quaternionStart=new b,this._scaleStart=new l,this._getPointer=Ot.bind(this),this._onPointerDown=Wt.bind(this),this._onPointerHover=jt.bind(this),this._onPointerMove=qt.bind(this),this._onPointerUp=kt.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0)return;D.setFromCamera(o,this.camera);const i=st(this._gizmo.picker[this.mode],D);i?this.axis=i.object.name:this.axis=null}pointerDown(o){if(!(this.object===void 0||this.dragging===!0||o.button!==0)&&this.axis!==null){D.setFromCamera(o,this.camera);const i=st(this._plane,D,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,ct.mode=this.mode,this.dispatchEvent(ct)}}pointerMove(o){const i=this.axis,n=this.mode,e=this.object;let a=this.space;if(n==="scale"?a="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(a="world"),e===void 0||i===null||this.dragging===!1||o.button!==-1)return;D.setFromCamera(o,this.camera);const t=st(this._plane,D,!0);if(!!t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),e.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(e.position.applyQuaternion(p.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.position.applyQuaternion(this._quaternionStart)),a==="world"&&(e.parent&&e.position.add(E.setFromMatrixPosition(e.parent.matrixWorld)),i.search("X")!==-1&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.parent&&e.position.sub(E.setFromMatrixPosition(e.parent.matrixWorld))));else if(n==="scale"){if(i.search("XYZ")!==-1){let r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),X.set(r,r,r)}else E.copy(this.pointStart),X.copy(this.pointEnd),E.applyQuaternion(this._worldQuaternionInv),X.applyQuaternion(this._worldQuaternionInv),X.divide(E),i.search("X")===-1&&(X.x=1),i.search("Y")===-1&&(X.y=1),i.search("Z")===-1&&(X.z=1);e.scale.copy(this._scaleStart).multiply(X),this.scaleSnap&&(i.search("X")!==-1&&(e.scale.x=Math.round(e.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(e.scale.y=Math.round(e.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(e.scale.z=Math.round(e.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const r=20/this.worldPosition.distanceTo(E.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(E.copy(this.rotationAxis).cross(this.eye))*r):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(lt[i]),E.copy(lt[i]),a==="local"&&E.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(E.cross(this.eye).normalize())*r),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&i!=="E"&&i!=="XYZE"?(e.quaternion.copy(this._quaternionStart),e.quaternion.multiply(p.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),e.quaternion.copy(p.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),e.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ot),this.dispatchEvent(dt)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(pt.mode=this.mode,this.dispatchEvent(pt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ot),this.dispatchEvent(dt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return D}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function Ot(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const o=this.domElement.getBoundingClientRect();return{x:(h.clientX-o.left)/o.width*2-1,y:-(h.clientY-o.top)/o.height*2+1,button:h.button}}}function jt(h){if(!!this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h));break}}function Wt(h){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function qt(h){!this.enabled||this.pointerMove(this._getPointer(h))}function kt(h){!this.enabled||(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function st(h,o,i){const n=o.intersectObject(h,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||i)return n[e];return!1}const J=new Xt,c=new l(0,1,0),mt=new l(0,0,0),ut=new wt,$=new b,et=new b,M=new l,ft=new wt,G=new l(1,0,0),C=new l(0,1,0),R=new l(0,0,1),tt=new l,q=new l,k=new l;class Gt extends nt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new yt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new Lt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=o.clone();n.opacity=.15;const e=i.clone();e.opacity=.5;const a=o.clone();a.color.setHex(16711680);const t=o.clone();t.color.setHex(65280);const r=o.clone();r.color.setHex(255);const _=o.clone();_.color.setHex(16711680),_.opacity=.5;const f=o.clone();f.color.setHex(65280),f.opacity=.5;const d=o.clone();d.color.setHex(255),d.opacity=.5;const L=o.clone();L.opacity=.25;const Y=o.clone();Y.color.setHex(16776960),Y.opacity=.25,o.clone().color.setHex(16776960);const U=o.clone();U.color.setHex(7895160);const g=new y(0,.04,.1,12);g.translate(0,.05,0);const I=new u(.08,.08,.08);I.translate(0,.04,0);const x=new rt;x.setAttribute("position",new ht([0,0,0,1,0,0],3));const m=new y(.0075,.0075,.5,3);m.translate(0,.25,0);function P(v,F){const S=new W(v,.0075,3,64,F*Math.PI*2);return S.rotateY(Math.PI/2),S.rotateX(Math.PI/2),S}function H(){const v=new rt;return v.setAttribute("position",new ht([0,0,0,1,1,1],3)),v}const Z={X:[[new s(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new s(g,a),[-.5,0,0],[0,0,Math.PI/2]],[new s(m,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new s(g,t),[0,.5,0]],[new s(g,t),[0,-.5,0],[Math.PI,0,0]],[new s(m,t)]],Z:[[new s(g,r),[0,0,.5],[Math.PI/2,0,0]],[new s(g,r),[0,0,-.5],[-Math.PI/2,0,0]],[new s(m,r),null,[Math.PI/2,0,0]]],XYZ:[[new s(new K(.1,0),L.clone()),[0,0,0]]],XY:[[new s(new u(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new s(new u(.15,.15,.01),_.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new u(.15,.15,.01),f.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Et={X:[[new s(new y(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s(new y(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new y(.2,0,.6,4),n),[0,.3,0]],[new s(new y(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new y(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s(new y(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new s(new K(.2,0),n)]],XY:[[new s(new u(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s(new u(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new u(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},_t={START:[[new s(new K(.01,2),e),null,null,null,"helper"]],END:[[new s(new K(.01,2),e),null,null,null,"helper"]],DELTA:[[new Q(H(),e),null,null,null,"helper"]],X:[[new Q(x,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Q(x,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Q(x,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},vt={XYZE:[[new s(P(.5,1),U),null,[0,Math.PI/2,0]]],X:[[new s(P(.5,.5),a)]],Y:[[new s(P(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new s(P(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new s(P(.75,1),Y),null,[0,Math.PI/2,0]]]},Pt={AXIS:[[new Q(x,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},St={XYZE:[[new s(new Yt(.25,10,8),n)]],X:[[new s(new W(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s(new W(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s(new W(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s(new W(.75,.1,2,24),n)]]},xt={X:[[new s(I,a),[.5,0,0],[0,0,-Math.PI/2]],[new s(m,a),[0,0,0],[0,0,-Math.PI/2]],[new s(I,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new s(I,t),[0,.5,0]],[new s(m,t)],[new s(I,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new s(I,r),[0,0,.5],[Math.PI/2,0,0]],[new s(m,r),[0,0,0],[Math.PI/2,0,0]],[new s(I,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new s(new u(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new s(new u(.15,.15,.01),_),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new u(.15,.15,.01),f),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new u(.1,.1,.1),L.clone())]]},Mt={X:[[new s(new y(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s(new y(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new y(.2,0,.6,4),n),[0,.3,0]],[new s(new y(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new y(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s(new y(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new s(new u(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s(new u(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new u(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new u(.2,.2,.2),n),[0,0,0]]]},bt={X:[[new Q(x,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Q(x,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Q(x,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function A(v){const F=new nt;for(const S in v)for(let O=v[S].length;O--;){const w=v[S][O][0].clone(),N=v[S][O][1],B=v[S][O][2],V=v[S][O][3],gt=v[S][O][4];w.name=S,w.tag=gt,N&&w.position.set(N[0],N[1],N[2]),B&&w.rotation.set(B[0],B[1],B[2]),V&&w.scale.set(V[0],V[1],V[2]),w.updateMatrix();const at=w.geometry.clone();at.applyMatrix4(w.matrix),w.geometry=at,w.renderOrder=1/0,w.position.set(0,0,0),w.rotation.set(0,0,0),w.scale.set(1,1,1),F.add(w)}return F}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=A(Z)),this.add(this.gizmo.rotate=A(vt)),this.add(this.gizmo.scale=A(xt)),this.add(this.picker.translate=A(Et)),this.add(this.picker.rotate=A(St)),this.add(this.picker.scale=A(Mt)),this.add(this.helper.translate=A(_t)),this.add(this.helper.rotate=A(Pt)),this.add(this.helper.scale=A(bt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:et;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let e=[];e=e.concat(this.picker[this.mode].children),e=e.concat(this.gizmo[this.mode].children),e=e.concat(this.helper[this.mode].children);for(let a=0;a<e.length;a++){const t=e[a];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(r*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(p.setFromEuler(J.set(0,0,0)),t.quaternion.copy(n).multiply(p),Math.abs(c.copy(G).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(p.setFromEuler(J.set(0,0,Math.PI/2)),t.quaternion.copy(n).multiply(p),Math.abs(c.copy(C).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(p.setFromEuler(J.set(0,Math.PI/2,0)),t.quaternion.copy(n).multiply(p),Math.abs(c.copy(R).applyQuaternion(n).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(p.setFromEuler(J.set(0,Math.PI/2,0)),c.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(ut.lookAt(mt,c,C)),t.quaternion.multiply(p),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),E.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),E.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(E),t.visible=this.dragging):(t.quaternion.copy(n),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(c.copy(G).applyQuaternion(n).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(c.copy(C).applyQuaternion(n).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(c.copy(R).applyQuaternion(n).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(c.copy(R).applyQuaternion(n).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(c.copy(G).applyQuaternion(n).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(c.copy(C).applyQuaternion(n).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&($.copy(n),c.copy(this.eye).applyQuaternion(p.copy(n).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(ut.lookAt(this.eye,mt,C)),t.name==="X"&&(p.setFromAxisAngle(G,Math.atan2(-c.y,c.z)),p.multiplyQuaternions($,p),t.quaternion.copy(p)),t.name==="Y"&&(p.setFromAxisAngle(C,Math.atan2(c.x,c.z)),p.multiplyQuaternions($,p),t.quaternion.copy(p)),t.name==="Z"&&(p.setFromAxisAngle(R,Math.atan2(c.y,c.x)),p.multiplyQuaternions($,p),t.quaternion.copy(p))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(_){return t.name===_}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(o)}}class Rt extends s{constructor(){super(new Zt(1e5,1e5,2,2),new yt({visible:!1,wireframe:!0,side:Dt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),tt.copy(G).applyQuaternion(i==="local"?this.worldQuaternion:et),q.copy(C).applyQuaternion(i==="local"?this.worldQuaternion:et),k.copy(R).applyQuaternion(i==="local"?this.worldQuaternion:et),c.copy(q),this.mode){case"translate":case"scale":switch(this.axis){case"X":c.copy(this.eye).cross(tt),M.copy(tt).cross(c);break;case"Y":c.copy(this.eye).cross(q),M.copy(q).cross(c);break;case"Z":c.copy(this.eye).cross(k),M.copy(k).cross(c);break;case"XY":M.copy(k);break;case"YZ":M.copy(tt);break;case"XZ":c.copy(k),M.copy(q);break;case"XYZ":case"E":M.set(0,0,0);break}break;case"rotate":default:M.set(0,0,0)}M.length()===0?this.quaternion.copy(this.cameraQuaternion):(ft.lookAt(E.set(0,0,0),M,c),this.quaternion.setFromRotationMatrix(ft)),super.updateMatrixWorld(o)}}var z;(function(h){h.CHANGED="changed",h.MOUSE_DOWN="mouseDown",h.CHANGEING="objectChange",h.MOUSE_UP="mouseUp"})(z||(z={}));class Ut extends Ht{constructor(i,n){!i&&(i=new Ct),!n&&(n=document.body);super(i,n);it(this,"target");it(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=f=>{var d;!this.enabled||!((d=this.object)!=null&&d.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(f)),this.pointerDown(this._getPointer(f)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new nt,this.transObjectSet=new Set;let e="";const a=this.target,t=this.transObjectSet,r={x:0,y:0,z:0},_=new WeakMap;this.addEventListener(z.MOUSE_DOWN,f=>{e=f.target.mode,e==="translate"&&(e="position"),e==="rotate"&&(e="rotation"),r.x=a[e].x,r.y=a[e].y,r.z=a[e].z,t.forEach(d=>{_.set(d,d.matrixAutoUpdate),d.matrixAutoUpdate=!1})}),this.addEventListener(z.CHANGEING,f=>{const d=a[e].x-r.x,L=a[e].y-r.y,Y=a[e].z-r.z;r.x=a[e].x,r.y=a[e].y,r.z=a[e].z,t.forEach(T=>{T[e].x+=d,T[e].y+=L,T[e].z+=Y,T.updateMatrix(),T.updateMatrixWorld()}),this.dispatchEvent({type:z.CHANGED,transObjectSet:t,mode:e,target:a})}),this.addEventListener(z.MOUSE_UP,f=>{t.forEach(d=>{d.matrixAutoUpdate=_.get(d),_.delete(d)})})}setDom(i){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement=i,this.connect(),this}setCamera(i){return this.camera=i,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...i){if(this.transObjectSet.clear(),!i.length||!i[0])return this.detach(),this;this.attach(this.target);const n=this.target;if(i.length===1){const r=i[0];return r.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.updateMatrix(),n.updateMatrixWorld(),this.transObjectSet.add(r),this}const e=[],a=[],t=[];return i.forEach(r=>{e.push(r.matrixWorld.elements[12]),a.push(r.matrixWorld.elements[13]),t.push(r.matrixWorld.elements[14])}),n.rotation.set(0,0,0),n.scale.set(0,0,0),n.position.x=(Math.max(...e)-Math.min(...e))/2+Math.min(...e),n.position.y=(Math.max(...a)-Math.min(...a))/2+Math.min(...a),n.position.z=(Math.max(...t)-Math.min(...t))/2+Math.min(...t),n.updateMatrix(),n.updateMatrixWorld(),i.forEach(r=>{this.transObjectSet.add(r)}),this}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointerup",this._onPointerUp)}dispose(){this.disconnect(),super.dispose()}}const Ft=Tt(zt),Kt=function(){let h,o,i;return{name:Ft,install(n){const e=new Ut(n.camera,n.dom);e.detach(),n.transformControls=e,n.scene.add(e),n.scene.add(e.target),n.transformControls.addEventListener(z.MOUSE_DOWN,()=>{n.transing=!0}),n.setTransformControls=function(a){return a?(this.transformControls.connect(),this.scene.add(this.transformControls)):(this.transformControls.disconnect(),this.scene.remove(this.transformControls)),this},o=a=>{a.options.transformControls&&e.setCamera(a.camera)},n.addEventListener(j.SETCAMERA,o),h=a=>{e.setDom(a.dom)},n.addEventListener(j.SETDOM,h),i=a=>{const t=a.scene;t.add(e.target),t.add(e)},n.addEventListener(j.SETSCENE,i)},dispose(n){var e;n.removeEventListener(j.SETCAMERA,o),n.removeEventListener(j.SETDOM,h),n.removeEventListener(j.SETSCENE,i),(e=n.transformControls)==null||e.dispose(),delete n.transing,delete n.transformControls,delete n.setTransformControls}}};export{Kt as T,Ft as a,z as b};
