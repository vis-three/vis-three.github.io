import{t as Ii,b as xt,E as Gi,s as Si,a as Li,i as be,c as $e,e as rr}from"./index.f2ecf0d4.js";import{q as z,o as j,x as Qe,y as Te,G as et,k as _e,l as fe,z as Mt,E as vt,I as At,J as Et,K as Hn,b as Wt,M as rn,X as Me,Y as cs,Z as tt,V as sn,_ as xi,$ as sr,a0 as oe,a1 as Oi,H as Jt,F as Fn,e as kt,a2 as ls,d as nt,a3 as us,P as Pn,a4 as hs,a5 as mt,a6 as Ve,a as ir,a7 as Hi,a8 as Pi,Q as Bt,N as _i,a9 as Ui,aa as Ji,ab as ki,ac as or,C as _n,ad as Ki,ae as fs,af as Ni,ag as ji,ah as Xi,ai as Qi,aj as on,ak as Vi,al as Tt,am as ps,an as Yi,ao as ds,L as As,ap as Wi,h as ms,aq as ge,O as Bs,ar as gs,as as Un,at as Cs,au as ys,av as Jn,v as Zt,w as N,aw as Ms,ax as an,ay as Zi,az as zi,aA as Cn,aB as qi,aC as $i,aD as eo,A as to,aE as no,aF as ro,aG as gt,aH as Or,aI as so,R as vs,aJ as io,aK as oo,aL as ao,aM as co,aN as Es,aO as Fs,aP as lo,aQ as uo,aR as Ts,aS as ho,aT as fo,aU as Hr,aV as po}from"./three.9c0f0dc6.js";import{P as Ao}from"./vis-three.plugin-pointer-manager.es.d581852e.js";import{E as mo}from"./index.1a70533e.js";import{R as Bo}from"./index.e11efb4f.js";import{_ as kn,a as cn,b as ln,c as yn}from"./G6.7004a6d1.js";var Kt,go=new Uint8Array(16);function Co(){if(!Kt&&(Kt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Kt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kt(go)}var yo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ar(s){return typeof s=="string"&&yo.test(s)}var Z=[];for(var Tn=0;Tn<256;++Tn)Z.push((Tn+256).toString(16).substr(1));function Mo(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Z[s[e+0]]+Z[s[e+1]]+Z[s[e+2]]+Z[s[e+3]]+"-"+Z[s[e+4]]+Z[s[e+5]]+"-"+Z[s[e+6]]+Z[s[e+7]]+"-"+Z[s[e+8]]+Z[s[e+9]]+"-"+Z[s[e+10]]+Z[s[e+11]]+Z[s[e+12]]+Z[s[e+13]]+Z[s[e+14]]+Z[s[e+15]]).toLowerCase();if(!ar(t))throw TypeError("Stringified UUID is invalid");return t}function Rs(s,e,t){s=s||{};var n=s.random||(s.rng||Co)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var r=0;r<16;++r)e[t+r]=n[r];return e}return Mo(n)}function Ge(s){return typeof s=="function"}function ws(s){var e=function(n){Error.call(n),n.stack=new Error().stack},t=s(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Rn=ws(function(s){return function(t){s(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Kn(s,e){if(s){var t=s.indexOf(e);0<=t&&s.splice(t,1)}}var Mn=function(){function s(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return s.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=kn(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(m){e={error:m}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var h=this.initialTeardown;if(Ge(h))try{h()}catch(m){i=m instanceof Rn?m.errors:[m]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var f=kn(u),p=f.next();!p.done;p=f.next()){var d=p.value;try{Pr(d)}catch(m){i=i!=null?i:[],m instanceof Rn?i=cn(cn([],ln(i)),ln(m.errors)):i.push(m)}}}catch(m){n={error:m}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}}if(i)throw new Rn(i)}},s.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Pr(e);else{if(e instanceof s){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},s.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},s.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},s.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Kn(t,e)},s.prototype.remove=function(e){var t=this._finalizers;t&&Kn(t,e),e instanceof s&&e._removeParent(this)},s.EMPTY=function(){var e=new s;return e.closed=!0,e}(),s}(),Ds=Mn.EMPTY;function bs(s){return s instanceof Mn||s&&"closed"in s&&Ge(s.remove)&&Ge(s.add)&&Ge(s.unsubscribe)}function Pr(s){Ge(s)?s():s.unsubscribe()}var cr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Nn={setTimeout:function(s,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var r=Nn.delegate;return r!=null&&r.setTimeout?r.setTimeout.apply(r,cn([s,e],ln(t))):setTimeout.apply(void 0,cn([s,e],ln(t)))},clearTimeout:function(s){var e=Nn.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(s)},delegate:void 0};function vo(s){Nn.setTimeout(function(){throw s})}function _r(){}var Nt=null;function zt(s){if(cr.useDeprecatedSynchronousErrorHandling){var e=!Nt;if(e&&(Nt={errorThrown:!1,error:null}),s(),e){var t=Nt,n=t.errorThrown,r=t.error;if(Nt=null,n)throw r}}else s()}var Is=function(s){yn(e,s);function e(t){var n=s.call(this)||this;return n.isStopped=!1,t?(n.destination=t,bs(t)&&t.add(n)):n.destination=Ro,n}return e.create=function(t,n,r){return new jn(t,n,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,s.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Mn),Eo=Function.prototype.bind;function wn(s,e){return Eo.call(s,e)}var Fo=function(){function s(e){this.partialObserver=e}return s.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){jt(n)}},s.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){jt(n)}else jt(e)},s.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){jt(t)}},s}(),jn=function(s){yn(e,s);function e(t,n,r){var i=s.call(this)||this,o;if(Ge(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:r!=null?r:void 0};else{var a;i&&cr.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return i.unsubscribe()},o={next:t.next&&wn(t.next,a),error:t.error&&wn(t.error,a),complete:t.complete&&wn(t.complete,a)}):o=t}return i.destination=new Fo(o),i}return e}(Is);function jt(s){vo(s)}function To(s){throw s}var Ro={closed:!0,next:_r,error:To,complete:_r},wo=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Do(s){return s}function bo(s){return s.length===0?Do:s.length===1?s[0]:function(t){return s.reduce(function(n,r){return r(n)},t)}}var Ur=function(){function s(e){e&&(this._subscribe=e)}return s.prototype.lift=function(e){var t=new s;return t.source=this,t.operator=e,t},s.prototype.subscribe=function(e,t,n){var r=this,i=Go(e)?e:new jn(e,t,n);return zt(function(){var o=r,a=o.operator,c=o.source;i.add(a?a.call(i,c):c?r._subscribe(i):r._trySubscribe(i))}),i},s.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},s.prototype.forEach=function(e,t){var n=this;return t=Jr(t),new t(function(r,i){var o=new jn({next:function(a){try{e(a)}catch(c){i(c),o.unsubscribe()}},error:i,complete:r});n.subscribe(o)})},s.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},s.prototype[wo]=function(){return this},s.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return bo(e)(this)},s.prototype.toPromise=function(e){var t=this;return e=Jr(e),new e(function(n,r){var i;t.subscribe(function(o){return i=o},function(o){return r(o)},function(){return n(i)})})},s.create=function(e){return new s(e)},s}();function Jr(s){var e;return(e=s!=null?s:cr.Promise)!==null&&e!==void 0?e:Promise}function Io(s){return s&&Ge(s.next)&&Ge(s.error)&&Ge(s.complete)}function Go(s){return s&&s instanceof Is||Io(s)&&bs(s)}var So=ws(function(s){return function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),lr=function(s){yn(e,s);function e(){var t=s.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new kr(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new So},e.prototype.next=function(t){var n=this;zt(function(){var r,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=kn(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var n=this;zt(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var r=n.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;zt(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),s.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,r=this,i=r.hasError,o=r.isStopped,a=r.observers;return i||o?Ds:(this.currentObservers=null,a.push(t),new Mn(function(){n.currentObservers=null,Kn(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,r=n.hasError,i=n.thrownError,o=n.isStopped;r?t.error(i):o&&t.complete()},e.prototype.asObservable=function(){var t=new Ur;return t.source=this,t},e.create=function(t,n){return new kr(t,n)},e}(Ur),kr=function(s){yn(e,s);function e(t,n){var r=s.call(this)||this;return r.destination=t,r.source=n,r}return e.prototype.next=function(t){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.next)===null||r===void 0||r.call(n,t)},e.prototype.error=function(t){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.error)===null||r===void 0||r.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,r;return(r=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&r!==void 0?r:Ds},e}(lr);const Lo=/^[og]\s*(.+)?/,xo=/^mtllib /,Oo=/^usemtl /,Ho=/^usemap /,Kr=new z,Dn=new z,Nr=new z,jr=new z,ue=new z,Xt=new j;function Po(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,i){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:r||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),r&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},n&&n.name&&typeof n.clone=="function"){const r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,i=this.object.geometry.normals;Kr.fromArray(r,e),Dn.fromArray(r,t),Nr.fromArray(r,n),ue.subVectors(Nr,Dn),jr.subVectors(Kr,Dn),ue.cross(jr),ue.normalize(),i.push(ue.x,ue.y,ue.z),i.push(ue.x,ue.y,ue.z),i.push(ue.x,ue.y,ue.z)},addColor:function(e,t,n){const r=this.colors,i=this.object.geometry.colors;r[e]!==void 0&&i.push(r[e+0],r[e+1],r[e+2]),r[t]!==void 0&&i.push(r[t+0],r[t+1],r[t+2]),r[n]!==void 0&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,o,a,c,l){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(n,h);if(this.addVertex(u,f,p),this.addColor(u,f,p),a!==void 0&&a!==""){const d=this.normals.length;u=this.parseNormalIndex(a,d),f=this.parseNormalIndex(c,d),p=this.parseNormalIndex(l,d),this.addNormal(u,f,p)}else this.addFaceNormal(u,f,p);if(r!==void 0&&r!==""){const d=this.uvs.length;u=this.parseUVIndex(r,d),f=this.parseUVIndex(i,d),p=this.parseUVIndex(o,d),this.addUV(u,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));for(let i=0,o=t.length;i<o;i++)this.addUVLine(this.parseUVIndex(t[i],r))}};return s.startObject("",!1),s}class _o extends Qe{constructor(e){super(e),this.materials=null}load(e,t,n,r){const i=this,o=new Te(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(i.parse(a))}catch(c){r?r(c):console.error(c),i.manager.itemError(e)}},n,r)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Po;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let r="",i="",o=0,a=[];const c=typeof"".trimLeft=="function";for(let u=0,f=n.length;u<f;u++)if(r=n[u],r=c?r.trimLeft():r.trim(),o=r.length,o!==0&&(i=r.charAt(0),i!=="#"))if(i==="v"){const p=r.split(/\s+/);switch(p[0]){case"v":t.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7?(Xt.setRGB(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6])).convertSRGBToLinear(),t.colors.push(Xt.r,Xt.g,Xt.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":t.uvs.push(parseFloat(p[1]),parseFloat(p[2]));break}}else if(i==="f"){const d=r.slice(1).trim().split(/\s+/),m=[];for(let g=0,C=d.length;g<C;g++){const A=d[g];if(A.length>0){const y=A.split("/");m.push(y)}}const B=m[0];for(let g=1,C=m.length-1;g<C;g++){const A=m[g],y=m[g+1];t.addFace(B[0],A[0],y[0],B[1],A[1],y[1],B[2],A[2],y[2])}}else if(i==="l"){const p=r.substring(1).trim().split(" ");let d=[];const m=[];if(r.indexOf("/")===-1)d=p;else for(let B=0,g=p.length;B<g;B++){const C=p[B].split("/");C[0]!==""&&d.push(C[0]),C[1]!==""&&m.push(C[1])}t.addLineGeometry(d,m)}else if(i==="p"){const d=r.slice(1).trim().split(" ");t.addPointGeometry(d)}else if((a=Lo.exec(r))!==null){const p=(" "+a[0].slice(1).trim()).slice(1);t.startObject(p)}else if(Oo.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(xo.test(r))t.materialLibraries.push(r.substring(7).trim());else if(Ho.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(i==="s"){if(a=r.split(" "),a.length>1){const d=a[1].trim().toLowerCase();t.object.smooth=d!=="0"&&d!=="off"}else t.object.smooth=!0;const p=t.object.currentMaterial();p&&(p.smooth=t.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}t.finalize();const l=new et;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let u=0,f=t.objects.length;u<f;u++){const p=t.objects[u],d=p.geometry,m=p.materials,B=d.type==="Line",g=d.type==="Points";let C=!1;if(d.vertices.length===0)continue;const A=new _e;A.setAttribute("position",new fe(d.vertices,3)),d.normals.length>0&&A.setAttribute("normal",new fe(d.normals,3)),d.colors.length>0&&(C=!0,A.setAttribute("color",new fe(d.colors,3))),d.hasUVIndices===!0&&A.setAttribute("uv",new fe(d.uvs,2));const y=[];for(let v=0,E=m.length;v<E;v++){const M=m[v],R=M.name+"_"+M.smooth+"_"+C;let F=t.materials[R];if(this.materials!==null){if(F=this.materials.create(M.name),B&&F&&!(F instanceof Mt)){const w=new Mt;vt.prototype.copy.call(w,F),w.color.copy(F.color),F=w}else if(g&&F&&!(F instanceof At)){const w=new At({size:10,sizeAttenuation:!1});vt.prototype.copy.call(w,F),w.color.copy(F.color),w.map=F.map,F=w}}F===void 0&&(B?F=new Mt:g?F=new At({size:1,sizeAttenuation:!1}):F=new Et,F.name=M.name,F.flatShading=!M.smooth,F.vertexColors=C,t.materials[R]=F),y.push(F)}let T;if(y.length>1){for(let v=0,E=m.length;v<E;v++){const M=m[v];A.addGroup(M.groupStart,M.groupCount,v)}B?T=new Hn(A,y):g?T=new Wt(A,y):T=new rn(A,y)}else B?T=new Hn(A,y[0]):g?T=new Wt(A,y[0]):T=new rn(A,y[0]);T.name=p.name,l.add(T)}else if(t.vertices.length>0){const u=new At({size:1,sizeAttenuation:!1}),f=new _e;f.setAttribute("position",new fe(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(f.setAttribute("color",new fe(t.colors,3)),u.vertexColors=!0);const p=new Wt(f,u);l.add(p)}return l}}class Uo extends Qe{constructor(e){super(e)}load(e,t,n,r){const i=this,o=this.path===""?Me.extractUrlBase(e):this.path,a=new Te(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(i.parse(c,o))}catch(l){r?r(l):console.error(l),i.manager.itemError(e)}},n,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let r={};const i=/\s+/,o={};for(let c=0;c<n.length;c++){let l=n[c];if(l=l.trim(),l.length===0||l.charAt(0)==="#")continue;const h=l.indexOf(" ");let u=h>=0?l.substring(0,h):l;u=u.toLowerCase();let f=h>=0?l.substring(h+1):"";if(f=f.trim(),u==="newmtl")r={name:f},o[f]=r;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=f.split(i,3);r[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else r[u]=f}const a=new Jo(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class Jo{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:cs,this.wrap=this.options.wrap!==void 0?this.options.wrap:tt}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],i={};t[n]=i;for(const o in r){let a=!0,c=r[o];const l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(a=!1);break}a&&(i[l]=c)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],r={name:e,side:this.side};function i(a,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:a+c}function o(a,c){if(r[a])return;const l=t.getTextureParams(c,r),h=t.loadTexture(i(t.baseUrl,l.url));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(h.encoding=oe),r[a]=h}for(const a in n){const c=n[a];let l;if(c!=="")switch(a.toLowerCase()){case"kd":r.color=new j().fromArray(c).convertSRGBToLinear();break;case"ks":r.specular=new j().fromArray(c).convertSRGBToLinear();break;case"ke":r.emissive=new j().fromArray(c).convertSRGBToLinear();break;case"map_kd":o("map",c);break;case"map_ks":o("specularMap",c);break;case"map_ke":o("emissiveMap",c);break;case"norm":o("normalMap",c);break;case"map_bump":case"bump":o("bumpMap",c);break;case"map_d":o("alphaMap",c),r.transparent=!0;break;case"ns":r.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(r.opacity=l,r.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(r.opacity=1-l,r.transparent=!0);break}}return this.materials[e]=new Et(r),this.materials[e]}getTextureParams(e,t){const n={scale:new sn(1,1),offset:new sn(0,0)},r=e.split(/\s+/);let i;return i=r.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),i=r.indexOf("-s"),i>=0&&(n.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),i=r.indexOf("-o"),i>=0&&(n.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),n.url=r.join(" ").trim(),n}loadTexture(e,t,n,r,i){const o=this.manager!==void 0?this.manager:xi;let a=o.getHandler(e);a===null&&(a=new sr(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const c=a.load(e,n,r,i);return t!==void 0&&(c.mapping=t),c}}class ko extends Oi{constructor(e){super(e),this.type=Jt}parse(e){const a=function(A,y){switch(A){case 1:console.error("THREE.RGBELoader Read Error: "+(y||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(y||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(y||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(y||""))}return-1},u=`
`,f=function(A,y,T){y=y||1024;let E=A.pos,M=-1,R=0,F="",w=String.fromCharCode.apply(null,new Uint16Array(A.subarray(E,E+128)));for(;0>(M=w.indexOf(u))&&R<y&&E<A.byteLength;)F+=w,R+=w.length,E+=128,w+=String.fromCharCode.apply(null,new Uint16Array(A.subarray(E,E+128)));return-1<M?(T!==!1&&(A.pos+=R+M+1),F+w.slice(0,M)):!1},p=function(A){const y=/^#\?(\S+)/,T=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,v=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,E=/^\s*FORMAT=(\S+)\s*$/,M=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,R={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let F,w;if(A.pos>=A.byteLength||!(F=f(A)))return a(1,"no header found");if(!(w=F.match(y)))return a(3,"bad initial token");for(R.valid|=1,R.programtype=w[1],R.string+=F+`
`;F=f(A),F!==!1;){if(R.string+=F+`
`,F.charAt(0)==="#"){R.comments+=F+`
`;continue}if((w=F.match(T))&&(R.gamma=parseFloat(w[1])),(w=F.match(v))&&(R.exposure=parseFloat(w[1])),(w=F.match(E))&&(R.valid|=2,R.format=w[1]),(w=F.match(M))&&(R.valid|=4,R.height=parseInt(w[1],10),R.width=parseInt(w[2],10)),R.valid&2&&R.valid&4)break}return R.valid&2?R.valid&4?R:a(3,"missing image size specifier"):a(3,"missing format specifier")},d=function(A,y,T){const v=y;if(v<8||v>32767||A[0]!==2||A[1]!==2||A[2]&128)return new Uint8Array(A);if(v!==(A[2]<<8|A[3]))return a(3,"wrong scanline width");const E=new Uint8Array(4*y*T);if(!E.length)return a(4,"unable to allocate buffer space");let M=0,R=0;const F=4*v,w=new Uint8Array(4),I=new Uint8Array(F);let b=T;for(;b>0&&R<A.byteLength;){if(R+4>A.byteLength)return a(1);if(w[0]=A[R++],w[1]=A[R++],w[2]=A[R++],w[3]=A[R++],w[0]!=2||w[1]!=2||(w[2]<<8|w[3])!=v)return a(3,"bad rgbe scanline format");let G=0,S;for(;G<F&&R<A.byteLength;){S=A[R++];const H=S>128;if(H&&(S-=128),S===0||G+S>F)return a(3,"bad scanline data");if(H){const L=A[R++];for(let K=0;K<S;K++)I[G++]=L}else I.set(A.subarray(R,R+S),G),G+=S,R+=S}const _=v;for(let H=0;H<_;H++){let L=0;E[M]=I[H+L],L+=v,E[M+1]=I[H+L],L+=v,E[M+2]=I[H+L],L+=v,E[M+3]=I[H+L],M+=4}b--}return E},m=function(A,y,T,v){const E=A[y+3],M=Math.pow(2,E-128)/255;T[v+0]=A[y+0]*M,T[v+1]=A[y+1]*M,T[v+2]=A[y+2]*M,T[v+3]=1},B=function(A,y,T,v){const E=A[y+3],M=Math.pow(2,E-128)/255;T[v+0]=kt.toHalfFloat(Math.min(A[y+0]*M,65504)),T[v+1]=kt.toHalfFloat(Math.min(A[y+1]*M,65504)),T[v+2]=kt.toHalfFloat(Math.min(A[y+2]*M,65504)),T[v+3]=kt.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const C=p(g);if(C!==-1){const A=C.width,y=C.height,T=d(g.subarray(g.pos),A,y);if(T!==-1){let v,E,M;switch(this.type){case Fn:M=T.length/4;const R=new Float32Array(M*4);for(let w=0;w<M;w++)m(T,w*4,R,w*4);v=R,E=Fn;break;case Jt:M=T.length/4;const F=new Uint16Array(M*4);for(let w=0;w<M;w++)B(T,w*4,F,w*4);v=F,E=Jt;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:A,height:y,data:v,header:C.string,gamma:C.gamma,exposure:C.exposure,type:E}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){function i(o,a){switch(o.type){case Fn:case Jt:o.encoding=ls,o.minFilter=nt,o.magFilter=nt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,i,n,r)}}class Ko extends Qe{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Vo(t)}),this.register(function(t){return new ea(t)}),this.register(function(t){return new ta(t)}),this.register(function(t){return new Wo(t)}),this.register(function(t){return new Zo(t)}),this.register(function(t){return new zo(t)}),this.register(function(t){return new qo(t)}),this.register(function(t){return new Qo(t)}),this.register(function(t){return new $o(t)}),this.register(function(t){return new Yo(t)}),this.register(function(t){return new jo(t)}),this.register(function(t){return new na(t)})}load(e,t,n,r){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Me.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){r?r(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},c=new Te(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{i.parse(l,o,function(h){t(h),i.manager.itemEnd(e)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const o={},a={};if(typeof e=="string")i=e;else if(Me.decodeText(new Uint8Array(e,0,4))===Gs){try{o[O.KHR_BINARY_GLTF]=new ra(e)}catch(u){r&&r(u);return}i=o[O.KHR_BINARY_GLTF].content}else i=Me.decodeText(new Uint8Array(e));const c=JSON.parse(i);if(c.asset===void 0||c.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new ma(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,o[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],f=c.extensionsRequired||[];switch(u){case O.KHR_MATERIALS_UNLIT:o[u]=new Xo;break;case O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new oa;break;case O.KHR_DRACO_MESH_COMPRESSION:o[u]=new sa(c,this.dracoLoader);break;case O.KHR_TEXTURE_TRANSFORM:o[u]=new ia;break;case O.KHR_MESH_QUANTIZATION:o[u]=new aa;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,i){n.parse(e,t,r,i)})}}function No(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const O={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class jo{constructor(e){this.parser=e,this.name=O.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new j(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new hs(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Pn(h),l.distance=u;break;case"spot":l=new us(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class Xo{constructor(){this.name=O.KHR_MATERIALS_UNLIT}getMaterialType(){return mt}extendParams(e,t,n){const r=[];e.color=new j(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}i.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",i.baseColorTexture,oe))}return Promise.all(r)}}class Qo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Vo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new sn(a,a)}return Promise.all(i)}}class Yo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class Wo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new j(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,oe)),o.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Zo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class zo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new j(a[0],a[1],a[2]),Promise.all(i)}}class qo{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class $o{constructor(e){this.parser=e,this.name=O.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ve}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new j(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,oe)),Promise.all(i)}}class ea{constructor(e){this.parser=e,this.name=O.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class ta{constructor(e){this.parser=e,this.name=O.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=r.images[o.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class na{constructor(e){this.name=O.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then(function(a){const c=r.byteOffset||0,l=r.byteLength||0,h=r.count,u=r.byteStride,f=new ArrayBuffer(h*u),p=new Uint8Array(a[0],c,l);return o.decodeGltfBuffer(new Uint8Array(f),h,u,p,r.mode,r.filter),f})}else return null}}const Gs="glTF",pt=12,Xr={JSON:1313821514,BIN:5130562};class ra{constructor(e){this.name=O.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,pt);if(this.header={magic:Me.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Gs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-pt,r=new DataView(e,pt);let i=0;for(;i<n;){const o=r.getUint32(i,!0);i+=4;const a=r.getUint32(i,!0);if(i+=4,a===Xr.JSON){const c=new Uint8Array(e,pt+i,o);this.content=Me.decodeText(c)}else if(a===Xr.BIN){const c=pt+i;this.body=e.slice(c,c+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class sa{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=O.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const h in o){const u=Qn[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=Qn[h]||h.toLowerCase();if(o[h]!==void 0){const f=n.accessors[e.attributes[h]],p=Rt[f.componentType];l[u]=p,c[u]=f.normalized===!0}}return t.getDependency("bufferView",i).then(function(h){return new Promise(function(u){r.decodeDracoFile(h,function(f){for(const p in f.attributes){const d=f.attributes[p],m=c[p];m!==void 0&&(d.normalized=m)}u(f)},a,l)})})}}class ia{constructor(){this.name=O.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Xn extends ir{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new j().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class oa{constructor(){this.name=O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Xn}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new j(1,1,1),e.opacity=1;const i=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&i.push(n.assignTexture(e,"map",r.diffuseTexture,oe)),e.emissive=new j(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new j(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",o)),i.push(n.assignTexture(e,"specularMap",o,oe))}return Promise.all(i)}createMaterial(e){const t=new Xn(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Hi,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class aa{constructor(){this.name=O.KHR_MESH_QUANTIZATION}}class ur extends Pi{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[i+o];return t}}ur.prototype.interpolate_=function(s,e,t,n){const r=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=o*2,c=o*3,l=n-e,h=(t-e)/l,u=h*h,f=u*h,p=s*c,d=p-c,m=-2*f+3*u,B=f-u,g=1-m,C=B-u+h;for(let A=0;A!==o;A++){const y=i[d+A+o],T=i[d+A+a]*l,v=i[p+A+o],E=i[p+A]*l;r[A]=g*y+C*T+m*v+B*E}return r};const ca=new Bt;class la extends ur{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return ca.fromArray(i).normalize().toArray(i),i}}const De={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Rt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qr={9728:_i,9729:nt,9984:Ui,9985:Ji,9986:ki,9987:or},Vr={33071:_n,33648:Ki,10497:tt},Yr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Oe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ua={CUBICSPLINE:void 0,LINEAR:fs,STEP:Ni},bn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ha(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new ir({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:cs})),s.DefaultMaterial}function dt(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function je(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function fa(s,e,t){let n=!1,r=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(r=!0),u.COLOR_0!==void 0&&(i=!0),n&&r&&i)break}if(!n&&!r&&!i)return Promise.resolve(s);const o=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):s.attributes.position;o.push(f)}if(r){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):s.attributes.normal;a.push(f)}if(i){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):s.attributes.color;c.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2];return n&&(s.morphAttributes.position=h),r&&(s.morphAttributes.normal=u),i&&(s.morphAttributes.color=f),s.morphTargetsRelative=!0,s})}function pa(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function da(s){const e=s.extensions&&s.extensions[O.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Wr(e.attributes):t=s.indices+":"+Wr(s.attributes)+":"+s.mode,t}function Wr(s){let e="";const t=Object.keys(s).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Vn(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Aa(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class ma{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new No,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||n||r&&i<98?this.textureLoader=new sr(this.options.manager):this.textureLoader=new ji(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Te(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};dt(i,a,r),je(a,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const o=t[r].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,h]of o.children.entries())i(h,a.children[l])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[O.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,o){n.load(Me.resolveURL(t.uri,r.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,i=t.byteOffset||0;return n.slice(i,i+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],c=Yr[r.type],l=Rt[r.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,f=r.byteOffset||0,p=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,d=r.normalized===!0;let m,B;if(p&&p!==u){const g=Math.floor(f/p),C="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count;let A=t.cache.get(C);A||(m=new l(a,g*p,r.count*p/h),A=new Xi(m,p/h),t.cache.add(C,A)),B=new Qi(A,c,f%p/h,d)}else a===null?m=new l(r.count*c):m=new l(a,f,r.count*c),B=new on(m,c,d);if(r.sparse!==void 0){const g=Yr.SCALAR,C=Rt[r.sparse.indices.componentType],A=r.sparse.indices.byteOffset||0,y=r.sparse.values.byteOffset||0,T=new C(o[1],A,r.sparse.count*g),v=new l(o[2],y,r.sparse.count*c);a!==null&&(B=new on(B.array.slice(),B.itemSize,B.normalized));for(let E=0,M=T.length;E<M;E++){const R=T[E];if(B.setX(R,v[E*c]),c>=2&&B.setY(R,v[E*c+1]),c>=3&&B.setZ(R,v[E*c+2]),c>=4&&B.setW(R,v[E*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return B})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const r=this,i=this.json,o=i.textures[e],a=i.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,o.name&&(h.name=o.name);const f=(i.samplers||{})[o.sampler]||{};return h.magFilter=Qr[f.magFilter]||nt,h.minFilter=Qr[f.minFilter]||or,h.wrapS=Vr[f.wrapS]||tt,h.wrapT=Vr[f.wrapT]||tt,r.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=r.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=n.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:o.mimeType});return c=a.createObjectURL(f),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(f,p){let d=f;t.isImageBitmapLoader===!0&&(d=function(m){const B=new an(m);B.needsUpdate=!0,f(B)}),t.load(Me.resolveURL(u,i.path),d,void 0,p)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=o.mimeType||Aa(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then(function(o){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[O.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[O.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(o);o=i.extensions[O.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,c)}}return r!==void 0&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new At,vt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new Mt,vt.prototype.copy.call(c,n),c.color.copy(n.color),this.cache.add(a,c)),n=c}if(r||i||o){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),r&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),i&&(c.vertexColors=!0),o&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return ir}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let o;const a={},c=i.extensions||{},l=[];if(c[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=r[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=u.getMaterialType(),l.push(u.extendParams(a,i,t))}else if(c[O.KHR_MATERIALS_UNLIT]){const u=r[O.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(a,i,t))}else{const u=i.pbrMetallicRoughness||{};if(a.color=new j(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture,oe)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=Vi);const h=i.alphaMode||bn.OPAQUE;if(h===bn.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===bn.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==mt&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new sn(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;a.normalScale.set(u,u)}return i.occlusionTexture!==void 0&&o!==mt&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==mt&&(a.emissive=new j().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&o!==mt&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,oe)),Promise.all(l).then(function(){let u;return o===Xn?u=r[O.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new o(a),i.name&&(u.name=i.name),je(u,i),t.associations.set(u,{materials:e}),i.extensions&&dt(r,u,i),u})}createUniqueName(e){const t=Tt.sanitizeNodeName(e||"");let n=t;for(let r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(a){return n[O.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Zr(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=da(l),u=r[h];if(u)o.push(u.promise);else{let f;l.extensions&&l.extensions[O.KHR_DRACO_MESH_COMPRESSION]?f=i(l):f=Zr(new _e,l,t),r[h]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],o=i.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const h=o[c].material===void 0?ha(this.cache):this.getDependency("material",o[c].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let p=0,d=h.length;p<d;p++){const m=h[p],B=o[p];let g;const C=l[p];if(B.mode===De.TRIANGLES||B.mode===De.TRIANGLE_STRIP||B.mode===De.TRIANGLE_FAN||B.mode===void 0)g=i.isSkinnedMesh===!0?new ps(m,C):new rn(m,C),g.isSkinnedMesh===!0&&!g.geometry.attributes.skinWeight.normalized&&g.normalizeSkinWeights(),B.mode===De.TRIANGLE_STRIP?g.geometry=zr(g.geometry,Yi):B.mode===De.TRIANGLE_FAN&&(g.geometry=zr(g.geometry,ds));else if(B.mode===De.LINES)g=new Hn(m,C);else if(B.mode===De.LINE_STRIP)g=new As(m,C);else if(B.mode===De.LINE_LOOP)g=new Wi(m,C);else if(B.mode===De.POINTS)g=new Wt(m,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+B.mode);Object.keys(g.geometry.morphAttributes).length>0&&pa(g,i),g.name=t.createUniqueName(i.name||"mesh_"+e),je(g,i),B.extensions&&dt(r,g,B),t.assignFinalMaterial(g),u.push(g)}for(let p=0,d=u.length;p<d;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return u[0];const f=new et;t.associations.set(f,{meshes:e});for(let p=0,d=u.length;p<d;p++)f.add(u[p]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new ms(ge.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new Bs(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),je(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return n.inverseBindMatrices=r,n})}loadAnimation(e){const n=this.json.animations[e],r=[],i=[],o=[],a=[],c=[];for(let l=0,h=n.channels.length;l<h;l++){const u=n.channels[l],f=n.samplers[u.sampler],p=u.target,d=p.node!==void 0?p.node:p.id,m=n.parameters!==void 0?n.parameters[f.input]:f.input,B=n.parameters!==void 0?n.parameters[f.output]:f.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",m)),o.push(this.getDependency("accessor",B)),a.push(f),c.push(p)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2],p=l[3],d=l[4],m=[];for(let g=0,C=h.length;g<C;g++){const A=h[g],y=u[g],T=f[g],v=p[g],E=d[g];if(A===void 0)continue;A.updateMatrix(),A.matrixAutoUpdate=!0;let M;switch(Oe[E.path]){case Oe.weights:M=Cs;break;case Oe.rotation:M=Un;break;case Oe.position:case Oe.scale:default:M=gs;break}const R=A.name?A.name:A.uuid,F=v.interpolation!==void 0?ua[v.interpolation]:fs,w=[];Oe[E.path]===Oe.weights?A.traverse(function(b){b.morphTargetInfluences&&w.push(b.name?b.name:b.uuid)}):w.push(R);let I=T.array;if(T.normalized){const b=Vn(I.constructor),G=new Float32Array(I.length);for(let S=0,_=I.length;S<_;S++)G[S]=I[S]*b;I=G}for(let b=0,G=w.length;b<G;b++){const S=new M(w[b]+"."+Oe[E.path],y.array,I,F);v.interpolation==="CUBICSPLINE"&&(S.createInterpolant=function(H){const L=this instanceof Un?la:ur;return new L(this.times,this.values,this.getValueSize()/3,H)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(S)}}const B=n.name?n.name:"animation_"+e;return new ys(B,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(i){const o=n._getNodeRef(n.meshCache,r.mesh,i);return r.weights!==void 0&&o.traverse(function(a){if(!!a.isMesh)for(let c=0,l=r.weights.length;c<l;c++)a.morphTargetInfluences[c]=r.weights[c]}),o})}loadNode(e){const t=this.json,n=this.extensions,r=this,i=t.nodes[e],o=i.name?r.createUniqueName(i.name):"";return function(){const a=[],c=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),i.camera!==void 0&&a.push(r.getDependency("camera",i.camera).then(function(l){return r._getNodeRef(r.cameraCache,i.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(i.isBone===!0?c=new Jn:a.length>1?c=new et:a.length===1?c=a[0]:c=new Zt,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(i.name&&(c.userData.name=i.name,c.name=o),je(c,i),i.extensions&&dt(n,c,i),i.matrix!==void 0){const l=new N;l.fromArray(i.matrix),c.applyMatrix4(l)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);return r.associations.has(c)||r.associations.set(c,{}),r.associations.get(c).nodes=e,c})}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],i=this,o=new et;r.name&&(o.name=i.createUniqueName(r.name)),je(o,r),r.extensions&&dt(n,o,r);const a=r.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(Ss(a[l],o,t,i));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[f,p]of i.associations)(f instanceof vt||f instanceof an)&&u.set(f,p);return h.traverse(f=>{const p=i.associations.get(f);p!=null&&u.set(f,p)}),u};return i.associations=l(o),o})}}function Ss(s,e,t,n){const r=t.nodes[s];return n.getDependency("node",s).then(function(i){if(r.skin===void 0)return i;let o;return n.getDependency("skin",r.skin).then(function(a){o=a;const c=[];for(let l=0,h=o.joints.length;l<h;l++)c.push(n.getDependency("node",o.joints[l]));return Promise.all(c)}).then(function(a){return i.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,f=a.length;u<f;u++){const p=a[u];if(p){l.push(p);const d=new N;o.inverseBindMatrices!==void 0&&d.fromArray(o.inverseBindMatrices.array,u*16),h.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[u])}c.bind(new Ms(l,h),c.matrixWorld)}),i})}).then(function(i){e.add(i);const o=[];if(r.children){const a=r.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];o.push(Ss(h,i,t,n))}}return Promise.all(o)})}function Ba(s,e,t){const n=e.attributes,r=new Zi;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(r.set(new z(c[0],c[1],c[2]),new z(l[0],l[1],l[2])),a.normalized){const h=Vn(Rt[a.componentType]);r.min.multiplyScalar(h),r.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new z,c=new z;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,d=f.max;if(p!==void 0&&d!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(d[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(d[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(d[2]))),f.normalized){const m=Vn(Rt[f.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}s.boundingBox=r;const o=new zi;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,s.boundingSphere=o}function Zr(s,e,t){const n=e.attributes,r=[];function i(o,a){return t.getDependency("accessor",o).then(function(c){s.setAttribute(a,c)})}for(const o in n){const a=Qn[o]||o.toLowerCase();a in s.attributes||r.push(i(n[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});r.push(o)}return je(s,e),Ba(s,e,t),Promise.all(r).then(function(){return e.targets!==void 0?fa(s,e.targets,t):s})}function zr(s,e){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,r=[];if(e===ds)for(let o=1;o<=n;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=s.clone();return i.setIndex(r),i}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var qr={},Yn=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))},Ls=function(s){return new Worker(s)};try{URL.revokeObjectURL(Yn(""))}catch{Yn=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Ls=function(e){return new Worker(e,{type:"module"})}}var ga=function(s,e,t,n,r){var i=Ls(qr[e]||(qr[e]=Yn(s)));return i.onerror=function(o){return r(o.error,null)},i.onmessage=function(o){return r(null,o.data)},i.postMessage(t,n),i},P=Uint8Array,W=Uint16Array,Se=Uint32Array,it=new P([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ot=new P([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wt=new P([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xs=function(s,e){for(var t=new W(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var r=new Se(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)r[i]=i-t[n]<<5|n;return[t,r]},Os=xs(it,2),hr=Os[0],un=Os[1];hr[28]=258,un[258]=28;var Hs=xs(ot,0),Ps=Hs[0],Wn=Hs[1],Dt=new W(32768);for(var k=0;k<32768;++k){var He=(k&43690)>>>1|(k&21845)<<1;He=(He&52428)>>>2|(He&13107)<<2,He=(He&61680)>>>4|(He&3855)<<4,Dt[k]=((He&65280)>>>8|(He&255)<<8)>>>1}var pe=function(s,e,t){for(var n=s.length,r=0,i=new W(e);r<n;++r)++i[s[r]-1];var o=new W(e);for(r=0;r<e;++r)o[r]=o[r-1]+i[r-1]<<1;var a;if(t){a=new W(1<<e);var c=15-e;for(r=0;r<n;++r)if(s[r])for(var l=r<<4|s[r],h=e-s[r],u=o[s[r]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)a[Dt[u]>>>c]=l}else for(a=new W(n),r=0;r<n;++r)s[r]&&(a[r]=Dt[o[s[r]-1]++]>>>15-s[r]);return a},Le=new P(288);for(var k=0;k<144;++k)Le[k]=8;for(var k=144;k<256;++k)Le[k]=9;for(var k=256;k<280;++k)Le[k]=7;for(var k=280;k<288;++k)Le[k]=8;var rt=new P(32);for(var k=0;k<32;++k)rt[k]=5;var _s=pe(Le,9,0),Us=pe(Le,9,1),Js=pe(rt,5,0),ks=pe(rt,5,1),qt=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},he=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(e&7)&t},$t=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},Ot=function(s){return(s/8|0)+(s&7&&1)},de=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof W?W:s instanceof Se?Se:P)(t-e);return n.set(s.subarray(e,t)),n},Ht=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new P(0);var r=!e||t,i=!t||t.i;t||(t={}),e||(e=new P(n*3));var o=function(ae){var re=e.length;if(ae>re){var ce=new P(Math.max(re*2,ae));ce.set(e),e=ce}},a=t.f||0,c=t.p||0,l=t.b||0,h=t.l,u=t.d,f=t.m,p=t.n,d=n*8;do{if(!h){t.f=a=he(s,c,1);var m=he(s,c+1,3);if(c+=3,m)if(m==1)h=Us,u=ks,f=9,p=5;else if(m==2){var A=he(s,c,31)+257,y=he(s,c+10,15)+4,T=A+he(s,c+5,31)+1;c+=14;for(var v=new P(T),E=new P(19),M=0;M<y;++M)E[wt[M]]=he(s,c+M*3,7);c+=y*3;for(var R=qt(E),F=(1<<R)-1,w=pe(E,R,1),M=0;M<T;){var I=w[he(s,c,F)];c+=I&15;var B=I>>>4;if(B<16)v[M++]=B;else{var b=0,G=0;for(B==16?(G=3+he(s,c,3),c+=2,b=v[M-1]):B==17?(G=3+he(s,c,7),c+=3):B==18&&(G=11+he(s,c,127),c+=7);G--;)v[M++]=b}}var S=v.subarray(0,A),_=v.subarray(A);f=qt(S),p=qt(_),h=pe(S,f,1),u=pe(_,p,1)}else throw"invalid block type";else{var B=Ot(c)+4,g=s[B-4]|s[B-3]<<8,C=B+g;if(C>n){if(i)throw"unexpected EOF";break}r&&o(l+g),e.set(s.subarray(B,C),l),t.b=l+=g,t.p=c=C*8;continue}if(c>d){if(i)throw"unexpected EOF";break}}r&&o(l+131072);for(var H=(1<<f)-1,L=(1<<p)-1,K=c;;K=c){var b=h[$t(s,c)&H],$=b>>>4;if(c+=b&15,c>d){if(i)throw"unexpected EOF";break}if(!b)throw"invalid length/literal";if($<256)e[l++]=$;else if($==256){K=c,h=null;break}else{var Y=$-254;if($>264){var M=$-257,V=it[M];Y=he(s,c,(1<<V)-1)+hr[M],c+=V}var ne=u[$t(s,c)&L],q=ne>>>4;if(!ne)throw"invalid distance";c+=ne&15;var _=Ps[q];if(q>3){var V=ot[q];_+=$t(s,c)&(1<<V)-1,c+=V}if(c>d){if(i)throw"unexpected EOF";break}r&&o(l+131072);for(var U=l+Y;l<U;l+=4)e[l]=e[l-_],e[l+1]=e[l+1-_],e[l+2]=e[l+2-_],e[l+3]=e[l+3-_];l=U}}t.l=h,t.p=K,t.b=l,h&&(a=1,t.m=f,t.d=u,t.n=p)}while(!a);return l==e.length?e:de(e,0,l)},Ee=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},ze=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},en=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,i=t.slice();if(!r)return[Ie,0];if(r==1){var o=new P(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(T,v){return T.f-v.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,h=1,u=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};h!=r-1;)a=t[t[l].f<t[u].f?l++:u++],c=t[l!=h&&t[l].f<t[u].f?l++:u++],t[h++]={s:-1,f:a.f+c.f,l:a,r:c};for(var f=i[0].s,n=1;n<r;++n)i[n].s>f&&(f=i[n].s);var p=new W(f+1),d=hn(t[h-1],p,0);if(d>e){var n=0,m=0,B=d-e,g=1<<B;for(i.sort(function(v,E){return p[E.s]-p[v.s]||v.f-E.f});n<r;++n){var C=i[n].s;if(p[C]>e)m+=g-(1<<d-p[C]),p[C]=e;else break}for(m>>>=B;m>0;){var A=i[n].s;p[A]<e?m-=1<<e-p[A]++-1:++n}for(;n>=0&&m;--n){var y=i[n].s;p[y]==e&&(--p[y],++m)}d=e}return[new P(p),d]},hn=function(s,e,t){return s.s==-1?Math.max(hn(s.l,e,t+1),hn(s.r,e,t+1)):e[s.s]=t},Zn=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new W(++e),n=0,r=s[0],i=1,o=function(c){t[n++]=c},a=1;a<=e;++a)if(s[a]==r&&a!=e)++i;else{if(!r&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(r),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(r);i=1,r=s[a]}return[t.subarray(0,n),e]},qe=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},Ft=function(s,e,t){var n=t.length,r=Ot(e+2);s[r]=n&255,s[r+1]=n>>>8,s[r+2]=s[r]^255,s[r+3]=s[r+1]^255;for(var i=0;i<n;++i)s[r+i+4]=t[i];return(r+4+n)*8},zn=function(s,e,t,n,r,i,o,a,c,l,h){Ee(e,h++,t),++r[256];for(var u=en(r,15),f=u[0],p=u[1],d=en(i,15),m=d[0],B=d[1],g=Zn(f),C=g[0],A=g[1],y=Zn(m),T=y[0],v=y[1],E=new W(19),M=0;M<C.length;++M)E[C[M]&31]++;for(var M=0;M<T.length;++M)E[T[M]&31]++;for(var R=en(E,7),F=R[0],w=R[1],I=19;I>4&&!F[wt[I-1]];--I);var b=l+5<<3,G=qe(r,Le)+qe(i,rt)+o,S=qe(r,f)+qe(i,m)+o+14+3*I+qe(E,F)+(2*E[16]+3*E[17]+7*E[18]);if(b<=G&&b<=S)return Ft(e,h,s.subarray(c,c+l));var _,H,L,K;if(Ee(e,h,1+(S<G)),h+=2,S<G){_=pe(f,p,0),H=f,L=pe(m,B,0),K=m;var $=pe(F,w,0);Ee(e,h,A-257),Ee(e,h+5,v-1),Ee(e,h+10,I-4),h+=14;for(var M=0;M<I;++M)Ee(e,h+3*M,F[wt[M]]);h+=3*I;for(var Y=[C,T],V=0;V<2;++V)for(var ne=Y[V],M=0;M<ne.length;++M){var q=ne[M]&31;Ee(e,h,$[q]),h+=F[q],q>15&&(Ee(e,h,ne[M]>>>5&127),h+=ne[M]>>>12)}}else _=_s,H=Le,L=Js,K=rt;for(var M=0;M<a;++M)if(n[M]>255){var q=n[M]>>>18&31;ze(e,h,_[q+257]),h+=H[q+257],q>7&&(Ee(e,h,n[M]>>>23&31),h+=it[q]);var U=n[M]&31;ze(e,h,L[U]),h+=K[U],U>3&&(ze(e,h,n[M]>>>5&8191),h+=ot[U])}else ze(e,h,_[n[M]]),h+=H[n[M]];return ze(e,h,_[256]),h+H[256]},Ks=new Se([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ie=new P(0),Ns=function(s,e,t,n,r,i){var o=s.length,a=new P(n+o+5*(1+Math.ceil(o/7e3))+r),c=a.subarray(n,a.length-r),l=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var u=h+65535;u<o?l=Ft(c,l,s.subarray(h,u)):(c[h]=i,l=Ft(c,l,s.subarray(h,o)))}else{for(var f=Ks[e-1],p=f>>>13,d=f&8191,m=(1<<t)-1,B=new W(32768),g=new W(m+1),C=Math.ceil(t/3),A=2*C,y=function(We){return(s[We]^s[We+1]<<C^s[We+2]<<A)&m},T=new Se(25e3),v=new W(288),E=new W(32),M=0,R=0,h=0,F=0,w=0,I=0;h<o;++h){var b=y(h),G=h&32767,S=g[b];if(B[G]=S,g[b]=G,w<=h){var _=o-h;if((M>7e3||F>24576)&&_>423){l=zn(s,c,0,T,v,E,R,F,I,h-I,l),F=M=R=0,I=h;for(var H=0;H<286;++H)v[H]=0;for(var H=0;H<30;++H)E[H]=0}var L=2,K=0,$=d,Y=G-S&32767;if(_>2&&b==y(h-Y))for(var V=Math.min(p,_)-1,ne=Math.min(32767,h),q=Math.min(258,_);Y<=ne&&--$&&G!=S;){if(s[h+L]==s[h+L-Y]){for(var U=0;U<q&&s[h+U]==s[h+U-Y];++U);if(U>L){if(L=U,K=Y,U>V)break;for(var ae=Math.min(Y,U-2),re=0,H=0;H<ae;++H){var ce=h-Y+H+32768&32767,we=B[ce],le=ce-we+32768&32767;le>re&&(re=le,S=ce)}}}G=S,S=B[G],Y+=G-S+32768&32767}if(K){T[F++]=268435456|un[L]<<18|Wn[K];var ve=un[L]&31,me=Wn[K]&31;R+=it[ve]+ot[me],++v[257+ve],++E[me],w=h+L,++M}else T[F++]=s[h],++v[s[h]]}}l=zn(s,c,i,T,v,E,R,F,I,h-I,l),!i&&l&7&&(l=Ft(c,l+1,Ie))}return de(a,0,n+Ot(l)+r)},js=function(){for(var s=new Se(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;s[e]=t}return s}(),at=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=js[t&255^e[n]]^t>>>8;s=t},d:function(){return~s}}},fr=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,i=t.length,o=0;o!=i;){for(var a=Math.min(o+2655,i);o<a;++o)r+=n+=t[o];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}s=n,e=r},d:function(){return s%=65521,e%=65521,(s&255)<<24|s>>>8<<16|(e&255)<<8|e>>>8}}},Ye=function(s,e,t,n,r){return Ns(s,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):12+e.mem,t,n,!r)},Pt=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},$r=function(s,e,t){for(var n=s(),r=s.toString(),i=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var a=n[o],c=i[o];if(typeof a=="function"){e+=";"+c+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var u in a.prototype)e+=";"+c+".prototype."+u+"="+a.prototype[u].toString()}else e+=l}else t[c]=a}return[e,t]},Qt=[],Ca=function(s){var e=[];for(var t in s)(s[t]instanceof P||s[t]instanceof W||s[t]instanceof Se)&&e.push((s[t]=new s[t].constructor(s[t])).buffer);return e},Xs=function(s,e,t,n){var r;if(!Qt[t]){for(var i="",o={},a=s.length-1,c=0;c<a;++c)r=$r(s[c],i,o),i=r[0],o=r[1];Qt[t]=$r(s[a],i,o)}var l=Pt({},Qt[t][1]);return ga(Qt[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,Ca(l),n)},ct=function(){return[P,W,Se,it,ot,wt,hr,Ps,Us,ks,Dt,pe,qt,he,$t,Ot,de,Ht,ft,Ne,pr]},lt=function(){return[P,W,Se,it,ot,wt,un,Wn,_s,Le,Js,rt,Dt,Ks,Ie,pe,Ee,ze,en,hn,Zn,qe,Ft,zn,Ot,de,Ns,Ye,_t,Ne]},Qs=function(){return[dr,mr,J,at,js]},Vs=function(){return[Ar,Zs]},Ys=function(){return[Br,J,fr]},Ws=function(){return[zs]},Ne=function(s){return postMessage(s,[s.buffer])},pr=function(s){return s&&s.size&&new P(s.size)},ut=function(s,e,t,n,r,i){var o=Xs(t,n,r,function(a,c){o.terminate(),i(a,c)});return o.postMessage([s,e],e.consume?[s.buffer]:[]),function(){o.terminate()}},Ae=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},ht=function(s,e,t,n,r){var i,o=Xs(s,n,r,function(a,c){a?(o.terminate(),e.ondata.call(e,a)):(c[1]&&o.terminate(),e.ondata.call(e,a,c[0],c[1]))});o.postMessage(t),e.push=function(a,c){if(i)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([a,i=c],[a.buffer])},e.terminate=function(){o.terminate()}},te=function(s,e){return s[e]|s[e+1]<<8},Q=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},In=function(s,e){return Q(s,e)+Q(s,e+4)*4294967296},J=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},dr=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&J(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},Ar=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;e&4&&(t+=s[10]|(s[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(e&2)},Zs=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},mr=function(s){return 10+(s.filename&&s.filename.length+1||0)},Br=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},zs=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function gr(s,e){return!e&&typeof s=="function"&&(e=s,s={}),this.ondata=e,s}var Re=function(){function s(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(Ye(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),qs=function(){function s(e,t){ht([lt,function(){return[Ae,Re]}],this,gr.call(this,e,t),function(n){var r=new Re(n.data);onmessage=Ae(r)},6)}return s}();function $s(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[lt],function(n){return Ne(_t(n.data[0],n.data[1]))},0,t)}function _t(s,e){return Ye(s,e||{},0,0)}var ie=function(){function s(e){this.s={},this.p=new P(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new P(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ht(this.p,this.o,this.s);this.ondata(de(n,t,this.s.b),this.d),this.o=de(n,this.s.b-32768),this.s.b=this.o.length,this.p=de(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),Cr=function(){function s(e){this.ondata=e,ht([ct,function(){return[Ae,ie]}],this,0,function(){var t=new ie;onmessage=Ae(t)},7)}return s}();function yr(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[ct],function(n){return Ne(ft(n.data[0],pr(n.data[1])))},1,t)}function ft(s,e){return Ht(s,e)}var fn=function(){function s(e,t){this.c=at(),this.l=0,this.v=1,Re.call(this,e,t)}return s.prototype.push=function(e,t){Re.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Ye(e,this.o,this.v&&mr(this.o),t&&8,!t);this.v&&(dr(n,this.o),this.v=0),t&&(J(n,n.length-8,this.c.d()),J(n,n.length-4,this.l)),this.ondata(n,t)},s}(),es=function(){function s(e,t){ht([lt,Qs,function(){return[Ae,Re,fn]}],this,gr.call(this,e,t),function(n){var r=new fn(n.data);onmessage=Ae(r)},8)}return s}();function ts(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[lt,Qs,function(){return[pn]}],function(n){return Ne(pn(n.data[0],n.data[1]))},2,t)}function pn(s,e){e||(e={});var t=at(),n=s.length;t.p(s);var r=Ye(s,e,mr(e),8),i=r.length;return dr(r,e),J(r,i-8,t.d()),J(r,i-4,n),r}var dn=function(){function s(e){this.v=1,ie.call(this,e)}return s.prototype.push=function(e,t){if(ie.prototype.e.call(this,e),this.v){var n=this.p.length>3?Ar(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ie.prototype.c.call(this,t)},s}(),ei=function(){function s(e){this.ondata=e,ht([ct,Vs,function(){return[Ae,ie,dn]}],this,0,function(){var t=new dn;onmessage=Ae(t)},9)}return s}();function ti(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[ct,Vs,function(){return[An]}],function(n){return Ne(An(n.data[0]))},3,t)}function An(s,e){return Ht(s.subarray(Ar(s),-8),e||new P(Zs(s)))}var qn=function(){function s(e,t){this.c=fr(),this.v=1,Re.call(this,e,t)}return s.prototype.push=function(e,t){Re.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=Ye(e,this.o,this.v&&2,t&&4,!t);this.v&&(Br(n,this.o),this.v=0),t&&J(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),ya=function(){function s(e,t){ht([lt,Ys,function(){return[Ae,Re,qn]}],this,gr.call(this,e,t),function(n){var r=new qn(n.data);onmessage=Ae(r)},10)}return s}();function Ma(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[lt,Ys,function(){return[$n]}],function(n){return Ne($n(n.data[0],n.data[1]))},4,t)}function $n(s,e){e||(e={});var t=fr();t.p(s);var n=Ye(s,e,2,4);return Br(n,e),J(n,n.length-4,t.d()),n}var mn=function(){function s(e){this.v=1,ie.call(this,e)}return s.prototype.push=function(e,t){if(ie.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ie.prototype.c.call(this,t)},s}(),ni=function(){function s(e){this.ondata=e,ht([ct,Ws,function(){return[Ae,ie,mn]}],this,0,function(){var t=new mn;onmessage=Ae(t)},11)}return s}();function ri(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ut(s,e,[ct,Ws,function(){return[bt]}],function(n){return Ne(bt(n.data[0],pr(n.data[1])))},5,t)}function bt(s,e){return Ht((zs(s),s.subarray(2,-4)),e)}var si=function(){function s(e){this.G=dn,this.I=ie,this.Z=mn,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new P(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,i=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(i):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,t),this.p=null}}},s}(),va=function(){function s(e){this.G=ei,this.I=Cr,this.Z=ni,this.ondata=e}return s.prototype.push=function(e,t){si.prototype.push.call(this,e,t)},s}();function Ea(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?ti(s,e,t):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?yr(s,e,t):ri(s,e,t)}function Fa(s,e){return s[0]==31&&s[1]==139&&s[2]==8?An(s,e):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?ft(s,e):bt(s,e)}var Mr=function(s,e,t,n){for(var r in s){var i=s[r],o=e+r;i instanceof P?t[o]=[i,n]:Array.isArray(i)?t[o]=[i[0],Pt(n,i[1])]:Mr(i,o+"/",t,n)}},ns=typeof TextEncoder!="undefined"&&new TextEncoder,er=typeof TextDecoder!="undefined"&&new TextDecoder,ii=0;try{er.decode(Ie,{stream:!0}),ii=1}catch{}var oi=function(s){for(var e="",t=0;;){var n=s[t++],r=(n>127)+(n>223)+(n>239);if(t+r>s.length)return[e,de(s,t-1)];r?r==3?(n=((n&15)<<18|(s[t++]&63)<<12|(s[t++]&63)<<6|s[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):r&1?e+=String.fromCharCode((n&31)<<6|s[t++]&63):e+=String.fromCharCode((n&15)<<12|(s[t++]&63)<<6|s[t++]&63):e+=String.fromCharCode(n)}},Ta=function(){function s(e){this.ondata=e,ii?this.t=new TextDecoder:this.p=Ie}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new P(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=oi(n),i=r[0],o=r[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(i,t)},s}(),Ra=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Ke(e),this.d=t||!1)},s}();function Ke(s,e){if(e){for(var t=new P(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(ns)return ns.encode(s);for(var r=s.length,i=new P(s.length+(s.length>>1)),o=0,a=function(h){i[o++]=h},n=0;n<r;++n){if(o+5>i.length){var c=new P(o+8+(r-n<<1));c.set(i),i=c}var l=s.charCodeAt(n);l<128||e?a(l):l<2048?(a(192|l>>6),a(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|s.charCodeAt(++n)&1023,a(240|l>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|l&63)):(a(224|l>>12),a(128|l>>6&63),a(128|l&63))}return de(i,0,o)}function vr(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}else{if(er)return er.decode(s);var r=oi(s),i=r[0],o=r[1];if(o.length)throw"invalid utf-8 data";return i}}var ai=function(s){return s==1?3:s<6?2:s==9?1:0},ci=function(s,e){return e+30+te(s,e+26)+te(s,e+28)},li=function(s,e,t){var n=te(s,e+28),r=vr(s.subarray(e+46,e+46+n),!(te(s,e+8)&2048)),i=e+46+n,o=Q(s,e+20),a=t&&o==4294967295?ui(s,i):[o,Q(s,e+24),Q(s,e+42)],c=a[0],l=a[1],h=a[2];return[te(s,e+10),c,l,r,i+te(s,e+30)+te(s,e+32),h]},ui=function(s,e){for(;te(s,e)!=1;e+=4+te(s,e+2));return[In(s,e+12),In(s,e+4),In(s,e+20)]},ke=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},st=function(s,e,t,n,r,i,o,a){var c=n.length,l=t.extra,h=a&&a.length,u=ke(l);J(s,e,o!=null?33639248:67324752),e+=4,o!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(i==null&&8),s[e++]=r&&8,s[e++]=t.compression&255,s[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(J(s,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,i!=null&&(J(s,e,t.crc),J(s,e+4,i),J(s,e+8,t.size)),J(s,e+12,c),J(s,e+14,u),e+=16,o!=null&&(J(s,e,h),J(s,e+6,t.attrs),J(s,e+10,o),e+=14),s.set(n,e),e+=c,u)for(var d in l){var m=l[d],B=m.length;J(s,e,+d),J(s,e+2,B),s.set(m,e+4),e+=4+B}return h&&(s.set(a,e),e+=h),e},Er=function(s,e,t,n,r){J(s,e,101010256),J(s,e+8,t),J(s,e+10,t),J(s,e+12,n),J(s,e+16,r)},It=function(){function s(e){this.filename=e,this.c=at(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),wa=function(){function s(e,t){var n=this;t||(t={}),It.call(this,e),this.d=new Re(t,function(r,i){n.ondata(null,r,i)}),this.compression=8,this.flag=ai(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){It.prototype.push.call(this,e,t)},s}(),Da=function(){function s(e,t){var n=this;t||(t={}),It.call(this,e),this.d=new qs(t,function(r,i,o){n.ondata(r,i,o)}),this.compression=8,this.flag=ai(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){It.prototype.push.call(this,e,t)},s}(),ba=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=Ke(e.filename),r=n.length,i=e.comment,o=i&&Ke(i),a=r!=e.filename.length||o&&i.length!=o.length,c=r+ke(e.extra)+30;if(r>65535)throw"filename too long";var l=new P(c);st(l,0,e,n,a);var h=[l],u=function(){for(var B=0,g=h;B<g.length;B++){var C=g[B];t.ondata(null,C,!1)}h=[]},f=this.d;this.d=0;var p=this.u.length,d=Pt(e,{f:n,u:a,o,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),f){var B=t.u[p+1];B?B.r():t.d=1}f=1}}),m=0;e.ondata=function(B,g,C){if(B)t.ondata(B,g,C),t.terminate();else if(m+=g.length,h.push(g),C){var A=new P(16);J(A,0,134695760),J(A,4,e.crc),J(A,8,m),J(A,12,e.size),h.push(A),d.c=m,d.b=c+m+16,d.crc=e.crc,d.size=e.size,f&&d.r(),f=1}else f&&u()},this.u.push(d)},s.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,r=0,i=this.u;r<i.length;r++){var o=i[r];n+=46+o.f.length+ke(o.extra)+(o.o?o.o.length:0)}for(var a=new P(n+22),c=0,l=this.u;c<l.length;c++){var o=l[c];st(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+ke(o.extra)+(o.o?o.o.length:0),t+=o.b}Er(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},s}();function Ia(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Mr(s,"",n,e);var r=Object.keys(n),i=r.length,o=0,a=0,c=i,l=new Array(i),h=[],u=function(){for(var m=0;m<h.length;++m)h[m]()},f=function(){var m=new P(a+22),B=o,g=a-o;a=0;for(var C=0;C<c;++C){var A=l[C];try{var y=A.c.length;st(m,a,A,A.f,A.u,y);var T=30+A.f.length+ke(A.extra),v=a+T;m.set(A.c,v),st(m,o,A,A.f,A.u,y,a,A.m),o+=16+T+(A.m?A.m.length:0),a=v+y}catch(E){return t(E,null)}}Er(m,o,l.length,g,B),t(null,m)};i||f();for(var p=function(m){var B=r[m],g=n[B],C=g[0],A=g[1],y=at(),T=C.length;y.p(C);var v=Ke(B),E=v.length,M=A.comment,R=M&&Ke(M),F=R&&R.length,w=ke(A.extra),I=A.level==0?0:8,b=function(G,S){if(G)u(),t(G,null);else{var _=S.length;l[m]=Pt(A,{size:T,crc:y.d(),c:S,f:v,m:R,u:E!=B.length||R&&M.length!=F,compression:I}),o+=30+E+w+_,a+=76+2*(E+w)+(F||0)+_,--i||f()}};if(E>65535&&b("filename too long",null),!I)b(null,C);else if(T<16e4)try{b(null,_t(C,A))}catch(G){b(G,null)}else h.push($s(C,A,b))},d=0;d<c;++d)p(d);return u}function Ga(s,e){e||(e={});var t={},n=[];Mr(s,"",t,e);var r=0,i=0;for(var o in t){var a=t[o],c=a[0],l=a[1],h=l.level==0?0:8,u=Ke(o),f=u.length,p=l.comment,d=p&&Ke(p),m=d&&d.length,B=ke(l.extra);if(f>65535)throw"filename too long";var g=h?_t(c,l):c,C=g.length,A=at();A.p(c),n.push(Pt(l,{size:c.length,crc:A.d(),c:g,f:u,m:d,u:f!=o.length||d&&p.length!=m,o:r,compression:h})),r+=30+f+B+C,i+=76+2*(f+B)+(m||0)+C}for(var y=new P(i+22),T=r,v=i-r,E=0;E<n.length;++E){var u=n[E];st(y,u.o,u,u.f,u.u,u.c.length);var M=30+u.f.length+ke(u.extra);y.set(u.c,u.o+M),st(y,r,u,u.f,u.u,u.c.length,u.o,u.m),r+=16+M+(u.m?u.m.length:0)}return Er(y,r,n.length,v,T),y}var hi=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),Sa=function(){function s(){var e=this;this.i=new ie(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),La=function(){function s(e,t){var n=this;t<32e4?this.i=new ie(function(r,i){n.ondata(null,r,i)}):(this.i=new Cr(function(r,i,o){n.ondata(r,i,o)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=de(e,0)),this.i.push(e,t)},s.compression=8,s}(),xa=function(){function s(e){this.onfile=e,this.k=[],this.o={0:hi},this.p=Ie}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),i=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(i,!this.c):this.k[0].push(i),e=e.subarray(r),e.length)return this.push(e,t)}else{var o=0,a=0,c=void 0,l=void 0;this.p.length?e.length?(l=new P(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var h=l.length,u=this.c,f=u&&this.d,p=function(){var g,C=Q(l,a);if(C==67324752){o=1,c=a,d.d=null,d.c=0;var A=te(l,a+6),y=te(l,a+8),T=A&2048,v=A&8,E=te(l,a+26),M=te(l,a+28);if(h>a+30+E+M){var R=[];d.k.unshift(R),o=2;var F=Q(l,a+18),w=Q(l,a+22),I=vr(l.subarray(a+30,a+=30+E),!T);F==4294967295?(g=v?[-2]:ui(l,a),F=g[0],w=g[1]):v&&(F=-1),a+=M,d.c=F;var b,G={name:I,compression:y,start:function(){if(!G.ondata)throw"no callback";if(!F)G.ondata(null,Ie,!0);else{var S=n.o[y];if(!S)throw"unknown compression type "+y;b=F<0?new S(I):new S(I,F,w),b.ondata=function(K,$,Y){G.ondata(K,$,Y)};for(var _=0,H=R;_<H.length;_++){var L=H[_];b.push(L,!1)}n.k[0]==R&&n.c?n.d=b:b.push(Ie,!0)}},terminate:function(){b&&b.terminate&&b.terminate()}};F>=0&&(G.size=F,G.originalSize=w),d.onfile(G)}return"break"}else if(u){if(C==134695760)return c=a+=12+(u==-2&&8),o=3,d.c=0,"break";if(C==33639248)return c=a-=4,o=3,d.c=0,"break"}},d=this;a<h-4;++a){var m=p();if(m==="break")break}if(this.p=Ie,u<0){var B=o?l.subarray(0,c-12-(u==-2&&8)-(Q(l,c-16)==134695760&&4)):l.subarray(0,a);f?f.push(B,!!o):this.k[+(o==2)].push(B)}if(o&2)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function Oa(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var f=0;f<t.length;++f)t[f]()},r={},i=s.length-22;Q(s,i)!=101010256;--i)if(!i||s.length-i>65558){e("invalid zip file",null);return}var o=te(s,i+8);o||e(null,{});var a=o,c=Q(s,i+16),l=c==4294967295;if(l){if(i=Q(s,i-12),Q(s,i)!=101075792){e("invalid zip file",null);return}a=o=Q(s,i+32),c=Q(s,i+48)}for(var h=function(f){var p=li(s,c,l),d=p[0],m=p[1],B=p[2],g=p[3],C=p[4],A=p[5],y=ci(s,A);c=C;var T=function(E,M){E?(n(),e(E,null)):(r[g]=M,--o||e(null,r))};if(!d)T(null,de(s,y,y+m));else if(d==8){var v=s.subarray(y,y+m);if(m<32e4)try{T(null,ft(v,new P(B)))}catch(E){T(E,null)}else t.push(yr(v,{size:B},T))}else T("unknown compression type "+d,null)},u=0;u<a;++u)h();return n}function Ha(s){for(var e={},t=s.length-22;Q(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=te(s,t+8);if(!n)return{};var r=Q(s,t+16),i=r==4294967295;if(i){if(t=Q(s,t-12),Q(s,t)!=101075792)throw"invalid zip file";n=Q(s,t+32),r=Q(s,t+48)}for(var o=0;o<n;++o){var a=li(s,r,i),c=a[0],l=a[1],h=a[2],u=a[3],f=a[4],p=a[5],d=ci(s,p);if(r=f,!c)e[u]=de(s,d,d+l);else if(c==8)e[u]=ft(s.subarray(d,d+l),new P(h));else throw"unknown compression type "+c}return e}var Pa=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Re,AsyncDeflate:qs,deflate:$s,deflateSync:_t,Inflate:ie,AsyncInflate:Cr,inflate:yr,inflateSync:ft,Gzip:fn,AsyncGzip:es,gzip:ts,gzipSync:pn,Gunzip:dn,AsyncGunzip:ei,gunzip:ti,gunzipSync:An,Zlib:qn,AsyncZlib:ya,zlib:Ma,zlibSync:$n,Unzlib:mn,AsyncUnzlib:ni,unzlib:ri,unzlibSync:bt,compress:ts,AsyncCompress:es,compressSync:pn,Compress:fn,Decompress:si,AsyncDecompress:va,decompress:Ea,decompressSync:Fa,DecodeUTF8:Ta,EncodeUTF8:Ra,strToU8:Ke,strFromU8:vr,ZipPassThrough:It,ZipDeflate:wa,AsyncZipDeflate:Da,Zip:ba,zip:Ia,zipSync:Ga,UnzipPassThrough:hi,UnzipInflate:Sa,AsyncUnzipInflate:La,Unzip:xa,unzip:Oa,unzipSync:Ha},Symbol.toStringTag,{value:"Module"}));function fi(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let r=s,i=n,o=Math.floor((r+i)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?i=o:r=o,o=Math.floor((r+i)/2);return o}function _a(s,e,t,n){const r=[],i=[],o=[];r[0]=1;for(let a=1;a<=t;++a){i[a]=e-n[s+1-a],o[a]=n[s+a]-e;let c=0;for(let l=0;l<a;++l){const h=o[l+1],u=i[a-l],f=r[l]/(h+u);r[l]=c+h*f,c=u*f}r[a]=c}return r}function Ua(s,e,t,n){const r=fi(s,n,e),i=_a(r,n,s,e),o=new Cn(0,0,0,0);for(let a=0;a<=s;++a){const c=t[r-s+a],l=i[a],h=c.w*l;o.x+=c.x*h,o.y+=c.y*h,o.z+=c.z*h,o.w+=c.w*l}return o}function Ja(s,e,t,n,r){const i=[];for(let u=0;u<=t;++u)i[u]=0;const o=[];for(let u=0;u<=n;++u)o[u]=i.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=i.slice(0);a[0][0]=1;const c=i.slice(0),l=i.slice(0);for(let u=1;u<=t;++u){c[u]=e-r[s+1-u],l[u]=r[s+u]-e;let f=0;for(let p=0;p<u;++p){const d=l[p+1],m=c[u-p];a[u][p]=d+m;const B=a[p][u-1]/a[u][p];a[p][u]=f+d*B,f=m*B}a[u][u]=f}for(let u=0;u<=t;++u)o[0][u]=a[u][t];for(let u=0;u<=t;++u){let f=0,p=1;const d=[];for(let m=0;m<=t;++m)d[m]=i.slice(0);d[0][0]=1;for(let m=1;m<=n;++m){let B=0;const g=u-m,C=t-m;u>=m&&(d[p][0]=d[f][0]/a[C+1][g],B=d[p][0]*a[g][C]);const A=g>=-1?1:-g,y=u-1<=C?m-1:t-u;for(let v=A;v<=y;++v)d[p][v]=(d[f][v]-d[f][v-1])/a[C+1][g+v],B+=d[p][v]*a[g+v][C];u<=C&&(d[p][m]=-d[f][m-1]/a[C+1][u],B+=d[p][m]*a[u][C]),o[m][u]=B;const T=f;f=p,p=T}}let h=t;for(let u=1;u<=n;++u){for(let f=0;f<=t;++f)o[u][f]*=h;h*=t-u}return o}function ka(s,e,t,n,r){const i=r<s?r:s,o=[],a=fi(s,n,e),c=Ja(a,n,s,i,e),l=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),f=u.w;u.x*=f,u.y*=f,u.z*=f,l[h]=u}for(let h=0;h<=i;++h){const u=l[a-s].clone().multiplyScalar(c[h][0]);for(let f=1;f<=s;++f)u.add(l[a-s+f].clone().multiplyScalar(c[h][f]));o[h]=u}for(let h=i+1;h<=r+1;++h)o[h]=new Cn(0,0,0);return o}function Ka(s,e){let t=1;for(let r=2;r<=s;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=s-e;++r)n*=r;return t/n}function Na(s){const e=s.length,t=[],n=[];for(let i=0;i<e;++i){const o=s[i];t[i]=new z(o.x,o.y,o.z),n[i]=o.w}const r=[];for(let i=0;i<e;++i){const o=t[i].clone();for(let a=1;a<=i;++a)o.sub(r[i-a].clone().multiplyScalar(Ka(i,a)*n[a]));r[i]=o.divideScalar(n[0])}return r}function ja(s,e,t,n,r){const i=ka(s,e,t,n,r);return Na(i)}class rs extends qi{constructor(e,t,n,r,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new Cn(a.x,a.y,a.z,a.w)}}getPoint(e,t=new z){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=Ua(this.degree,this.knots,this.controlPoints,r);return i.w!==1&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(e,t=new z){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=ja(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}let x,X,se;class Xa extends Qe{constructor(e){super(e)}load(e,t,n,r){const i=this,o=i.path===""?Me.extractUrlBase(e):i.path,a=new Te(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(c){try{t(i.parse(c,o))}catch(l){r?r(l):console.error(l),i.manager.itemError(e)}},n,r)}parse(e,t){if(za(e))x=new Za().parse(e);else{const r=mi(e);if(!qa(r))throw new Error("THREE.FBXLoader: Unknown format.");if(is(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+is(r));x=new Wa().parse(r)}const n=new sr(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Qa(n,this.manager).parse(x)}}class Qa{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){X=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=new Va().parse(r);return this.parseScene(r,i,n),se}parseConnections(){const e=new Map;return"Connections"in x&&x.Connections.connections.forEach(function(n){const r=n[0],i=n[1],o=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:i,relationship:o};e.get(r).parents.push(a),e.has(i)||e.set(i,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(i).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in x.Objects){const n=x.Objects.Video;for(const r in n){const i=n[r],o=parseInt(r);if(e[o]=i.RelativeFilename||i.Filename,"Content"in i){const a=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,c=typeof i.Content=="string"&&i.Content!=="";if(a||c){const l=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=l}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+i+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in x.Objects){const n=x.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,i=e.WrapModeV,o=r!==void 0?r.value:0,a=i!==void 0?i.value:0;if(n.wrapS=o===0?tt:_n,n.wrapT=a===0?tt:_n,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,i=X.get(e.id).children;i!==void 0&&i.length>0&&t[i[0].ID]!==void 0&&(n=t[i[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new an):(c.setPath(this.textureLoader.path),o=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new an):o=this.textureLoader.load(n);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in x.Objects){const n=x.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],e);i!==null&&t.set(parseInt(r),i)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let i=e.ShadingModel;if(typeof i=="object"&&(i=i.value),!X.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(i.toLowerCase()){case"phong":a=new Et;break;case"lambert":a=new $i;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),a=new Et;break}return a.setValues(o),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new j().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new j().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new j().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new j().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new j().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new j().fromArray(e.SpecularColor.value));const i=this;return X.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=i.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,o.ID),r.map!==void 0&&(r.map.encoding=oe);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.encoding=oe);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=eo,r.envMap.encoding=oe);break;case"SpecularColor":r.specularMap=i.getTexture(t,o.ID),r.specularMap!==void 0&&(r.specularMap.encoding=oe);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in x.Objects&&t in x.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=X.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in x.Objects){const n=x.Objects.Deformer;for(const r in n){const i=n[r],o=X.get(parseInt(r));if(i.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(i.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,n),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const i=t[r.ID];if(i.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new N().fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const i=e.children[r],o=t[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=X.get(parseInt(i.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){se=new et;const r=this.parseModels(e.skeletons,t,n),i=x.Objects.Model,o=this;r.forEach(function(c){const l=i[c.ID];o.setLookAtProperties(c,l),X.get(c.ID).parents.forEach(function(u){const f=r.get(u.ID);f!==void 0&&f.add(c)}),c.parent===null&&se.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),se.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=di(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new Ya().parse();se.children.length===1&&se.children[0].isGroup&&(se.children[0].animations=a,se=se.children[0]),se.animations=a}parseModels(e,t,n){const r=new Map,i=x.Objects.Model;for(const o in i){const a=parseInt(o),c=i[o],l=X.get(a);let h=this.buildSkeleton(l,e,a,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,t,n);break;case"NurbsCurve":h=this.createCurve(l,t);break;case"LimbNode":case"Root":h=new Jn;break;case"Null":default:h=new et;break}h.name=c.attrName?Tt.sanitizeNodeName(c.attrName):"",h.ID=a}this.getTransformData(h,c),r.set(a,h)}return r}buildSkeleton(e,t,n,r){let i=null;return e.parents.forEach(function(o){for(const a in t){const c=t[a];c.rawBones.forEach(function(l,h){if(l.ID===o.ID){const u=i;i=new Jn,i.matrixWorld.copy(l.transformLink),i.name=r?Tt.sanitizeNodeName(r):"",i.ID=n,c.bones[h]=i,u!==null&&i.add(u)}})}}),i}createCamera(e){let t,n;if(e.children.forEach(function(r){const i=x.Objects.NodeAttribute[r.ID];i!==void 0&&(n=i)}),n===void 0)t=new Zt;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let i=1;n.NearPlane!==void 0&&(i=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const l=a/c;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new ms(h,l,i,o),u!==null&&t.setFocalLength(u);break;case 1:t=new Bs(-a/2,a/2,c/2,-c/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new Zt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const i=x.Objects.NodeAttribute[r.ID];i!==void 0&&(n=i)}),n===void 0)t=new Zt;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let i=16777215;n.Color!==void 0&&(i=new j().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new Pn(i,o,a,c);break;case 1:t=new hs(i,o);break;case 2:let l=Math.PI/3;n.InnerAngle!==void 0&&(l=ge.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=ge.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new us(i,o,a,l,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Pn(i,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,i=null,o=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(i=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Et({color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach(function(c){c.vertexColors=!0}),i.FBX_Deformer?(r=new ps(i,o),r.normalizeSkinWeights()):r=new rn(i,o),r}createCurve(e,t){const n=e.children.reduce(function(i,o){return t.has(o.ID)&&(i=t.get(o.ID)),i},null),r=new Mt({color:3342591,linewidth:1});return new As(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Ai(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&X.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const i=x.Objects.Model[r.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),se.add(e.target)):e.lookAt(new z().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const i in e){const o=e[i];X.get(parseInt(o.ID)).parents.forEach(function(c){if(t.has(c.ID)){const l=c.ID;X.get(l).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new Ms(o.bones),r[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in x.Objects){const t=x.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(i){e[i.Node]=new N().fromArray(i.Matrix.a)}):e[r.Node]=new N().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in x&&"AmbientColor"in x.GlobalSettings){const e=x.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const i=new j(t,n,r);se.add(new to(i,1))}}}}class Va{parse(e){const t=new Map;if("Geometry"in x.Objects){const n=x.Objects.Geometry;for(const r in n){const i=X.get(parseInt(r)),o=this.parseGeometry(i,n[r],e);t.set(parseInt(r),o)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,i=[],o=e.parents.map(function(u){return x.Objects.Model[u.ID]});if(o.length===0)return;const a=e.children.reduce(function(u,f){return r[f.ID]!==void 0&&(u=r[f.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&i.push(n.morphTargets[u.ID])});const c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=Ai(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const h=di(l);return this.genGeometry(t,a,i,h)}genGeometry(e,t,n,r){const i=new _e;e.attrName&&(i.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),c=new fe(a.vertex,3);if(c.applyMatrix4(r),i.setAttribute("position",c),a.colors.length>0&&i.setAttribute("color",new fe(a.colors,3)),t&&(i.setAttribute("skinIndex",new no(a.weightsIndices,4)),i.setAttribute("skinWeight",new fe(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){const l=new ro().getNormalMatrix(r),h=new fe(a.normal,3);h.applyNormalMatrix(l),i.setAttribute("normal",h)}if(a.uvs.forEach(function(l,h){let u="uv"+(h+1).toString();h===0&&(u="uv"),i.setAttribute(u,new fe(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let l=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,f){u!==l&&(i.addGroup(h,f-h,l),l=u,h=f)}),i.groups.length>0){const u=i.groups[i.groups.length-1],f=u.start+u.count;f!==a.materialIndex.length&&i.addGroup(f,a.materialIndex.length-f,l)}i.groups.length===0&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,i){r.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:i,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,o=[],a=[],c=[],l=[],h=[],u=[];const f=this;return e.vertexIndices.forEach(function(p,d){let m,B=!1;p<0&&(p=p^-1,B=!0);let g=[],C=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const A=Vt(d,n,p,e.color);c.push(A[0],A[1],A[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(A){C.push(A.weight),g.push(A.id)}),C.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const A=[0,0,0,0],y=[0,0,0,0];C.forEach(function(T,v){let E=T,M=g[v];y.forEach(function(R,F,w){if(E>R){w[F]=E,E=R;const I=A[F];A[F]=M,M=I}})}),g=A,C=y}for(;C.length<4;)C.push(0),g.push(0);for(let A=0;A<4;++A)h.push(C[A]),u.push(g[A])}if(e.normal){const A=Vt(d,n,p,e.normal);a.push(A[0],A[1],A[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Vt(d,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(A,y){const T=Vt(d,n,p,A);l[y]===void 0&&(l[y]=[]),l[y].push(T[0]),l[y].push(T[1])}),r++,B&&(f.genFace(t,e,o,m,a,c,l,h,u,r),n++,r=0,o=[],a=[],c=[],l=[],h=[],u=[])}),t}genFace(e,t,n,r,i,o,a,c,l,h){for(let u=2;u<h;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(u-1)*3]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[n[u*3]]),e.vertex.push(t.vertexPositions[n[u*3+1]]),e.vertex.push(t.vertexPositions[n[u*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(u-1)*4]),e.vertexWeights.push(c[(u-1)*4+1]),e.vertexWeights.push(c[(u-1)*4+2]),e.vertexWeights.push(c[(u-1)*4+3]),e.vertexWeights.push(c[u*4]),e.vertexWeights.push(c[u*4+1]),e.vertexWeights.push(c[u*4+2]),e.vertexWeights.push(c[u*4+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[u*4]),e.weightsIndices.push(l[u*4+1]),e.weightsIndices.push(l[u*4+2]),e.weightsIndices.push(l[u*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(u-1)*3]),e.colors.push(o[(u-1)*3+1]),e.colors.push(o[(u-1)*3+2]),e.colors.push(o[u*3]),e.colors.push(o[u*3+1]),e.colors.push(o[u*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[(u-1)*3]),e.normal.push(i[(u-1)*3+1]),e.normal.push(i[(u-1)*3+2]),e.normal.push(i[u*3]),e.normal.push(i[u*3+1]),e.normal.push(i[u*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(u-1)*2]),e.uvs[p].push(a[p][(u-1)*2+1]),e.uvs[p].push(a[p][u*2]),e.uvs[p].push(a[p][u*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const c=x.Objects.Geometry[a.geoID];c!==void 0&&i.genMorphGeometry(e,t,c,r,a.name)})})}genMorphGeometry(e,t,n,r,i){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],l=e.attributes.position.count*3,h=new Float32Array(l);for(let d=0;d<c.length;d++){const m=c[d]*3;h[m]=a[d*3],h[m+1]=a[d*3+1],h[m+2]=a[d*3+2]}const u={vertexIndices:o,vertexPositions:h},f=this.genBuffers(u),p=new fe(f.vertex,3);p.name=i||n.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return n==="IndexToDirect"&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return n==="IndexToDirect"&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];return n==="IndexToDirect"&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(rs===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new _e;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new _e;const n=t-1,r=e.KnotVector.a,i=[],o=e.Points.a;for(let u=0,f=o.length;u<f;u+=4)i.push(new Cn().fromArray(o,u));let a,c;if(e.Form==="Closed")i.push(i[0]);else if(e.Form==="Periodic"){a=n,c=r.length-1-a;for(let u=0;u<n;++u)i.push(i[u])}const h=new rs(n,r,i,a,c).getPoints(i.length*12);return new _e().setFromPoints(h)}}class Ya{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(x.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=x.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const i={id:r.id,attr:r.attrName,curves:{}};t.set(i.id,i)}}return t}parseAnimationCurves(e){const t=x.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map($a),values:t[n].KeyValueFloat.a},i=X.get(r.id);if(i!==void 0){const o=i.parents[0].ID,a=i.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=x.Objects.AnimationLayer,n=new Map;for(const r in t){const i=[],o=X.get(parseInt(r));o!==void 0&&(o.children.forEach(function(c,l){if(e.has(c.ID)){const h=e.get(c.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(i[l]===void 0){const u=X.get(c.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(u!==void 0){const f=x.Objects.Model[u.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const p={modelName:f.attrName?Tt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};se.traverse(function(d){d.ID===f.id&&(p.transform=d.matrix,d.userData.transformData&&(p.eulerOrder=d.userData.transformData.eulerOrder))}),p.transform||(p.transform=new N),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),i[l]=p}}i[l]&&(i[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(i[l]===void 0){const u=X.get(c.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID,f=X.get(u).parents[0].ID,p=X.get(f).parents[0].ID,d=X.get(p).parents[0].ID,m=x.Objects.Model[d],B={modelName:m.attrName?Tt.sanitizeNodeName(m.attrName):"",morphName:x.Objects.Deformer[u].attrName};i[l]=B}i[l][h.attr]=h}}}),n.set(parseInt(r),i))}return n}parseAnimStacks(e){const t=x.Objects.AnimationStack,n={};for(const r in t){const i=X.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new ys(e.name,-1,t)}generateTracks(e){const t=[];let n=new z,r=new Bt,i=new z;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=new gt().setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,n,r){const i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,n);return new gs(e+"."+r,i,o)}generateRotationTrack(e,t,n,r,i,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ge.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ge.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ge.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);r!==void 0&&(r=r.map(ge.degToRad),r.push(o),r=new gt().fromArray(r),r=new Bt().setFromEuler(r)),i!==void 0&&(i=i.map(ge.degToRad),i.push(o),i=new gt().fromArray(i),i=new Bt().setFromEuler(i).invert());const l=new Bt,h=new gt,u=[];for(let f=0;f<c.length;f+=3)h.set(c[f],c[f+1],c[f+2],o),l.setFromEuler(h),r!==void 0&&l.premultiply(r),i!==void 0&&l.multiply(i),l.toArray(u,f/3*4);return new Un(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(i){return i/100}),r=se.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Cs(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let i=1;i<t.length;i++){const o=t[i];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let o=-1,a=-1,c=-1;return e.forEach(function(l){if(t.x&&(o=t.x.times.indexOf(l)),t.y&&(a=t.y.times.indexOf(l)),t.z&&(c=t.z.times.indexOf(l)),o!==-1){const h=t.x.values[o];i.push(h),r[0]=h}else i.push(r[0]);if(a!==-1){const h=t.y.values[a];i.push(h),r[1]=h}else i.push(r[1]);if(c!==-1){const h=t.z.values[c];i.push(h),r[2]=h}else i.push(r[2])}),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const o=i/180,a=r/o;let c=n+a;const l=e.times[t-1],u=(e.times[t]-l)/o;let f=l+u;const p=[],d=[];for(;f<e.times[t];)p.push(f),f+=u,d.push(c),c+=a;e.times=os(e.times,t,p),e.values=os(e.values,t,d)}}}}class Wa{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new pi,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,i){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),l=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):l?t.parseNodeProperty(r,l,n[++i]):h?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,i):n in a?(n==="PoseNode"?a.PoseNode.push(i):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=i)):typeof o.id=="number"?(a[n]={},a[n][o.id]=i):n!=="Properties70"&&(n==="PoseNode"?a[n]=[i]:a[n]=i),typeof o.id=="number"&&(i.id=o.id),o.name!==""&&(i.attrName=o.name),o.type!==""&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&i===","&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,i);return}if(r==="C"){const c=i.split(",").slice(1),l=parseInt(c[0]),h=parseInt(c[1]);let u=i.split(",").slice(3);u=u.map(function(f){return f.trim().replace(/^"/,"")}),r="connections",i=[l,h],tc(i,u),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):r!=="a"?o[r]=i:o.a=i,this.setCurrentProp(o,r),r==="a"&&i.slice(-1)!==","&&(o.a=Sn(i))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Sn(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=r[0],o=r[1],a=r[2],c=r[3];let l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Sn(l);break}this.getPrevNode()[i]={type:o,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class Za{parse(e){const t=new ss(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new pi;for(;!this.endOfContent(t);){const i=this.parseNode(t,n);i!==null&&r.add(i.name,i)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const c=[];for(let f=0;f<i;f++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",h=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(n.singleProperty=i===1&&e.getOffset()===r;r>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=c,typeof l=="number"&&(n.id=l),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(i,o){o!==0&&r.push(i)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(i){t[i]=n[i]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],i=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),i==="Color"||i==="ColorRGB"||i==="Vector"||i==="Vector3D"||i.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:i,type2:o,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(i===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}typeof Pa=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=bt(new Uint8Array(e.getArrayBuffer(o))),c=new ss(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class ss{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),Me.decodeText(new Uint8Array(t))}}class pi{add(e,t){this[e]=t}}function za(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===mi(s,0,e.length)}function qa(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const i=s[r-1];return s=s.slice(t+r),t++,i}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function is(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function $a(s){return s/46186158e3}const ec=[];function Vt(s,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=s;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const i=r*n.dataSize,o=i+n.dataSize;return nc(ec,n.buffer,i,o)}const Gn=new gt,Ze=new z;function di(s){const e=new N,t=new N,n=new N,r=new N,i=new N,o=new N,a=new N,c=new N,l=new N,h=new N,u=new N,f=new N,p=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(Ze.fromArray(s.translation)),s.preRotation){const F=s.preRotation.map(ge.degToRad);F.push(s.eulerOrder),t.makeRotationFromEuler(Gn.fromArray(F))}if(s.rotation){const F=s.rotation.map(ge.degToRad);F.push(s.eulerOrder),n.makeRotationFromEuler(Gn.fromArray(F))}if(s.postRotation){const F=s.postRotation.map(ge.degToRad);F.push(s.eulerOrder),r.makeRotationFromEuler(Gn.fromArray(F)),r.invert()}s.scale&&i.scale(Ze.fromArray(s.scale)),s.scalingOffset&&a.setPosition(Ze.fromArray(s.scalingOffset)),s.scalingPivot&&o.setPosition(Ze.fromArray(s.scalingPivot)),s.rotationOffset&&c.setPosition(Ze.fromArray(s.rotationOffset)),s.rotationPivot&&l.setPosition(Ze.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(u.copy(s.parentMatrix),h.copy(s.parentMatrixWorld));const d=t.clone().multiply(n).multiply(r),m=new N;m.extractRotation(h);const B=new N;B.copyPosition(h);const g=B.clone().invert().multiply(h),C=m.clone().invert().multiply(g),A=i,y=new N;if(p===0)y.copy(m).multiply(d).multiply(C).multiply(A);else if(p===1)y.copy(m).multiply(C).multiply(d).multiply(A);else{const w=new N().scale(new z().setFromMatrixScale(u)).clone().invert(),I=C.clone().multiply(w);y.copy(m).multiply(d).multiply(I).multiply(A)}const T=l.clone().invert(),v=o.clone().invert();let E=e.clone().multiply(c).multiply(l).multiply(t).multiply(n).multiply(r).multiply(T).multiply(a).multiply(o).multiply(i).multiply(v);const M=new N().copyPosition(E),R=h.clone().multiply(M);return f.copyPosition(R),E=f.clone().multiply(y),E.premultiply(h.invert()),E}function Ai(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function Sn(s){return s.split(",").map(function(t){return parseFloat(t)})}function mi(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),Me.decodeText(new Uint8Array(s,e,t))}function tc(s,e){for(let t=0,n=s.length,r=e.length;t<r;t++,n++)s[n]=e[t]}function nc(s,e,t,n){for(let r=t,i=0;r<n;r++,i++)s[i]=e[r];return s}function os(s,e,t){return s.slice(0,e).concat(t).concat(s.slice(e))}const Ln=new WeakMap;class rc extends Qe{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const i=new Te(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const l=t.attributeTypes[c];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=l.name)}const n=JSON.stringify(t);if(Ln.has(e)){const c=Ln.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(i,o).then(c=>(r=c,new Promise((l,h)=>{r._callbacks[i]={resolve:l,reject:h},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),Ln.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new _e;e.index&&t.setIndex(new on(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],i=r.name,o=r.array,a=r.itemSize;t.setAttribute(i,new on(o,a))}return t}_loadLibrary(e,t){const n=new Te(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,i)=>{n.load(e,r,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const i=sc.toString(),o=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(i){const o=i.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,i){return r._taskLoad>i._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function sc(){let s,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":s=a.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(s)});break;case"decode":const c=a.buffer,l=a.taskConfig;e.then(h=>{const u=h.draco,f=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(c),c.byteLength);try{const d=t(u,f,p,l),m=d.attributes.map(B=>B.array.buffer);d.index&&m.push(d.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:d},m)}catch(d){console.error(d),self.postMessage({type:"error",id:a.id,error:d.message})}finally{u.destroy(p),u.destroy(f)}});break}};function t(o,a,c,l){const h=l.attributeIDs,u=l.attributeTypes;let f,p;const d=a.GetEncodedGeometryType(c);if(d===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeBufferToMesh(c,f);else if(d===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeBufferToPointCloud(c,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const m={index:null,attributes:[]};for(const B in h){const g=self[u[B]];let C,A;if(l.useUniqueIDs)A=h[B],C=a.GetAttributeByUniqueId(f,A);else{if(A=a.GetAttributeId(f,o[h[B]]),A===-1)continue;C=a.GetAttribute(f,A)}m.attributes.push(r(o,a,f,B,g,C))}return d===o.TRIANGULAR_MESH&&(m.index=n(o,a,f)),o.destroy(f),m}function n(o,a,c){const h=c.num_faces()*3,u=h*4,f=o._malloc(u);a.GetTrianglesUInt32Array(c,u,f);const p=new Uint32Array(o.HEAPF32.buffer,f,h).slice();return o._free(f),{array:p,itemSize:1}}function r(o,a,c,l,h,u){const f=u.num_components(),d=c.num_points()*f,m=d*h.BYTES_PER_ELEMENT,B=i(o,h),g=o._malloc(m);a.GetAttributeDataArrayForAllPoints(c,u,B,m,g);const C=new h(o.HEAPF32.buffer,g,d).slice();return o._free(g),{name:l,array:C,itemSize:f}}function i(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class ic{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:i,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(i,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const oc=2,ac=1,xn=new WeakMap;let On=0;class Fe extends Qe{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new ic,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new Te(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new Te(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([i,o])=>{const a=Fe.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(Fe.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Fe.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Fe.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})}),On>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),On++}return this.transcoderPending}load(e,t,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new Te(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const o=new Or;return i.load(e,a=>{if(xn.has(a))return xn.get(a).promise.then(t).catch(r);this._createTexture([a]).then(function(c){o.copy(c),o.needsUpdate=!0,t&&t(o)}).catch(r)},n,r),o}_createTextureFrom(e){const{mipmaps:t,width:n,height:r,format:i,type:o,error:a,dfdTransferFn:c,dfdFlags:l}=e;if(o==="error")return Promise.reject(a);const h=new Or(t,n,r,i,so);return h.minFilter=t.length===1?nt:or,h.magFilter=nt,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=c===oc?oe:ls,h.premultiplyAlpha=!!(l&ac),h}_createTexture(e,t={}){const n=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(i=>this._createTextureFrom(i.data));return xn.set(e[0],{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),On--,this}}Fe.BasisFormat={ETC1S:0,UASTC_4x4:1};Fe.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Fe.EngineFormat={RGBAFormat:vs,RGBA_ASTC_4x4_Format:io,RGBA_BPTC_Format:oo,RGBA_ETC2_EAC_Format:ao,RGBA_PVRTC_4BPPV1_Format:co,RGBA_S3TC_DXT5_Format:Es,RGB_ETC1_Format:Fs,RGB_ETC2_Format:lo,RGB_PVRTC_4BPPV1_Format:uo,RGB_S3TC_DXT1_Format:Ts};Fe.BasisWorker=function(){let s,e,t;const n=_EngineFormat,r=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",function(p){const d=p.data;switch(d.type){case"init":s=d.config,o(d.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:m,height:B,hasAlpha:g,mipmaps:C,format:A,dfdTransferFn:y,dfdFlags:T}=a(d.buffers[0]),v=[];for(let E=0;E<C.length;++E)v.push(C[E].data.buffer);self.postMessage({type:"transcode",id:d.id,width:m,height:B,hasAlpha:g,mipmaps:C,format:A,dfdTransferFn:y,dfdFlags:T},v)}catch(m){console.error(m),self.postMessage({type:"error",id:d.id,error:m.message})}});break}});function o(p){e=new Promise(d=>{t={wasmBinary:p,onRuntimeInitialized:d},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(p){const d=new t.KTX2File(new Uint8Array(p));function m(){d.close(),d.delete()}if(!d.isValid())throw m(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const B=d.isUASTC()?i.UASTC_4x4:i.ETC1S,g=d.getWidth(),C=d.getHeight(),A=d.getLevels(),y=d.getHasAlpha(),T=d.getDFDTransferFunc(),v=d.getDFDFlags(),{transcoderFormat:E,engineFormat:M}=u(B,g,C,y);if(!g||!C||!A)throw m(),new Error("THREE.KTX2Loader:	Invalid texture");if(!d.startTranscoding())throw m(),new Error("THREE.KTX2Loader: .startTranscoding failed");const R=[];for(let F=0;F<A;F++){const w=d.getImageLevelInfo(F,0,0),I=w.origWidth,b=w.origHeight,G=new Uint8Array(d.getImageTranscodedSizeInBytes(F,0,0,E));if(!d.transcodeImage(G,F,0,0,E,0,-1,-1))throw m(),new Error("THREE.KTX2Loader: .transcodeImage failed.");R.push({data:G,width:I,height:b})}return m(),{width:g,height:C,hasAlpha:y,mipmaps:R,format:M,dfdTransferFn:T,dfdFlags:v}}const c=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=c.sort(function(p,d){return p.priorityETC1S-d.priorityETC1S}),h=c.sort(function(p,d){return p.priorityUASTC-d.priorityUASTC});function u(p,d,m,B){let g,C;const A=p===i.ETC1S?l:h;for(let y=0;y<A.length;y++){const T=A[y];if(!!s[T.if]&&!!T.basisFormat.includes(p)&&!(B&&T.transcoderFormat.length<2)&&!(T.needsPowerOfTwo&&!(f(d)&&f(m))))return g=T.transcoderFormat[B?1:0],C=T.engineFormat[B?1:0],{transcoderFormat:g,engineFormat:C}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),g=r.RGBA32,C=n.RGBAFormat,{transcoderFormat:g,engineFormat:C}}function f(p){return p<=2?!0:(p&p-1)===0&&p!==0}};class cc extends ho{constructor(e){super(e)}parse(e,t){const n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},r=542327876,i=131072,o=512,a=1024,c=2048,l=4096,h=8192,u=16384,f=32768;function p(U){return U.charCodeAt(0)+(U.charCodeAt(1)<<8)+(U.charCodeAt(2)<<16)+(U.charCodeAt(3)<<24)}function d(U){return String.fromCharCode(U&255,U>>8&255,U>>16&255,U>>24&255)}function m(U,ae,re,ce){const we=re*ce*4,le=new Uint8Array(U,ae,we),ve=new Uint8Array(we);let me=0,xe=0;for(let We=0;We<ce;We++)for(let xr=0;xr<re;xr++){const Ri=le[xe];xe++;const wi=le[xe];xe++;const Di=le[xe];xe++;const bi=le[xe];xe++,ve[me]=Di,me++,ve[me]=wi,me++,ve[me]=Ri,me++,ve[me]=bi,me++}return ve}const B=p("DXT1"),g=p("DXT3"),C=p("DXT5"),A=p("ETC1"),y=31,T=0,v=1,E=2,M=3,R=4,F=7,w=21,I=22,b=23,G=24,S=25,_=26,H=28,L=new Int32Array(e,0,y);if(L[T]!==r)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;let K;const $=L[w];let Y=!1;switch($){case B:K=8,n.format=Ts;break;case g:K=16,n.format=fo;break;case C:K=16,n.format=Es;break;case A:K=8,n.format=Fs;break;default:if(L[I]===32&&L[b]&16711680&&L[G]&65280&&L[S]&255&&L[_]&4278190080)Y=!0,K=64,n.format=vs;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",d($)),n}n.mipmapCount=1,L[E]&i&&t!==!1&&(n.mipmapCount=Math.max(1,L[F]));const V=L[H];if(n.isCubemap=!!(V&o),n.isCubemap&&(!(V&a)||!(V&c)||!(V&l)||!(V&h)||!(V&u)||!(V&f)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=L[R],n.height=L[M];let ne=L[v]+4;const q=n.isCubemap?6:1;for(let U=0;U<q;U++){let ae=n.width,re=n.height;for(let ce=0;ce<n.mipmapCount;ce++){let we,le;Y?(we=m(e,ne,ae,re),le=we.length):(le=Math.max(4,ae)/4*Math.max(4,re)/4*K,we=new Uint8Array(e,ne,le));const ve={data:we,width:ae,height:re};n.mipmaps.push(ve),ne+=le,ae=Math.max(ae>>1,1),re=Math.max(re>>1,1)}}return n}}var lc=function(){var s="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",e="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",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};var r=s;WebAssembly.validate(t)&&(r=e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));var i,o=WebAssembly.instantiate(a(r),{}).then(function(u){i=u.instance,i.exports.__wasm_call_ctors()});function a(u){for(var f=new Uint8Array(u.length),p=0;p<u.length;++p){var d=u.charCodeAt(p);f[p]=d>96?d-71:d>64?d-65:d>47?d+4:d>46?63:62}for(var m=0,p=0;p<u.length;++p)f[m++]=f[p]<60?n[f[p]]:(f[p]-60)*64+f[++p];return f.buffer.slice(0,m)}function c(u,f,p,d,m,B){var g=i.exports.sbrk,C=p+3&-4,A=g(C*d),y=g(m.length),T=new Uint8Array(i.exports.memory.buffer);T.set(m,y);var v=u(A,p,d,y,m.length);if(v==0&&B&&B(A,C,d),f.set(T.subarray(A,A+p*d)),g(A-g(0)),v!=0)throw new Error("Malformed buffer data: "+v)}var l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:o,supported:!0,decodeVertexBuffer:function(u,f,p,d,m){c(i.exports.meshopt_decodeVertexBuffer,u,f,p,d,i.exports[l[m]])},decodeIndexBuffer:function(u,f,p,d){c(i.exports.meshopt_decodeIndexBuffer,u,f,p,d)},decodeIndexSequence:function(u,f,p,d){c(i.exports.meshopt_decodeIndexSequence,u,f,p,d)},decodeGltfBuffer:function(u,f,p,d,m,B){c(i.exports[h[m]],u,f,p,d,i.exports[l[B]])}}}(),uc=Object.defineProperty,hc=(s,e,t)=>e in s?uc(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ee=(s,e,t)=>(hc(s,typeof e!="symbol"?e+"":e,t),t);const Ct=class extends Qe{constructor(s){super(s)}load(s,e,t,n){this.path!==void 0&&(s=this.path+s),this.manager.itemStart(s),s=this.manager.resolveURL(s);const r=Hr.get(s);if(r!==void 0)return setTimeout(()=>{e&&e(r),this.manager.itemEnd(s)},0),r;const i=document.createElement("video");return i.preload=Ct.preload,i.autoplay=Ct.autoplay,i.loop=Ct.loop,i.muted=Ct.muted,i.src=s,i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.zIndex="-1",document.body.appendChild(i),i.oncanplay=()=>{Hr.add(s,i),this.manager.itemEnd(s),e&&e(i)},i.onerror=o=>{this.manager.itemEnd(s),n&&n(o)},i}};let Ut=Ct;ee(Ut,"autoplay",!0);ee(Ut,"preload","auto");ee(Ut,"muted",!0);ee(Ut,"loop",!0);var Ue=(s=>(s.BEFORELOAD="beforeLoad",s.LOADING="loading",s.DETAILLOADING="detailLoading",s.DETAILLOADED="detailLoaded",s.LOADED="loaded",s))(Ue||{});class fc extends xt{constructor(e){super(),ee(this,"resourceMap"),ee(this,"loaderMap"),ee(this,"urlList",[]),ee(this,"loadTotal"),ee(this,"loadSuccess"),ee(this,"loadError"),ee(this,"isError"),ee(this,"isLoading"),ee(this,"isLoaded"),ee(this,"loadDetailMap"),ee(this,"path",""),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new po,n=new Ut,r=new Ko;r.setDRACOLoader(new rc),r.setKTX2Loader(new Fe),r.setMeshoptDecoder(lc),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new _o,mtl:new Uo,mp4:n,webm:n,ogg:n,hdr:new ko,gltf:r,glb:r,fbx:new Xa,dds:new cc},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:"loaded",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(t=>{t.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(t=>{t.setResponseType&&t.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var t;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:"beforeLoad",urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const n=this.resourceMap,r=this.loaderMap,i=this.loadDetailMap;for(const o of e){let a,c;typeof o=="string"?(a=o,c=((t=a.split(".").pop())==null?void 0:t.toLocaleLowerCase())||""):(a=o.url,c=o.ext.toLocaleLowerCase(),c.startsWith(".")&&(c=c.slice(1)));const l={url:a,progress:0,error:!1,message:a};if(i[a]=l,n.has(a)){l.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!c){l.message=`url: ${a} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(l.message),l.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const h=r[c];if(!h){l.message=`url: ${a} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(l.message),l.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const u=a.replace(/\\/g,"/").split("/"),f=u.pop(),p=this.path+u.join("/")+"/";h.setPath(p).loadAsync(f,d=>{l.progress=Number((d.loaded/d.total).toFixed(2)),this.dispatchEvent({type:"detailLoading",detail:l})}).then(d=>{l.progress=1,this.loadSuccess+=1,this.resourceMap.set(a,d),this.urlList.push(o),this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(d=>{l.error=!0,l.message=JSON.stringify(d),this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:l}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const pc="@vis-three/plugin-loader-manager",Fr=Ii(pc),dc=function(s){return{name:Fr,install(e){const t=new fc(s);s!=null&&s.path&&t.setPath(s.path),e.loaderManager=t,e.loadResources=(n,r)=>{const i=o=>{r(void 0,o),t.removeEventListener(Ue.LOADED,i)};try{t.addEventListener(Ue.LOADED,i)}catch(o){r(o)}return t.load(n),e},e.loadResourcesAsync=n=>new Promise((r,i)=>{const o=a=>{r(a),t.removeEventListener(Ue.LOADED,o)};try{t.addEventListener(Ue.LOADED,o)}catch(a){i(a)}t.load(n)})},dispose(e){e.loaderManager.dispose(),delete e.loaderManager,delete e.loadResources,delete e.loadResourcesAsync}}};var Ac=Object.defineProperty,mc=(s,e,t)=>e in s?Ac(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,D=(s,e,t)=>(mc(s,typeof e!="symbol"?e+"":e,t),t);const Je={},as={},Tr={},vn={},Bi={},tr={},Rr=s=>Bi[s]||null,Bc=s=>vn[s],gc=s=>{const e=Rr(s);return e?Bc(e):!1},gi=function(s,e){tr[s.type]=s,Tr[s.type.toLocaleUpperCase()]=s.type,Je[s.type]=s.config,Bi[s.type]=e},Yt={proxy:{expand:void 0,timing:"before",toRaw:void 0},symbol:{generator:Rs,validator:ar}},Gt=(s,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,Ci=(s,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,tn=s=>JSON.parse(JSON.stringify(s,Gt),Ci);class Cc{constructor(e){D(this,"config"),this.config=e}pipe(e){return this.config=e(this.config),this}get(){return this.config}}var St={stringify:Gt,parse:Ci,clone:tn,Pipeline:Cc};const Be=function(s,e,t={observer:!0,strict:!0,warn:!0}){if(t.observer===void 0&&(t.observer=!0),t.strict===void 0&&(t.strict=!0),t.warn===void 0&&(t.warn=!0),t.handler===void 0&&(t.handler=Yt.proxy.expand),!Je[s])return console.error(`type: ${s} can not be found in configList.`),{vid:"",type:s};const n=(o,a)=>{for(const c in a){if(o[c]===void 0){!t.strict&&(o[c]=a[c]),t.strict&&t.warn&&console.warn(`'${s}' config can not set key: ${c}`);continue}typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?(o[c]===null&&(o[c]={...a[c]}),n(o[c],a[c])):o[c]=a[c]}};let r=Je[s]();if(r.vid===""&&(r.vid=Yt.symbol.generator()),e&&n(r,e),t.observer===!1)return r;t.handler&&Yt.proxy.timing==="before"&&(r=t.handler(r));let i=Oc(r);if(t.handler&&Yt.proxy.timing==="after"&&(i=t.handler(i)),Be.autoInject&&Be.injectEngine){const o=Be.injectEngine;if(o.applyConfig(i),Be.injectScene&&gc(r.type)&&r.type!==Tr.SCENE){let a=null;typeof Be.injectScene=="boolean"?a=o.getObjectConfig(o.scene):typeof Be.injectScene=="string"&&(a=o.getConfigBySymbol(Be.injectScene)),a?a.children.push(r.vid):console.warn("current engine scene can not found it config",o,o.scene)}return i}return i};Be.autoInject=!0;Be.injectScene=!1;Be.injectEngine=null;const yi=(s,e={})=>{let t=JSON.stringify(s,St.stringify);const n={},r=Object.keys(s).filter(o=>o!=="assets");for(const o of r)for(const a of s[o]){const c=a.vid,l=Rs();t=t.replace(new RegExp(c,"g"),l),e.detail&&(n[c]=l)}const i=JSON.parse(t,St.parse);if(e.fillName)if(typeof e.fillName=="function")for(const o of r)for(const a of i[o])a.name||(a.name=e.fillName(a));else for(const o of r)for(const a of i[o])a.name||(a.name=`${a.type}-${a.vid.slice(-2)}`);return e.detail?{config:i,detail:n}:i},wr=(s,e,t={clone:!0,assets:!1})=>{const n=t.clone?St.clone(s):s,r=t.assets?Object.keys(n):Object.keys(n).filter(i=>i!=="assets");for(const i of r)n[i].forEach((a,c,l)=>{l[c]=e(a)});return n},Mi=function(s){const e={};for(const t of Object.keys(s))for(const n of s[t])e[n.name]=n;return e},vi=function(s,e){return typeof s=="string"&&(s=JSON.parse(s,St.parse)),wr(St.clone(s),t=>(t=Be(t.type,t),e?e(t):t))};var yc={clone:yi,handler:wr,planish:Mi,observable:vi},ul=Object.freeze(Object.defineProperty({__proto__:null,clone:yi,handler:wr,planish:Mi,observable:vi,default:yc},Symbol.toStringTag,{value:"Module"}));class Mc{constructor(){D(this,"list",[]),D(this,"timer"),D(this,"time",0)}exec(e){if(e(!1))return;this.list.includes(e)||this.list.push(e);let t=0;const n=()=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const r=[];for(const i of this.list)i(!1)||r.push(i);if(r.length)if(r.length===t){for(const i of r)i(!0);this.list=[]}else t=r.length,this.list=r,n();else this.list=[]},this.time)};n()}append(e){this.list.length&&!this.list.includes(e)?this.list.push(e):this.exec(e)}nextTick(e){setTimeout(()=>{e()},this.time)}}const hl=new Mc;class Dr{constructor(){D(this,"map",new WeakMap)}create(e){if(this.map.has(e)){console.warn("object is exist.",e);return}this.map.set(e,new xt)}dispose(e){this.map.delete(e)}check(e){return this.map.has(e)}emit(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).emit(t,n)}on(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).on(t,n)}off(e,t,n){if(!this.map.has(e)){console.warn("object can not create eventDispatcher please create it",e);return}this.map.get(e).off(t,n)}}const Xe=new Dr,vc=new Dr;var fl=Object.freeze(Object.defineProperty({__proto__:null,Bus:Dr,compilerEvent:Xe,configEvent:vc},Symbol.toStringTag,{value:"Module"}));class Ec{constructor(){D(this,"condition",{})}registerModule(e){return this.condition[e]=!1,this}updateCondition(e){return typeof this.condition[e]!="undefined"&&(this.condition[e]=!0),this}reset(){Object.keys(this.condition).forEach(e=>{this.condition[e]=!1})}test(){return!Object.values(this.condition).includes(!1)}trig(){}}class Fc extends Ec{constructor(){super(),D(this,"triggerList",[])}registerModule(e){return vn[e]?super.registerModule(e):this}registerExec(e){e(!0)||this.triggerList.push(e)}trig(){const e=this.triggerList;for(const t of e)t();this.reset()}reset(){this.triggerList=[],super.reset()}}const Tc=new Fc;var Rc=(s=>(s.ADD="compiler.add",s.REMOVE="compiler.remove",s.COMPILE="compiler.compile",s.UPDATE="compiler.update",s))(Rc||{});class pl{constructor(){D(this,"MODULE",""),D(this,"processors",new Map),D(this,"target",{}),D(this,"map",new Map),D(this,"weakMap",new WeakMap),D(this,"engine"),D(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!this.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const n=this.processors.get(e.type).create(e,this.engine,this);return this.map.set(e.vid,n),this.weakMap.set(n,e.vid),Xe.create(n),Xe.emit(n,"compiler.add"),n}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!this.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const n=this.map.get(t);return this.processors.get(e.type).dispose(n,this.engine,this),this.map.delete(t),this.weakMap.delete(n),Xe.emit(n,"compiler.remove"),Xe.dispose(n),this.cacheCompile&&this.cacheCompile.vid===t&&(this.cacheCompile=void 0),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{Si(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const n=this.cacheCompile;let r,i,o;if(n&&n.vid===e)r=n.target,i=n.config,o=n.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(r=this.map.get(e),i=this.target[e],!this.processors.has(i.type))return console.warn(`PassCompiler can not support this type: ${i.type}`),this;o=this.processors.get(i.type),this.cacheCompile={target:r,config:i,processor:o,vid:e}}return o.process({config:i,target:r,engine:this.engine,processor:o,compiler:this,...t}),Xe.emit(r,`compiler.compile:${t.path.join(".")}.${t.key}`),Xe.emit(r,"compiler.update"),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!this.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}this.processors.get(e.type).dispose(t,this.engine,this)}return this.map.clear(),this.target={},this}reigstProcessor(e,t){return this.processors.has(e.type)?(console.warn(`${this.MODULE} compiler has already exist this processor ${e.type}, that will be cover.`),this):(this.processors.set(e.type,e),gi(e,this.MODULE),t(this),this)}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}}const wc=function(s,e,t){return class extends e{constructor(){super(),D(this,"MODULE",s);for(const n of t)this.processors.set(n.type,n)}}},Ei=new WeakMap,nn=function(s){Array.isArray(s)&&Ei.set(s,s.concat([]))},Dc=function(s){return Ei.get(s)},nr="vis.father",Lt="vis.key",br=function(s){let e="";const t=n=>{n[Symbol.for(Lt)]!==void 0&&(e=`${n[Symbol.for(Lt)]}${e?`.${e}`:""}`,n[Symbol.for(nr)]&&t(n[Symbol.for(nr)]))};return t(s),e},bc=function(s){if(s.length&&be(s[0])){const e=s.length;for(let t=0;t<e;t+=1)s[t][Symbol.for(Lt)]=t}},Bn=new WeakMap,Ic=["push","pop","shift","unshift","splice","sort","reverse"],yt=new WeakSet,Gc=function(s,e,t){return Array.isArray(s)&&Ic.includes(e)&&yt.add(s),Reflect.get(s,e,t)},Sc=function(s,e,t,n,r){const i=br(s);if(typeof e=="symbol"||r.isIgnore(rr(i,e)))return Reflect.set(s,e,t,n);if(be(t)&&!Bn.has(t)&&(t=gn(r,t,s)),s[e]===void 0){be(t)&&(t[Symbol.for(Lt)]=e,$e(t)&&nn(t)),$e(s)&&yt.delete(s);const a=Reflect.set(s,e,t);return $e(s)&&nn(s),r.next({operate:"add",path:i,key:e,value:t}),a}const o=Reflect.set(s,e,t);if($e(s)){if(yt.has(s)&&e==="length"){const a=Dc(s);if(!a)return console.error("array value is not be cached:",s),o;bc(s);const c=Math.abs(a.length-s.length),l=a.length>=s.length?"delete":"add",h=a.length>=s.length?s:a;let u=0,f=0;for(const p of l==="delete"?a:s){if(!h.includes(p)&&(r.next({operate:l,path:i,key:f.toString(),value:p}),u+=1,u===c))break;f+=1}return nn(s),yt.delete(s),o}else if(yt.has(s)||e==="length")return o}return r.next({operate:"set",path:i,key:e,value:t}),o},Lc=function(s,e,t){const n=br(s);if(typeof e=="symbol"||t.isIgnore(n))return Reflect.deleteProperty(s,e);const r=s[e],i=Reflect.deleteProperty(s,e);return $e(s)||t.next({operate:"delete",path:n,key:e,value:r}),i},gn=function(s,e,t){if(!be(e)||Bn.has(e))return e;const n=t?br(t):"";if(s.isIgnore(n))return e;const r={get:Gc,set:(o,a,c,l)=>Sc(o,a,c,l,s),deleteProperty:(o,a)=>Lc(o,a,s)};t&&(e[Symbol.for(nr)]=t);for(const o in e){const a=rr(n,o);if(!s.isIgnore(a)&&be(e[o])){if($e(e[o])){const c=e[o];e[o]=gn(s,e[o],e),nn(c)}else e[o]=gn(s,e[o],e);e[o][Symbol.for(Lt)]=o}}const i=new Proxy(e,r);return s.saveRaw(i,e),Bn.set(i,s),i};class xc extends lr{constructor(e,t){super(),D(this,"ignore",{}),D(this,"target"),D(this,"rawMap",new WeakMap),t&&(this.ignore=t),this.target=gn(this,e)}isIgnore(e){let t=this.ignore;for(const n of e.split(".")){if(t[n]===void 0)return!1;if(typeof t[n]=="boolean"&&t[n])return!0;t=t[n]}return!1}setIgnore(e){this.ignore=e}mergeIgnore(e){this.ignore=Object.assign(this.ignore,e)}saveRaw(e,t){this.rawMap.set(e,t)}toRaw(e){return this.rawMap.get(e)}}const Oc=function(s,e){return new xc(s,e).target},Hc=function(s){return Bn.get(s)},Pc=function(s,e,t){return Reflect.get(s,e,t)},_c=function(s,e,t,n,r){if(typeof e=="symbol")return Reflect.set(s,e,t,n);if(s[e]===void 0){const i=Reflect.set(s,e,t);return r.add(t),r.next({operate:"add",path:e,key:e,value:t}),i}else{const i=Reflect.set(s,e,t);return r.remove(t.vid),r.add(t),r.next({operate:"set",path:e,key:e,value:t}),i}},Uc=function(s,e,t){if(typeof e=="symbol")return Reflect.deleteProperty(s,e);const n=s[e],r=Reflect.deleteProperty(s,e);return t.next({operate:"delete",path:e,key:e,value:n}),t.remove(n.vid),r};class Jc extends lr{constructor(){super(),D(this,"container"),D(this,"subscriptions",new Map);const e=(t={})=>t;this.container=new Proxy(e(),{get:Pc,set:(t,n,r,i)=>_c(t,n,r,i,this),deleteProperty:(t,n)=>Uc(t,n,this)})}add(e){const t=Hc(e);if(!t){console.error("DataContainer: this config can not observer",e);return}this.subscriptions.set(t.target.vid,t.subscribe(n=>{this.next({operate:n.operate,path:rr(t.target.vid,n.path),key:n.key,value:n.value})}))}remove(e){this.subscriptions.delete(e)}}class kc{constructor(){D(this,"rule",()=>{}),D(this,"members",[])}apply(e){return this.members.includes(e)||this.members.push(e),this}cancel(e){return this.members.includes(e)&&this.members.splice(this.members.indexOf(e),1),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;for(const n of this.members)t(e,n);return this}}class Kc{constructor(e,t=[]){D(this,"MODULE",""),D(this,"dataContainer",new Jc),D(this,"translater"),this.translater=new kc().setRule(e),this.dataContainer.subscribe(n=>{this.translater.translate(n)});for(const n of t)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(e){return Boolean(this.dataContainer.container[e])}addConfig(e){return this.dataContainer.container[e.vid]=e,this}getConfig(e){return this.dataContainer.container[e]}removeConfig(e){const t=this.dataContainer.container;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.dataContainer.container),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),Gt):JSON.stringify(Object.values(this.dataContainer.container),Gt)}exportConfig(e=!0){if(e){const t=this.dataContainer.container,n=[],r={},i=(o,a,c={})=>{for(const l in o){if(["vid","type"].includes(l)){c[l]=o[l];continue}if(typeof o[l]=="object"&&o[l]!==null){if(Array.isArray(o[l])){if(!o[l].length)continue;c[l]=o[l].map(h=>typeof h=="object"&&h!==null?tn(h):h);continue}c[l]={},a[l]?(i(o[l],a[l],c[l]),Object.keys(c[l]).length===0&&delete c[l]):c[l]=tn(o[l])}else a[l]!==o[l]&&(c[l]=o[l])}};for(const o of Object.values(t)){if(!r[o.type]){if(!Je[o.type]){console.error(`can not font some config with: ${o.type}`);continue}r[o.type]=Je[o.type]()}const a={};i(o,r[o.type],a),n.push(a)}return n}else return Object.values(tn(this.dataContainer.container))}load(e){const t=this.dataContainer.container,n={},r=(i,o)=>{for(const a in o)typeof i[a]=="object"&&i[a]!==null&&typeof o[a]=="object"&&o[a]!==null?r(i[a],o[a]):i[a]===void 0&&(i[a]=o[a])};for(const i of e){if(!n[i.type]){if(!Je[i.type]){console.error(`can not font some config with: ${i.type}`);continue}n[i.type]=Je[i.type]()}r(i,n[i.type]),t[i.vid]=i}return this}remove(e){const t=this.dataContainer.container;for(const n of e)t[n.vid]!==void 0&&delete t[n.vid];return this}}const Nc=function(s,e){return class extends Kc{constructor(t=[]){super(e,t),D(this,"MODULE",s)}}};class jc{constructor(e){D(this,"type"),D(this,"config"),D(this,"commands"),D(this,"create"),D(this,"dispose"),this.type=e.type,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose,this.config=()=>{const t=e.config();return t.type=this.type,t},Tr[this.type.toLocaleUpperCase()]=this.type,Je[this.type]=this.config}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const n of[].concat(e.path,e.key))if(!t[n]&&!t.$reg){this[e.operate](e);return}else if(t[n])if(typeof t[n]=="function"){t[n](e);return}else t=t[n];else if(t.$reg){for(const r of t.$reg)if(r.reg.test(n)){r.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const n=e.path;for(const r of n)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const n=e.path;for(const r of n)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const n=e.path;for(const r of n)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}expand(e){const t=function(n,r){for(const i in r)be(r[i])&&be(n[i])?t(n[i],r[i]):(be(r[i])&&!n[i]||!be(r[i])&&!n[i])&&(n[i]=r[i])};return this.commands||(this.commands={}),t(this.commands,e),this}}const dl=s=>new jc(s),Al=(s,e,t=ar)=>{const{operate:n,key:r,path:i,value:o}=s;let a=r;const c=i.split(".");if(c.length&&(a=c.shift()),!t(a)){console.warn(`${e.MODULE} Rule: vid is illeage: ${a}`);return}if(n==="add"&&!c.length&&a===r){e.add(o);return}if(s.operate==="delete"&&!c.length){e.remove(o);return}if(s.operate==="set"&&!c.length&&r===a){e.cover(o);return}e.compile(a,{operate:n,key:r,path:c,value:o})},ml=function(){return{vid:"",type:"",name:""}},Bl=function(s){return`DEFUALT-${s}`},gl=function(){};class Xc extends xt{constructor(){super(),D(this,"compilerMap",new Map)}extend(e,t=!1){this.compilerMap.has(e.MODULE)?(console.warn("compiler manager has exist this compiler",e),t&&this.compilerMap.set(e.MODULE,e)):this.compilerMap.set(e.MODULE,e)}getCompiler(e){return this.compilerMap.has(e)?this.compilerMap.get(e):(console.warn(`can not found this type in compiler manager: ${e}`),null)}getObjectSymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectSymbol(e);if(n)return n}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectBySymbol(e);if(n)return n}return null}getObjectfromModule(e,t){return this.compilerMap.has(e)?this.compilerMap.get(e).map.get(t)||null:(console.warn(`compiler manager can not found this module: ${e}`),null)}getObjectfromModules(e,t){Array.isArray(e)||(e=Object.keys(e));for(const n of e){if(!this.compilerMap.has(n)){console.warn(`compiler manager can not found this module: ${n}`);continue}const r=this.compilerMap.get(n);if(r.map.has(t))return r.map.get(t)}return null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Ir="CompilerManagerPlugin",Qc=function(){return{name:Ir,install(s){const e=new Xc;s.compilerManager=e,s.getObjectSymbol=function(t){return e.getObjectSymbol(t)},s.getObjectBySymbol=function(t){return e.getObjectBySymbol(t)},s.getObjectfromModule=function(t,n){return e.getObjectfromModule(t,n)},s.getObjectfromModules=function(t,n){return e.getObjectfromModules(t,n)},s.getObject3D=function(t){return e.getObjectfromModules(vn,t)}},dispose(s){s.compilerManager.dispose(),delete s.compilerManager,delete s.getObjectSymbol,delete s.getObjectBySymbol,delete s.getObjectfromModule,delete s.getObjectfromModules,delete s.getObject3D}}};class Vc extends xt{constructor(){super(),D(this,"dataSupportMap",new Map)}extend(e,t=!1){this.dataSupportMap.has(e.MODULE)?(console.warn("dataSupport manager has exist this dataSupport",e),t&&this.dataSupportMap.set(e.MODULE,e)):this.dataSupportMap.set(e.MODULE,e)}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const n of t){const r=n.getConfig(e);if(r)return r}return null}removeConfigBySymbol(...e){for(const t of e)for(const n of this.dataSupportMap.values())if(n.existSymbol(t)){n.removeConfig(t);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const n of t)if(n.existSymbol(e))return n.MODULE;return null}applyConfig(...e){for(const t of e){const n=Rr(t.type);n?this.dataSupportMap.get(n).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}load(e){return this.dataSupportMap.forEach((n,r)=>{e[r]&&n.load(e[r])}),this}loadByModule(e,t){const n=this.dataSupportMap.get(t);return n?(n.load(e),this):(console.warn(`DataSupportManager can not support this module: ${t}`),this)}remove(e){return this.dataSupportMap.forEach((n,r)=>{e[r]&&n.remove(e[r])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),Gt)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((r,i)=>{e[i]=r.exportConfig(t)}),e}}const En="DataSupportManagerPlugin",Yc=function(){return{name:En,install(s){const e=new Vc;s.dataSupportManager=e,s.applyConfig=function(...t){return e.applyConfig(...t),s},s.getConfigBySymbol=function(t){return e.getConfigBySymbol(t)},s.removeConfigBySymbol=function(...t){return e.removeConfigBySymbol(...t),s},s.toJSON=function(){return e.toJSON()},s.exportConfig=function(){return e.exportConfig()}},dispose(s){delete s.dataSupportManager,delete s.applyConfig,delete s.getConfigBySymbol,delete s.removeConfigBySymbol,delete s.toJSON,delete s.exportConfig}}};var Gr=(s=>(s.MAPPED="mapped",s))(Gr||{});class Wc extends xt{constructor(e={}){super(),D(this,"configMap",new Map),D(this,"resourceMap",new Map),D(this,"paserMap",new Map);const t=new Map;for(const n in e)t.has(n)&&console.warn(`resourceManager construct params rescource already exist: ${n}, that will be cover.`),t.set(n,e[n]);this.mappingResource(t)}addParser(e){return this.paserMap.has(e.constructor)?this:(this.paserMap.set(e.constructor,e),this)}mappingResource(e,t){const n=this.configMap,r=this.resourceMap,i=[...this.paserMap.values()],o={};for(const[a,c]of e.entries()){if((t==null?void 0:t.parser)&&t.parser[a]){t.parser[a].parse({url:a,resource:c,configMap:n,resourceMap:r});continue}if((t==null?void 0:t.selector)&&t.selector[a]){const h=t.selector[a](a,c,this.paserMap);if(!h){console.warn("resource manager hanlder can not found this resource parser: ",c,t.selector[a]);continue}h.parse({url:a,resource:c,configMap:n,resourceMap:r}),o[a]=this.getResourceConfig(a);continue}let l=null;for(const h of i)if(l=h.selector(a,c,this.paserMap),l)break;if(!l){console.warn("resouce manager can not found some handler to parser this resource:",c);continue}l.parse({url:a,resource:c,configMap:n,resourceMap:r}),o[a]=this.getResourceConfig(a)}return this.dispatchEvent({type:"mapped",configMap:n,resourceMap:r,resourceConfig:o}),this}getResourceConfig(e){const t=this.configMap,n={};return[...t.keys()].filter(r=>r.startsWith(e)).forEach(r=>{const i=t.get(r);if(!i)console.error(`unknow error: can not found config by url: ${r}`);else{const o=Rr(i.type);o?(!n[o]&&(n[o]=[]),n[o].push(i)):console.error(`unknow error: can not found module by type: ${i.type}`,i)}}),n}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,n=this.resourceMap;return[...t.keys()].filter(r=>r.startsWith(e)).forEach(r=>{t.delete(r);const i=n.get(r);i.dispose&&i.dispose(),n.delete(r)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}class Cl{}const Fi="ResourceManagerPlugin",Zc=function(s={}){return{name:Fi,install(e){const t=new Wc(s.resources);e.resourceManager=t,e.registerResources=n=>{const r=new Map;return Object.keys(n).forEach(i=>{r.set(i,n[i])}),t.mappingResource(r),e}},dispose(e){e.addEventListener(Li.DISPOSE,()=>{e.resourceManager.dispose()})}}},zc="LoaderDataSupportStrategy",qc=function(){let s,e;return{name:zc,condition:[En,Fr],exec(t){s=t.toJSON,t.toJSON=function(){const n={assets:JSON.parse(t.loaderManager.toJSON())};return t.dataSupportManager.toJSON(n)},e=t.exportConfig,t.exportConfig=function(){let n={};return n={assets:t.loaderManager.exportConfig()},t.dataSupportManager.exportConfig(n)}},rollback(t){t.toJSON=s,t.exportConfig=e}}},$c="LoaderMappingStrategy",el=function(){let s,e;return{name:$c,condition:[Fi,Fr],exec(t){s=t.loadResources,t.loadResources=(n,r)=>{const i=o=>{r(void 0,o),t.resourceManager.removeEventListener(Ue.LOADED,i)};try{t.resourceManager.addEventListener(Ue.LOADED,i)}catch(o){r(o)}return t.loaderManager.reset().load(n),t},e=t.loadResourcesAsync,t.loadResourcesAsync=n=>new Promise((r,i)=>{try{t.loaderManager.once(Ue.LOADED,o=>{t.resourceManager.once(Gr.MAPPED,c=>{r(c)});const a=new Map;n.forEach(c=>{typeof c=="string"?a.set(c,o.resourceMap.get(c)):a.set(c.url,o.resourceMap.get(c.url))}),t.resourceManager.mappingResource(a)})}catch(o){i(o)}t.loaderManager.reset().load(n)})},rollback(t){t.loadResources=s,t.loadResourcesAsync=e}}},tl="CompilerSupportStrategy",nl=function(){return{name:tl,condition:[Ir,En],exec(s){s.compilerManager.compilerMap.forEach((e,t)=>{var n;e.useEngine(s),(n=s.dataSupportManager.dataSupportMap.get(t))==null||n.addCompiler(e)})},rollback(){}}};var rl=(s=>(s[s.ZERO=0]="ZERO",s[s.ONE=100]="ONE",s[s.TWO=200]="TWO",s[s.THREE=300]="THREE",s[s.FOUR=400]="FOUR",s[s.FIVE=500]="FIVE",s[s.SIX=600]="SIX",s[s.SEVEN=700]="SEVEN",s[s.EIGHT=800]="EIGHT",s[s.NINE=900]="NINE",s))(rl||{});class yl extends Gi{constructor(){super(),D(this,"moduleLifeCycle",[]),D(this,"moduleTriggers",[Tc]),D(this,"processorExpands",[]),this.install(dc()).install(Ao()).install(mo()).install(Bo()).install(Zc()).install(Yc()).install(Qc()),this.exec(qc()).exec(el()).exec(nl())}loadLifeCycle(e){const t=this.dataSupportManager,n=this.moduleTriggers,r=this.moduleLifeCycle.sort((i,o)=>i.order-o.order);for(const{module:i}of r){e[i]&&t.loadByModule(e[i],i);for(const o of n)o.updateCondition(i),o.test()&&o.trig()}}removeLifeCycle(e){const t=this.dataSupportManager,n=this.moduleLifeCycle.sort((a,c)=>c.order-a.order);for(const{module:a}of n)e[a]&&t.remove({[a]:e[a]});const r=e.assets||[],i=this.resourceManager,o=this.loaderManager;r.forEach(a=>{i.remove(a),o.remove(a)})}loadConfig(e,t){const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),e.assets&&e.assets.length){const r=i=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",r),t&&t(i),n?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",r),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),n?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e,t){return new Promise((n,r)=>{const i=this.renderManager.hasRendering();i&&this.renderManager.stop(),e.assets&&e.assets.length?this.loadResourcesAsync(e.assets).then(o=>{delete e.assets,this.loadLifeCycle(e),i?this.renderManager.play():this.renderManager.render(),n(o)}):(this.loadLifeCycle(e),i?this.renderManager.play():this.renderManager.render(),n({type:Gr.MAPPED,configMap:this.resourceManager.configMap,resourceMap:this.resourceManager.resourceMap,resourceConfig:{}}))})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}registModule(e){if(as[e.type.toLocaleUpperCase()])return console.warn(`module ${e.type} is already exist.`),this;as[e.type.toLocaleUpperCase()]=e.type,e.object&&(vn[e.type]=!0);const t=Nc(e.type,e.rule),n=wc(e.type,e.compiler,e.processors);for(const o of e.processors)gi(o,e.type);const r=new n,i=new t([]);this.dataSupportManager.extend(i),this.compilerManager.extend(r),r.useEngine(this),i.addCompiler(r),e.extend&&e.extend(this),e.processors.forEach(o=>{}),e.expand&&this.processorExpands.push(...e.expand);for(const o of this.processorExpands)Array.isArray(o.processors)?Object.values(tr).forEach(a=>{o.processors.includes(a.type)&&a.expand(o.command)}):Object.values(tr).forEach(a=>{o.processors.test(a.type)&&a.expand(o.command)});return this.moduleLifeCycle.push({module:e.type,order:e.lifeOrder||0}),this.moduleTriggers.forEach(o=>{o.registerModule(e.type)}),this}}const Ce=class{static generateConfig(s,e){if(!Ce.configLibrary.has(s))return console.warn(`event library can not found config by name: ${s}`),{name:""};const t=(r,i)=>{for(const o in i)r[o]!==void 0&&(typeof i[o]=="object"&&i[o]!==null&&!Array.isArray(i[o])?t(r[o],i[o]):r[o]=i[o])},n=JSON.parse(JSON.stringify(Ce.configLibrary.get(s)));return t(n,e),n}static generateScript(s,e,t,n){return Ce.generatorLibrary.has(n.name)?Ce.generatorLibrary.get(n.name)(s,e,t,n):(console.error(`event library can not found generator by name: ${n.name}`),()=>{})}static has(s){return Ce.configLibrary.has(s)}};let Sr=Ce;D(Sr,"configLibrary",new Map);D(Sr,"generatorLibrary",new Map);D(Sr,"register",function({config:s,generator:e}){return Ce.configLibrary.has(s.name)?(console.warn(`EventLibrary has already exist this event generator: ${s.name}, that will be cover.`),Ce):(Ce.configLibrary.set(s.name,JSON.parse(JSON.stringify(s))),Ce.generatorLibrary.set(s.name,e),Ce)});const ye=class{static generateConfig(s,e){if(!ye.configLibrary.has(s))return console.warn(`event library can not found config by name: ${s}`),{name:""};const t=(r,i)=>{for(const o in i)typeof i[o]=="object"&&i[o]!==null&&!Array.isArray(i[o])?t(r[o],i[o]):r[o]=i[o]},n=JSON.parse(JSON.stringify(ye.configLibrary.get(s)));return t(n,e),n}static generateEvent(s,e){return ye.generatorLibrary.has(s.name)?ye.generatorLibrary.get(s.name)(e,s):(console.error(`event library can not found generator by name: ${s.name}`),()=>{})}static has(s){return ye.configLibrary.has(s)}};let Lr=ye;D(Lr,"configLibrary",new Map);D(Lr,"generatorLibrary",new Map);D(Lr,"register",function({config:s,generator:e}){return ye.configLibrary.has(s.name)?(console.warn(`EventGeneratorManager has already exist this event generator: ${s.name}, that will be cover.`),ye):(ye.configLibrary.set(s.name,JSON.parse(JSON.stringify(s))),ye.generatorLibrary.set(s.name,e),ye)});const Pe=class{static getShader(s){return Pe.library.has(s)?Pe.cloneShader(Pe.library.get(s)):(console.warn(`con not found shader in shader library: ${s}`),null)}static generateConfig(s,e){if(!Pe.library.has(s))return console.warn(`con not found shader in shader library: ${s}`),{shader:s,uniforms:{}};const t=Pe.library.get(s),n={shader:s,uniforms:{}};if(t.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(t.uniforms))),e){const r=(i,o)=>{for(const a in o)i[a]!==void 0&&(typeof o[a]=="object"&&o[a]!==null&&!Array.isArray(o[a])?(i[a]===null&&(i[a]={...o[a]}),r(i[a],o[a])):i[a]=o[a])};r(n.uniforms,e)}return n}static cloneShader(s){const e={name:s.name};return s.vertexShader&&(e.vertexShader=s.vertexShader),s.fragmentShader&&(e.fragmentShader=s.fragmentShader),s.uniforms&&(e.uniforms=JSON.parse(JSON.stringify(s.uniforms))),e}};let Ti=Pe;D(Ti,"library",new Map);D(Ti,"register",function(s){Pe.library.has(s.name)&&console.warn(`shader library has exist shader: ${s.name} that will be cover.`),Pe.library.set(s.name,s)});const Ml=[Ir,En];export{Sr as A,fl as B,pl as C,En as D,yl as E,as as M,vn as O,Ml as P,Al as R,rl as S,Ir as a,Tr as b,Cl as c,dl as d,Je as e,Rs as f,Be as g,ml as h,hl as i,gl as j,Lr as k,Tc as l,Rc as m,Ti as n,Oc as o,Hc as p,ul as t,Bl as u,ar as v};
