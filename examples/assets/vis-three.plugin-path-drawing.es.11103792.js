import{t as p,b,a as S}from"./index.f2ecf0d4.js";import{S as E,a as h,T as y,g as P}from"./index.4918a762.js";import{b as x}from"./index.1a70533e.js";import{a as m,D as u,d as O,u as d,M as T,b as w}from"./vis-three.middleware.es.03da49c0.js";import{a as N}from"./vis-three.plugin-pointer-manager.es.d581852e.js";import{O as C,bJ as L,q as l,M as F,b2 as v,a5 as R,w as A,Q as f}from"./three.9c0f0dc6.js";const _="@vis-three/plugin-selection-support",B=p(_),Z=function(){return{name:B,deps:[E,m,u],install(a){a.setSelectionBoxBySymbol=function(t){this.selectionBox.clear();for(const n of t){const e=a.getObjectBySymbol(n);e?this.selectionBox.add(e):console.warn(`can not found object by: ${n}`)}return a.dispatchEvent({type:h,objects:Array.from(this.selectionBox),objectSymbols:t}),this}},dispose(a){delete a.setSelectionBoxBySymbol}}},D="@vis-three/strategy-trans-select-event-support",g=p(D),J=function(){let a,t,n;return{name:g,condition:[E,B,x,y,m,u],exec(e){const c=()=>{const r=[];e.selectionBox.forEach(o=>{const s=e.compilerManager.getObjectSymbol(o);s?r.push(s):console.warn(`${g} can not font vid in compilerManager.`,o)}),e.dispatchEvent({type:h,objects:Array.from(e.selectionBox),objectSymbols:r})};a=e.setSelectionBox,e.setSelectionBox=function(r){this.selectionBox.clear();for(const o of r)this.selectionBox.add(o);return c(),this},e.eventManager.addFilterObject(e.transformControls),t=r=>{if(e.transing){e.transing=!1;return}const o=r.intersections;if(r.ctrlKey||e.selectionBox.clear(),e.eventManager.penetrate)for(const s of o){if(r.ctrlKey&&e.selectionBox.has(s.object)){e.selectionBox.delete(s.object);continue}e.selectionBox.add(s.object)}else if(o.length){const s=o[0].object;if(r.ctrlKey&&e.selectionBox.has(s)){e.selectionBox.delete(s);return}e.selectionBox.add(s)}c()},e.eventManager.addEventListener("click",t),n=r=>{e.transformControls.setAttach(...r.objects)},e.addEventListener(h,n)},rollback(e){e.setSelectionBox=a,e.eventManager.removeFilterObject(e.transformControls),e.eventManager.removeEventListener("click",t),e.eventManager.removeEventListener(h,n)}}},I="@vis-three/strategy-transform-controls-support",M="TransformControls",j=function(){return{vid:d(M),type:"",axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}};var G=O({type:M,config:j,commands:{set:{snapAllow({target:a,config:t,value:n}){n?(a.translationSnap=t.translationSnap,a.rotationSnap=t.rotationSnap,a.scaleSnap=t.scaleSnap):(a.translationSnap=null,a.rotationSnap=null,a.scaleSnap=null)},translationSnap({target:a,config:t,value:n}){t.snapAllow&&(a.translationSnap=n)},rotationSnap({target:a,config:t,value:n}){t.snapAllow&&(a.rotationSnap=n)},scaleSnap({target:a,config:t,value:n}){t.snapAllow&&(a.scaleSnap=n)}}},create(a,t){let n=t.transformControls;return a.snapAllow&&(n.translationSnap=a.translationSnap,n.rotationSnap=a.rotationSnap,n.scaleSnap=a.scaleSnap),n},dispose(a){a.dispose()}});const U=p(I),tt=function(){return{name:U,condition:[m,u,y],exec(a){a.compilerManager.getCompiler(T.CONTROLS).reigstProcessor(G,r=>{r.map.set(d(w.TRNASFORMCONTROLS),a.transformControls),r.weakMap.set(a.transformControls,d(w.ORBITCONTROLS))});const n=r=>{const o=a.compilerManager.getObjectSymbol(r);return o?a.dataSupportManager.getConfigBySymbol(o):null};let e=null,c;a.transformControls.addEventListener(P.CHANGED,r=>{const o=r;o.transObjectSet.forEach(s=>{e=n(s),c=o.mode,e&&(e[c].x=s[c].x,e[c].y=s[c].y,e[c].z=s[c].z)})})},rollback(){}}};var W=Object.defineProperty,k=(a,t,n)=>t in a?W(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,i=(a,t,n)=>(k(a,typeof t!="symbol"?t+"":t,n),n);const V="@vis-three/plugin-path-drawing";class z extends b{constructor(t){super(),i(this,"camera",new C(-window.innerWidth,window.innerWidth,window.innerHeight,-window.innerHeight,0,1e4)),i(this,"plane",new L(new l(0,0,1),0)),i(this,"boardOffset",20),i(this,"drawingBoard",new F(new v(150,150),new R({transparent:!0,opacity:.2,color:"rgb(64, 255, 242)"}))),i(this,"relativeMatrixInvert",new A),i(this,"engine"),i(this,"cachePoint",new l),i(this,"cacheRelativePoint",new l),i(this,"begun",!1),i(this,"setScene",n=>{this.drawingBoard.parent&&n.scene.add(this.drawingBoard)}),i(this,"cacheBeginWriteFun",n=>{const e=this.engine.pointerManager;this.cacheWriteFun(n),e.addEventListener("mousedown",this.cacheWriteFun),e.addEventListener("pointermove",this.cacheMoveFun),e.removeEventListener("mousedown",this.cacheBeginWriteFun),this.begun=!0}),i(this,"cacheWriteFun",n=>{const e=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!e){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"write",point:e,relativePoint:this.cacheRelativePoint.copy(e).applyMatrix4(this.relativeMatrixInvert)})}),i(this,"cacheMoveFun",n=>{const e=this.engine.pointerManager.intersectPlane(this.camera,this.plane,this.cachePoint);if(!e){console.warn("path sketcher can not intersect point in this plane and this camera");return}this.dispatchEvent({type:"move",point:e,relativePoint:this.cacheRelativePoint.copy(e).applyMatrix4(this.relativeMatrixInvert)})}),this.engine=t,this.drawingBoard.raycast=()=>{},this.drawingBoard.matrixAutoUpdate=!1,this.setDrawingBoardMatrix(),t.addEventListener(S.SETSCENE,this.setScene)}setDraingBoardSize(t,n){const e=new v(t,n);this.drawingBoard.geometry.copy(e),e.dispose()}offsetCamera(t){const n=t.length();return t.normalize().applyQuaternion(new f().setFromUnitVectors(new l(0,1,0),this.plane.normal)),this.camera.position.copy(this.plane.normal).multiplyScalar(this.plane.constant).add(t.multiplyScalar(n)),this.camera.zoom=(this.camera.top-this.camera.bottom)/(this.drawingBoard.geometry.parameters.height+this.boardOffset),this.camera.updateProjectionMatrix(),this.drawingBoard.position.add(t),this.drawingBoard.updateMatrix(),this.drawingBoard.updateMatrixWorld(!0),this}setRelativeObject(t){return this.relativeMatrixInvert.copy(t.matrixWorld).invert(),this}setDrawPlane(t,n=0){return this.plane.set(t,n),this.setDrawingBoardMatrix(),this}setDrawPlaneByFace(t){return this.plane.setFromCoplanarPoints(t.a,t.b,t.c),this.setDrawingBoardMatrix(),this}setDrawingBoardMatrix(){const t=this.drawingBoard;t.position.copy(this.plane.normal).multiplyScalar(this.plane.constant),t.applyQuaternion(new f().setFromUnitVectors(new l(0,0,1),this.plane.normal)),t.updateMatrix(),t.updateMatrixWorld(!0)}dispose(){this.drawingBoard.removeFromParent(),this.drawingBoard.geometry.dispose(),this.drawingBoard.material.dispose(),this.engine.removeEventListener(S.SETSCENE,this.setScene)}showDrawingBoard(t){return t?this.engine.scene.add(this.drawingBoard):this.engine.scene.remove(this.drawingBoard),this}setSketcherByPlane(t=new l(0,0,1),n=0,e=new l(0,50,0)){return this.setDrawPlane(t,n).offsetCamera(e)}setSketcherByFace(t,n=new l(0,50,0)){return this.setDrawPlaneByFace(t).offsetCamera(n)}setSketcherByFaceAndObject(t,n){const e=new l().setFromMatrixPosition(n.matrixWorld);return this.setRelativeObject(n),this.setSketcherByFace(t,e)}changeToDrawingView(){return this.engine.setCamera(this.camera),this}beginDraw(){return this.dispatchEvent({type:"begin"}),this.begun=!1,this.engine.pointerManager.addEventListener("mousedown",this.cacheBeginWriteFun),this}endDraw(t=!0){const n=this.engine.pointerManager;return n.removeEventListener("mousedown",this.cacheWriteFun),n.removeEventListener("pointermove",this.cacheMoveFun),this.dispatchEvent({type:"end"}),t&&(this.begun||this.engine.pointerManager.removeEventListener("mousedown",this.cacheBeginWriteFun),this.removeEvent("begin"),this.removeEvent("write"),this.removeEvent("move"),this.removeEvent("end")),this.begun=!1,this}}const $=p(V),et=function(){return{name:$,deps:[N],install(a){const t=new z(a);a.pathSketcher=t},dispose(a){a.pathSketcher.dispose(),delete a.pathSketcher}}};export{et as P,Z as S,J as T,tt as a};
