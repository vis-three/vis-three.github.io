import{t as x,a as n}from"./index.f2ecf0d4.js";import{W as D}from"./three.9c0f0dc6.js";const I="@vis-three/plugin-webgl-renderer",N=x(I),P=function(G){let E,a,R;return{name:N,install(t){t.webGLRenderer=new D(G);const r=t.webGLRenderer.domElement;r.style.position="absolute",r.style.top="0",r.style.left="0",r.classList.add("vis-webgl"),t.getScreenshot=async function(e={}){const o={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!e.width&&(e.width=this.dom.offsetWidth),!e.height&&(e.height=this.dom.offsetHeight),!e.mine&&(e.mine="image/png");let h="";const L=this.webGLRenderer.getContext(),d=L.getParameter(L.MAX_RENDERBUFFER_SIZE)/4;if(e.width>d||e.height>d){const f=[],u=Math.ceil(e.width/d),S=Math.ceil(e.height/d),c=e.width/u,w=e.height/S,l=document.createElement("canvas");l.setAttribute("width",e.width.toString()),l.setAttribute("height",e.height.toString());const b=l.getContext("2d");if(!b)return console.warn("can not support canvas 2d;"),h;this.setSize(c,w);for(let i=0;i<u;i+=1)for(let s=0;s<S;s+=1)f.push({x:c*i,y:w*s});const g=[];f.forEach(i=>{this.camera.setViewOffset(e.width,e.height,i.x,i.y,c,w),this.webGLRenderer.render(this.scene,this.camera);const s=this.webGLRenderer.domElement.toDataURL(e.mine);g.push(new Promise((v,W)=>{const m=new Image;m.src=s,m.onload=()=>{b.drawImage(m,i.x,i.y,c,w),v(null)}}))}),this.setSize(o.width,o.height),await Promise.all(g).catch(i=>{console.warn(i)}),h=l.toDataURL(e.mine),this.camera.clearViewOffset()}else this.setSize(e.width,e.height),this.webGLRenderer.render(this.scene,this.camera),h=this.webGLRenderer.domElement.toDataURL(e.mine),this.setSize(o.width,o.height);return h},E=e=>{e.dom.appendChild(t.webGLRenderer.domElement)},t.addEventListener(n.SETDOM,E),a=e=>{t.webGLRenderer.setSize(e.width,e.height,!0)},t.addEventListener(n.SETSIZE,a),R=()=>{t.webGLRenderer.render(t.scene,t.camera)},t.addEventListener(n.RENDER,R)},dispose(t){t.removeEventListener(n.SETDOM,E),t.removeEventListener(n.SETSIZE,a),t.removeEventListener(n.RENDER,R),t.webGLRenderer.dispose(),delete t.webGLRenderer,delete t.getScreenshot}}};export{P as W,N as a};
