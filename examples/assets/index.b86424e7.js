var M=Object.defineProperty;var k=(s,e,o)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var t=(s,e,o)=>(k(s,typeof e!="symbol"?e+"":e,o),o);import{t as f,a as h}from"./index.202ebdec.js";import{a as L,b as u}from"./index.e6be8a02.js";import{n as v,o as b,at as d}from"./three.237d835c.js";const E=new v,l=new b,c=new v;class D{constructor(e,o){t(this,"object");t(this,"domElement");t(this,"enabled",!0);t(this,"movementSpeed",1);t(this,"lookSpeed",.005);t(this,"lookVertical",!0);t(this,"autoForward",!1);t(this,"activeLook",!0);t(this,"heightSpeed",!1);t(this,"heightCoef",1);t(this,"heightMin",0);t(this,"heightMax",1);t(this,"constrainVertical",!1);t(this,"verticalMin",0);t(this,"verticalMax",Math.PI);t(this,"mouseDragOn",!1);t(this,"autoSpeedFactor",0);t(this,"mouseX",0);t(this,"mouseY",0);t(this,"moveForward",!1);t(this,"moveBackward",!1);t(this,"moveLeft",!1);t(this,"moveRight",!1);t(this,"moveUp",!1);t(this,"moveDown",!1);t(this,"viewHalfX",0);t(this,"viewHalfY",0);t(this,"targetPosition",new v);t(this,"lat",0);t(this,"lon",0);t(this,"_onMouseMove",this.onMouseMove.bind(this));t(this,"_onMouseDown",this.onMouseDown.bind(this));t(this,"_onMouseUp",this.onMouseUp.bind(this));t(this,"_onKeyDown",this.onKeyDown.bind(this));t(this,"_onKeyUp",this.onKeyUp.bind(this));t(this,"contextmenu",function(e){e.preventDefault()});o===void 0&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),o=document.body),this.object=e,this.domElement=o,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("mousemove",this._onMouseMove),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("mouseup",this._onMouseUp),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.handleResize(),this.setOrientation()}setCamera(e){this.object=e}setDom(e){this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("mousemove",this._onMouseMove),this.domElement.removeEventListener("mouseup",this._onMouseUp),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("mousemove",this._onMouseMove),this.domElement.addEventListener("mouseup",this._onMouseUp)}setSize(e,o){this.handleResize()}setOrientation(){const e=this.object.quaternion;E.set(0,0,-1).applyQuaternion(e),l.setFromVector3(E),this.lat=90-d.radToDeg(l.phi),this.lon=d.radToDeg(l.theta)}handleResize(){this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2}onMouseDown(e){if(this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}onMouseUp(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}onMouseMove(e){this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY}onKeyDown(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}onKeyUp(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}lookAt(e,o,r){return e.isVector3?c.copy(e):c.set(e,o,r),this.object.lookAt(c),this.setOrientation(),this}update(e){if(this.enabled===!1)return;if(this.heightSpeed){const p=d.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(p*this.heightCoef)}else this.autoSpeedFactor=0;const o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);let r=e*this.lookSpeed;this.activeLook||(r=0);let m=1;this.constrainVertical&&(m=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*m),this.lat=Math.max(-85,Math.min(85,this.lat));let i=d.degToRad(90-this.lat);const n=d.degToRad(this.lon);this.constrainVertical&&(i=d.mapLinear(i,0,Math.PI,this.verticalMin,this.verticalMax));const a=this.object.position;this.targetPosition.setFromSphericalCoords(1,i,n).add(a),this.object.lookAt(this.targetPosition)}dispose(){this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("mousemove",this._onMouseMove),this.domElement.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}}const g="@vis-three/plugin-first-person-controls",w=f(g),A=function(s={}){let e,o,r,m;return{name:w,install(i){const n=new D(i.camera,i.dom);n.movementSpeed=s.movementSpeed||1,n.lookSpeed=s.lookSpeed||.005,n.lookVertical=s.lookVertical||!0,n.autoForward=s.autoForward||!1,n.activeLook=s.activeLook||!0,n.heightSpeed=s.heightSpeed||!1,n.heightCoef=s.heightCoef||1,n.heightMin=s.heightMin||0,n.heightMax=s.heightMax||1,i.firstPersonControls=n,e=a=>{n.setDom(a.dom)},i.addEventListener(h.SETDOM,e),o=a=>{n.setCamera(a.camera)},i.addEventListener(h.SETCAMERA,o),r=a=>{n.setSize(a.width,a.height)},i.addEventListener(h.SETSIZE,r),m=a=>{n.update(a.delta)},i.addEventListener(h.RENDER,m)},dispose(i){i.removeEventListener(h.SETDOM,e),i.removeEventListener(h.SETCAMERA,o),i.removeEventListener(h.SETSIZE,r),i.removeEventListener(h.RENDER,m)}}},S="@vis-three/strategy-first-person-render",y=f(S),x=function(){let s;return{name:y,condition:[w,L],exec(e){s=o=>{e.firstPersonControls.update(o.delta)},e.renderManager.addEventListener(u.RENDER,s)},rollback(e){e.renderManager.removeEventListener(u.RENDER,s)}}};export{A as F,x as a};
