import{q as P,E as L,G as O}from"./three.837c9bb0.js";import{s as h}from"./index.5fd0e639.js";import{e as m,f as o,a as l,h as f}from"./vis-three.middleware.es.2585b78e.js";var D=Object.defineProperty,A=(p,t,e)=>t in p?D(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e,u=(p,t,e)=>(A(p,typeof t!="symbol"?t+"":t,e),e);class d extends m{constructor(){super(...arguments),u(this,"selector",(t,e,s)=>e.isObject3D&&s.get(d)||null)}parse(t){this.parseObject3D(t)}parseAnimation({url:t,resource:e,configMap:s,resourceMap:i}){i.set(t,e);const n=o[l.LOADANIMATIONCLIP]();n.vid=f(),n.url=t,n.name=e.name,s.set(t,n)}parseColor(t){return`rgb(${Math.round(255*t.r)}, ${Math.round(255*t.g)}, ${Math.round(255*t.b)})`}attributeEnhance(t){const e={};for(const s in t)s.startsWith("_")?e[s.slice(1)]=t[s]:e[s]=t[s];return e}parseTexture({url:t,resource:e,configMap:s,resourceMap:i}){i.set(t,e);const n=o[l.LOADTEXTURE]();s.set(t,n),n.vid=f(),n.url=t,h(e,n,{type:!0,vid:!0,url:!0})}parseMaterial({url:t,resource:e,configMap:s,resourceMap:i}){if(i.set(t,e),!o[e.type]){console.warn("can not found support config in vis for this resource",e);return}const n=o[e.type]();s.set(t,n),n.vid=f(),h(this.attributeEnhance(e),n,{type:!0,vid:!0});for(const r in e)if(!!e[r]){if(e[r].isColor)n[r]=this.parseColor(e[r]);else if(r.toLocaleLowerCase().endsWith("map")&&e[r]){const a=`${t}.${r}`;this.parseTexture({url:a,resource:e[r],configMap:s,resourceMap:i}),n[r]=s.get(a).vid}}}parseGeometry({url:t,resource:e,configMap:s,resourceMap:i}){i.set(t,e),e.computeBoundingBox();const n=e.boundingBox,r=n.getCenter(new P),a=o[l.LOADGEOMETRY]();a.vid=f(),a.url=t,a.position.x=r.x/(n.max.x-n.min.x)*2,a.position.y=r.y/(n.max.y-n.min.y)*2,a.position.z=r.z/(n.max.z-n.min.z)*2,s.set(t,a)}parseSkeleton({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[l.SKELETON]();n.vid=f();const r=new WeakMap;for(const[a,c]of i.entries())c instanceof L&&r.set(c,s.get(a));for(const a of e.bones){if(!r.has(a)){console.warn("object3D parser can not fond bone in configMap",a);continue}n.bones.push(r.get(a).vid)}s.set(t,n)}parseObject3D({url:t,resource:e,configMap:s,resourceMap:i}){if(i.set(t,e),!o[e.type]){console.warn("can not found support config in middleware module for this resource",e);return}const n=o[e.type]();if(n.vid=f(),h(e,n,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0,skeleton:!0}),n.rotation.x=e.rotation.x,n.rotation.y=e.rotation.y,n.rotation.z=e.rotation.z,s.set(t,n),e.material)if(Array.isArray(e.material))n.material=[],e.material.forEach((r,a,c)=>{const v=`${t}.material.${a}`;this.parseMaterial({url:v,resource:r,configMap:s,resourceMap:i}),n.material.push(s.get(v).vid)});else{const r=`${t}.material`;this.parseMaterial({url:r,resource:e.material,configMap:s,resourceMap:i}),n.material=s.get(r).vid}if(e.geometry){const r=`${t}.geometry`;this.parseGeometry({url:r,resource:e.geometry,configMap:s,resourceMap:i}),n.geometry=s.get(r).vid}if(e.skeleton){const r=`${t}.skeleton`;this.parseSkeleton({url:r,resource:e.skeleton,configMap:s,resourceMap:i}),n.skeleton=s.get(r).vid}if(e.children&&e.children.length){const r=[];e.children.forEach((a,c)=>{a.type==="Bone"?r.unshift({index:c,object:a,type:a.type}):r.push({index:c,object:a,type:a.type})}),r.forEach(a=>{const c=`${t}.children.${a.index}`;this.parseObject3D({url:c,resource:a.object,configMap:s,resourceMap:i}),n.children.push(s.get(c).vid)})}}}class C extends d{constructor(){super()}}class g extends m{constructor(){super(),u(this,"object3DParser",new d),u(this,"selector",(t,e,s)=>e.parser&&e.animations&&e.scene&&e.scenes&&s.get(g)||null)}parse({url:t,resource:e,configMap:s,resourceMap:i}){this.object3DParser.parse({url:`${t}.scene`,resource:e.scene,configMap:s,resourceMap:i}),e.animations.forEach((n,r)=>{this.object3DParser.parseAnimation({url:`${t}.animations.${r}`,resource:n,configMap:s,resourceMap:i})})}}class y extends m{constructor(){super(...arguments),u(this,"selector",(t,e,s)=>e instanceof HTMLCanvasElement&&s.get(y)||null)}parse({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[l.CANVASTEXTURE]();n.url=t,i.set(t,e),s.set(t,n)}}class E extends m{constructor(){super(...arguments),u(this,"selector",(t,e,s)=>e instanceof HTMLImageElement&&s.get(E)||null)}parse({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[l.IMAGETEXTURE]();n.url=t,i.set(t,e),s.set(t,n)}}class x extends m{constructor(){super(...arguments),u(this,"selector",(t,e,s)=>e instanceof HTMLVideoElement&&s.get(x)||null)}parse({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[l.VIDEOTEXTURE]();n.url=t,i.set(t,e),s.set(t,n)}}class T extends m{constructor(){super(...arguments),u(this,"selector",(t,e,s)=>e instanceof O&&s.get(T)||null)}parse({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[l.LOADTEXTURE]();n.url=t,i.set(t,e),s.set(t,n)}}class b extends m{constructor(t="css3D"){super(),u(this,"type"),u(this,"selector",(e,s,i)=>s instanceof HTMLElement&&i.get(b)||null),this.type=t}parse({url:t,resource:e,configMap:s,resourceMap:i}){const n=o[this.type==="css3D"?l.CSS3DPLANE:l.CSS2DPLANE]();n.element=t,i.set(t,e),s.set(t,n)}}var S=Object.freeze(Object.defineProperty({__proto__:null,FBXResourceParser:C,GLTFResourceParser:g,HTMLCanvasElementParser:y,HTMLElementParser:b,HTMLImageElementParser:E,HTMLVideoElementParser:x,Object3DParser:d,TextureParser:T},Symbol.toStringTag,{value:"Module"}));export{g as G,y as H,b as a,S as p};
