import{g as S,t as x,a as v}from"../index.f2ecf0d4.js";import{P as T,g as p,b as g}from"../vis-three.middleware.es.03da49c0.js";import{M as _}from"../index.b26a84d4.js";import{bv as M,v as j,u as F,b as P,k as E,bJ as L,q as u,Q as O,I as z,bE as I,aj as N}from"../three.9c0f0dc6.js";import{C}from"../vis-three.convenient.es.421933a2.js";import{a as U}from"../vis-three.plugin-pointer-manager.es.d581852e.js";import"../index.1a70533e.js";import"../index.e11efb4f.js";import"../G6.7004a6d1.js";import"../Antdv.6be70e33.js";import"../index.62b980cf.js";import"../index.134e4e63.js";import"../Pass.609ff57c.js";import"../index.8d7364ed.js";import"../CSS3DRenderer.f52dbe9c.js";import"../index.45f20074.js";import"../vis-three.plugin-path-drawing.es.11103792.js";import"../index.4918a762.js";import"../index.24c0872b.js";import"../index.246dda8d.js";import"../index.e2d93a37.js";import"../vis-three.module-animation-action.es.aa5e1fca.js";import"../index.56f54492.js";import"../index.ae9b04a1.js";import"../vis-three.library-parser.es.459bfd34.js";import"../vis-three.strategy-multi-renderer.es.73c1d64a.js";var V=Object.defineProperty,R=(e,t,n)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s=(e,t,n)=>(R(e,typeof t!="symbol"?t+"":t,n),n);const B="@vis-three/plugin-path-support-controls",k=new M(new C({width:32,height:32}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,32,32),e.closePath(),e.beginPath(),e.fillStyle="rgb(0, 255, 238)",e.strokeStyle="black",e.lineWidth=1,e.arc(16,16,15,0,2*Math.PI),e.stroke(),e.fill(),e.closePath()}).getDom()),H=new M(new C({width:32,height:32}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,32,32),e.closePath(),e.beginPath(),e.fillStyle="rgb(255, 248, 0)",e.strokeStyle="black",e.lineWidth=1,e.arc(16,16,15,0,2*Math.PI),e.stroke(),e.fill(),e.closePath()}).getDom()),W=new M(new C({width:32,height:32}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,32,32),e.closePath(),e.beginPath(),e.fillStyle="rgb(255, 0, 0)",e.strokeStyle="black",e.lineWidth=1,e.moveTo(1,0),e.lineTo(31,16),e.lineTo(0,31),e.lineTo(1,0),e.stroke(),e.fill(),e.closePath()}).getDom()),y=class extends j{constructor(e,t,n,i){super(),s(this,"dragging",!1),s(this,"raycaster",new F),s(this,"anchorGizmo",new P(new E,y.anchorMaterial)),s(this,"moveGizmo",new P(new E,y.moveMaterial)),s(this,"switchGizmo",new P(new E,y.switchMaterial)),s(this,"plane",new L),s(this,"pointerManager"),s(this,"cachePlaneVector3",new u),s(this,"cacheQuaternion",new O),s(this,"cacheNormal",new u),s(this,"cachePosition",new u),s(this,"cacheVertical",0),s(this,"cacheMouseDownPoistion",new u),s(this,"cacheMouseMoveDirection",new u),s(this,"geometryIndexFunMap",{arcVertical:[],arcClockwise:[],bezierCP1:[],bezierCP2:[],quadraticCP1:[]}),s(this,"anchorArcUpdateIndexs",[]),s(this,"arcVecticalDirectionsMap",{}),s(this,"cacheConfigIndex",0),s(this,"currentGuizmo"),s(this,"currentIndex",0),s(this,"domElement"),s(this,"camera"),s(this,"config"),s(this,"object"),s(this,"_pointerHover",this.pointerHover.bind(this)),s(this,"_pointerMove",this.pointerMove.bind(this)),s(this,"_pointerDown",this.pointerDown.bind(this)),s(this,"_pointerUp",this.pointerUp.bind(this)),this.anchorGizmo.type="PathSupportControlsAnchorGizmo",this.moveGizmo.type="PathSupportControlsMoveGizmo",this.switchGizmo.type="PathSupportControlsSwitchGizmo",this.add(this.anchorGizmo,this.moveGizmo,this.switchGizmo),this.renderOrder=1/0,this.matrixAutoUpdate=!1,i&&this.setConfig(i),n&&this.setObject(n),this.setDom(t).setCamera(e).connect()}setDom(e){return this.domElement&&this.disconnect(),this.domElement=e,this.connect(),this}setCamera(e){return this.camera=e,this}setObject(e){return this.object=e,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this}setConfig(e){this.geometryIndexFunMap={arcVertical:[],arcClockwise:[],bezierCP1:[],bezierCP2:[],quadraticCP1:[]},this.arcVecticalDirectionsMap={},this.anchorArcUpdateIndexs=[],this.config=e;const t=[],n=[],i=[],r=this.geometryIndexFunMap,l=this.arcVecticalDirectionsMap;this.config.curves.forEach((o,c,h)=>{if(c===h.length-1?t.push(o.params[0],o.params[1],0,o.params[o.params.length-2],o.params[o.params.length-1],0):t.push(o.params[0],o.params[1],0),o.curve==="arc"){this.anchorArcUpdateIndexs.push(c,c+1);const a=S(...o.params);i.push(a.center.x,a.center.y,0),r.arcVertical.push(i.length/3-1),l[i.length/3-1]={segment:c,direction:new u(a.verticalDirection.x,a.verticalDirection.y,0)};const f=a.mid.clone().sub(a.start).multiplyScalar(.5),G=a.start.clone().add(f);n.push(G.x,G.y,0),r.arcClockwise.push(c)}});const d=function(o,c){const h=o.geometry;h.setAttribute("position",new N(new Float32Array(c),3)),h.getAttribute("position").needsUpdate=!0,h.computeBoundingBox(),h.computeBoundingSphere()};return d(this.anchorGizmo,t),d(this.moveGizmo,i),d(this.switchGizmo,n),this}update(){this.setConfig(this.config)}use(e){this.pointerManager=e}connect(){return this.object&&this.config&&(this.domElement.addEventListener("pointermove",this._pointerHover),this.domElement.addEventListener("mousedown",this._pointerDown)),this}disconnect(){return this.domElement.removeEventListener("pointermove",this._pointerHover),this.domElement.removeEventListener("mousedown",this._pointerDown),this}dispose(){const e=t=>{t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(n=>{n.dispose()}):t.material.dispose()};e(this.anchorGizmo),e(this.moveGizmo),e(this.switchGizmo)}intersectPoint(e){this.raycaster.setFromCamera(this.pointerManager.mouse,this.camera);const t=this.raycaster.intersectObject(this,!0);return t.length?(this.currentGuizmo=t[0].object,this.currentIndex=t[0].index,{guizmo:this.currentGuizmo,index:this.currentIndex}):null}intersectPlane(e){return this.raycaster.setFromCamera(this.pointerManager.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.cachePlaneVector3)}pointerHover(e){if(this.dragging||!this.visible)return;const t=this.intersectPoint(e);Number.isInteger(t==null?void 0:t.index)?this.domElement.style.cursor="move":this.domElement.style.cursor=""}pointerDown(e){if(!this.visible)return;if(this.cacheQuaternion.setFromRotationMatrix(this.object.matrixWorld),this.cacheNormal.set(0,0,1).applyQuaternion(this.cacheQuaternion),this.cachePosition.setFromMatrixPosition(this.object.matrixWorld),this.plane.set(this.cacheNormal,this.cachePosition.length()),this.intersectPoint(e)){if(this.dragging=!0,this.currentGuizmo===this.switchGizmo){const i=this.geometryIndexFunMap.arcClockwise[this.currentIndex],r=this.config.curves[i];this.dispatchEvent({type:"mousedown",index:i,config:this.config,last:!1,object:this.object,operate:"switch"}),r.params[3]=!r.params[3],this.dispatchEvent({type:"changing",index:i,config:this.config,last:!1,object:this.object,operate:"switch"}),this.cacheConfigIndex=i,this.domElement.addEventListener("mouseup",this._pointerUp);return}if(this.cacheMouseDownPoistion.copy(this.intersectPlane(e)).sub(this.cachePosition),this.currentGuizmo===this.moveGizmo&&this.geometryIndexFunMap.arcVertical.includes(this.currentIndex)){const i=this.arcVecticalDirectionsMap[this.currentIndex];this.cacheVertical=this.config.curves[i.segment].params[2],this.dispatchEvent({type:"mousedown",index:i.segment,config:this.config,last:!1,object:this.object,operate:"move"}),this.cacheConfigIndex=i.segment}const n=this.currentIndex===this.config.curves.length?this.currentIndex-1:this.currentIndex;this.dispatchEvent({type:"mousedown",index:n,config:this.config,last:this.currentIndex===this.config.curves.length,object:this.object,operate:"anchor"}),this.cacheConfigIndex=n,this.domElement.addEventListener("mousemove",this._pointerMove),this.domElement.addEventListener("mouseup",this._pointerUp)}}pointerMove(e){if(!this.visible&&!this.dragging)return;const t=this.intersectPlane(e);if(!t)return;t.sub(this.cachePosition),this.cacheMouseMoveDirection.copy(t).sub(this.cacheMouseDownPoistion).normalize();const n=this.currentGuizmo,i=this.currentIndex,r=this.config,l=this.cacheConfigIndex,d=this.geometryIndexFunMap;if(n===this.anchorGizmo){const o=r.curves.length;if(i!==r.curves.length){const a=r.curves[i];a.params[0]=t.x,a.params[1]=t.y}else{const a=r.curves[o-1];a.params[a.params.length-2]=t.x,a.params[a.params.length-1]=t.y}const c=this.anchorGizmo.geometry.getAttribute("position"),h=c.array;h[i*3]=t.x,h[i*3+1]=t.y,c.needsUpdate=!0,this.anchorArcUpdateIndexs.includes(this.currentIndex)&&this.update(),this.dispatchEvent({type:"changing",index:l,config:this.config,last:this.currentIndex===this.config.curves.length,object:this.object,operate:"anchor"})}else if(n===this.moveGizmo&&d.arcVertical.includes(i)){const o=this.arcVecticalDirectionsMap[i],c=this.cacheMouseMoveDirection.angleTo(o.direction);r.curves[o.segment].params[2]=this.cacheVertical+t.sub(this.cacheMouseDownPoistion).length()*Math.cos(c);const h=S(...r.curves[o.segment].params),a=this.moveGizmo.geometry.getAttribute("position"),f=a.array;f[i*3]=h.center.x,f[i*3+1]=h.center.y,a.needsUpdate=!0,this.dispatchEvent({type:"changing",index:o.segment,config:this.config,last:!1,object:this.object,operate:"move"})}}pointerUp(e){this.dragging=!1,this.domElement.removeEventListener("mousemove",this._pointerMove),this.domElement.removeEventListener("mouseup",this._pointerUp),this.currentGuizmo&&(this.currentGuizmo.geometry.computeBoundingSphere(),this.currentGuizmo.geometry.computeBoundingBox()),this.dispatchEvent({type:"mouseup",index:this.cacheConfigIndex,config:this.config,last:this.currentIndex===this.config.curves.length,object:this.object,operate:this.currentGuizmo===this.anchorGizmo?"anchor":this.currentGuizmo===this.moveGizmo?"move":"switch"})}};let w=y;s(w,"anchorMaterial",new z({map:k,transparent:!0,depthFunc:I,alphaTest:.01,sizeAttenuation:!1,size:15}));s(w,"moveMaterial",new z({map:H,transparent:!0,depthFunc:I,alphaTest:.01,sizeAttenuation:!1,size:15}));s(w,"switchMaterial",new z({map:W,transparent:!0,depthFunc:I,alphaTest:.01,sizeAttenuation:!1,size:15}));const Q=x(B),q=function(e={}){let t,n;return{name:Q,deps:[...T,U],install(i){const r=new w(i.camera,i.dom);e.raycaster&&e.raycaster.params&&Object.assign(r.raycaster.params,e.raycaster.params),r.use(i.pointerManager),i.pathSupportControls=r,n=l=>{r.setDom(l.dom)},t=l=>{r.setCamera(l.camera)},i.addEventListener(v.SETDOM,n),i.addEventListener(v.SETCAMERA,t)},dispose(i){i.removeEventListener(v.SETDOM,n),i.removeEventListener(v.SETCAMERA,t),i.pathSupportControls.disconnect().dispose(),delete i.pathSupportControls}}},m=new _().install(q()).setDom(document.getElementById("app")).setSize().play();p.injectEngine=m;const Y=p(g.ORTHOGRAPHICCAMERA,{far:1e3,near:0,zoom:20,position:{z:100}}),D=p("Scene");m.setSceneBySymbol(D.vid);m.setCameraBySymbol(Y.vid);p.injectScene=!0;window.scene=D;const b=p(g.PATH,{autoClose:!1,curves:[{curve:"line",params:[0,0,10,10]},{curve:"line",params:[10,10,10,0]},{curve:"line",params:[10,0,-10,-10]},{curve:"arc",params:[-10,-10,-0,!1,10,-10]},{curve:"bezier",params:[10,-10,20,-10,10,10,20,10]},{curve:"arc",params:[20,10,-0,!0,30,-10]}]});window.drawPath=b;const J=p(g.PATHGEOMETRY,{path:b.vid,space:!1}),K=p(g.LINEBASICMATERIAL,{}),A=p(g.LINE,{material:K.vid,geometry:J.vid});window.line=A;m.pathSupportControls.setObject(m.getObjectBySymbol(A.vid)).setConfig(b).connect();m.scene.add(m.pathSupportControls);window.engine=m;document.getElementById("deletePath").onclick=()=>{b.curves.splice(1,2),m.pathSupportControls.update()};
