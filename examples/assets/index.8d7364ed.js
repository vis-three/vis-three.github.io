var ve=Object.defineProperty;var Ce=(l,a,h)=>a in l?ve(l,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):l[a]=h;var o=(l,a,h)=>(Ce(l,typeof a!="symbol"?a+"":a,h),h);import{b as xe,t as z,a as p}from"./index.f2ecf0d4.js";import{C as je,a as Ie}from"./CSS3DRenderer.f52dbe9c.js";import{a as ce,b as F}from"./index.e11efb4f.js";import{q as g,r as I,T as x,h as U,Q as le,s as he,V as E,O as V}from"./three.9c0f0dc6.js";const ke="@vis-three/plugin-orbit-controls";class Ye extends xe{constructor(h,d){super();o(this,"object");o(this,"domElement");o(this,"enabled",!0);o(this,"target",new g);o(this,"minDistance",0);o(this,"maxDistance",1/0);o(this,"minZoom",0);o(this,"maxZoom",1/0);o(this,"minPolarAngle",0);o(this,"maxPolarAngle",Math.PI);o(this,"minAzimuthAngle",-1/0);o(this,"maxAzimuthAngle",1/0);o(this,"enableDamping",!1);o(this,"dampingFactor",.05);o(this,"enableZoom",!0);o(this,"zoomSpeed",1);o(this,"enableRotate",!0);o(this,"rotateSpeed",1);o(this,"enablePan",!0);o(this,"panSpeed",1);o(this,"screenSpacePanning",!0);o(this,"keyPanSpeed",7);o(this,"autoRotate",!1);o(this,"autoRotateSpeed",2);o(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});o(this,"mouseButtons",{LEFT:null,MIDDLE:I.DOLLY,RIGHT:I.ROTATE});o(this,"touches",{ONE:x.ROTATE,TWO:x.DOLLY_PAN});o(this,"target0");o(this,"position0");o(this,"zoom0");o(this,"_domElementKeyEvents",null);o(this,"spherical");o(this,"reset");o(this,"update");o(this,"onContextMenu");o(this,"onPointerDown");o(this,"onPointerCancel");o(this,"onMouseWheel");o(this,"onPointerMove");o(this,"onPointerUp");o(this,"onKeyDown");this.object=h||new U,this.domElement=d||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const e=new g,t=new le().setFromUnitVectors(this.object.up,new g(0,1,0)),c=t.clone().invert(),m=new g,P=new le,T=2*Math.PI;return()=>{const re=this.object.position;e.copy(re).sub(this.target),e.applyQuaternion(t),r.setFromVector3(e),this.autoRotate&&s===n.NONE&&H(pe()),this.enableDamping?(r.theta+=u.theta*this.dampingFactor,r.phi+=u.phi*this.dampingFactor):(r.theta+=u.theta,r.phi+=u.phi);let f=this.minAzimuthAngle,b=this.maxAzimuthAngle;return isFinite(f)&&isFinite(b)&&(f<-Math.PI?f+=T:f>Math.PI&&(f-=T),b<-Math.PI?b+=T:b>Math.PI&&(b-=T),f<=b?r.theta=Math.max(f,Math.min(b,r.theta)):r.theta=r.theta>(f+b)/2?Math.max(f,r.theta):Math.min(b,r.theta)),r.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=D,r.radius=Math.max(this.minDistance,Math.min(this.maxDistance,r.radius)),this.enableDamping===!0?this.target.addScaledVector(S,this.dampingFactor):this.target.add(S),e.setFromSpherical(r),e.applyQuaternion(c),re.copy(this.target).add(e),this.object.lookAt(this.target),this.enableDamping===!0?(u.theta*=1-this.dampingFactor,u.phi*=1-this.dampingFactor,S.multiplyScalar(1-this.dampingFactor)):(u.set(0,0,0),S.set(0,0,0)),D=1,k||m.distanceToSquared(this.object.position)>y||8*(1-P.dot(this.object.quaternion))>y?(this.dispatchEvent({type:"change"}),m.copy(this.object.position),P.copy(this.object.quaternion),k=!1,!0):!1}})();const n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const y=1e-6,r=new he,u=new he;let D=1;const S=new g;let k=!1;const M=new E,O=new E,N=new E,L=new E,R=new E,w=new E,A=new E,v=new E,j=new E,i=[],Y={},pe=()=>2*Math.PI/60/60*this.autoRotateSpeed,_=()=>Math.pow(.95,this.zoomSpeed),H=e=>{u.theta-=e},G=e=>{u.phi-=e},W=function(){const e=new g;return function(c,m){e.setFromMatrixColumn(m,0),e.multiplyScalar(-c),S.add(e)}}(),q=(()=>{const e=new g;return(t,c)=>{this.screenSpacePanning===!0?e.setFromMatrixColumn(c,1):(e.setFromMatrixColumn(c,0),e.crossVectors(this.object.up,e)),e.multiplyScalar(t),S.add(e)}})(),C=(()=>{const e=new g;return(t,c)=>{const m=this.domElement;if(this.object instanceof U){const P=this.object.position;e.copy(P).sub(this.target);let T=e.length();T*=Math.tan(this.object.fov/2*Math.PI/180),W(2*t*T/m.clientHeight,this.object.matrix),q(2*c*T/m.clientHeight,this.object.matrix)}else this.object instanceof V?(W(t*(this.object.right-this.object.left)/this.object.zoom/m.clientWidth,this.object.matrix),q(c*(this.object.top-this.object.bottom)/this.object.zoom/m.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Z=e=>{this.object instanceof U?D/=e:this.object instanceof V?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),this.object.updateProjectionMatrix(),k=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},B=e=>{this.object instanceof U?D*=e:this.object instanceof V?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),this.object.updateProjectionMatrix(),k=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function Q(e){M.set(e.clientX,e.clientY)}function ue(e){A.set(e.clientX,e.clientY)}function $(e){L.set(e.clientX,e.clientY)}const Ee=e=>{O.set(e.clientX,e.clientY),N.subVectors(O,M).multiplyScalar(this.rotateSpeed);const t=this.domElement;H(2*Math.PI*N.x/t.clientHeight),G(2*Math.PI*N.y/t.clientHeight),M.copy(O),this.update()},fe=e=>{v.set(e.clientX,e.clientY),j.subVectors(v,A),j.y>0?Z(_()):j.y<0&&B(_()),A.copy(v),this.update()},be=e=>{R.set(e.clientX,e.clientY),w.subVectors(R,L).multiplyScalar(this.panSpeed),C(w.x,w.y),L.copy(R),this.update()},ye=e=>{e.deltaY<0?B(_()):e.deltaY>0&&Z(_()),this.update()},Pe=e=>{let t=!1;switch(e.code){case this.keys.UP:C(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:C(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:C(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:C(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())};function J(){if(i.length===1)M.set(i[0].pageX,i[0].pageY);else{const e=.5*(i[0].pageX+i[1].pageX),t=.5*(i[0].pageY+i[1].pageY);M.set(e,t)}}function ee(){if(i.length===1)L.set(i[0].pageX,i[0].pageY);else{const e=.5*(i[0].pageX+i[1].pageX),t=.5*(i[0].pageY+i[1].pageY);L.set(e,t)}}function te(){const e=i[0].pageX-i[1].pageX,t=i[0].pageY-i[1].pageY,c=Math.sqrt(e*e+t*t);A.set(0,c)}const Te=()=>{this.enableZoom&&te(),this.enablePan&&ee()},ge=()=>{this.enableZoom&&te(),this.enableRotate&&J()},ne=e=>{if(i.length==1)O.set(e.pageX,e.pageY);else{const c=K(e),m=.5*(e.pageX+c.x),P=.5*(e.pageY+c.y);O.set(m,P)}N.subVectors(O,M).multiplyScalar(this.rotateSpeed);const t=this.domElement;H(2*Math.PI*N.x/t.clientHeight),G(2*Math.PI*N.y/t.clientHeight),M.copy(O)},oe=e=>{if(i.length===1)R.set(e.pageX,e.pageY);else{const t=K(e),c=.5*(e.pageX+t.x),m=.5*(e.pageY+t.y);R.set(c,m)}w.subVectors(R,L).multiplyScalar(this.panSpeed),C(w.x,w.y),L.copy(R)},se=e=>{const t=K(e),c=e.pageX-t.x,m=e.pageY-t.y,P=Math.sqrt(c*c+m*m);v.set(0,P),j.set(0,Math.pow(v.y/A.y,this.zoomSpeed)),Z(j.y),A.copy(v)},De=e=>{this.enableZoom&&se(e),this.enablePan&&oe(e)},Me=e=>{this.enableZoom&&se(e),this.enableRotate&&ne(e)};this.onPointerDown=e=>{this.enabled!==!1&&(i.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),Ae(e),e.pointerType==="touch"?Se(e):Oe(e))};let X=!1;this.onPointerMove=e=>{this.enabled!==!1&&(X||(this.domElement.setPointerCapture(e.pointerId),X=!0),e.pointerType==="touch"?Ne(e):Le(e))},this.onPointerUp=e=>{this.enabled!==!1&&(X=!1,e.pointerType==="touch"?we():Re(),ie(e),i.length===0&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=e=>{ie(e)};const Oe=e=>{let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case I.DOLLY:if(this.enableZoom===!1)return;ue(e),s=n.DOLLY;break;case I.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;$(e),s=n.PAN}else{if(this.enableRotate===!1)return;Q(e),s=n.ROTATE}break;case I.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;Q(e),s=n.ROTATE}else{if(this.enablePan===!1)return;$(e),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&this.dispatchEvent({type:"start"})},Le=e=>{if(this.enabled!==!1)switch(s){case n.ROTATE:if(this.enableRotate===!1)return;Ee(e);break;case n.DOLLY:if(this.enableZoom===!1)return;fe(e);break;case n.PAN:if(this.enablePan===!1)return;be(e);break}},Re=e=>{this.dispatchEvent({type:"end"}),s=n.NONE};this.onMouseWheel=e=>{this.enabled===!1||this.enableZoom===!1||s!==n.NONE||(e.preventDefault(),this.dispatchEvent({type:"start"}),ye(e),this.dispatchEvent({type:"end"}))},this.onKeyDown=e=>{this.enabled===!1||this.enablePan===!1||Pe(e)};const Se=e=>{switch(ae(e),i.length){case 1:switch(this.touches.ONE){case x.ROTATE:if(this.enableRotate===!1)return;J(),s=n.TOUCH_ROTATE;break;case x.PAN:if(this.enablePan===!1)return;ee(),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(this.touches.TWO){case x.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Te(),s=n.TOUCH_DOLLY_PAN;break;case x.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;ge(),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&this.dispatchEvent({type:"start"})},Ne=e=>{switch(ae(e),s){case n.TOUCH_ROTATE:if(this.enableRotate===!1)return;ne(e),this.update();break;case n.TOUCH_PAN:if(this.enablePan===!1)return;oe(e),this.update();break;case n.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;De(e),this.update();break;case n.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Me(e),this.update();break;default:s=n.NONE}},we=e=>{this.dispatchEvent({type:"end"}),s=n.NONE};this.onContextMenu=e=>{this.enabled!==!1&&e.preventDefault()};function Ae(e){i.push(e)}const ie=e=>{delete Y[e.pointerId];for(let t=0;t<i.length;t++)if(i[t].pointerId==e.pointerId){i.splice(t,1);return}};function ae(e){let t=Y[e.pointerId];t===void 0&&(t=new E,Y[e.pointerId]=t),t.set(e.pageX,e.pageY)}function K(e){const t=e.pointerId===i[0].pointerId?i[1]:i[0];return Y[t.pointerId]}this.spherical=r,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),s=n.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(h){h.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=h}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(h){this.object=h}setDom(h){this.dispose(),this.domElement=h,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}const de=z(ke),We=function(){let l,a,h;return{name:de,install(d){const n=new Ye(d.camera,d.dom);d.orbitControls=n,l=s=>{n.setDom(s.dom)},d.addEventListener(p.SETDOM,l),a=s=>{s.options.orbitControls&&n.setCamera(s.camera)},d.addEventListener(p.SETCAMERA,a),h=()=>{n.update()},d.addEventListener(p.RENDER,h)},dispose(d){d.removeEventListener(p.SETDOM,l),d.removeEventListener(p.SETCAMERA,a),d.removeEventListener(p.RENDER,h)}}},_e="@vis-three/plugin-css3d-renderer",me=z(_e),qe=function(){let l,a,h,d;return{name:me,install(n){const s=new je;n.css3DRenderer=s;const y=s.domElement;y.classList.add("vis-css3D"),y.style.position="absolute",y.style.top="0",y.style.left="0",y.style.zIndex="1",l=r=>{r.dom.appendChild(s.domElement)},a=r=>{s.setSize(r.width,r.height)},h=r=>{r.oldScene.traverse(D=>{D instanceof Ie&&(D.element.style.display="none")})},d=()=>{s.render(n.scene,n.camera)},n.addEventListener(p.SETDOM,l),n.addEventListener(p.SETSIZE,a),n.addEventListener(p.SETSCENE,h),n.addEventListener(p.RENDER,d)},dispose(n){n.removeEventListener(p.SETDOM,l),n.removeEventListener(p.SETSIZE,a),n.removeEventListener(p.SETSCENE,h),n.removeEventListener(p.RENDER,d)}}},Ue="@vis-three/strategy-css3d-render",Fe=z(Ue),Be=function(){let l;return{name:Fe,condition:[me,ce],exec(a){l=()=>{a.css3DRenderer.render(a.scene,a.camera)},a.renderManager.addEventListener(F.RENDER,l)},rollback(a){a.renderManager.removeEventListener(F.RENDER,l)}}},ze="@vis-three/strategy-orbit-render",He=z(ze),Qe=function(){let l;return{name:He,condition:[de,ce],exec(a){l=()=>{a.orbitControls.update()},a.renderManager.addEventListener(F.RENDER,l)},rollback(a){a.renderManager.removeEventListener(F.RENDER,l)}}};export{qe as C,We as O,Be as a,Qe as b,me as c,de as d};
